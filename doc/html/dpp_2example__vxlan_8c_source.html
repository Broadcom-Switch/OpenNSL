<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/dpp/example_vxlan.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/dpp/example_vxlan.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="dpp_2example__vxlan_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2017</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> ******************************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> * \file     example_vxlan.c</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * \brief    Example code for VxLAN application</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * VXLAN is a L2 VPN technology targeted for Data-Center communication </span>
<a name="l00023"></a>00023 <span class="comment"> * between Virtual Machines (VM) assigned to the same customer(Tenant) that are </span>
<a name="l00024"></a>00024 <span class="comment"> * distributed in various racks in the Data-Center. L2VPN over IP/UDP tunnels can provide </span>
<a name="l00025"></a>00025 <span class="comment"> * E-LAN (similar to VPLS) and E-LINE (similar to VPWS) service. With VXLAN the ethernet </span>
<a name="l00026"></a>00026 <span class="comment"> * packets are encapsulated in UDP tunnels over an IP network. VXLAN uses UDP Source_Port</span>
<a name="l00027"></a>00027 <span class="comment"> * as multiplexing field for multiplexing multiple VPNs into the same UDP Tunnel.</span>
<a name="l00028"></a>00028 <span class="comment"> * E-LINE is point-to-point service without support for Multicast traffic. In E-LINE, Ethernet</span>
<a name="l00029"></a>00029 <span class="comment"> * frames are mapped into a VXLAN Tunnel based on incoming port plus packet header information. </span>
<a name="l00030"></a>00030 <span class="comment"> * At the end of Tunnel, forwarding of Ethernet frames after Tunnel decapsulation is based on </span>
<a name="l00031"></a>00031 <span class="comment"> * VXLAN-VNID and Tunnel lookup.</span>
<a name="l00032"></a>00032 <span class="comment"> *</span>
<a name="l00033"></a>00033 <span class="comment"> * In E-LAN, Ethernet frames of interest are also identified by incoming port plus packet </span>
<a name="l00034"></a>00034 <span class="comment"> * header information. Ethernet frames are switched into one or more VXLAN Tunnels based </span>
<a name="l00035"></a>00035 <span class="comment"> * on the MAC DA lookup.  At the end of  Tunnel, forwarding of Ethernet frames after Tunnel </span>
<a name="l00036"></a>00036 <span class="comment"> * decapsulation is based on the VXLAN-VNID and Tunnel lookup and frames are again forwarded </span>
<a name="l00037"></a>00037 <span class="comment"> * based on MAC-DA lookup.</span>
<a name="l00038"></a>00038 <span class="comment"> *</span>
<a name="l00039"></a>00039 <span class="comment"> * VXLAN VPN can be of type ELINE or ELAN.</span>
<a name="l00040"></a>00040 <span class="comment"> *</span>
<a name="l00041"></a>00041 <span class="comment"> * For ELAN, a VPN is similar to a VLAN, which identifies a group of physical ports to be </span>
<a name="l00042"></a>00042 <span class="comment"> * included in a broadcast domain. However, instead of physical ports, a ELAN VPN identifies </span>
<a name="l00043"></a>00043 <span class="comment"> * a group of &quot;virtual-ports&quot; to be included in a broadcast domain. In the VXLAN APIs, </span>
<a name="l00044"></a>00044 <span class="comment"> * a &quot;virtual-port&quot; is called an VXLAN port (see description below). The VPN ID is used to </span>
<a name="l00045"></a>00045 <span class="comment"> * qualify MAC DA lookups within the VPN.</span>
<a name="l00046"></a>00046 <span class="comment"> *</span>
<a name="l00047"></a>00047 <span class="comment"> * For ELINE, a VPN consists of two VXLAN ports. Packets arriving on one VXLAN port are sent </span>
<a name="l00048"></a>00048 <span class="comment"> * directly out the other VXLAN port.</span>
<a name="l00049"></a>00049 <span class="comment"> *</span>
<a name="l00050"></a>00050 <span class="comment"> * This example application creates a VxLAN segment:</span>
<a name="l00051"></a>00051 <span class="comment"> *</span>
<a name="l00052"></a>00052 <span class="comment"> *   VM1 --- Access Port --&gt; Segment (VPN) -&gt; network UDP tunnel --- VM2</span>
<a name="l00053"></a>00053 <span class="comment"> *</span>
<a name="l00054"></a>00054 <span class="comment"> * Setup configuration:</span>
<a name="l00055"></a>00055 <span class="comment"> *   The following configuration needs to provided using platform configuration file (opennsl.cfg)</span>
<a name="l00056"></a>00056 <span class="comment"> *   to run the VxLAN the application.</span>
<a name="l00057"></a>00057 <span class="comment"> *     bcm886xx_ip4_tunnel_termination_mode=0</span>
<a name="l00058"></a>00058 <span class="comment"> *     bcm886xx_l2gre_enable=0</span>
<a name="l00059"></a>00059 <span class="comment"> *     bcm886xx_vxlan_enable=1</span>
<a name="l00060"></a>00060 <span class="comment"> *     bcm886xx_ether_ip_enable=0</span>
<a name="l00061"></a>00061 <span class="comment"> *     bcm886xx_vxlan_tunnel_lookup_mode=2</span>
<a name="l00062"></a>00062 <span class="comment"> *     split_horizon_forwarding_groups_mode=1</span>
<a name="l00063"></a>00063 <span class="comment"> *</span>
<a name="l00064"></a>00064 <span class="comment"> * Testing Description:</span>
<a name="l00065"></a>00065 <span class="comment"> *   Packet from Access Port to Network Port (Packet encapsulation):</span>
<a name="l00066"></a>00066 <span class="comment"> *     A packet sent from access port with parameters: Access VLAN = 200, SMAC = VM1 MAC,</span>
<a name="l00067"></a>00067 <span class="comment"> *     DMAC = VM2 MAC will be received on networking port with VxLAN encapsulation as follows:</span>
<a name="l00068"></a>00068 <span class="comment"> *     SMAC = Switch MAC (00:0c:00:02:00:00), DMAC = Nexthop MAC (20:00:00:00:cd:1d)</span>
<a name="l00069"></a>00069 <span class="comment"> *</span>
<a name="l00070"></a>00070 <span class="comment"> *   Packet from Network Port to Access Port (Packet decapsulation):</span>
<a name="l00071"></a>00071 <span class="comment"> *     A packet sent from network port with parameters: Tunnel VLAN = 20, SMAC = Router MAC</span>
<a name="l00072"></a>00072 <span class="comment">*     (20:00:00:00:cd:1d), DMAC = Switch MAC (00:0c:00:02:00:00), Destination UDP Port = 4789</span>
<a name="l00073"></a>00073 <span class="comment">       *     will be received on access port as follows:</span>
<a name="l00074"></a>00074 <span class="comment">       *     SMAC = VM2 MAC, DMAC = VM1 MAC</span>
<a name="l00075"></a>00075 <span class="comment">       *</span>
<a name="l00076"></a>00076 <span class="comment">       ******************************************************************************/</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span>
<a name="l00082"></a>00082 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#include &lt;<a class="code" href="init_8h.html">opennsl/init.h</a>&gt;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &lt;<a class="code" href="l2_8h.html">opennsl/l2.h</a>&gt;</span>
<a name="l00085"></a>00085 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2switch_8h.html">opennsl/switch.h</a>&gt;</span>
<a name="l00086"></a>00086 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00087"></a>00087 <span class="preprocessor">#include &lt;<a class="code" href="vswitch_8h.html">opennsl/vswitch.h</a>&gt;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &lt;<a class="code" href="tunnel_8h.html">opennsl/tunnel.h</a>&gt;</span>
<a name="l00089"></a>00089 <span class="preprocessor">#include &lt;<a class="code" href="multicast_8h.html">opennsl/multicast.h</a>&gt;</span>
<a name="l00090"></a>00090 <span class="preprocessor">#include &lt;<a class="code" href="vxlan_8h.html">opennsl/vxlan.h</a>&gt;</span>
<a name="l00091"></a>00091 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00092"></a>00092 
<a name="l00093"></a><a class="code" href="dpp_2example__vxlan_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00093</a> <span class="preprocessor">#define DEFAULT_UNIT  0</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a><a class="code" href="dpp_2example__vxlan_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00095</a> <span class="keywordtype">char</span> <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00096"></a>00096 <span class="stringliteral">&quot;Syntax: example_vxlan                                                 \n\r&quot;</span>
<a name="l00097"></a>00097 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00098"></a>00098 <span class="stringliteral">&quot;Paramaters: None.                                                     \n\r&quot;</span>
<a name="l00099"></a>00099 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00100"></a>00100 <span class="stringliteral">&quot;Usage Guidelines: None.                                               \n\r&quot;</span>;
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="comment">/* Global Variables */</span>
<a name="l00103"></a><a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">00103</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = 0; <span class="comment">/* To enable debug prints */</span>
<a name="l00104"></a><a class="code" href="dpp_2example__vxlan_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">00104</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a> = 0;
<a name="l00105"></a><a class="code" href="dpp_2example__vxlan_8c.html#a6501cefdf37aa8504bf40ad749d6691e">00105</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a6501cefdf37aa8504bf40ad749d6691e">outlif_to_count2</a>;
<a name="l00106"></a><a class="code" href="dpp_2example__vxlan_8c.html#af6ad039dbf5967db3b9664ea9267d81a">00106</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#af6ad039dbf5967db3b9664ea9267d81a">outlif_counting_profile</a> = <a class="code" href="group__stat.html#gad5497a8abb099bc58967e3fb393f4388" title="An indicator for a LIF to be uncounted.">OPENNSL_STAT_LIF_COUNTING_PROFILE_NONE</a>;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="comment">/* Configure vxlan port */</span>
<a name="l00109"></a><a class="code" href="structvxlan__port__add__s.html">00109</a> <span class="keyword">struct </span><a class="code" href="structvxlan__port__add__s.html">vxlan_port_add_s</a> {
<a name="l00110"></a>00110   <span class="comment">/* INPUT */</span>
<a name="l00111"></a><a class="code" href="structvxlan__port__add__s.html#a871ac564d33b78b193bba71ab8007acb">00111</a>   <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structvxlan__port__add__s.html#a871ac564d33b78b193bba71ab8007acb">vpn</a>;                   <span class="comment">/* vpn to which we add the vxlan port  */</span>
<a name="l00112"></a><a class="code" href="structvxlan__port__add__s.html#aa63b6f1c4a3906da1dd79446e2606d30">00112</a>   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> <a class="code" href="structvxlan__port__add__s.html#aa63b6f1c4a3906da1dd79446e2606d30">in_port</a>;          <span class="comment">/* network side port for learning info. */</span>
<a name="l00113"></a><a class="code" href="structvxlan__port__add__s.html#ab32e0326829e5a9ebd5437a924286e9f">00113</a>   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> <a class="code" href="structvxlan__port__add__s.html#ab32e0326829e5a9ebd5437a924286e9f">in_tunnel</a>;        <span class="comment">/* ip tunnel terminator gport */</span>
<a name="l00114"></a><a class="code" href="structvxlan__port__add__s.html#a15fadc6bc382fbd97c2b669987ce0c5e">00114</a>   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> <a class="code" href="structvxlan__port__add__s.html#a15fadc6bc382fbd97c2b669987ce0c5e">out_tunnel</a>;       <span class="comment">/* ip tunnel initiator gport */</span>
<a name="l00115"></a><a class="code" href="structvxlan__port__add__s.html#a79ce4d83e6ef740255e7a2c76c8a05ad">00115</a>   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> <a class="code" href="structvxlan__port__add__s.html#a79ce4d83e6ef740255e7a2c76c8a05ad">egress_if</a>;           <span class="comment">/* FEC entry, contains ip tunnel encapsulation information */</span>
<a name="l00116"></a><a class="code" href="structvxlan__port__add__s.html#a65c03fc2e80c752f9caa54e9e4c7eb48">00116</a>   <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structvxlan__port__add__s.html#a65c03fc2e80c752f9caa54e9e4c7eb48">flags</a>;                 <span class="comment">/* vxlan flags */</span>
<a name="l00117"></a><a class="code" href="structvxlan__port__add__s.html#a7fbbe076345119b05d4822d047be833b">00117</a>   <span class="keywordtype">int</span> <a class="code" href="structvxlan__port__add__s.html#a7fbbe076345119b05d4822d047be833b">set_egress_orientation_using_vxlan_port_add</a>;  <span class="comment">/* egress orientation can be configured:</span>
<a name="l00118"></a>00118 <span class="comment">                                                       - using the api opennsl_vxlan_port_add,</span>
<a name="l00119"></a>00119 <span class="comment">                                                       when egress_tunnel_id (ip tunnel initiator gport, contains outlif) is valid (optional).</span>
<a name="l00120"></a>00120 <span class="comment">                                                       - using the api opennsl_port_class_set, update egress orientation.</span>
<a name="l00121"></a>00121 <span class="comment">                                                       By default: enabled */</span>
<a name="l00122"></a><a class="code" href="structvxlan__port__add__s.html#a3c72b692b025ba9c797e178e6df99ec1">00122</a>   <span class="keywordtype">int</span> <a class="code" href="structvxlan__port__add__s.html#a3c72b692b025ba9c797e178e6df99ec1">network_group_id</a>;         <span class="comment">/* forwarding group for vxlan port. Used for orientation filter */</span>
<a name="l00123"></a>00123 
<a name="l00124"></a>00124   <span class="comment">/* If the FEC that is passed to vxlan port is an ECMP. We can&#39;t add directly the vxlan port to the</span>
<a name="l00125"></a>00125 <span class="comment">   * VSI flooding MC group.</span>
<a name="l00126"></a>00126 <span class="comment">   * We&#39;ll add instead the tunnel initiator interface to the VSI flooding MC group */</span>
<a name="l00127"></a><a class="code" href="structvxlan__port__add__s.html#a2130b5ecac56339ed90de17750ed590e">00127</a>   <span class="keywordtype">int</span> <a class="code" href="structvxlan__port__add__s.html#a2130b5ecac56339ed90de17750ed590e">is_ecmp</a>;                  <span class="comment">/* indicate that FEC that is passed to vxlan port is an ECMP */</span>
<a name="l00128"></a><a class="code" href="structvxlan__port__add__s.html#a02f4180359f2f3f4c8bfe223e6f96775">00128</a>   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> <a class="code" href="structvxlan__port__add__s.html#a02f4180359f2f3f4c8bfe223e6f96775">out_tunnel_if</a>;       <span class="comment">/* ip tunnel initiator itf */</span>
<a name="l00129"></a>00129 
<a name="l00130"></a>00130   <span class="comment">/* OUTPUT */</span>
<a name="l00131"></a><a class="code" href="structvxlan__port__add__s.html#a2d496e06482a0c065da46ceb7fe2f9c3">00131</a>   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> <a class="code" href="structvxlan__port__add__s.html#a2d496e06482a0c065da46ceb7fe2f9c3">vxlan_port_id</a>;    <span class="comment">/* returned vxlan gport */</span>
<a name="l00132"></a>00132 };
<a name="l00133"></a>00133 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">/* Creating L3 interface */</span>
<a name="l00136"></a><a class="code" href="structcreate__l3__intf__s.html">00136</a> <span class="keyword">struct </span><a class="code" href="structcreate__l3__intf__s.html">create_l3_intf_s</a> {
<a name="l00137"></a>00137   <span class="comment">/* Input */</span>
<a name="l00138"></a><a class="code" href="structcreate__l3__intf__s.html#ade488a8984e2b1e8117977201ab85e34">00138</a>   <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structcreate__l3__intf__s.html#ade488a8984e2b1e8117977201ab85e34">flags</a>;                 <span class="comment">/* OPENNSL_L3_XXX */</span>
<a name="l00139"></a><a class="code" href="structcreate__l3__intf__s.html#ab4d364f28625040a59d2082fad36c931">00139</a>   <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structcreate__l3__intf__s.html#ab4d364f28625040a59d2082fad36c931">ingress_flags</a>;         <span class="comment">/* OPENNSL_L3_INGRESS_XXX */</span>
<a name="l00140"></a><a class="code" href="structcreate__l3__intf__s.html#ae9a43dcc685930edd966e3ba11482b4c">00140</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#ae9a43dcc685930edd966e3ba11482b4c">no_publc</a>;                 <span class="comment">/* Used to force no public, public is forced if vrf = 0 or scale feature is turned on */</span>
<a name="l00141"></a><a class="code" href="structcreate__l3__intf__s.html#a564aa639ea097d89c53b16761e2eff0b">00141</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#a564aa639ea097d89c53b16761e2eff0b">vsi</a>;
<a name="l00142"></a><a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">00142</a>   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> <a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">my_global_mac</a>;
<a name="l00143"></a><a class="code" href="structcreate__l3__intf__s.html#aa6d14a5e6193ff80e19ba88d4b7a4411">00143</a>   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> <a class="code" href="structcreate__l3__intf__s.html#aa6d14a5e6193ff80e19ba88d4b7a4411">my_lsb_mac</a>;
<a name="l00144"></a><a class="code" href="structcreate__l3__intf__s.html#aa03ed0ffb6a161dd6384575910498bd8">00144</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#aa03ed0ffb6a161dd6384575910498bd8">vrf_valid</a>;                <span class="comment">/* Do we need to set vrf */</span>
<a name="l00145"></a><a class="code" href="structcreate__l3__intf__s.html#ab55b1b00e614e76e34c14a1c1c7ea722">00145</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#ab55b1b00e614e76e34c14a1c1c7ea722">vrf</a>;
<a name="l00146"></a><a class="code" href="structcreate__l3__intf__s.html#af3fe053b8eee484b7a2f6aad865f3c48">00146</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#af3fe053b8eee484b7a2f6aad865f3c48">rpf_valid</a>;                <span class="comment">/* Do we need to set rpf */</span>
<a name="l00147"></a><a class="code" href="structcreate__l3__intf__s.html#a60229d7110ab64661717d6661996ce31">00147</a>   <a class="code" href="group__l3.html#gad1547c994e10f0c6d8dc7b4fc1e3fb35" title="L3 Ingress Interface URPF Mode setting.">opennsl_l3_ingress_urpf_mode_t</a> <a class="code" href="structcreate__l3__intf__s.html#a60229d7110ab64661717d6661996ce31">urpf_mode</a>; <span class="comment">/* avail. when OPENNSL_L3_RPF is set */</span>
<a name="l00148"></a><a class="code" href="structcreate__l3__intf__s.html#a6ab767b31e08f16ce24ee4f206498cd0">00148</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#a6ab767b31e08f16ce24ee4f206498cd0">mtu_valid</a>;
<a name="l00149"></a><a class="code" href="structcreate__l3__intf__s.html#ad003167e22301bc1bfa6cd0f8e015893">00149</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#ad003167e22301bc1bfa6cd0f8e015893">mtu</a>;
<a name="l00150"></a><a class="code" href="structcreate__l3__intf__s.html#aedf7a744442fd97a87649ffbe4daca7a">00150</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#aedf7a744442fd97a87649ffbe4daca7a">mtu_forwarding</a>;
<a name="l00151"></a><a class="code" href="structcreate__l3__intf__s.html#aaf66536a30054878e119d9acd06ec205">00151</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#aaf66536a30054878e119d9acd06ec205">qos_map_valid</a>;
<a name="l00152"></a><a class="code" href="structcreate__l3__intf__s.html#ad97ca83a2b0583f72ea9d2a2980184da">00152</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#ad97ca83a2b0583f72ea9d2a2980184da">qos_map_id</a>;
<a name="l00153"></a><a class="code" href="structcreate__l3__intf__s.html#ab7c506ae16ea0db13b6e90bb84b705ff">00153</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#ab7c506ae16ea0db13b6e90bb84b705ff">ttl_valid</a>;
<a name="l00154"></a><a class="code" href="structcreate__l3__intf__s.html#a3e799623c55add91dbaeb522fbcf90b8">00154</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#a3e799623c55add91dbaeb522fbcf90b8">ttl</a>;
<a name="l00155"></a><a class="code" href="structcreate__l3__intf__s.html#ab0b683220fb713d877f18bb91e195adb">00155</a>   <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structcreate__l3__intf__s.html#ab0b683220fb713d877f18bb91e195adb">native_routing_vlan_tags</a>;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   <span class="comment">/* Output */</span>
<a name="l00158"></a><a class="code" href="structcreate__l3__intf__s.html#a28debc3d8a4a4faeca1205474eb44191">00158</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__intf__s.html#a28debc3d8a4a4faeca1205474eb44191">rif</a>;
<a name="l00159"></a><a class="code" href="structcreate__l3__intf__s.html#a9f87e9c3b45045e3138f0078a6338b10">00159</a>   <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> <a class="code" href="structcreate__l3__intf__s.html#a9f87e9c3b45045e3138f0078a6338b10">skip_mymac</a>;             <span class="comment">/* If true, mymac will not be set. Make sure you set it elsewhere. */</span>
<a name="l00160"></a>00160 };
<a name="l00161"></a>00161 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="comment">/* Creating L3 egress */</span>
<a name="l00164"></a><a class="code" href="structcreate__l3__egress__s.html">00164</a> <span class="keyword">struct </span><a class="code" href="structcreate__l3__egress__s.html">create_l3_egress_s</a> {
<a name="l00165"></a>00165   <span class="comment">/* Input */</span>
<a name="l00166"></a><a class="code" href="structcreate__l3__egress__s.html#a0bfde0df8564a019553943094f9a2914">00166</a>   <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structcreate__l3__egress__s.html#a0bfde0df8564a019553943094f9a2914">allocation_flags</a>;      <span class="comment">/* OPENNSL_L3_XXX */</span>
<a name="l00167"></a><a class="code" href="structcreate__l3__egress__s.html#ab57fa5535985458434a0029c9a618042">00167</a>   <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structcreate__l3__egress__s.html#ab57fa5535985458434a0029c9a618042">l3_flags</a>;              <span class="comment">/* OPENNSL_L3_XXX */</span>
<a name="l00168"></a><a class="code" href="structcreate__l3__egress__s.html#aedf62eaf66e87fde30a48b47367f2095">00168</a>   <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="structcreate__l3__egress__s.html#aedf62eaf66e87fde30a48b47367f2095">l3_flags2</a>;             <span class="comment">/* OPENNSL_L3_FLAGS2_XXX */</span>
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   <span class="comment">/* ARP */</span>
<a name="l00171"></a><a class="code" href="structcreate__l3__egress__s.html#addaf76f3ca7163ad8983384027515713">00171</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__egress__s.html#addaf76f3ca7163ad8983384027515713">vlan</a>;                     <span class="comment">/* Outgoing vlan-VSI, relevant for ARP creation. In case set then SA MAC address is retreived from this VSI. */</span>
<a name="l00172"></a><a class="code" href="structcreate__l3__egress__s.html#a3b90370e27f84ad469f110c4e39eee14">00172</a>   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> <a class="code" href="structcreate__l3__egress__s.html#a3b90370e27f84ad469f110c4e39eee14">next_hop_mac_addr</a>;  <span class="comment">/* Next-hop MAC address, relevant for ARP creation */</span>
<a name="l00173"></a><a class="code" href="structcreate__l3__egress__s.html#a174365355c2c9510d497ce22014b067f">00173</a>   <span class="keywordtype">int</span> <a class="code" href="structcreate__l3__egress__s.html#a174365355c2c9510d497ce22014b067f">qos_map_id</a>;               <span class="comment">/* General QOS map id */</span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <span class="comment">/* FEC */</span>
<a name="l00176"></a><a class="code" href="structcreate__l3__egress__s.html#ae7712a901c1185126fbc99ec1c3e05fb">00176</a>   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> <a class="code" href="structcreate__l3__egress__s.html#ae7712a901c1185126fbc99ec1c3e05fb">out_tunnel_or_rif</a>;   <span class="comment">/* *Outgoing intf, can be tunnel/rif, relevant for FEC creation */</span>
<a name="l00177"></a><a class="code" href="structcreate__l3__egress__s.html#ae2aae72d826c0aebbceeab27311787db">00177</a>   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> <a class="code" href="structcreate__l3__egress__s.html#ae2aae72d826c0aebbceeab27311787db">out_gport</a>;        <span class="comment">/* *Outgoing port , relevant for FEC creation */</span>
<a name="l00178"></a>00178 
<a name="l00179"></a>00179   <span class="comment">/* Input/Output ID allocation */</span>
<a name="l00180"></a><a class="code" href="structcreate__l3__egress__s.html#a660e3c6d1170a31969e568b04dccbe7a">00180</a>   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> <a class="code" href="structcreate__l3__egress__s.html#a660e3c6d1170a31969e568b04dccbe7a">fec_id</a>;              <span class="comment">/* *FEC ID */</span>
<a name="l00181"></a><a class="code" href="structcreate__l3__egress__s.html#aa475f6c0813d25042d984bdd93eec535">00181</a>   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> <a class="code" href="structcreate__l3__egress__s.html#aa475f6c0813d25042d984bdd93eec535">arp_encap_id</a>;        <span class="comment">/* *ARP ID, may need for allocation ID or for FEC creation */</span>
<a name="l00182"></a>00182 };
<a name="l00183"></a>00183 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00184"></a>00184 
<a name="l00185"></a><a class="code" href="structvxlan__s.html">00185</a> <span class="keyword">struct </span><a class="code" href="structvxlan__s.html">vxlan_s</a> {
<a name="l00186"></a><a class="code" href="structvxlan__s.html#ad86bc71950683d29530ca040aaf545fe">00186</a>   <span class="keywordtype">int</span>          <a class="code" href="structvxlan__s.html#ad86bc71950683d29530ca040aaf545fe">vpn_id</a>;
<a name="l00187"></a><a class="code" href="structvxlan__s.html#abe6f1f9f9213a49e63de056544cb4191">00187</a>   <span class="keywordtype">int</span>          <a class="code" href="structvxlan__s.html#abe6f1f9f9213a49e63de056544cb4191">vni</a>;
<a name="l00188"></a><a class="code" href="structvxlan__s.html#ae7d8ca029ccb27c998e23699eb540e5d">00188</a>   <span class="keywordtype">int</span>          <a class="code" href="structvxlan__s.html#ae7d8ca029ccb27c998e23699eb540e5d">vxlan_vdc_enable</a>;          <span class="comment">/* Option to enable/disable VXLAN VDC support */</span>
<a name="l00189"></a><a class="code" href="structvxlan__s.html#a9b5e69181be2bfb6c9dd27d2ceb6b01a">00189</a>   <span class="keywordtype">int</span>          <a class="code" href="structvxlan__s.html#a9b5e69181be2bfb6c9dd27d2ceb6b01a">vxlan_network_group_id</a>;    <span class="comment">/* ingress and egress orientation for VXLAN */</span>
<a name="l00190"></a><a class="code" href="structvxlan__s.html#ae31c573d0a4c39166a520e58375a7cd2">00190</a>   <span class="keywordtype">int</span>          <a class="code" href="structvxlan__s.html#ae31c573d0a4c39166a520e58375a7cd2">dip_sip_vrf_using_my_vtep_index_mode</a>; <span class="comment">/* configure DIP-&gt; my-vtep-index, tunnel term: my-vtep-index, SIP, VRF and</span>
<a name="l00191"></a>00191 <span class="comment">                                                        default tunnel term: DIP, SIP, VRF */</span>
<a name="l00192"></a><a class="code" href="structvxlan__s.html#a846e717770bb1041aaf65fd877c27c05">00192</a>   <span class="keywordtype">int</span>          <a class="code" href="structvxlan__s.html#a846e717770bb1041aaf65fd877c27c05">my_vtep_index</a>;             <span class="comment">/* used in dip_sip_vrf_using_my_vtep_index_mode */</span>
<a name="l00193"></a><a class="code" href="structvxlan__s.html#aed1548bcb4778c489fee321cb8070add">00193</a>   <span class="keywordtype">int</span>          <a class="code" href="structvxlan__s.html#aed1548bcb4778c489fee321cb8070add">access_port</a>;               <span class="comment">/* access port for the script */</span>
<a name="l00194"></a><a class="code" href="structvxlan__s.html#a920ac099de8959b39b8f02076afd837f">00194</a>   <span class="keywordtype">int</span>          <a class="code" href="structvxlan__s.html#a920ac099de8959b39b8f02076afd837f">network_port</a>;              <span class="comment">/* Network port for the script */</span>
<a name="l00195"></a>00195   <span class="comment">/* HW object created by the script */</span>
<a name="l00196"></a><a class="code" href="structvxlan__s.html#a7dde8b90deec0c176991dbff88289f35">00196</a>   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a>  <a class="code" href="structvxlan__s.html#a7dde8b90deec0c176991dbff88289f35">tunnel_init_gport</a>;         <span class="comment">/* GPORT for Tunnel initiator */</span>
<a name="l00197"></a><a class="code" href="structvxlan__s.html#a5d21223d761c733751fa1f039ad77c63">00197</a>   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a>     <a class="code" href="structvxlan__s.html#a5d21223d761c733751fa1f039ad77c63">tunnel_init_intf_id</a>;      <span class="comment">/* Tunnel interface Id for vxlan Tunnel */</span>
<a name="l00198"></a><a class="code" href="structvxlan__s.html#a8bb65f9081317e27044d587510e2fed7">00198</a>   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a>     <a class="code" href="structvxlan__s.html#a8bb65f9081317e27044d587510e2fed7">vxlan_fec_intf_id</a>;         <span class="comment">/* fec for the VXLAN tunnel, set at example_vxlan */</span>
<a name="l00199"></a><a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">00199</a>   <span class="keywordtype">int</span>          <a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>;               <span class="comment">/* Flood group created for VPN */</span>
<a name="l00200"></a><a class="code" href="structvxlan__s.html#a6d8b46cddca08debd4645f38e008dab5">00200</a>   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a>  <a class="code" href="structvxlan__s.html#a6d8b46cddca08debd4645f38e008dab5">tunnel_term_gport</a>;         <span class="comment">/* GPORT for tunnel terminator */</span>
<a name="l00201"></a><a class="code" href="structvxlan__s.html#abb2535de38a9772d1086c307e988d1da">00201</a>   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a>     <a class="code" href="structvxlan__s.html#abb2535de38a9772d1086c307e988d1da">prov_vlan_l3_intf_id</a>;      <span class="comment">/* L3 interface on provider vlan */</span>
<a name="l00202"></a><a class="code" href="structvxlan__s.html#a216de94dfb7c6b4dee49c39ac0d075d5">00202</a>   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a>  <a class="code" href="structvxlan__s.html#a216de94dfb7c6b4dee49c39ac0d075d5">vlan_inLif</a>;                <span class="comment">/* InLif for the VLAN port on access port */</span>
<a name="l00203"></a><a class="code" href="structvxlan__s.html#ac0d9f56dd4557107733a1a6dcc480a0c">00203</a>   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a>  <a class="code" href="structvxlan__s.html#ac0d9f56dd4557107733a1a6dcc480a0c">vxlan_gport</a>;               <span class="comment">/* GPORT for the VXLAN */</span>
<a name="l00204"></a><a class="code" href="structvxlan__s.html#a7248861a4911aa922e37411fb4df449a">00204</a>   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>    <a class="code" href="structvxlan__s.html#a7248861a4911aa922e37411fb4df449a">user_mac_address</a>;          <span class="comment">/* UC static MAC address for inLif */</span>
<a name="l00205"></a><a class="code" href="structvxlan__s.html#ae0340b7e4b5b4b5026ab10c4aace77f4">00205</a>   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>    <a class="code" href="structvxlan__s.html#ae0340b7e4b5b4b5026ab10c4aace77f4">tunnel_mac_address</a>;        <span class="comment">/* UC static MAC address for VxLAN */</span>
<a name="l00206"></a><a class="code" href="structvxlan__s.html#af238f93ae76db66e5d353eb48d21aa14">00206</a>   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>    <a class="code" href="structvxlan__s.html#af238f93ae76db66e5d353eb48d21aa14">mc_mac</a>;                    <span class="comment">/* reserved MAC for MC traffic */</span>
<a name="l00207"></a>00207 };
<a name="l00208"></a>00208 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00209"></a>00209 
<a name="l00210"></a><a class="code" href="dpp_2example__vxlan_8c.html#a0bde41e626c41e89eb96aed08686c0bb">00210</a> <span class="keyword">struct </span><a class="code" href="structvxlan__s.html">vxlan_s</a> <a class="code" href="dpp_2example__vxlan_8c.html#a0bde41e626c41e89eb96aed08686c0bb">g_vxlan</a> = {
<a name="l00211"></a>00211   15,                 <span class="comment">/* vpn_id */</span>
<a name="l00212"></a>00212   5000,               <span class="comment">/* vni    */</span>
<a name="l00213"></a>00213   0,                  <span class="comment">/* enable vdc support */</span>
<a name="l00214"></a>00214   1,                  <span class="comment">/* vxlan orientation */</span>
<a name="l00215"></a>00215   0,                  <span class="comment">/* dip_sip_vrf_using_my_vtep_index_mode */</span>
<a name="l00216"></a>00216   0x2,                <span class="comment">/* my_vtep_index */</span>
<a name="l00217"></a>00217   0,                  <span class="comment">/* access port: Updated by script on execution */</span>
<a name="l00218"></a>00218   0,                  <span class="comment">/* network port: Updated by script on execution */</span>
<a name="l00219"></a>00219   0,0,0,0,0,0,0,0,    <span class="comment">/* Updatedd by script on execution */</span>
<a name="l00220"></a>00220   { 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0 },
<a name="l00221"></a>00221   { 0x00, 0x00, 0x00, 0x00, 0x00, 0xf1 },
<a name="l00222"></a>00222   { 0x01, 0x00, 0x5E, 0x01, 0x01, 0x14 }
<a name="l00223"></a>00223 };
<a name="l00224"></a>00224 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00225"></a>00225 
<a name="l00226"></a><a class="code" href="dpp_2example__vxlan_8c.html#a7df647d7b39028bae7fc129cbc272eb5">00226</a> <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> <a class="code" href="dpp_2example__vxlan_8c.html#a7df647d7b39028bae7fc129cbc272eb5">vdc_port_class</a> = 10;
<a name="l00227"></a><a class="code" href="dpp_2example__vxlan_8c.html#aeaa487f5205c0aac9da4e004c173429c">00227</a> <span class="preprocessor">#define MY_MAC          {0x00, 0x0c, 0x00, 0x02, 0x00, 0x00}</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span><span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00229"></a>00229 
<a name="l00230"></a><a class="code" href="structip__tunnel__s.html">00230</a> <span class="keyword">struct </span><a class="code" href="structip__tunnel__s.html">ip_tunnel_s</a> {
<a name="l00231"></a><a class="code" href="structip__tunnel__s.html#aa93c11e74eaac66b07587afdcc3a615e">00231</a>   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> <a class="code" href="structip__tunnel__s.html#aa93c11e74eaac66b07587afdcc3a615e">da</a>;                 <span class="comment">/* ip tunnel da */</span>
<a name="l00232"></a><a class="code" href="structip__tunnel__s.html#ae2419bff42cb7781a27946a896463127">00232</a>   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> <a class="code" href="structip__tunnel__s.html#ae2419bff42cb7781a27946a896463127">sa</a>;                 <span class="comment">/* ip tunnel my mac */</span>
<a name="l00233"></a><a class="code" href="structip__tunnel__s.html#a7498174a2601cd591857b8679055671e">00233</a>   <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__s.html#a7498174a2601cd591857b8679055671e">sip</a>;                      <span class="comment">/* ip tunnel sip */</span>
<a name="l00234"></a><a class="code" href="structip__tunnel__s.html#aa8f304a201c5f0e585cf0b24d7c68e30">00234</a>   <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__s.html#aa8f304a201c5f0e585cf0b24d7c68e30">sip_mask</a>;
<a name="l00235"></a><a class="code" href="structip__tunnel__s.html#a6e2cbabe1620866cc70d11725c36a9e0">00235</a>   <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__s.html#a6e2cbabe1620866cc70d11725c36a9e0">dip</a>;                      <span class="comment">/* ip tunnel dip */</span>
<a name="l00236"></a><a class="code" href="structip__tunnel__s.html#ae7430678eeddcb4e49e24240fc5480cc">00236</a>   <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__s.html#ae7430678eeddcb4e49e24240fc5480cc">dip_mask</a>;
<a name="l00237"></a><a class="code" href="structip__tunnel__s.html#ab4b8224cefab5f54172cb75e40434d85">00237</a>   <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__s.html#ab4b8224cefab5f54172cb75e40434d85">ttl</a>;                      <span class="comment">/* ip tunnel ttl */</span>
<a name="l00238"></a><a class="code" href="structip__tunnel__s.html#a340e44021e9f43b5f40cd811a06b07d8">00238</a>   <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__s.html#a340e44021e9f43b5f40cd811a06b07d8">dscp</a>;                     <span class="comment">/* ip tunnel dscp */</span>
<a name="l00239"></a><a class="code" href="structip__tunnel__s.html#a0ee0b2ddd7aa5a2014a81307792c7d15">00239</a>   <a class="code" href="group__tunnel.html#ga744c07b22929b49bf9b1258b68804b00" title="opennsl_tunnel_dscp_select_e">opennsl_tunnel_dscp_select_t</a> <a class="code" href="structip__tunnel__s.html#a0ee0b2ddd7aa5a2014a81307792c7d15">dscp_sel</a>;    <span class="comment">/* ip tunnel dscp_sel */</span>
<a name="l00240"></a><a class="code" href="structip__tunnel__s.html#aa1eb702ce743171c380383da4576f1e7">00240</a>   <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__s.html#aa1eb702ce743171c380383da4576f1e7">flags</a>;
<a name="l00241"></a>00241 };
<a name="l00242"></a>00242 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="comment">/*</span>
<a name="l00245"></a>00245 <span class="comment"> * struct include meta information.</span>
<a name="l00246"></a>00246 <span class="comment"> * where the cint logic pull data from this struct.</span>
<a name="l00247"></a>00247 <span class="comment"> * use to control differ runs of the cint, without changing the cint code</span>
<a name="l00248"></a>00248 <span class="comment"> */</span>
<a name="l00249"></a><a class="code" href="structip__tunnel__glbl__info__s.html">00249</a> <span class="keyword">struct </span><a class="code" href="structip__tunnel__glbl__info__s.html">ip_tunnel_glbl_info_s</a> {
<a name="l00250"></a><a class="code" href="structip__tunnel__glbl__info__s.html#ae369a39300829316147880f161f0a0ae">00250</a>   <a class="code" href="group__tunnel.html#gac30f3d86cc6b9c08b406825f94e729c8" title="Tunnel types.">opennsl_tunnel_type_t</a> <a class="code" href="structip__tunnel__glbl__info__s.html#ae369a39300829316147880f161f0a0ae">tunnel_type</a>;
<a name="l00251"></a><a class="code" href="structip__tunnel__glbl__info__s.html#adac12f83da3900c1e0f423c5e2a851f6">00251</a>   <span class="keyword">struct </span><a class="code" href="structip__tunnel__s.html">ip_tunnel_s</a> <a class="code" href="structip__tunnel__glbl__info__s.html#adac12f83da3900c1e0f423c5e2a851f6">ip_tunnel_info</a>;
<a name="l00252"></a><a class="code" href="structip__tunnel__glbl__info__s.html#ac06eafb784664031824be6cdda096566">00252</a>   <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__glbl__info__s.html#ac06eafb784664031824be6cdda096566">tunnel_vlan</a>;                     <span class="comment">/* vlan for ip tunnels */</span>
<a name="l00253"></a><a class="code" href="structip__tunnel__glbl__info__s.html#a64cd9f31c970420a8119bc9956c88da6">00253</a>   <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__glbl__info__s.html#a64cd9f31c970420a8119bc9956c88da6">provider_vlan</a>;
<a name="l00254"></a><a class="code" href="structip__tunnel__glbl__info__s.html#a21b5a34ff96e8fe80f8068d3790871d6">00254</a>   <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__glbl__info__s.html#a21b5a34ff96e8fe80f8068d3790871d6">access_vlan</a>;
<a name="l00255"></a>00255 };
<a name="l00256"></a>00256 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00257"></a>00257 
<a name="l00258"></a><a class="code" href="dpp_2example__vxlan_8c.html#ad2307df2ef1f52af04c1379716c8e940">00258</a> <span class="keyword">struct </span><a class="code" href="structip__tunnel__glbl__info__s.html">ip_tunnel_glbl_info_s</a> <a class="code" href="dpp_2example__vxlan_8c.html#ad2307df2ef1f52af04c1379716c8e940">ip_tunnel_glbl_info</a> = {
<a name="l00259"></a>00259   <span class="comment">/* tunnel type */</span>
<a name="l00260"></a>00260   <a class="code" href="group__tunnel.html#gga3e4190fb50ca1bcda4c884af45ca716fac1249e178f6daa961b5ae19195b4b1e1" title="VXLAN Tunnel.">opennslTunnelTypeVxlan</a>,
<a name="l00261"></a>00261   <span class="comment">/* tunnel da                         |      sa               | sip: 170.0.0.17 | mask:0  */</span>
<a name="l00262"></a>00262   {{0x20, 0x00, 0x00, 0x00, 0xcd, 0x1d}, <a class="code" href="dpp_2example__vxlan_8c.html#aeaa487f5205c0aac9da4e004c173429c">MY_MAC</a>, 0xAA000011,       0,
<a name="l00263"></a>00263     0xAB000011, 0xFFFFFFFF,    50,    11,   <a class="code" href="group__tunnel.html#ggac3e728f0dd215de5da9911325eb139d0a0558ae670e8b16fef48c2c62a474b634" title="Copy packet DSCP to outer header.">opennslTunnelDscpPacket</a>, <a class="code" href="group__tunnel.html#ga453ccc063aa3d714687554ae1ed60c68" title="Copy DF from inner header.">OPENNSL_TUNNEL_INIT_USE_INNER_DF</a>},
<a name="l00264"></a>00264   <span class="comment">/* vlan for both ip tunnels */</span>
<a name="l00265"></a>00265   20,
<a name="l00266"></a>00266   20,
<a name="l00267"></a>00267   200
<a name="l00268"></a>00268 };
<a name="l00269"></a>00269 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a152a7e2d2abdc2542fd24cb3cd10f25d" title="Create ipv4 tunnel.">example_ip_tunnel_add</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> *itf,
<a name="l00272"></a>00272     <a class="code" href="structopennsl__tunnel__initiator__s.html" title="L3 tunneling initiator.">opennsl_tunnel_initiator_t</a> * <a class="code" href="opennsl__api_8dox.html#aa5eb3d2bb92909819359b4fd24749880">tunnel</a>);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 <span class="comment">/* Utility API */</span>
<a name="l00275"></a><a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">00275</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[100] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
<a name="l00276"></a>00276 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00277"></a>00277 <span class="comment">/*****************************************************************/</span>
<a name="l00284"></a><a class="code" href="dpp_2example__vxlan_8c.html#a250f8b62242774ce141a27acb9752aaa">00284</a> <span class="keywordtype">void</span> <a class="code" href="dpp_2example__vxlan_8c.html#a250f8b62242774ce141a27acb9752aaa" title="OTP portmap for DNX device.">init_portmap</a>(<span class="keywordtype">int</span> unit)
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286   <a class="code" href="structopennsl__info__s.html" title="OPENNSL Information structure.">opennsl_info_t</a> info;
<a name="l00287"></a>00287   <span class="keywordtype">int</span> rv = <a class="code" href="group__init.html#ga64691ef7b923460206cd9abb675807c0" title="Get information about a OPENNSL unit.">opennsl_info_get</a>(unit, &amp;info);
<a name="l00288"></a>00288   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00289"></a>00289     printf(<span class="stringliteral">&quot;Error in getting the chip info, Error = %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00290"></a>00290     <span class="keywordflow">return</span>;
<a name="l00291"></a>00291   }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293   <span class="keywordflow">if</span> (<a class="code" href="examples_2util_8h.html#a131ca7039d41fc26c375479724d2f903" title="Returns true if the device is Qumran-MX device.">example_is_qmx_device</a>(unit))
<a name="l00294"></a>00294   {
<a name="l00295"></a>00295     <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[1]=13;  <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[2]=14;  <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[3]=15;  <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[4]=16;
<a name="l00296"></a>00296     <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[5]=17;  <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[6]=18;  <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[7]=19;  <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[8]=20;
<a name="l00297"></a>00297     <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[9]=21;  <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[10]=22; <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[11]=23; <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[12]=24;
<a name="l00298"></a>00298     <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[13]=25; <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[14]=26; <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[15]=27; <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[16]=28;
<a name="l00299"></a>00299     <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[17]=29; <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[18]=30; <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[19]=31; <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[20]=32;
<a name="l00300"></a>00300   }
<a name="l00301"></a>00301   <span class="keywordflow">else</span>
<a name="l00302"></a>00302   {
<a name="l00303"></a>00303     printf(<span class="stringliteral">&quot;device is not QMX\n&quot;</span>);
<a name="l00304"></a>00304     <span class="keywordtype">int</span> i;
<a name="l00305"></a>00305     <span class="keywordflow">for</span> (i=1;i&lt;50;i++)
<a name="l00306"></a>00306       <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[i]=i;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   }
<a name="l00309"></a>00309 }
<a name="l00310"></a>00310 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="comment">/*****************************************************************/</span>
<a name="l00320"></a><a class="code" href="dpp_2example__vxlan_8c.html#a687c7c8830a4913646170e0fb626abc4">00320</a> <span class="keywordtype">void</span> <a class="code" href="dpp_2example__vxlan_8c.html#a687c7c8830a4913646170e0fb626abc4" title="Utility function to print IP tunnel parameters.">example_ip_tunnel_term_print_key</a>(<span class="keywordtype">char</span> *type,
<a name="l00321"></a>00321     <a class="code" href="structopennsl__tunnel__terminator__s.html" title="L3 tunneling terminator.">opennsl_tunnel_terminator_t</a> *tunnel_term)
<a name="l00322"></a>00322 {
<a name="l00323"></a>00323   printf(<span class="stringliteral">&quot;%s  key: &quot;</span>, type);
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="keywordflow">if</span> (tunnel_term-&gt;<a class="code" href="structopennsl__tunnel__terminator__s.html#abbe9c0b5556f85bdff0962b3e6c5cd1d" title="Source IP mask.">sip_mask</a> == 0) {
<a name="l00326"></a>00326     printf(<span class="stringliteral">&quot;SIP: masked    &quot;</span>);
<a name="l00327"></a>00327   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tunnel_term-&gt;<a class="code" href="structopennsl__tunnel__terminator__s.html#abbe9c0b5556f85bdff0962b3e6c5cd1d" title="Source IP mask.">sip_mask</a> == 0xFFFFFFFF) {
<a name="l00328"></a>00328     <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot;SIP:&quot;</span>, tunnel_term-&gt;<a class="code" href="structopennsl__tunnel__terminator__s.html#a5cbcb1eaa0a16ebc96c576dfc73421b5" title="SIP for tunnel header match.">sip</a>);
<a name="l00329"></a>00329     printf(<span class="stringliteral">&quot;/0x%08x &quot;</span>, tunnel_term-&gt;<a class="code" href="structopennsl__tunnel__terminator__s.html#abbe9c0b5556f85bdff0962b3e6c5cd1d" title="Source IP mask.">sip_mask</a>);
<a name="l00330"></a>00330   }
<a name="l00331"></a>00331   <span class="keywordflow">if</span> (tunnel_term-&gt;<a class="code" href="structopennsl__tunnel__terminator__s.html#acf11a94221a666cd7581ca3404528ded" title="Destination IP mask.">dip_mask</a> == 0) {
<a name="l00332"></a>00332     printf(<span class="stringliteral">&quot;DIP: masked    &quot;</span>);
<a name="l00333"></a>00333   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tunnel_term-&gt;<a class="code" href="structopennsl__tunnel__terminator__s.html#acf11a94221a666cd7581ca3404528ded" title="Destination IP mask.">dip_mask</a> == 0xFFFFFFFF) {
<a name="l00334"></a>00334     <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot;DIP:&quot;</span>, tunnel_term-&gt;<a class="code" href="structopennsl__tunnel__terminator__s.html#a57a7d057bf79bbcfed4db60fd9236b7e" title="DIP for tunnel header match.">dip</a>);
<a name="l00335"></a>00335     printf(<span class="stringliteral">&quot;/0x%08x &quot;</span>, tunnel_term-&gt;<a class="code" href="structopennsl__tunnel__terminator__s.html#acf11a94221a666cd7581ca3404528ded" title="Destination IP mask.">dip_mask</a>);
<a name="l00336"></a>00336   }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338   printf(<span class="stringliteral">&quot;RIF: 0x%08x &quot;</span>, tunnel_term-&gt;<a class="code" href="structopennsl__tunnel__terminator__s.html#aa598195e2194e7add6b28b39d0d62b10" title="hierarchical interface.">tunnel_if</a>);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   printf(<span class="stringliteral">&quot;\n\r&quot;</span>);
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="comment">/*</span>
<a name="l00346"></a>00346 <span class="comment"> * add entry to mac table &lt;vlan,mac&gt; --&gt; port</span>
<a name="l00347"></a>00347 <span class="comment"> * &lt;VID, MAC&gt; --&gt; port</span>
<a name="l00348"></a>00348 <span class="comment"> */</span>
<a name="l00349"></a>00349 <span class="comment">/*****************************************************************/</span>
<a name="l00359"></a><a class="code" href="dpp_2example__vxlan_8c.html#a6ff8a48e7bde727289c04b10bcea2197">00359</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a6ff8a48e7bde727289c04b10bcea2197" title="To update MAC table.">example_l2_addr_add</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac,
<a name="l00360"></a>00360     <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> vid, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>)
<a name="l00361"></a>00361 {
<a name="l00362"></a>00362 
<a name="l00363"></a>00363   <span class="keywordtype">int</span> rv;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> l2addr;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   <a class="code" href="group__l2.html#ga47e819cf5939a8e643ad09505df52071" title="Initialize an L2 address structure to a specified MAC address and VLAN ID.">opennsl_l2_addr_t_init</a>(&amp;l2addr, mac, vid);
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   l2addr.<a class="code" href="structopennsl__l2__addr__s.html#a7546884120ba8ab5dce9348fd9bd819f" title="Zero-based port number.">port</a> = <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>;
<a name="l00370"></a>00370   l2addr.<a class="code" href="structopennsl__l2__addr__s.html#a4a220dea5708ef83208923402a402cb1" title="VLAN identifier.">vid</a> = vid;
<a name="l00371"></a>00371   l2addr.<a class="code" href="structopennsl__l2__addr__s.html#a3c915015c746bbad9799b9a40a51b829" title="OPENNSL_L2_xxx flags.">flags</a> = <a class="code" href="group__l2.html#ga838d2e1cee40e3ae41cd4a59599dd333">OPENNSL_L2_STATIC</a>;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   rv = <a class="code" href="group__l2.html#ga4b8920c1c3cf4c0c59bf8f0c5890f7c5" title="Add an L2 address entry to the specified device.">opennsl_l2_addr_add</a>(unit, &amp;l2addr);
<a name="l00374"></a>00374   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00375"></a>00375     printf(<span class="stringliteral">&quot;Error, Failed to add L2 entry, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00376"></a>00376     <span class="keywordflow">return</span> rv;
<a name="l00377"></a>00377   }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt; 2) {
<a name="l00380"></a>00380     printf(<span class="stringliteral">&quot;l2 entry: fid = %d &quot;</span>, vid);
<a name="l00381"></a>00381     <a class="code" href="examples_2util_8h.html#a3262fde70495cd6e0f3afd6baf9ae95c" title="To print the MAC address.">l2_print_mac</a>(<span class="stringliteral">&quot;mac =&quot;</span>, mac);
<a name="l00382"></a>00382     printf(<span class="stringliteral">&quot;  dest-port 0x%08x \n&quot;</span>, port);
<a name="l00383"></a>00383   }
<a name="l00384"></a>00384   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="comment">/*****************************************************************/</span>
<a name="l00401"></a><a class="code" href="dpp_2example__vxlan_8c.html#a7a5576d260494b0638d376d16223de74">00401</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a7a5576d260494b0638d376d16223de74" title="Adding entries to MC group.">example_add_multicast_entry</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> ipmc_index,
<a name="l00402"></a>00402     <span class="keywordtype">int</span> *<a class="code" href="opennsl__api_8dox.html#af9d2702e21ab86e9074894ba172b114d">ports</a>, <span class="keywordtype">int</span> *cud, <span class="keywordtype">int</span> nof_mc_entries, <span class="keywordtype">int</span> is_egress)
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00405"></a>00405   <span class="keywordtype">int</span> i;
<a name="l00406"></a>00406 
<a name="l00407"></a>00407   <span class="keywordflow">for</span> (i = 0; i &lt; nof_mc_entries; i++) {
<a name="l00408"></a>00408     <span class="comment">/* egress MC */</span>
<a name="l00409"></a>00409     <span class="keywordflow">if</span> (is_egress) {
<a name="l00410"></a>00410       rv = <a class="code" href="group__multicast.html#gae60ad27650b6302a5fc73df3af8efaa6" title="Add an encapsulated interface to a multicast group&#39;s replication list on a specific port...">opennsl_multicast_egress_add</a>(unit, ipmc_index, ports[i], cud[i]);
<a name="l00411"></a>00411       <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00412"></a>00412         printf(<span class="stringliteral">&quot;Failed to add egress multicast entry, port %d encap_id: %d, Error %s\n&quot;</span>, ports[i],
<a name="l00413"></a>00413             cud[i], <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00414"></a>00414         <span class="keywordflow">return</span> rv;
<a name="l00415"></a>00415       }
<a name="l00416"></a>00416     }
<a name="l00417"></a>00417     <span class="comment">/* ingress MC */</span>
<a name="l00418"></a>00418     <span class="keywordflow">else</span> {
<a name="l00419"></a>00419       rv = <a class="code" href="group__multicast.html#gafa55f761fe7a9b6026267234c3fd7057" title="Add a port to a Ingress Multicast group&#39;s replication list.">opennsl_multicast_ingress_add</a>(unit, ipmc_index, ports[i], cud[i]);
<a name="l00420"></a>00420       <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00421"></a>00421         printf(<span class="stringliteral">&quot;Error, opennsl_multicast_ingress_add: port %d encap_id: %d \n&quot;</span>,
<a name="l00422"></a>00422             ports[i], cud[i]);
<a name="l00423"></a>00423         <span class="keywordflow">return</span> rv;
<a name="l00424"></a>00424       }
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426   }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428   <span class="keywordflow">return</span> rv;
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="comment">/*****************************************************************/</span>
<a name="l00443"></a><a class="code" href="dpp_2example__vxlan_8c.html#a3e963257e80f70696214f007b5a77a6a">00443</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a3e963257e80f70696214f007b5a77a6a" title="Add gport of type vlan-port to the multicast.">example_vlan_port_add</a>( <span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> mc_group_id,
<a name="l00444"></a>00444     <span class="keywordtype">int</span> sys_port, <span class="keywordtype">int</span> gport, <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> is_egress)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446   <span class="keywordtype">int</span> encap_id;
<a name="l00447"></a>00447   <span class="keywordtype">int</span> rv;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449   rv = <a class="code" href="group__multicast.html#ga64838f4544fab1f6afb798f0ce993c07" title="Get the multicast encapsulation ID for layer 2 logical port replication.">opennsl_multicast_vlan_encap_get</a>(unit, mc_group_id, sys_port, gport, &amp;encap_id);
<a name="l00450"></a>00450   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00451"></a>00451     printf(<span class="stringliteral">&quot;Failed to get multicast encapsulation ID for Multicast group 0x%08x&quot;</span>
<a name="l00452"></a>00452         <span class="stringliteral">&quot; phy_port: 0x%08x  gport: 0x%08x, Error %s\n&quot;</span>,
<a name="l00453"></a>00453         mc_group_id, sys_port, gport, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00454"></a>00454     <span class="keywordflow">return</span> rv;
<a name="l00455"></a>00455   }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a7a5576d260494b0638d376d16223de74" title="Adding entries to MC group.">example_add_multicast_entry</a>(unit, mc_group_id, &amp;sys_port,
<a name="l00458"></a>00458       &amp;encap_id, 1, is_egress);
<a name="l00459"></a>00459   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00460"></a>00460     printf(<span class="stringliteral">&quot;Failed to add multicast entry for mc_group_id: 0x%08x &quot;</span>
<a name="l00461"></a>00461         <span class="stringliteral">&quot;phy_port: 0x%08x gport: 0x%08x, Error %s \n&quot;</span>,
<a name="l00462"></a>00462         mc_group_id, sys_port, gport, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00463"></a>00463     <span class="keywordflow">return</span> rv;
<a name="l00464"></a>00464   }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466   <span class="keywordflow">return</span> rv;
<a name="l00467"></a>00467 }
<a name="l00468"></a>00468 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00469"></a>00469 
<a name="l00470"></a>00470 <span class="comment">/*****************************************************************/</span>
<a name="l00480"></a><a class="code" href="dpp_2example__vxlan_8c.html#a420d8c462502c6c006b9382625dc1048">00480</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a420d8c462502c6c006b9382625dc1048" title="Add gport of type vlan-port to the multicast.">example_add_inLif_to_vswitch</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vsi,
<a name="l00481"></a>00481     <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> phy_port, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> gport)
<a name="l00482"></a>00482 {
<a name="l00483"></a>00483   <span class="keywordtype">int</span> rv;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485   <span class="comment">/* add to vswitch */</span>
<a name="l00486"></a>00486   rv = <a class="code" href="group__vswitch.html#ga1951ac6adec6a4a558009cd785708772" title="Add a logical port to the specified virtual switching instance.">opennsl_vswitch_port_add</a>(unit, vsi, gport);
<a name="l00487"></a>00487   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00488"></a>00488     printf(<span class="stringliteral">&quot;Failed to add a port to vswitch, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00489"></a>00489     <span class="keywordflow">return</span> rv;
<a name="l00490"></a>00490   }
<a name="l00491"></a>00491   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) {
<a name="l00492"></a>00492     printf(<span class="stringliteral">&quot;add access port 0x%08x to vswitch %d (0x%08x) \n\r&quot;</span>, gport, vsi, vsi);
<a name="l00493"></a>00493   }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495   <span class="comment">/* update Multicast to have the added port  */</span>
<a name="l00496"></a>00496   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a3e963257e80f70696214f007b5a77a6a" title="Add gport of type vlan-port to the multicast.">example_vlan_port_add</a>(unit, g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>, phy_port, gport, 0);
<a name="l00497"></a>00497   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00498"></a>00498     printf(<span class="stringliteral">&quot;Failed to add a port to multicast group, phy_port: 0x%08x &quot;</span>
<a name="l00499"></a>00499         <span class="stringliteral">&quot;gport: 0x%08x, Error %s\n&quot;</span>, phy_port, gport, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00500"></a>00500     <span class="keywordflow">return</span> rv;
<a name="l00501"></a>00501   }
<a name="l00502"></a>00502   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) {
<a name="l00503"></a>00503     printf(<span class="stringliteral">&quot;add access port 0x%08x to multicast in unit %d\n&quot;</span>, gport, unit);
<a name="l00504"></a>00504   }
<a name="l00505"></a>00505   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00506"></a>00506 }
<a name="l00507"></a>00507 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 <span class="comment">/*****************************************************************/</span>
<a name="l00519"></a><a class="code" href="dpp_2example__vxlan_8c.html#a059dcd96d8f3c160df3b353ebc06cc56">00519</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a059dcd96d8f3c160df3b353ebc06cc56" title="Remove gport of type vlan-port from the multicast group.">remove_inLif_from_vswitch</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a>  vsi,
<a name="l00520"></a>00520     <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a>  phy_port, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> vlan_port)
<a name="l00521"></a>00521 {
<a name="l00522"></a>00522   <span class="keywordtype">int</span> rv;
<a name="l00523"></a>00523   <span class="keywordtype">int</span> encap_id;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525   rv = <a class="code" href="group__multicast.html#ga64838f4544fab1f6afb798f0ce993c07" title="Get the multicast encapsulation ID for layer 2 logical port replication.">opennsl_multicast_vlan_encap_get</a>(unit, g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>, phy_port, vlan_port, &amp;encap_id);
<a name="l00526"></a>00526   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00527"></a>00527     printf(<span class="stringliteral">&quot;Failed to get encapsulation ID for mc_group_id: 0x%08x &quot;</span>
<a name="l00528"></a>00528         <span class="stringliteral">&quot;phy_port: 0x%08x vlan_port: 0x%08x, Error %s \n&quot;</span>,
<a name="l00529"></a>00529         g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>, phy_port, vlan_port, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00530"></a>00530     <span class="keywordflow">return</span> rv;
<a name="l00531"></a>00531   }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533   rv = <a class="code" href="group__multicast.html#gae92827d7cece3e754a4886ba15e3c5b4" title="Delete a port from Ingress Multicast group&#39;s replication list.">opennsl_multicast_ingress_delete</a>(unit, g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>, phy_port, encap_id);
<a name="l00534"></a>00534   <span class="keywordflow">if</span> (rv == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a90445f03d34051de0c90acfd955ef178">OPENNSL_E_NOT_FOUND</a>) {
<a name="l00535"></a>00535     printf(<span class="stringliteral">&quot;Failed to delete phy_port: 0x%08x from multicast group ID %d, Error %s\n&quot;</span>,
<a name="l00536"></a>00536         phy_port, g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00537"></a>00537     rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00538"></a>00538   }
<a name="l00539"></a>00539   printf (<span class="stringliteral">&quot;Deleted phy_port: 0x%08x, encap_id:0x%08x from multicast group with ID: 0x%08x\n&quot;</span>,
<a name="l00540"></a>00540       phy_port, encap_id, g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542 
<a name="l00543"></a>00543   <span class="comment">/* remove from vswitch */</span>
<a name="l00544"></a>00544   rv = <a class="code" href="group__vswitch.html#ga4213b61720ac1ddd547a958f2a557a66" title="Remove a logical port from the specified virtual switching instance.">opennsl_vswitch_port_delete</a>(unit, vsi, vlan_port);
<a name="l00545"></a>00545   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00546"></a>00546     printf(<span class="stringliteral">&quot;Failed to remove port 0x%08x from vsi 0x%08x, Error %s\n&quot;</span>,
<a name="l00547"></a>00547         vlan_port, vsi, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00548"></a>00548     <span class="keywordflow">return</span> rv;
<a name="l00549"></a>00549   }
<a name="l00550"></a>00550   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a>) {
<a name="l00551"></a>00551     printf(<span class="stringliteral">&quot;Removed port 0x%08x from vswitch 0x%08x\n\r&quot;</span>, vlan_port, vsi);
<a name="l00552"></a>00552   }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="comment">/*****************************************************************/</span>
<a name="l00567"></a><a class="code" href="dpp_2example__vxlan_8c.html#a335e19d71758c4b885c99c86a0cb3ea2">00567</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a335e19d71758c4b885c99c86a0cb3ea2" title="Create new VSI.">example_open_vlan_per_mc</a>(
<a name="l00568"></a>00568     <span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> vlan, <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> mc_group)
<a name="l00569"></a>00569 {
<a name="l00570"></a>00570   <span class="keywordtype">int</span> rv;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572   <span class="comment">/* The vlan in this case may also represent a vsi. in that case, it should be created with a different api */</span>
<a name="l00573"></a>00573   <span class="keywordflow">if</span> (vlan &lt;= <a class="code" href="group__types.html#ga872ed872034a93a888718d259d21c615">OPENNSL_VLAN_MAX</a>) {
<a name="l00574"></a>00574     rv = <a class="code" href="group__vlan.html#ga4db9e633ba9c276064768d1718c3062c" title="Allocate and configure a VLAN on the OPENNSL device.">opennsl_vlan_create</a>(unit, vlan);
<a name="l00575"></a>00575   } <span class="keywordflow">else</span> {
<a name="l00576"></a>00576     rv = <a class="code" href="group__vswitch.html#ga7fa63a56dcff35bd6001da0a18727e68" title="Create a Virtual Switching Instance, with a specified ID.">opennsl_vswitch_create_with_id</a>(unit, vlan);
<a name="l00577"></a>00577   }
<a name="l00578"></a>00578   <span class="keywordflow">if</span> ((rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) &amp;&amp; (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5ad03e135eecd46c9c1280e7b3f6ab5b6a">OPENNSL_E_EXISTS</a>)) {
<a name="l00579"></a>00579     printf(<span class="stringliteral">&quot;Failed to opensl vlan(%d), Error %s&quot;</span>, vlan, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00580"></a>00580     <span class="keywordflow">return</span> rv;
<a name="l00581"></a>00581   }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583   <span class="comment">/* Set VLAN with MC is not required for VXLAN, removed below calls */</span>
<a name="l00584"></a>00584   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 3) {
<a name="l00585"></a>00585     printf(<span class="stringliteral">&quot;Created vlan:%d \n&quot;</span>, vlan);
<a name="l00586"></a>00586   }
<a name="l00587"></a>00587 
<a name="l00588"></a>00588   <span class="keywordflow">return</span> rv;
<a name="l00589"></a>00589 }
<a name="l00590"></a>00590 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 <span class="comment">/*****************************************************************/</span>
<a name="l00601"></a><a class="code" href="dpp_2example__vxlan_8c.html#af5e2420d40444ad4494bf9b63c51d07c">00601</a> <span class="keywordtype">void</span> <a class="code" href="dpp_2example__vxlan_8c.html#af5e2420d40444ad4494bf9b63c51d07c" title="Open new vsi and attach it to the give mc_group.">example_add_vlan_on_port</a>(
<a name="l00602"></a>00602     <span class="keywordtype">int</span> unit,
<a name="l00603"></a>00603     <span class="keywordtype">int</span> vlan,
<a name="l00604"></a>00604     <span class="keywordtype">int</span> <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>)
<a name="l00605"></a>00605 {
<a name="l00606"></a>00606   <span class="keywordtype">int</span> rv;
<a name="l00607"></a>00607   <span class="comment">/* create vlan and add port to it */</span>
<a name="l00608"></a>00608   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a335e19d71758c4b885c99c86a0cb3ea2" title="Create new VSI.">example_open_vlan_per_mc</a>(unit, vlan, 0);
<a name="l00609"></a>00609   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00610"></a>00610     <span class="keywordflow">return</span>;
<a name="l00611"></a>00611   }
<a name="l00612"></a>00612   rv = <a class="code" href="group__vlan.html#ga56e2dc3c7cf8dd9dd7985c4980393645" title="Add a virtual or physical port to the specified VLAN.">opennsl_vlan_gport_add</a>(unit, vlan, port, 0);
<a name="l00613"></a>00613   <span class="keywordflow">if</span> ((rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) &amp;&amp; (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5ad03e135eecd46c9c1280e7b3f6ab5b6a">OPENNSL_E_EXISTS</a>)) {
<a name="l00614"></a>00614     printf(<span class="stringliteral">&quot;Failed to add port(0x%08x) to vlan %d, Error %s\n&quot;</span>,
<a name="l00615"></a>00615         port, vlan, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00616"></a>00616   }
<a name="l00617"></a>00617   printf(<span class="stringliteral">&quot;Added port %d (0x%08x) to vlan %d\n&quot;</span>, port, port, vlan);
<a name="l00618"></a>00618   <span class="keywordflow">return</span>;
<a name="l00619"></a>00619 }
<a name="l00620"></a>00620 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00621"></a>00621 
<a name="l00622"></a>00622 <span class="comment">/*****************************************************************/</span>
<a name="l00631"></a><a class="code" href="dpp_2example__vxlan_8c.html#ad74eca815fd91ca5fda606965f3468c5">00631</a> <span class="keywordtype">void</span> <a class="code" href="dpp_2example__vxlan_8c.html#ad74eca815fd91ca5fda606965f3468c5" title="Utility function to add ports to relevant VLAN&#39;s.">example_add_ports_to_vlans</a>(
<a name="l00632"></a>00632     <span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> network_port, <span class="keywordtype">int</span> access_port)
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634   <span class="comment">/*** create tunnel_vlan and add the network port  ***/</span>
<a name="l00635"></a>00635   <span class="keywordflow">if</span> (ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#ac06eafb784664031824be6cdda096566">tunnel_vlan</a> != ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#a64cd9f31c970420a8119bc9956c88da6">provider_vlan</a>) 
<a name="l00636"></a>00636   {
<a name="l00637"></a>00637     <a class="code" href="dpp_2example__vxlan_8c.html#af5e2420d40444ad4494bf9b63c51d07c" title="Open new vsi and attach it to the give mc_group.">example_add_vlan_on_port</a>(unit, ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#ac06eafb784664031824be6cdda096566">tunnel_vlan</a>, network_port);
<a name="l00638"></a>00638   }
<a name="l00639"></a>00639 
<a name="l00640"></a>00640   <span class="comment">/*** create provider_vlan and add network port to it ***/</span>
<a name="l00641"></a>00641   <a class="code" href="dpp_2example__vxlan_8c.html#af5e2420d40444ad4494bf9b63c51d07c" title="Open new vsi and attach it to the give mc_group.">example_add_vlan_on_port</a>(unit, ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#a64cd9f31c970420a8119bc9956c88da6">provider_vlan</a>, network_port);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643   <span class="comment">/*** create access_vlan and add user port to it ***/</span>
<a name="l00644"></a>00644   <a class="code" href="dpp_2example__vxlan_8c.html#af5e2420d40444ad4494bf9b63c51d07c" title="Open new vsi and attach it to the give mc_group.">example_add_vlan_on_port</a>(unit, ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#a21b5a34ff96e8fe80f8068d3790871d6">access_vlan</a>, access_port);
<a name="l00645"></a>00645 }
<a name="l00646"></a>00646 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00647"></a>00647 
<a name="l00648"></a>00648 <span class="comment">/*****************************************************************/</span>
<a name="l00657"></a><a class="code" href="dpp_2example__vxlan_8c.html#ac7704d686c6c44bb0da37824d699966d">00657</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#ac7704d686c6c44bb0da37824d699966d" title="Utility function to create multicast group.">example_multicast_group_open</a>(
<a name="l00658"></a>00658     <span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> *mc_group_id, <span class="keywordtype">int</span> extra_flags)
<a name="l00659"></a>00659 {
<a name="l00660"></a>00660   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00661"></a>00661   <span class="keywordtype">int</span> flags;
<a name="l00662"></a>00662 
<a name="l00663"></a>00663   flags = <a class="code" href="group__multicast.html#gaf2991b6d0bfbd56d66953868e6c099be">OPENNSL_MULTICAST_WITH_ID</a> | extra_flags;
<a name="l00664"></a>00664   <span class="comment">/* create ingress/egress MC */</span>
<a name="l00665"></a>00665   <span class="keywordflow">if</span> (<a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a>) {
<a name="l00666"></a>00666     flags |= <a class="code" href="group__multicast.html#ga9d5471deb377bb1324e0b77f04319250">OPENNSL_MULTICAST_EGRESS_GROUP</a>;
<a name="l00667"></a>00667   } <span class="keywordflow">else</span> {
<a name="l00668"></a>00668     flags |= <a class="code" href="group__multicast.html#gaae730f6ddddbdef6db10444bc9e5a657">OPENNSL_MULTICAST_INGRESS_GROUP</a>;
<a name="l00669"></a>00669   }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671   rv = <a class="code" href="group__multicast.html#ga9134d19d090cf0b13f883abc1edf606c" title="Create a multicast group for packet replication.">opennsl_multicast_create</a>(unit, flags, mc_group_id);
<a name="l00672"></a>00672   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00673"></a>00673     printf(<span class="stringliteral">&quot;Failed to create multicast group with ID %d, Error %s\n&quot;</span>,
<a name="l00674"></a>00674         *mc_group_id, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00675"></a>00675     <span class="keywordflow">return</span> rv;
<a name="l00676"></a>00676   }
<a name="l00677"></a>00677 
<a name="l00678"></a>00678   <span class="keywordflow">if</span> (<a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a>) {
<a name="l00679"></a>00679     printf(<span class="stringliteral">&quot;Created egress mc_group %d (0x%x) \n&quot;</span>, *mc_group_id, *mc_group_id);
<a name="l00680"></a>00680   } <span class="keywordflow">else</span> {
<a name="l00681"></a>00681     printf(<span class="stringliteral">&quot;Created ingress mc_group %d (0x%x) \n&quot;</span>, *mc_group_id, *mc_group_id);
<a name="l00682"></a>00682   }
<a name="l00683"></a>00683   <span class="comment">/* save multicast group id */</span>
<a name="l00684"></a>00684   g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a> = *mc_group_id;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686   <span class="keywordflow">return</span> rv;
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00689"></a>00689 
<a name="l00690"></a>00690 <span class="comment">/*****************************************************************/</span>
<a name="l00698"></a><a class="code" href="dpp_2example__vxlan_8c.html#a4e714391e0198579d1509fd5231af009">00698</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a4e714391e0198579d1509fd5231af009" title="Create L3 egress object for FEC and ARP entry.">example_l3_egress_create</a>(<span class="keywordtype">int</span> unit, <span class="keyword">struct</span> <a class="code" href="structcreate__l3__egress__s.html">create_l3_egress_s</a> *l3_egress)
<a name="l00699"></a>00699 {
<a name="l00700"></a>00700   <span class="keywordtype">int</span> rv;
<a name="l00701"></a>00701   <a class="code" href="structopennsl__l3__egress__s.html" title="L3 Egress Structure.">opennsl_l3_egress_t</a> l3eg;
<a name="l00702"></a>00702   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> l3egid;
<a name="l00703"></a>00703   <a class="code" href="group__l3.html#ga10b5ea766149d2bfdcd9d453939057e5" title="Initialize a opennsl_l3_egress_t structure.">opennsl_l3_egress_t_init</a>(&amp;l3eg);
<a name="l00704"></a>00704 
<a name="l00705"></a>00705   <span class="comment">/* FEC properties */</span>
<a name="l00706"></a>00706   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a495387f57bb66a0b0c38842564af10ec" title="L3 interface (source MAC, tunnel).">intf</a> = l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#ae7712a901c1185126fbc99ec1c3e05fb">out_tunnel_or_rif</a>;
<a name="l00707"></a>00707   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#af53aa7695462aa231d4ba889ad06601a" title="Port packet switched to (if !OPENNSL_L3_TGID).">port</a> = l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#ae2aae72d826c0aebbceeab27311787db">out_gport</a>;
<a name="l00708"></a>00708   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#aa2d4d9b638d36c0ead585e6c9e103f46" title="Encapsulation index.">encap_id</a> = l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#aa475f6c0813d25042d984bdd93eec535">arp_encap_id</a>;
<a name="l00709"></a>00709 
<a name="l00710"></a>00710   <span class="comment">/* ARP */</span>
<a name="l00711"></a>00711   memcpy(&amp;l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>, &amp;l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#a3b90370e27f84ad469f110c4e39eee14">next_hop_mac_addr</a>, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));
<a name="l00712"></a>00712   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a4559c3254ee6ba88106523dd8c9b4422" title="Next hop vlan id.">vlan</a> = l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#addaf76f3ca7163ad8983384027515713">vlan</a>;
<a name="l00713"></a>00713   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#ac93e3e7889729bce6e37a77b6a2bc270" title="General QOS map id.">qos_map_id</a> = l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#a174365355c2c9510d497ce22014b067f">qos_map_id</a>;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#ad2020d0ca398d03556c939201f5d1744" title="Interface flags (OPENNSL_L3_TGID, OPENNSL_L3_L2TOCPU).">flags</a> = l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#ab57fa5535985458434a0029c9a618042">l3_flags</a>;
<a name="l00716"></a>00716   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a760fcbbce602d71818278740a1ad7709" title="See OPENNSL_L3_FLAGS2_xxx flag definitions.">flags2</a> = l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#aedf62eaf66e87fde30a48b47367f2095">l3_flags2</a>;
<a name="l00717"></a>00717   l3egid = l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#a660e3c6d1170a31969e568b04dccbe7a">fec_id</a>;
<a name="l00718"></a>00718 
<a name="l00719"></a>00719   rv = <a class="code" href="group__l3.html#ga0b4c7fdba7b362a408ba712e6894ee50" title="Create an Egress forwarding object.">opennsl_l3_egress_create</a>(unit, l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#a0bfde0df8564a019553943094f9a2914">allocation_flags</a>, &amp;l3eg, &amp;l3egid);
<a name="l00720"></a>00720   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00721"></a>00721     printf(<span class="stringliteral">&quot;Failed to create egress egress object, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00722"></a>00722     <span class="keywordflow">return</span> rv;
<a name="l00723"></a>00723   }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725   l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#a660e3c6d1170a31969e568b04dccbe7a">fec_id</a> = l3egid;
<a name="l00726"></a>00726   l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#aa475f6c0813d25042d984bdd93eec535">arp_encap_id</a> = l3eg.<a class="code" href="structopennsl__l3__egress__s.html#aa2d4d9b638d36c0ead585e6c9e103f46" title="Encapsulation index.">encap_id</a>;
<a name="l00727"></a>00727 
<a name="l00728"></a>00728   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 1) {
<a name="l00729"></a>00729     printf(<span class="stringliteral">&quot;VLAN:%d created FEC-id = 0x%08x, &quot;</span>, l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a4559c3254ee6ba88106523dd8c9b4422" title="Next hop vlan id.">vlan</a>,
<a name="l00730"></a>00730         l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#a660e3c6d1170a31969e568b04dccbe7a">fec_id</a>);
<a name="l00731"></a>00731     printf(<span class="stringliteral">&quot;encap-id = 0x%08x &quot;</span>, l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#aa475f6c0813d25042d984bdd93eec535">arp_encap_id</a>);
<a name="l00732"></a>00732   }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l00735"></a>00735     printf(<span class="stringliteral">&quot;\n\toutRIF = 0x%08x out-port =%d &quot;</span>, l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#ae7712a901c1185126fbc99ec1c3e05fb">out_tunnel_or_rif</a>,
<a name="l00736"></a>00736         l3_egress-&gt;<a class="code" href="structcreate__l3__egress__s.html#ae2aae72d826c0aebbceeab27311787db">out_gport</a>);
<a name="l00737"></a>00737     printf(<span class="stringliteral">&quot;mac-address: %02x:%02x:%02x:%02x:%02x:%02x&quot;</span>,
<a name="l00738"></a>00738         l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>[0], l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>[1], l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>[2],
<a name="l00739"></a>00739         l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>[3], l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>[4], l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>[5]);
<a name="l00740"></a>00740   }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 1) {
<a name="l00743"></a>00743     printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00744"></a>00744   }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746   <span class="keywordflow">return</span> rv;
<a name="l00747"></a>00747 }
<a name="l00748"></a>00748 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 <span class="comment">/*****************************************************************/</span>
<a name="l00768"></a><a class="code" href="dpp_2example__vxlan_8c.html#a3a4da3d88b48f189c51ee4f03da1b112">00768</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a3a4da3d88b48f189c51ee4f03da1b112" title="Create Router interface.">example_l3_intf_rif_create</a>(
<a name="l00769"></a>00769     <span class="keywordtype">int</span> unit, <span class="keyword">struct</span> <a class="code" href="structcreate__l3__intf__s.html">create_l3_intf_s</a> * l3_intf)
<a name="l00770"></a>00770 {
<a name="l00771"></a>00771   <a class="code" href="structopennsl__l3__intf__s.html" title="L3 Interface Structure.">opennsl_l3_intf_t</a> l3if, l3if_old;
<a name="l00772"></a>00772   <span class="keywordtype">int</span> rv, station_id;
<a name="l00773"></a>00773   <a class="code" href="structopennsl__l2__station__s.html" title="L2 Station address info.">opennsl_l2_station_t</a> station;
<a name="l00774"></a>00774   <a class="code" href="structopennsl__l3__ingress__s.html" title="L3 Ingress Structure.">opennsl_l3_ingress_t</a> l3_ing_if;
<a name="l00775"></a>00775   <span class="keywordtype">int</span> is_urpf_mode_per_rif = 0;
<a name="l00776"></a>00776   <span class="keywordtype">int</span> enable_public = 0;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778   <span class="comment">/* Initialize a opennsl_l3_intf_t structure. */</span>
<a name="l00779"></a>00779   <a class="code" href="group__l3.html#gaa92edab97138caed29fe11f4f9b35fa7" title="Initialize a opennsl_l3_intf_t structure.">opennsl_l3_intf_t_init</a>(&amp;l3if);
<a name="l00780"></a>00780   <a class="code" href="group__l3.html#gaa92edab97138caed29fe11f4f9b35fa7" title="Initialize a opennsl_l3_intf_t structure.">opennsl_l3_intf_t_init</a>(&amp;l3if_old);
<a name="l00781"></a>00781   <a class="code" href="group__l2.html#ga237f10dccfaf6f29a0c4ccee74a3ed8e" title="Initialize L2 Station structure.">opennsl_l2_station_t_init</a>(&amp;station);
<a name="l00782"></a>00782   <a class="code" href="group__l3.html#ga326fd6c3b1e90668a46fe57d4fa5d482" title="Initialize L3 Ingress Interface object structure.">opennsl_l3_ingress_t_init</a>(&amp;l3_ing_if);
<a name="l00783"></a>00783 
<a name="l00784"></a>00784   <span class="keywordflow">if</span> (!l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a9f87e9c3b45045e3138f0078a6338b10">skip_mymac</a>) {
<a name="l00785"></a>00785     <span class="comment">/* set my-Mac global MSB */</span>
<a name="l00786"></a>00786     station.<a class="code" href="structopennsl__l2__station__s.html#a2eb42681485db17c250d2aab2481403d" title="OPENNSL_L2_STATION_xxx flags.">flags</a> = 0;
<a name="l00787"></a>00787     memcpy(station.<a class="code" href="structopennsl__l2__station__s.html#ac294283242a88ad175d25e02f621d5f5" title="Destination MAC address to match.">dst_mac</a>, l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">my_global_mac</a>, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));
<a name="l00788"></a>00788     station.<a class="code" href="structopennsl__l2__station__s.html#ad84dded12ef92f9ef708d7ba5ac5dee2" title="Ingress port mask value.">src_port_mask</a> = 0;  <span class="comment">/* port is not valid */</span>
<a name="l00789"></a>00789     station.<a class="code" href="structopennsl__l2__station__s.html#a42011f54c5fd03cd3c6bf292b14e9af5" title="VLAN mask value.">vlan_mask</a> = 0;      <span class="comment">/* vsi is not valid */</span>
<a name="l00790"></a>00790     station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[0] = 0xff; <span class="comment">/* dst_mac my-Mac MSB mask is -1 */</span>
<a name="l00791"></a>00791     station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[1] = 0xff;
<a name="l00792"></a>00792     station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[2] = 0xff;
<a name="l00793"></a>00793     station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[3] = 0xff;
<a name="l00794"></a>00794     station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[4] = 0xff;
<a name="l00795"></a>00795     station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[5] = 0xff;
<a name="l00796"></a>00796 
<a name="l00797"></a>00797     rv = <a class="code" href="group__l2.html#ga8b8c76a2dd59776079dba4e8e25b681c" title="Add an entry to L2 Station table.">opennsl_l2_station_add</a>(unit, &amp;station_id, &amp;station);
<a name="l00798"></a>00798     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00799"></a>00799       printf(<span class="stringliteral">&quot;Failed to add L2 station, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00800"></a>00800       <span class="keywordflow">return</span> rv;
<a name="l00801"></a>00801     }
<a name="l00802"></a>00802   }
<a name="l00803"></a>00803 
<a name="l00804"></a>00804   l3if.<a class="code" href="structopennsl__l3__intf__s.html#a1f4aef82705348abe8caec9a827cb5bf" title="See OPENNSL_L3_XXX flag definitions.">l3a_flags</a> = <a class="code" href="group__l3.html#gabf1c04c5421531f00540beca29a95cf5" title="ID is provided.">OPENNSL_L3_WITH_ID</a>;  <span class="comment">/* WITH-ID or without-ID does not really matter. Anyway for now RIF equal VSI */</span>
<a name="l00805"></a>00805   <span class="keywordflow">if</span> ((l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ae9a43dcc685930edd966e3ba11482b4c">no_publc</a> == 0) &amp;&amp; ( <span class="comment">/* Update the in_rif to have public searches enabled for vrf == 0 */</span>
<a name="l00806"></a>00806         (l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ab55b1b00e614e76e34c14a1c1c7ea722">vrf</a> == 0 &amp;&amp; <a class="code" href="examples_2util_8h.html#a131ca7039d41fc26c375479724d2f903" title="Returns true if the device is Qumran-MX device.">example_is_qmx_device</a>(unit)) ))
<a name="l00807"></a>00807   {
<a name="l00808"></a>00808     l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#aa03ed0ffb6a161dd6384575910498bd8">vrf_valid</a> = 1;
<a name="l00809"></a>00809     enable_public = 1;
<a name="l00810"></a>00810   }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812   l3if.<a class="code" href="structopennsl__l3__intf__s.html#acc865cc8d7ef1ed69ca9d3648ad47c07" title="VLAN ID.">l3a_vid</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a564aa639ea097d89c53b16761e2eff0b">vsi</a>;
<a name="l00813"></a>00813   l3if.<a class="code" href="structopennsl__l3__intf__s.html#afd264ddfcd5088463180739c886a68c7" title="TTL threshold.">l3a_ttl</a> = 31;            <span class="comment">/* default settings */</span>
<a name="l00814"></a>00814   <span class="keywordflow">if</span> (l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ab7c506ae16ea0db13b6e90bb84b705ff">ttl_valid</a>) {
<a name="l00815"></a>00815     l3if.<a class="code" href="structopennsl__l3__intf__s.html#afd264ddfcd5088463180739c886a68c7" title="TTL threshold.">l3a_ttl</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a3e799623c55add91dbaeb522fbcf90b8">ttl</a>;
<a name="l00816"></a>00816   }
<a name="l00817"></a>00817   l3if.<a class="code" href="structopennsl__l3__intf__s.html#a006aee03ae47f03204d59537eb568bc0" title="MTU.">l3a_mtu</a> = 1524;          <span class="comment">/* default settings */</span>
<a name="l00818"></a>00818   <span class="keywordflow">if</span> (l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a6ab767b31e08f16ce24ee4f206498cd0">mtu_valid</a>) {
<a name="l00819"></a>00819     l3if.<a class="code" href="structopennsl__l3__intf__s.html#a006aee03ae47f03204d59537eb568bc0" title="MTU.">l3a_mtu</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad003167e22301bc1bfa6cd0f8e015893">mtu</a>;
<a name="l00820"></a>00820     l3if.<a class="code" href="structopennsl__l3__intf__s.html#a3c7ba8f1b63d62a4ee772245926feeb3" title="Forwarding Layer MTU.">l3a_mtu_forwarding</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#aedf7a744442fd97a87649ffbe4daca7a">mtu_forwarding</a>;
<a name="l00821"></a>00821   }
<a name="l00822"></a>00822   l3if.<a class="code" href="structopennsl__l3__intf__s.html#a2e932bc6d690392e54386f95157b3c03" title="Set number of VLAN tags expected when interface is used for native routing.">native_routing_vlan_tags</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ab0b683220fb713d877f18bb91e195adb">native_routing_vlan_tags</a>;
<a name="l00823"></a>00823   l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a28debc3d8a4a4faeca1205474eb44191">rif</a> = l3if.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a564aa639ea097d89c53b16761e2eff0b">vsi</a>;   <span class="comment">/* In DNX Arch VSI always equal RIF */</span>
<a name="l00824"></a>00824 
<a name="l00825"></a>00825   memcpy(l3if.<a class="code" href="structopennsl__l3__intf__s.html#ace9be269a08c66e4420c4a11b1689936" title="MAC address.">l3a_mac_addr</a>, l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#aa6d14a5e6193ff80e19ba88d4b7a4411">my_lsb_mac</a>, 6);
<a name="l00826"></a>00826   memcpy(l3if.<a class="code" href="structopennsl__l3__intf__s.html#ace9be269a08c66e4420c4a11b1689936" title="MAC address.">l3a_mac_addr</a>, l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">my_global_mac</a>, 4); <span class="comment">/* ovewriting 4 MSB bytes with global MAC configuration */</span>
<a name="l00827"></a>00827 
<a name="l00828"></a>00828   l3if.<a class="code" href="structopennsl__l3__intf__s.html#a2e932bc6d690392e54386f95157b3c03" title="Set number of VLAN tags expected when interface is used for native routing.">native_routing_vlan_tags</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ab0b683220fb713d877f18bb91e195adb">native_routing_vlan_tags</a>;
<a name="l00829"></a>00829 
<a name="l00830"></a>00830   l3if_old.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a564aa639ea097d89c53b16761e2eff0b">vsi</a>;
<a name="l00831"></a>00831   rv = <a class="code" href="group__l3.html#gaecbb7ded42acdcf76aad0dd8b8a2147d" title="Given the L3 interface number, return the interface information.">opennsl_l3_intf_get</a>(unit, &amp;l3if_old);
<a name="l00832"></a>00832   <span class="keywordflow">if</span> (rv == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00833"></a>00833     <span class="comment">/* if L3 INTF already exists, replace it */</span>
<a name="l00834"></a>00834     l3if.<a class="code" href="structopennsl__l3__intf__s.html#a1f4aef82705348abe8caec9a827cb5bf" title="See OPENNSL_L3_XXX flag definitions.">l3a_flags</a> = l3if.<a class="code" href="structopennsl__l3__intf__s.html#a1f4aef82705348abe8caec9a827cb5bf" title="See OPENNSL_L3_XXX flag definitions.">l3a_flags</a> | <a class="code" href="group__l3.html#gafab4c3edb06267658bff13149a593c5f" title="Replace existing entry.">OPENNSL_L3_REPLACE</a>;
<a name="l00835"></a>00835     printf(<span class="stringliteral">&quot;intf 0x%x already exist, just replacing\n&quot;</span>,
<a name="l00836"></a>00836         l3if_old.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a>);
<a name="l00837"></a>00837   }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839   <span class="keywordflow">if</span> (l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#aaf66536a30054878e119d9acd06ec205">qos_map_valid</a>) {
<a name="l00840"></a>00840     l3if.<a class="code" href="structopennsl__l3__intf__s.html#a4aec3a26196f11a3721dbfe50d63b201" title="DSCP QoS Setting.">dscp_qos</a>.<a class="code" href="structopennsl__l3__intf__qos__s.html#aeb29828a01480e1bf6eb4502850b6878" title="QOS Map ID.">qos_map_id</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad97ca83a2b0583f72ea9d2a2980184da">qos_map_id</a>;
<a name="l00841"></a>00841   }
<a name="l00842"></a>00842 
<a name="l00843"></a>00843   rv = <a class="code" href="group__l3.html#ga9706ea196e518e48a9a7940471c7a04d" title="Create a new L3 interface.">opennsl_l3_intf_create</a>(unit, &amp;l3if);
<a name="l00844"></a>00844   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00845"></a>00845     printf(<span class="stringliteral">&quot;Failed to create L3 interface, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00846"></a>00846     <span class="keywordflow">return</span> rv;
<a name="l00847"></a>00847   }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849   <span class="keywordflow">if</span> (l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#aa03ed0ffb6a161dd6384575910498bd8">vrf_valid</a> || l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#af3fe053b8eee484b7a2f6aad865f3c48">rpf_valid</a>) {
<a name="l00850"></a>00850     l3_ing_if.<a class="code" href="structopennsl__l3__ingress__s.html#aebfa01a97a7e22d12e87977947a410c6" title="Interface flags.">flags</a> = <a class="code" href="group__l3.html#gaffe7430b00fe89bbf5d8b1445518d590" title="L3 Ingress ID is provided.">OPENNSL_L3_INGRESS_WITH_ID</a>;   <span class="comment">/* must, as we update exist RIF */</span>
<a name="l00851"></a>00851     l3_ing_if.<a class="code" href="structopennsl__l3__ingress__s.html#af0b51967b7d9f56282a37303a77e4edb" title="Virtual router id.">vrf</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ab55b1b00e614e76e34c14a1c1c7ea722">vrf</a>;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853     <span class="keywordflow">if</span> (l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#af3fe053b8eee484b7a2f6aad865f3c48">rpf_valid</a> &amp;&amp; !is_urpf_mode_per_rif) {
<a name="l00854"></a>00854       <span class="comment">/* Set uRPF global configuration */</span>
<a name="l00855"></a>00855       rv = <a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33cad9c6998e810125c80a91102963154f44" title="Port rpf mode for unicast packets.">opennslSwitchL3UrpfMode</a>, l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a60229d7110ab64661717d6661996ce31">urpf_mode</a>);
<a name="l00856"></a>00856       <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00857"></a>00857         <span class="keywordflow">return</span> rv;
<a name="l00858"></a>00858       }
<a name="l00859"></a>00859     }
<a name="l00860"></a>00860     <span class="keywordflow">if</span> (l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ade488a8984e2b1e8117977201ab85e34">flags</a> &amp; <a class="code" href="group__l3.html#ga9083b0d73e5aba69f4d44874100c29b8" title="RPF check.">OPENNSL_L3_RPF</a>) {
<a name="l00861"></a>00861       l3_ing_if.<a class="code" href="structopennsl__l3__ingress__s.html#af0e1001b674e6c7805344458e4396893" title="URPF mode setting for L3 Ingress Interface.">urpf_mode</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a60229d7110ab64661717d6661996ce31">urpf_mode</a>;
<a name="l00862"></a>00862     } <span class="keywordflow">else</span> {
<a name="l00863"></a>00863       l3_ing_if.<a class="code" href="structopennsl__l3__ingress__s.html#af0e1001b674e6c7805344458e4396893" title="URPF mode setting for L3 Ingress Interface.">urpf_mode</a> = <a class="code" href="group__l3.html#gga9ffd39434b904a446d9ad109a8eef08aa2034af75a4846d03b59e2bb7ac32f133" title="Disable unicast RPF.">opennslL3IngressUrpfDisable</a>;
<a name="l00864"></a>00864     }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866     <span class="keywordflow">if</span> ((l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ab4d364f28625040a59d2082fad36c931">ingress_flags</a> &amp; <a class="code" href="group__l3.html#ga51d5fe02d5f4160e9e856b4ffcdb5559" title="Allow Global Route on L3 Ingress Interface.">OPENNSL_L3_INGRESS_GLOBAL_ROUTE</a>)
<a name="l00867"></a>00867         || ((enable_public == 1) &amp;&amp; <a class="code" href="examples_2util_8h.html#a131ca7039d41fc26c375479724d2f903" title="Returns true if the device is Qumran-MX device.">example_is_qmx_device</a>(unit))) {
<a name="l00868"></a>00868       l3_ing_if.<a class="code" href="structopennsl__l3__ingress__s.html#aebfa01a97a7e22d12e87977947a410c6" title="Interface flags.">flags</a> |= <a class="code" href="group__l3.html#ga51d5fe02d5f4160e9e856b4ffcdb5559" title="Allow Global Route on L3 Ingress Interface.">OPENNSL_L3_INGRESS_GLOBAL_ROUTE</a>;
<a name="l00869"></a>00869     }
<a name="l00870"></a>00870     <span class="keywordflow">if</span> (l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ab4d364f28625040a59d2082fad36c931">ingress_flags</a> &amp; <a class="code" href="group__l3.html#gaf0da8b541ffe4ecec34756e14bcd84f3" title="Trust incoming DSCP on L3 Ingress.">OPENNSL_L3_INGRESS_DSCP_TRUST</a>) {
<a name="l00871"></a>00871       l3_ing_if.<a class="code" href="structopennsl__l3__ingress__s.html#aebfa01a97a7e22d12e87977947a410c6" title="Interface flags.">flags</a> |= <a class="code" href="group__l3.html#gaf0da8b541ffe4ecec34756e14bcd84f3" title="Trust incoming DSCP on L3 Ingress.">OPENNSL_L3_INGRESS_DSCP_TRUST</a>;
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874     <span class="keywordflow">if</span> (l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#aaf66536a30054878e119d9acd06ec205">qos_map_valid</a>) {
<a name="l00875"></a>00875       l3_ing_if.<a class="code" href="structopennsl__l3__ingress__s.html#a669273334b60b95cbff183a2e6550c79" title="QoS DSCP priority map.">qos_map_id</a> = l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad97ca83a2b0583f72ea9d2a2980184da">qos_map_id</a>;
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878     rv = <a class="code" href="group__l3.html#ga3687e6ad79ebc4e99820655e6b4f55b4" title="Create L3 Ingress Interface object.">opennsl_l3_ingress_create</a>(unit, &amp;l3_ing_if, &amp;l3if.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a>);
<a name="l00879"></a>00879     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00880"></a>00880       printf(<span class="stringliteral">&quot;Failed to create L3 ingress interface, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00881"></a>00881       <span class="keywordflow">return</span> rv;
<a name="l00882"></a>00882     }
<a name="l00883"></a>00883     l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a28debc3d8a4a4faeca1205474eb44191">rif</a> = l3if.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a>;
<a name="l00884"></a>00884   }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886   printf
<a name="l00887"></a>00887     (<span class="stringliteral">&quot;created ingress interface = %d, on vlan = %d in unit %d, vrf = %d, skip_mymac:%d  &quot;</span>,
<a name="l00888"></a>00888      l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a28debc3d8a4a4faeca1205474eb44191">rif</a>, l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a564aa639ea097d89c53b16761e2eff0b">vsi</a>, unit, l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ab55b1b00e614e76e34c14a1c1c7ea722">vrf</a>, l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#a9f87e9c3b45045e3138f0078a6338b10">skip_mymac</a>);
<a name="l00889"></a>00889   printf(<span class="stringliteral">&quot;mac: %02x:%02x:%02x:%02x:%02x:%02x\n\r&quot;</span>,
<a name="l00890"></a>00890       l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">my_global_mac</a>[0], l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">my_global_mac</a>[1],
<a name="l00891"></a>00891       l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">my_global_mac</a>[2], l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">my_global_mac</a>[3],
<a name="l00892"></a>00892       l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">my_global_mac</a>[4], l3_intf-&gt;<a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">my_global_mac</a>[5]);
<a name="l00893"></a>00893 
<a name="l00894"></a>00894   <span class="keywordflow">return</span> rv;
<a name="l00895"></a>00895 }
<a name="l00896"></a>00896 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00897"></a>00897 
<a name="l00898"></a>00898 <span class="comment">/*****************************************************************/</span>
<a name="l00906"></a><a class="code" href="dpp_2example__vxlan_8c.html#a025f115ed142679975518fd8ac76ca09">00906</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a025f115ed142679975518fd8ac76ca09" title="Create L3 interface on provider_vlan.">example_ip_tunnel_term_create_l3_intf</a>(
<a name="l00907"></a>00907     <span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> <a class="code" href="structip__tunnel__glbl__info__s.html#a64cd9f31c970420a8119bc9956c88da6">provider_vlan</a>)
<a name="l00908"></a>00908 {
<a name="l00909"></a>00909   <span class="keywordtype">int</span> rv;
<a name="l00910"></a>00910   <span class="comment">/* my-mac for LL termination */</span>
<a name="l00911"></a>00911   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> my_mac = <a class="code" href="dpp_2example__vxlan_8c.html#aeaa487f5205c0aac9da4e004c173429c">MY_MAC</a>;
<a name="l00912"></a>00912   <span class="keyword">struct </span><a class="code" href="structcreate__l3__intf__s.html">create_l3_intf_s</a> intf;
<a name="l00913"></a>00913 
<a name="l00914"></a>00914   memset(&amp;intf, 0, <span class="keyword">sizeof</span>(intf));
<a name="l00915"></a>00915   <span class="comment">/* packets income on this vlan with my-mac will be LL termination */</span>
<a name="l00916"></a>00916   intf.<a class="code" href="structcreate__l3__intf__s.html#a564aa639ea097d89c53b16761e2eff0b">vsi</a>           = provider_vlan;
<a name="l00917"></a>00917   memcpy(intf.<a class="code" href="structcreate__l3__intf__s.html#ad17fcf4d0b6a92d48f8f5e1f3e514a10">my_global_mac</a>, my_mac, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));
<a name="l00918"></a>00918   memcpy(intf.<a class="code" href="structcreate__l3__intf__s.html#aa6d14a5e6193ff80e19ba88d4b7a4411">my_lsb_mac</a>, my_mac, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));
<a name="l00919"></a>00919   intf.<a class="code" href="structcreate__l3__intf__s.html#ab4d364f28625040a59d2082fad36c931">ingress_flags</a> = <a class="code" href="group__l3.html#ga51d5fe02d5f4160e9e856b4ffcdb5559" title="Allow Global Route on L3 Ingress Interface.">OPENNSL_L3_INGRESS_GLOBAL_ROUTE</a>; <span class="comment">/* enable public searches */</span>
<a name="l00920"></a>00920 
<a name="l00921"></a>00921   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a3a4da3d88b48f189c51ee4f03da1b112" title="Create Router interface.">example_l3_intf_rif_create</a>(unit, &amp;intf);
<a name="l00922"></a>00922   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00923"></a>00923     printf(<span class="stringliteral">&quot;Failed to create L3 interface, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00924"></a>00924   }
<a name="l00925"></a>00925   g_vxlan.<a class="code" href="structvxlan__s.html#abb2535de38a9772d1086c307e988d1da">prov_vlan_l3_intf_id</a> = intf.<a class="code" href="structcreate__l3__intf__s.html#a28debc3d8a4a4faeca1205474eb44191">rif</a>;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927   <span class="keywordflow">return</span> rv;
<a name="l00928"></a>00928 }
<a name="l00929"></a>00929 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00930"></a>00930 
<a name="l00931"></a>00931 <span class="comment">/*****************************************************************/</span>
<a name="l00939"></a><a class="code" href="dpp_2example__vxlan_8c.html#afb4809761bfd3367c7d1ae11a28ffeaf">00939</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#afb4809761bfd3367c7d1ae11a28ffeaf" title="Create IP tunnel termination interface.">example_vxlan_tunnel_terminator_create</a>(
<a name="l00940"></a>00940     <span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> *in_tunnel_gport_p)
<a name="l00941"></a>00941 {
<a name="l00942"></a>00942   <span class="keywordtype">int</span> rv;
<a name="l00943"></a>00943   <span class="comment">/* tunnel term info: according to DIP  only */</span>
<a name="l00944"></a>00944   <a class="code" href="structopennsl__tunnel__terminator__s.html" title="L3 tunneling terminator.">opennsl_tunnel_terminator_t</a> ip_tunnel_term;
<a name="l00945"></a>00945   <span class="keyword">struct </span><a class="code" href="structip__tunnel__s.html">ip_tunnel_s</a> ip_tunnel_info = ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#adac12f83da3900c1e0f423c5e2a851f6">ip_tunnel_info</a>;
<a name="l00946"></a>00946   <span class="comment">/*** create IP tunnel terminator ***/</span>
<a name="l00947"></a>00947   <a class="code" href="group__tunnel.html#gae9a2149c3e68ae37b11739ea199f08f5" title="Initialize a opennsl_tunnel_terminator_t structure.">opennsl_tunnel_terminator_t_init</a>(&amp;ip_tunnel_term);
<a name="l00948"></a>00948   ip_tunnel_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#a57a7d057bf79bbcfed4db60fd9236b7e" title="DIP for tunnel header match.">dip</a>       = ip_tunnel_info.<a class="code" href="structip__tunnel__s.html#a7498174a2601cd591857b8679055671e">sip</a>;      <span class="comment">/* 170.0.0.17 */</span>
<a name="l00949"></a>00949   ip_tunnel_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#acf11a94221a666cd7581ca3404528ded" title="Destination IP mask.">dip_mask</a>  = 0xFFFFFFFF;
<a name="l00950"></a>00950   ip_tunnel_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#a5cbcb1eaa0a16ebc96c576dfc73421b5" title="SIP for tunnel header match.">sip</a>       = ip_tunnel_info.<a class="code" href="structip__tunnel__s.html#a6e2cbabe1620866cc70d11725c36a9e0">dip</a>;      <span class="comment">/* 171.0.0.17 */</span>
<a name="l00951"></a>00951   ip_tunnel_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#abbe9c0b5556f85bdff0962b3e6c5cd1d" title="Source IP mask.">sip_mask</a>  = 0xFFFFFFFF;
<a name="l00952"></a>00952   ip_tunnel_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#aa598195e2194e7add6b28b39d0d62b10" title="hierarchical interface.">tunnel_if</a> = -1;    <span class="comment">/* means don&#39;t overwite RIF */</span>
<a name="l00953"></a>00953   ip_tunnel_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#abcc9831103f029841cd0821ec0b0988b" title="Tunnel type.">type</a> = <a class="code" href="group__tunnel.html#gga3e4190fb50ca1bcda4c884af45ca716fac1249e178f6daa961b5ae19195b4b1e1" title="VXLAN Tunnel.">opennslTunnelTypeVxlan</a>;
<a name="l00954"></a>00954 
<a name="l00955"></a>00955   rv = <a class="code" href="group__tunnel.html#gad02c6721f4c5f60eedb8010b6e2354b3" title="Add a tunnel terminator for DIP-SIP key.">opennsl_tunnel_terminator_create</a>(unit, &amp;ip_tunnel_term);
<a name="l00956"></a>00956   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00957"></a>00957     printf(<span class="stringliteral">&quot;Failed to create tunnel terminator, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00958"></a>00958   }
<a name="l00959"></a>00959   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 1) {
<a name="l00960"></a>00960     printf(<span class="stringliteral">&quot;created tunnel terminator = 0x%08x \n&quot;</span>, ip_tunnel_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#ad41b511de63a2839f30511f2f03c5302" title="Tunnel id.">tunnel_id</a>);
<a name="l00961"></a>00961     <a class="code" href="dpp_2example__vxlan_8c.html#a687c7c8830a4913646170e0fb626abc4" title="Utility function to print IP tunnel parameters.">example_ip_tunnel_term_print_key</a>(<span class="stringliteral">&quot;created tunnel term &quot;</span>, &amp;ip_tunnel_term);
<a name="l00962"></a>00962   }
<a name="l00963"></a>00963   *in_tunnel_gport_p = ip_tunnel_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#ad41b511de63a2839f30511f2f03c5302" title="Tunnel id.">tunnel_id</a>;
<a name="l00964"></a>00964 
<a name="l00965"></a>00965   <span class="keywordflow">return</span> rv;
<a name="l00966"></a>00966 }
<a name="l00967"></a>00967 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00968"></a>00968 
<a name="l00969"></a>00969 <span class="comment">/*****************************************************************/</span>
<a name="l00978"></a><a class="code" href="dpp_2example__vxlan_8c.html#a68ddb0d0ce33c08cd1205345ace91018">00978</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a68ddb0d0ce33c08cd1205345ace91018" title="Build IP tunnel.">example_vxlan_egress_tunnel_create</a>(
<a name="l00979"></a>00979     <span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> tunnel_vlan, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> *tunnel_gportp)
<a name="l00980"></a>00980 {
<a name="l00981"></a>00981   <span class="keywordtype">int</span> rv;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983   <span class="comment">/* tunnel info */</span>
<a name="l00984"></a>00984   <a class="code" href="structopennsl__tunnel__initiator__s.html" title="L3 tunneling initiator.">opennsl_tunnel_initiator_t</a> ip_tunnel;
<a name="l00985"></a>00985   <span class="keyword">struct </span><a class="code" href="structip__tunnel__s.html">ip_tunnel_s</a> ip_tunnel_info = ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#adac12f83da3900c1e0f423c5e2a851f6">ip_tunnel_info</a>;
<a name="l00986"></a>00986   <span class="keywordtype">int</span> tunnel_itf = 0;
<a name="l00987"></a>00987 
<a name="l00988"></a>00988   <span class="comment">/*** create tunnel ***/</span>
<a name="l00989"></a>00989   <a class="code" href="group__tunnel.html#gaf47bc343029b37da6493ad1608452c49" title="Initialize a opennsl_tunnel_initiator_t structure.">opennsl_tunnel_initiator_t_init</a>(&amp;ip_tunnel);
<a name="l00990"></a>00990   ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#ae197f0e3771f255246a3b926d77d44d8" title="Tunnel header DIP (IPv4).">dip</a>       = ip_tunnel_info.<a class="code" href="structip__tunnel__s.html#a6e2cbabe1620866cc70d11725c36a9e0">dip</a>;   <span class="comment">/* default: 171.0.0.17 */</span>
<a name="l00991"></a>00991   ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#afb622ffe0e32261607929317b796b188" title="Tunnel header SIP (IPv4).">sip</a>       = ip_tunnel_info.<a class="code" href="structip__tunnel__s.html#a7498174a2601cd591857b8679055671e">sip</a>;   <span class="comment">/* default: 170.0.0.17 */</span>
<a name="l00992"></a>00992   ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#a32f65c0f4c554ce8490295d15fcd4fc2" title="Configuration flags.">flags</a>    |= ip_tunnel_info.<a class="code" href="structip__tunnel__s.html#aa1eb702ce743171c380383da4576f1e7">flags</a>;
<a name="l00993"></a>00993   ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#a8c381d8f2f316b82e1d267f0b6eea3ce" title="Tunnel header TTL.">ttl</a>       = ip_tunnel_info.<a class="code" href="structip__tunnel__s.html#ab4b8224cefab5f54172cb75e40434d85">ttl</a>;   <span class="comment">/* default: 50 */</span>
<a name="l00994"></a>00994   ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#a99d41099e966760cce3744d7390e6b5c" title="Tunnel type.">type</a>      = ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#ae369a39300829316147880f161f0a0ae">tunnel_type</a>; <span class="comment">/* default: opennslTunnelTypeIpAnyIn4 */</span>
<a name="l00995"></a>00995   ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#a1b6cdd436a45137e19bb7c1a59504b4f" title="Tunnel VLAN.">vlan</a>      = tunnel_vlan;
<a name="l00996"></a>00996   ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#a75caff92c25accc06b8bbd7aea1734e8" title="Tunnel header DSCP select.">dscp_sel</a>  = ip_tunnel_info.<a class="code" href="structip__tunnel__s.html#a0ee0b2ddd7aa5a2014a81307792c7d15">dscp_sel</a>; <span class="comment">/* default: opennslTunnelDscpAssign */</span>
<a name="l00997"></a>00997   <span class="keywordflow">if</span> (<a class="code" href="group__tunnel.html#ggac3e728f0dd215de5da9911325eb139d0a99b787675258d897c83a1e346746cec0" title="Set outer IP header DSCP to tunnel initiator DSCP value.">opennslTunnelDscpAssign</a> == ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#a75caff92c25accc06b8bbd7aea1734e8" title="Tunnel header DSCP select.">dscp_sel</a>)
<a name="l00998"></a>00998   {
<a name="l00999"></a>00999     ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#a0e9d4adb9f2174e0bd59cc3db29f6c57" title="Tunnel header DSCP value.">dscp</a>  = ip_tunnel_info.<a class="code" href="structip__tunnel__s.html#a340e44021e9f43b5f40cd811a06b07d8">dscp</a>; <span class="comment">/* default: 11 */</span>
<a name="l01000"></a>01000   }
<a name="l01001"></a>01001   ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#ac94faca2f1e1f1b1985205d0cc544437" title="Out LIF counting profile.">outlif_counting_profile</a> = <a class="code" href="dpp_2example__vxlan_8c.html#af6ad039dbf5967db3b9664ea9267d81a">outlif_counting_profile</a>;
<a name="l01002"></a>01002   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a152a7e2d2abdc2542fd24cb3cd10f25d" title="Create ipv4 tunnel.">example_ip_tunnel_add</a>(unit, &amp;tunnel_itf, &amp;ip_tunnel);
<a name="l01003"></a>01003   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01004"></a>01004     printf(<span class="stringliteral">&quot;Failed to add IP tunnel, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01005"></a>01005   }
<a name="l01006"></a>01006   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 1) {
<a name="l01007"></a>01007     printf(<span class="stringliteral">&quot;Created IP tunnel on intf : 0x%08x &quot;</span>, tunnel_itf);
<a name="l01008"></a>01008     <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot; SIP:&quot;</span>, ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#afb622ffe0e32261607929317b796b188" title="Tunnel header SIP (IPv4).">sip</a>);
<a name="l01009"></a>01009     <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot; DIP:&quot;</span>, ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#ae197f0e3771f255246a3b926d77d44d8" title="Tunnel header DIP (IPv4).">dip</a>);
<a name="l01010"></a>01010     printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01011"></a>01011   }
<a name="l01012"></a>01012   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#af6ad039dbf5967db3b9664ea9267d81a">outlif_counting_profile</a> != <a class="code" href="group__stat.html#gad5497a8abb099bc58967e3fb393f4388" title="An indicator for a LIF to be uncounted.">OPENNSL_STAT_LIF_COUNTING_PROFILE_NONE</a>) {
<a name="l01013"></a>01013     <a class="code" href="dpp_2example__vxlan_8c.html#a6501cefdf37aa8504bf40ad749d6691e">outlif_to_count2</a> = ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#ace61a09c712a58a55daaa3ffec6a9682" title="Tunnel ID.">tunnel_id</a>;
<a name="l01014"></a>01014   }
<a name="l01015"></a>01015   <span class="comment">/*** save it in global data */</span>
<a name="l01016"></a>01016   g_vxlan.<a class="code" href="structvxlan__s.html#a5d21223d761c733751fa1f039ad77c63">tunnel_init_intf_id</a> = tunnel_itf;
<a name="l01017"></a>01017 
<a name="l01018"></a>01018   <span class="comment">/* refernces to created tunnels as gport */</span>
<a name="l01019"></a>01019   *tunnel_gportp = ip_tunnel.<a class="code" href="structopennsl__tunnel__initiator__s.html#ace61a09c712a58a55daaa3ffec6a9682" title="Tunnel ID.">tunnel_id</a>;
<a name="l01020"></a>01020   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 1) {
<a name="l01021"></a>01021     printf(<span class="stringliteral">&quot;created tunnel initiator gport : 0x%08x vlan : %d &quot;</span>
<a name="l01022"></a>01022         <span class="stringliteral">&quot;g_vxlan.tunnel_init_intf_id : 0x%08x\n&quot;</span>, *tunnel_gportp,
<a name="l01023"></a>01023         tunnel_vlan, g_vxlan.<a class="code" href="structvxlan__s.html#a5d21223d761c733751fa1f039ad77c63">tunnel_init_intf_id</a>);
<a name="l01024"></a>01024   }
<a name="l01025"></a>01025 
<a name="l01026"></a>01026   <span class="keywordflow">return</span> rv;
<a name="l01027"></a>01027 }
<a name="l01028"></a>01028 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01029"></a>01029 
<a name="l01030"></a>01030 <span class="comment">/*****************************************************************/</span>
<a name="l01040"></a><a class="code" href="dpp_2example__vxlan_8c.html#adb8e51af57ca4e7cac9fcb834bc18aa8">01040</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#adb8e51af57ca4e7cac9fcb834bc18aa8" title="Create Egress FEC object.">example_vxlan_egress_tunnel_fec_create</a>(
<a name="l01041"></a>01041     <span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> tunnel_vlan,
<a name="l01042"></a>01042     <span class="keywordtype">int</span> tunnel_port, <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> * tunnel_fec_p)
<a name="l01043"></a>01043 {
<a name="l01044"></a>01044   <span class="keywordtype">int</span> rv;
<a name="l01045"></a>01045 
<a name="l01046"></a>01046   <span class="comment">/* tunnel info */</span>
<a name="l01047"></a>01047   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> next_hop_mac;
<a name="l01048"></a>01048 
<a name="l01049"></a>01049   <span class="comment">/*** create egress object: points into tunnel, with allocating FEC, and da-mac = next_hop_mac  ***/</span>
<a name="l01050"></a>01050   <span class="keyword">struct </span><a class="code" href="structcreate__l3__egress__s.html">create_l3_egress_s</a> l3eg1;
<a name="l01051"></a>01051 
<a name="l01052"></a>01052   memcpy(next_hop_mac, ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#adac12f83da3900c1e0f423c5e2a851f6">ip_tunnel_info</a>.<a class="code" href="structip__tunnel__s.html#aa93c11e74eaac66b07587afdcc3a615e">da</a>, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));
<a name="l01053"></a>01053   memset(&amp;l3eg1, 0, <span class="keyword">sizeof</span>(l3eg1));
<a name="l01054"></a>01054   memcpy(l3eg1.<a class="code" href="structcreate__l3__egress__s.html#a3b90370e27f84ad469f110c4e39eee14">next_hop_mac_addr</a>, next_hop_mac, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));
<a name="l01055"></a>01055   l3eg1.<a class="code" href="structcreate__l3__egress__s.html#ae7712a901c1185126fbc99ec1c3e05fb">out_tunnel_or_rif</a> = g_vxlan.<a class="code" href="structvxlan__s.html#a5d21223d761c733751fa1f039ad77c63">tunnel_init_intf_id</a>;
<a name="l01056"></a>01056   l3eg1.<a class="code" href="structcreate__l3__egress__s.html#ae2aae72d826c0aebbceeab27311787db">out_gport</a>         = <a class="code" href="dpp_2example__vxlan_8c.html#a4ec76d143b6dd3ef786287ce4bae3270">portmap</a>[tunnel_port];
<a name="l01057"></a>01057   l3eg1.<a class="code" href="structcreate__l3__egress__s.html#addaf76f3ca7163ad8983384027515713">vlan</a>              = tunnel_vlan;
<a name="l01058"></a>01058   l3eg1.<a class="code" href="structcreate__l3__egress__s.html#a660e3c6d1170a31969e568b04dccbe7a">fec_id</a> = 0;             <span class="comment">/* This may not matter so much, sarath */</span>
<a name="l01059"></a>01059   l3eg1.<a class="code" href="structcreate__l3__egress__s.html#aa475f6c0813d25042d984bdd93eec535">arp_encap_id</a> = 0;
<a name="l01060"></a>01060 
<a name="l01061"></a>01061   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a4e714391e0198579d1509fd5231af009" title="Create L3 egress object for FEC and ARP entry.">example_l3_egress_create</a>(unit, &amp;l3eg1);
<a name="l01062"></a>01062   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01063"></a>01063     printf(<span class="stringliteral">&quot;Failed to create L3 egress object, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01064"></a>01064     <span class="keywordflow">return</span> rv;
<a name="l01065"></a>01065   }
<a name="l01066"></a>01066 
<a name="l01067"></a>01067   <span class="comment">/* interface for ip_tunnel is egress-object (FEC) */</span>
<a name="l01068"></a>01068   *tunnel_fec_p = l3eg1.<a class="code" href="structcreate__l3__egress__s.html#a660e3c6d1170a31969e568b04dccbe7a">fec_id</a>;
<a name="l01069"></a>01069   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 1) {
<a name="l01070"></a>01070     printf(<span class="stringliteral">&quot;Created FEC-id = 0x%08x\n&quot;</span>, *tunnel_fec_p);
<a name="l01071"></a>01071   }
<a name="l01072"></a>01072 
<a name="l01073"></a>01073   <span class="keywordflow">return</span> rv;
<a name="l01074"></a>01074 }
<a name="l01075"></a>01075 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01076"></a>01076 
<a name="l01077"></a>01077 <span class="comment">/*****************************************************************/</span>
<a name="l01087"></a><a class="code" href="dpp_2example__vxlan_8c.html#a152a7e2d2abdc2542fd24cb3cd10f25d">01087</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a152a7e2d2abdc2542fd24cb3cd10f25d" title="Create ipv4 tunnel.">example_ip_tunnel_add</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> * itf,
<a name="l01088"></a>01088     <a class="code" href="structopennsl__tunnel__initiator__s.html" title="L3 tunneling initiator.">opennsl_tunnel_initiator_t</a> * <a class="code" href="opennsl__api_8dox.html#aa5eb3d2bb92909819359b4fd24749880">tunnel</a>)
<a name="l01089"></a>01089 {
<a name="l01090"></a>01090 
<a name="l01091"></a>01091   <a class="code" href="structopennsl__l3__intf__s.html" title="L3 Interface Structure.">opennsl_l3_intf_t</a> l3_intf;
<a name="l01092"></a>01092   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l01093"></a>01093 
<a name="l01094"></a>01094   <a class="code" href="group__l3.html#gaa92edab97138caed29fe11f4f9b35fa7" title="Initialize a opennsl_l3_intf_t structure.">opennsl_l3_intf_t_init</a>(&amp;l3_intf);
<a name="l01095"></a>01095 
<a name="l01096"></a>01096   <span class="comment">/* if given ID is set, then use it as placement of the ipv4-tunnel */</span>
<a name="l01097"></a>01097   <span class="keywordflow">if</span> (*itf != 0) {
<a name="l01098"></a>01098     <a class="code" href="group__types.html#gac6d19ddb0a45a93b8b99ddb0c7422194">OPENNSL_GPORT_TUNNEL_ID_SET</a>(tunnel-&gt;<a class="code" href="structopennsl__tunnel__initiator__s.html#ace61a09c712a58a55daaa3ffec6a9682" title="Tunnel ID.">tunnel_id</a>, *itf);
<a name="l01099"></a>01099     tunnel-&gt;<a class="code" href="structopennsl__tunnel__initiator__s.html#a32f65c0f4c554ce8490295d15fcd4fc2" title="Configuration flags.">flags</a> |= <a class="code" href="group__tunnel.html#gab4f2d80d4d2e9aca71a07e0f6bc19858" title="Add using the specified ID.">OPENNSL_TUNNEL_WITH_ID</a>;
<a name="l01100"></a>01100   }
<a name="l01101"></a>01101 
<a name="l01102"></a>01102   rv = <a class="code" href="group__tunnel.html#ga847d52df4fabf270271ca1b88e94cf95" title="Set the tunneling initiator parameters on an L3 interface.">opennsl_tunnel_initiator_create</a>(unit, &amp;l3_intf, tunnel);
<a name="l01103"></a>01103   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01104"></a>01104     printf(<span class="stringliteral">&quot;Failed to create tunnel initiator, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01105"></a>01105     <span class="keywordflow">return</span> rv;
<a name="l01106"></a>01106   }
<a name="l01107"></a>01107 
<a name="l01108"></a>01108   <span class="comment">/* include interface-id points to the tunnel */</span>
<a name="l01109"></a>01109   *itf = l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a>;
<a name="l01110"></a>01110   <span class="keywordflow">return</span> rv;
<a name="l01111"></a>01111 }
<a name="l01112"></a>01112 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01113"></a>01113 
<a name="l01114"></a>01114 <span class="comment">/*****************************************************************/</span>
<a name="l01121"></a><a class="code" href="dpp_2example__vxlan_8c.html#a0b8948666e6b815b34588008f4aef977">01121</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a0b8948666e6b815b34588008f4aef977" title="To initialize vxlan_port_add_s.">example_vxlan_port_s_clear</a>(
<a name="l01122"></a>01122     <span class="keyword">struct</span> <a class="code" href="structvxlan__port__add__s.html">vxlan_port_add_s</a> * vxlan_port_add)
<a name="l01123"></a>01123 {
<a name="l01124"></a>01124 
<a name="l01125"></a>01125   memset(vxlan_port_add, 0, <span class="keyword">sizeof</span>(*vxlan_port_add));
<a name="l01126"></a>01126 
<a name="l01127"></a>01127   <span class="comment">/* by default, egress orientatino is set by vxlan port */</span>
<a name="l01128"></a>01128   vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a7fbbe076345119b05d4822d047be833b">set_egress_orientation_using_vxlan_port_add</a> = 1;
<a name="l01129"></a>01129 
<a name="l01130"></a>01130   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l01131"></a>01131 }
<a name="l01132"></a>01132 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01133"></a>01133 
<a name="l01134"></a>01134 <span class="comment">/*****************************************************************/</span>
<a name="l01145"></a><a class="code" href="dpp_2example__vxlan_8c.html#a16d117a09a5c6ed09709fea3bc458ed1">01145</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a16d117a09a5c6ed09709fea3bc458ed1" title="Add gport of type vlan-port to the multicast.">example_multicast_vxlan_port_add</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> mc_group_id,
<a name="l01146"></a>01146     <span class="keywordtype">int</span> sys_port, <span class="keywordtype">int</span> gport, <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> is_egress)
<a name="l01147"></a>01147 {
<a name="l01148"></a>01148 
<a name="l01149"></a>01149   <span class="keywordtype">int</span> encap_id;
<a name="l01150"></a>01150   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l01151"></a>01151 
<a name="l01152"></a>01152   rv = <a class="code" href="group__multicast.html#gafc7e3a95a0a18021de98480a83aeb351" title="Get the multicast encapsulation ID for VXLAN replication.">opennsl_multicast_vxlan_encap_get</a>(unit, mc_group_id, sys_port, gport, &amp;encap_id);
<a name="l01153"></a>01153   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01154"></a>01154     printf
<a name="l01155"></a>01155       (<span class="stringliteral">&quot;Failed to vxlan encapsulation ID for mc_group_id: 0x%08x &quot;</span>
<a name="l01156"></a>01156        <span class="stringliteral">&quot;phy_port: 0x%08x gport: 0x%08x, Error %s\n&quot;</span>,
<a name="l01157"></a>01157        mc_group_id, sys_port, gport, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01158"></a>01158     <span class="keywordflow">return</span> rv;
<a name="l01159"></a>01159   }
<a name="l01160"></a>01160   rv = <a class="code" href="group__multicast.html#gafa55f761fe7a9b6026267234c3fd7057" title="Add a port to a Ingress Multicast group&#39;s replication list.">opennsl_multicast_ingress_add</a>(unit, mc_group_id, sys_port, encap_id);
<a name="l01161"></a>01161   <span class="comment">/* if the MC entry already exist, then we shouldn&#39;t add it twice to the multicast group */</span>
<a name="l01162"></a>01162   <span class="keywordflow">if</span> (rv == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5ad03e135eecd46c9c1280e7b3f6ab5b6a">OPENNSL_E_EXISTS</a>) {
<a name="l01163"></a>01163     printf(<span class="stringliteral">&quot;The multicast entry already exists \n&quot;</span>);
<a name="l01164"></a>01164     rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l01165"></a>01165   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01166"></a>01166     printf(<span class="stringliteral">&quot;Failed to update ingress multicast group for mc_group_id: 0x%08x &quot;</span>
<a name="l01167"></a>01167         <span class="stringliteral">&quot;phy_port: 0x%08x encap_id: 0x%08x, Error %s\n&quot;</span>,
<a name="l01168"></a>01168         mc_group_id, sys_port, encap_id, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01169"></a>01169     <span class="keywordflow">return</span> rv;
<a name="l01170"></a>01170   }
<a name="l01171"></a>01171   printf(<span class="stringliteral">&quot;Added sys_port %d to mc_group_id %d encap_id: 0x%08x\n&quot;</span>, sys_port, mc_group_id, encap_id);
<a name="l01172"></a>01172 
<a name="l01173"></a>01173   <span class="keywordflow">return</span> rv;
<a name="l01174"></a>01174 }
<a name="l01175"></a>01175 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01176"></a>01176 
<a name="l01177"></a>01177 <span class="comment">/*****************************************************************/</span>
<a name="l01185"></a><a class="code" href="dpp_2example__vxlan_8c.html#a7ed94e934f01fbde62c6d0d5ce55ac95">01185</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a7ed94e934f01fbde62c6d0d5ce55ac95" title="To create VxLAN port.">example_vxlan_port_add</a>(
<a name="l01186"></a>01186     <span class="keywordtype">int</span> unit, <span class="keyword">struct</span> <a class="code" href="structvxlan__port__add__s.html">vxlan_port_add_s</a> *vxlan_port_add)
<a name="l01187"></a>01187 {
<a name="l01188"></a>01188   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l01189"></a>01189   <a class="code" href="structopennsl__vxlan__port__s.html" title="VXLAN Gport.">opennsl_vxlan_port_t</a> vxlan_port;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191   <a class="code" href="group__vxlan.html#gabb37c026d44cf86b88db9b746864678c" title="Initialize VXLAN port structure.">opennsl_vxlan_port_t_init</a>(&amp;vxlan_port);
<a name="l01192"></a>01192 
<a name="l01193"></a>01193   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a55833885a33e3b4564f244eb739366f0" title="Match criteria.">criteria</a>         = <a class="code" href="group__vxlan.html#gga4600e13897e04ce6c7eef1ea4c52a97aa95dd2a39582292c5434afce67210ca12" title="Match VXLAN VN_ID.">OPENNSL_VXLAN_PORT_MATCH_VN_ID</a>;
<a name="l01194"></a>01194   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a7db9ca71d49c4d5adb2452eb7f37bd69" title="Match port / trunk.">match_port</a>       = vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#aa63b6f1c4a3906da1dd79446e2606d30">in_port</a>;
<a name="l01195"></a>01195   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#aa3c53f3028118b7e98d3547e179e25eb" title="Tunnel Terminator ID.">match_tunnel_id</a>  = vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#ab32e0326829e5a9ebd5437a924286e9f">in_tunnel</a>;
<a name="l01196"></a>01196   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#abede24b43e4492ea401abe937bc24b47" title="VXLAN egress object.">egress_if</a>        = vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a79ce4d83e6ef740255e7a2c76c8a05ad">egress_if</a>;
<a name="l01197"></a>01197   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a66bd0455a644c92731efa6997b53d709" title="Tunnel Initiator ID.">egress_tunnel_id</a> = vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a15fadc6bc382fbd97c2b669987ce0c5e">out_tunnel</a>;
<a name="l01198"></a>01198   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ab25ba86e1f740cefc25bcfe66511afb0" title="OPENNSL_VXLAN_PORT_xxx.">flags</a>            = vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a65c03fc2e80c752f9caa54e9e4c7eb48">flags</a> | <a class="code" href="group__vxlan.html#ga970a0937f71cff5f48e85b2be086aeb2" title="Specified Egress tunnel is valid.">OPENNSL_VXLAN_PORT_EGRESS_TUNNEL</a>;
<a name="l01199"></a>01199 
<a name="l01200"></a>01200   <span class="comment">/* set orientation, work for Jericho.</span>
<a name="l01201"></a>01201 <span class="comment">   * For Jericho, we configure orientation at ingress (inLif) and egress (outLif): </span>
<a name="l01202"></a>01202 <span class="comment">   * ingress orientation is configured at opennsl_vxlan_port_add. </span>
<a name="l01203"></a>01203 <span class="comment">   * egress orientation can be configured using opennsl_vxlan_port_add or at opennsl_port_class_set</span>
<a name="l01204"></a>01204 <span class="comment">   */</span>
<a name="l01205"></a>01205   <span class="comment">/* flag indicating network orientation.</span>
<a name="l01206"></a>01206 <span class="comment">   * Used to configure ingress orientation and optionally egress orientation */</span>
<a name="l01207"></a>01207   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ab25ba86e1f740cefc25bcfe66511afb0" title="OPENNSL_VXLAN_PORT_xxx.">flags</a> |= <a class="code" href="group__vxlan.html#gabc6fe5af508cc9e898aa992bdf981db1" title="Network facing interface.">OPENNSL_VXLAN_PORT_NETWORK</a>;
<a name="l01208"></a>01208   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a834e366d60729310f76dcfdefa7fe495" title="Split Horizon network group identifier.">network_group_id</a> = vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a3c72b692b025ba9c797e178e6df99ec1">network_group_id</a>; <span class="comment">/* TO FIX g_vxlan.vxlan_network_group_id;  */</span>
<a name="l01209"></a>01209 
<a name="l01210"></a>01210   rv = <a class="code" href="group__vxlan.html#ga436707cb4c75c0ecf856e2859f878ef5" title="opennsl_vxlan_port_add adds a Access or Network VXLAN port.">opennsl_vxlan_port_add</a>(unit, vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a871ac564d33b78b193bba71ab8007acb">vpn</a>, &amp;vxlan_port);
<a name="l01211"></a>01211   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01212"></a>01212     printf(<span class="stringliteral">&quot;Failed to add vxlan port, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01213"></a>01213     <span class="keywordflow">return</span> rv;
<a name="l01214"></a>01214   }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216   vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a2d496e06482a0c065da46ceb7fe2f9c3">vxlan_port_id</a> = vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ad75a73a038313fbb6412b11c99a8410b" title="GPORT identifier.">vxlan_port_id</a>;
<a name="l01217"></a>01217 
<a name="l01218"></a>01218   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l01219"></a>01219     printf(<span class="stringliteral">&quot;vxlan port created, vxlan_port_id: 0x%08x \n&quot;</span>,
<a name="l01220"></a>01220         vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ad75a73a038313fbb6412b11c99a8410b" title="GPORT identifier.">vxlan_port_id</a>);
<a name="l01221"></a>01221     printf(<span class="stringliteral">&quot;vxlan port is config with:\n&quot;</span>);
<a name="l01222"></a>01222     printf(<span class="stringliteral">&quot;  ip in tunnel termination gport:0x%08x  \n&quot;</span>, vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#ab32e0326829e5a9ebd5437a924286e9f">in_tunnel</a>);
<a name="l01223"></a>01223     <span class="keywordflow">if</span> (vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a79ce4d83e6ef740255e7a2c76c8a05ad">egress_if</a> != 0) {
<a name="l01224"></a>01224       printf(<span class="stringliteral">&quot;  FEC entry (contains ip tunnel encapsulation information):0x%08x \n&quot;</span>,
<a name="l01225"></a>01225           vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a79ce4d83e6ef740255e7a2c76c8a05ad">egress_if</a>);
<a name="l01226"></a>01226     } <span class="keywordflow">else</span> {
<a name="l01227"></a>01227       printf(<span class="stringliteral">&quot;  ip tunnel initiator gport:0x%08x\n&quot;</span>, vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a15fadc6bc382fbd97c2b669987ce0c5e">out_tunnel</a>);
<a name="l01228"></a>01228     }
<a name="l01229"></a>01229     printf(<span class="stringliteral">&quot;  vpn: 0x%08x\n\r&quot;</span>, vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a871ac564d33b78b193bba71ab8007acb">vpn</a>);
<a name="l01230"></a>01230     printf(<span class="stringliteral">&quot;  vxlan lif orientation: network_group_id = %d\n\r&quot;</span>, vxlan_port_add-&gt;<a class="code" href="structvxlan__port__add__s.html#a3c72b692b025ba9c797e178e6df99ec1">network_group_id</a>);
<a name="l01231"></a>01231   }
<a name="l01232"></a>01232 
<a name="l01233"></a>01233   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a16d117a09a5c6ed09709fea3bc458ed1" title="Add gport of type vlan-port to the multicast.">example_multicast_vxlan_port_add</a>(unit, g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>,
<a name="l01234"></a>01234       vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a7db9ca71d49c4d5adb2452eb7f37bd69" title="Match port / trunk.">match_port</a>, vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ad75a73a038313fbb6412b11c99a8410b" title="GPORT identifier.">vxlan_port_id</a>, <a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a>);
<a name="l01235"></a>01235   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01236"></a>01236     printf(<span class="stringliteral">&quot;Failed to add vxlan port to multicast group, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01237"></a>01237     <span class="keywordflow">return</span> rv;
<a name="l01238"></a>01238   }
<a name="l01239"></a>01239   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l01240"></a>01240     printf(<span class="stringliteral">&quot;add vxlan-port 0x%08x to VPN flooding group %d (0x%08x)\n\r&quot;</span>,
<a name="l01241"></a>01241         vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ad75a73a038313fbb6412b11c99a8410b" title="GPORT identifier.">vxlan_port_id</a>, g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>, g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>);
<a name="l01242"></a>01242   }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244   <span class="keywordflow">return</span> rv;
<a name="l01245"></a>01245 }
<a name="l01246"></a>01246 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01247"></a>01247 
<a name="l01248"></a>01248 <span class="comment">/*****************************************************************/</span>
<a name="l01256"></a><a class="code" href="dpp_2example__vxlan_8c.html#a7c09d41cae87a4d1d2fa5164e035335b">01256</a> <span class="keywordtype">void</span> <a class="code" href="dpp_2example__vxlan_8c.html#a7c09d41cae87a4d1d2fa5164e035335b" title="To initialize the global VxLAN structure.">vxlan_init</a>(<span class="keywordtype">int</span> unit, <span class="keyword">struct</span> <a class="code" href="structvxlan__s.html">vxlan_s</a> *vx_info)
<a name="l01257"></a>01257 {
<a name="l01258"></a>01258   <span class="keywordflow">if</span> (vx_info != <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01259"></a>01259     memcpy(&amp;g_vxlan, vx_info, <span class="keyword">sizeof</span>(g_vxlan));
<a name="l01260"></a>01260   }
<a name="l01261"></a>01261 }
<a name="l01262"></a>01262 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01263"></a>01263 
<a name="l01264"></a>01264 <span class="comment">/*****************************************************************/</span>
<a name="l01272"></a><a class="code" href="dpp_2example__vxlan_8c.html#a268488e2ad7ba73eafea58bd298bcce3">01272</a> <span class="keywordtype">void</span> <a class="code" href="dpp_2example__vxlan_8c.html#a268488e2ad7ba73eafea58bd298bcce3" title="To copy the global VxLAN structure.">vxlan_struct_get</a>(<span class="keyword">struct</span> <a class="code" href="structvxlan__s.html">vxlan_s</a> *vx_info)
<a name="l01273"></a>01273 {
<a name="l01274"></a>01274   memcpy(vx_info, &amp;g_vxlan, <span class="keyword">sizeof</span>(g_vxlan));
<a name="l01275"></a>01275 }
<a name="l01276"></a>01276 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01277"></a>01277 
<a name="l01278"></a>01278 <span class="comment">/*****************************************************************/</span>
<a name="l01287"></a><a class="code" href="dpp_2example__vxlan_8c.html#a0a0ecff77aba73348c6bd59869101f1d">01287</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a0a0ecff77aba73348c6bd59869101f1d" title="To build L2 VPN.">example_vxlan_open_vpn</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> vpn, <span class="keywordtype">int</span> vni)
<a name="l01288"></a>01288 {
<a name="l01289"></a>01289   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l01290"></a>01290   <span class="keywordtype">int</span> mc_group_id = vpn;
<a name="l01291"></a>01291 
<a name="l01292"></a>01292   <a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a> = 0;
<a name="l01293"></a>01293   rv = <a class="code" href="dpp_2example__vxlan_8c.html#ac7704d686c6c44bb0da37824d699966d" title="Utility function to create multicast group.">example_multicast_group_open</a>(unit, &amp;mc_group_id,
<a name="l01294"></a>01294       <a class="code" href="group__multicast.html#gaa76a6dd0b85d5ddc43cea2c36df48b4e">OPENNSL_MULTICAST_TYPE_L2</a>);
<a name="l01295"></a>01295   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01296"></a>01296     printf(<span class="stringliteral">&quot;Failed to create multicast group, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01297"></a>01297     <span class="keywordflow">return</span> rv;
<a name="l01298"></a>01298   }
<a name="l01299"></a>01299 
<a name="l01300"></a>01300   <a class="code" href="structopennsl__vxlan__vpn__config__s.html" title="VXLAN VPN Config Structure.">opennsl_vxlan_vpn_config_t</a> vpn_config;
<a name="l01301"></a>01301   <a class="code" href="group__vxlan.html#ga6714301b6f97f14df45b8e96f26cbae8" title="Initialize VXLAN VPN config structure.">opennsl_vxlan_vpn_config_t_init</a>(&amp;vpn_config);
<a name="l01302"></a>01302 
<a name="l01303"></a>01303   vpn_config.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a16136c29ade623ced30606f46e7ff6d5" title="OPENNSL_VXLAN_VPN_xxx.">flags</a> =
<a name="l01304"></a>01304     <a class="code" href="group__vxlan.html#ga40d3a155a0639cf603ce0fddc8765e87">OPENNSL_VXLAN_VPN_ELAN</a> | <a class="code" href="group__vxlan.html#ga91cf169bff8103ae7e80bf2f437a3725">OPENNSL_VXLAN_VPN_WITH_ID</a> | <a class="code" href="group__vxlan.html#gad5f555e90830304d8338b723f9239698">OPENNSL_VXLAN_VPN_WITH_VPNID</a>;
<a name="l01305"></a>01305   vpn_config.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#afbf3610c95f5cf94a92c79259b65211c" title="VXLAN VPN.">vpn</a>                      = vpn;
<a name="l01306"></a>01306   vpn_config.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a497586a6d6f0ce3195a29975068e1461">broadcast_group</a>          = mc_group_id;
<a name="l01307"></a>01307   vpn_config.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a1105297de06ffd03b750d7f46c8ea12d">unknown_unicast_group</a>    = mc_group_id;
<a name="l01308"></a>01308   vpn_config.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#afa48be63476fbb0faff6317d8748446c">unknown_multicast_group</a>  = mc_group_id;
<a name="l01309"></a>01309   vpn_config.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a662233db9e571082acf8eeb89d495a68" title="VNID.">vnid</a>                     = vni;
<a name="l01310"></a>01310   <span class="keywordflow">if</span> (g_vxlan.<a class="code" href="structvxlan__s.html#ae7d8ca029ccb27c998e23699eb540e5d">vxlan_vdc_enable</a>) {
<a name="l01311"></a>01311     vpn_config.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a6d953c779cdc613e2510713c27fecd21" title="local port vlan domain">match_port_class</a> = <a class="code" href="dpp_2example__vxlan_8c.html#a7df647d7b39028bae7fc129cbc272eb5">vdc_port_class</a>;
<a name="l01312"></a>01312   }
<a name="l01313"></a>01313 
<a name="l01314"></a>01314   rv = <a class="code" href="group__vxlan.html#ga7a04195dfb41f6db86a90a1b865962c8" title="Create or update VXLAN VPN.">opennsl_vxlan_vpn_create</a>(unit, &amp;vpn_config);
<a name="l01315"></a>01315   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01316"></a>01316     printf(<span class="stringliteral">&quot;Failed to create vxlan vpn, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01317"></a>01317     <span class="keywordflow">return</span> rv;
<a name="l01318"></a>01318   }
<a name="l01319"></a>01319   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 1) {
<a name="l01320"></a>01320     printf(<span class="stringliteral">&quot;Created vpn %d (0x%08x)\n\r&quot;</span>, vpn, vpn);
<a name="l01321"></a>01321   }
<a name="l01322"></a>01322 
<a name="l01323"></a>01323   <span class="keywordflow">return</span> rv;
<a name="l01324"></a>01324 }
<a name="l01325"></a>01325 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01326"></a>01326 
<a name="l01327"></a>01327 <span class="comment">/*****************************************************************/</span>
<a name="l01336"></a><a class="code" href="dpp_2example__vxlan_8c.html#a9fa34635706aa7d06850dabda9969220">01336</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a9fa34635706aa7d06850dabda9969220" title="To create inLif for a port.">example_vlan_inLif_create</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> in_port,
<a name="l01337"></a>01337     <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> *port_id)
<a name="l01338"></a>01338 {
<a name="l01339"></a>01339   <span class="keywordtype">int</span> rv;
<a name="l01340"></a>01340   <a class="code" href="structopennsl__vlan__port__s.html" title="Layer 2 Logical port type.">opennsl_vlan_port_t</a> vport1;
<a name="l01341"></a>01341   <a class="code" href="group__vlan.html#gaa1bf59398c66fd46c9109b4fc9d79051" title="Initialize the VLAN port structure.">opennsl_vlan_port_t_init</a>(&amp;vport1);
<a name="l01342"></a>01342   vport1.<a class="code" href="structopennsl__vlan__port__s.html#ab94d90776edeb955129f95b07f287181" title="Match criteria.">criteria</a>        = <a class="code" href="group__vlan.html#ggac691cd787b4b6aa9a2f8b83659d4af50a0e8e71613acf7f6159c59d446e5bb1d0" title="Mod/port/trunk + outer VLAN.">OPENNSL_VLAN_PORT_MATCH_PORT_VLAN</a>;
<a name="l01343"></a>01343   vport1.<a class="code" href="structopennsl__vlan__port__s.html#a38cc4cd1deb11194217fc3eed635b108" title="Gport: local or remote Physical or logical gport.">port</a>            = in_port;
<a name="l01344"></a>01344   vport1.<a class="code" href="structopennsl__vlan__port__s.html#a10ec33efb60f9917b243dd872dc3858f" title="Outer VLAN ID to match.">match_vlan</a>      = ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#a21b5a34ff96e8fe80f8068d3790871d6">access_vlan</a>;
<a name="l01345"></a>01345   vport1.<a class="code" href="structopennsl__vlan__port__s.html#aae4bfab581619f524b69104a589634bb" title="Egress Outer VLAN or SD-TAG VLAN ID.">egress_vlan</a>     = ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#a21b5a34ff96e8fe80f8068d3790871d6">access_vlan</a>;
<a name="l01346"></a>01346   vport1.<a class="code" href="structopennsl__vlan__port__s.html#a7780aaa81891b515df40ae3696db218b" title="OPENNSL_VLAN_PORT_xxx.">flags</a>           = 0;
<a name="l01347"></a>01347   vport1.<a class="code" href="structopennsl__vlan__port__s.html#a3180209e53566f3050a304955fabe8ff" title="Populated for opennsl_vlan_port_find only.">vsi</a>             = 0;
<a name="l01348"></a>01348   rv = <a class="code" href="group__vlan.html#ga019a29bf98cbf78d0b609f3e1b00d473" title="Create a layer 2 logical port.">opennsl_vlan_port_create</a>(unit, &amp;vport1);
<a name="l01349"></a>01349 
<a name="l01350"></a>01350   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01351"></a>01351     printf(<span class="stringliteral">&quot;Failed to create vlan_port filter, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01352"></a>01352     <span class="keywordflow">return</span> rv;
<a name="l01353"></a>01353   }
<a name="l01354"></a>01354 
<a name="l01355"></a>01355   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l01356"></a>01356     printf
<a name="l01357"></a>01357       (<span class="stringliteral">&quot;Add vlan-port-id: 0x%08x in-port: %d (0x%08x) match_vlan: %d &quot;</span>
<a name="l01358"></a>01358        <span class="stringliteral">&quot;egress_vlan: %d match_inner_vlan: %d\n\r&quot;</span>, vport1.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>,
<a name="l01359"></a>01359        vport1.<a class="code" href="structopennsl__vlan__port__s.html#a38cc4cd1deb11194217fc3eed635b108" title="Gport: local or remote Physical or logical gport.">port</a>, vport1.<a class="code" href="structopennsl__vlan__port__s.html#a38cc4cd1deb11194217fc3eed635b108" title="Gport: local or remote Physical or logical gport.">port</a>, vport1.<a class="code" href="structopennsl__vlan__port__s.html#a10ec33efb60f9917b243dd872dc3858f" title="Outer VLAN ID to match.">match_vlan</a>, vport1.<a class="code" href="structopennsl__vlan__port__s.html#aae4bfab581619f524b69104a589634bb" title="Egress Outer VLAN or SD-TAG VLAN ID.">egress_vlan</a>,
<a name="l01360"></a>01360        vport1.<a class="code" href="structopennsl__vlan__port__s.html#a6a6a74cf200a3ff06e4be8e4d4102f6c" title="Inner VLAN ID to match.">match_inner_vlan</a>);
<a name="l01361"></a>01361   }
<a name="l01362"></a>01362 
<a name="l01363"></a>01363   <span class="comment">/* handle of the created gport */</span>
<a name="l01364"></a>01364   *port_id = vport1.<a class="code" href="structopennsl__vlan__port__s.html#a6bf4ca3edeb7068c9baea003faad1f52" title="GPORT identifier.">vlan_port_id</a>;
<a name="l01365"></a>01365 
<a name="l01366"></a>01366   <span class="keywordflow">return</span> rv;
<a name="l01367"></a>01367 }
<a name="l01368"></a>01368 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01369"></a>01369 
<a name="l01370"></a>01370 <span class="comment">/*****************************************************************/</span>
<a name="l01382"></a><a class="code" href="dpp_2example__vxlan_8c.html#a5bd99907b1249af4dc595c4d17b727b3">01382</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a5bd99907b1249af4dc595c4d17b727b3" title="Main function to build VxLAN IP tunnel.">example_vxlan</a>(
<a name="l01383"></a>01383     <span class="keywordtype">int</span> unit,
<a name="l01384"></a>01384     <span class="keywordtype">int</span> network_port,
<a name="l01385"></a>01385     <span class="keywordtype">int</span> access_port,
<a name="l01386"></a>01386     <span class="keywordtype">int</span> vpn_id)
<a name="l01387"></a>01387 {
<a name="l01388"></a>01388   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l01389"></a>01389   <span class="keywordtype">int</span> vxlan_port_flags = 0;
<a name="l01390"></a>01390   <span class="keyword">struct </span><a class="code" href="structvxlan__port__add__s.html">vxlan_port_add_s</a> vxlan_port_add;
<a name="l01391"></a>01391 
<a name="l01392"></a>01392   <span class="comment">/* init vxlan global */</span>
<a name="l01393"></a>01393   <span class="keyword">struct </span><a class="code" href="structvxlan__s.html">vxlan_s</a> vxlan_param;
<a name="l01394"></a>01394   <a class="code" href="dpp_2example__vxlan_8c.html#a268488e2ad7ba73eafea58bd298bcce3" title="To copy the global VxLAN structure.">vxlan_struct_get</a>(&amp;vxlan_param);
<a name="l01395"></a>01395   <span class="keywordflow">if</span> (vpn_id &gt;= 0) {
<a name="l01396"></a>01396     vxlan_param.<a class="code" href="structvxlan__s.html#ad86bc71950683d29530ca040aaf545fe">vpn_id</a> = <a class="code" href="structvxlan__s.html#ad86bc71950683d29530ca040aaf545fe">vpn_id</a>;
<a name="l01397"></a>01397   }
<a name="l01398"></a>01398   <a class="code" href="dpp_2example__vxlan_8c.html#a7c09d41cae87a4d1d2fa5164e035335b" title="To initialize the global VxLAN structure.">vxlan_init</a>(unit, &amp;vxlan_param);
<a name="l01399"></a>01399   vpn_id = g_vxlan.<a class="code" href="structvxlan__s.html#ad86bc71950683d29530ca040aaf545fe">vpn_id</a>;
<a name="l01400"></a>01400   <a class="code" href="dpp_2example__vxlan_8c.html#a250f8b62242774ce141a27acb9752aaa" title="OTP portmap for DNX device.">init_portmap</a>(unit);
<a name="l01401"></a>01401 
<a name="l01402"></a>01402   printf(<span class="stringliteral">&quot;Parameters \n&quot;</span>);
<a name="l01403"></a>01403   printf(<span class="stringliteral">&quot;Ports (Network: %d, Access: %d)\n&quot;</span>, network_port, access_port);
<a name="l01404"></a>01404   printf(<span class="stringliteral">&quot;Vlans (Provider:%d Tunnel:%d Access:%d)\n&quot;</span>,
<a name="l01405"></a>01405       ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#a64cd9f31c970420a8119bc9956c88da6">provider_vlan</a>,
<a name="l01406"></a>01406       ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#ac06eafb784664031824be6cdda096566">tunnel_vlan</a>,
<a name="l01407"></a>01407       ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#a21b5a34ff96e8fe80f8068d3790871d6">access_vlan</a>);
<a name="l01408"></a>01408   printf(<span class="stringliteral">&quot;VPN: %d VNI: %d(0x%x)\n&quot;</span>, vpn_id, g_vxlan.<a class="code" href="structvxlan__s.html#abe6f1f9f9213a49e63de056544cb4191">vni</a>, g_vxlan.<a class="code" href="structvxlan__s.html#abe6f1f9f9213a49e63de056544cb4191">vni</a>);
<a name="l01409"></a>01409   g_vxlan.<a class="code" href="structvxlan__s.html#aed1548bcb4778c489fee321cb8070add">access_port</a>  = <a class="code" href="structvxlan__s.html#aed1548bcb4778c489fee321cb8070add">access_port</a>;
<a name="l01410"></a>01410   g_vxlan.<a class="code" href="structvxlan__s.html#a920ac099de8959b39b8f02076afd837f">network_port</a> = <a class="code" href="structvxlan__s.html#a920ac099de8959b39b8f02076afd837f">network_port</a>;
<a name="l01411"></a>01411 
<a name="l01412"></a>01412   <a class="code" href="dpp_2example__vxlan_8c.html#a0b8948666e6b815b34588008f4aef977" title="To initialize vxlan_port_add_s.">example_vxlan_port_s_clear</a>(&amp;vxlan_port_add);
<a name="l01413"></a>01413   <span class="comment">/* config ports as local ports i.e Works as egress port */</span>
<a name="l01414"></a>01414   <a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca2bd885f05e90af619d58cb5c41fab717" title="Set UDP Destination port for VXLAN.">opennslSwitchVxlanUdpDestPortSet</a>, 0x12b5);
<a name="l01415"></a>01415 
<a name="l01416"></a>01416   <a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = 10;
<a name="l01417"></a>01417 
<a name="l01418"></a>01418   <span class="comment">/* init L2 VXLAN module */</span>
<a name="l01419"></a>01419   rv = <a class="code" href="group__vxlan.html#ga264a5af1920511d7b3318483414448e7" title="Initialize the OPENNSL VXLAN subsystem.">opennsl_vxlan_init</a>(unit);
<a name="l01420"></a>01420   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01421"></a>01421     printf(<span class="stringliteral">&quot;Failed to initialize vxlan, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01422"></a>01422   }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424   <span class="comment">/*** Add the ports to VLANs ***/</span>
<a name="l01425"></a>01425   <a class="code" href="dpp_2example__vxlan_8c.html#ad74eca815fd91ca5fda606965f3468c5" title="Utility function to add ports to relevant VLAN&#39;s.">example_add_ports_to_vlans</a>(unit, network_port, access_port);
<a name="l01426"></a>01426 
<a name="l01427"></a>01427   <span class="comment">/* build L2 VPN */</span>
<a name="l01428"></a>01428   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a0a0ecff77aba73348c6bd59869101f1d" title="To build L2 VPN.">example_vxlan_open_vpn</a>(unit, vpn_id, g_vxlan.<a class="code" href="structvxlan__s.html#abe6f1f9f9213a49e63de056544cb4191">vni</a>);
<a name="l01429"></a>01429   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01430"></a>01430     printf(<span class="stringliteral">&quot;Failed to open vpn %d, Error %s\n&quot;</span>, vpn_id, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01431"></a>01431   }
<a name="l01432"></a>01432 
<a name="l01433"></a>01433   <span class="comment">/* Create inLif for access port */</span>
<a name="l01434"></a>01434   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a9fa34635706aa7d06850dabda9969220" title="To create inLif for a port.">example_vlan_inLif_create</a>(unit, access_port, &amp;g_vxlan.<a class="code" href="structvxlan__s.html#a216de94dfb7c6b4dee49c39ac0d075d5">vlan_inLif</a>);
<a name="l01435"></a>01435   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01436"></a>01436     printf(<span class="stringliteral">&quot;Failed to create VLAN inLIF 0x%08x, Error %s\n&quot;</span>, g_vxlan.<a class="code" href="structvxlan__s.html#a216de94dfb7c6b4dee49c39ac0d075d5">vlan_inLif</a>,
<a name="l01437"></a>01437         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01438"></a>01438   }
<a name="l01439"></a>01439 
<a name="l01440"></a>01440   <span class="comment">/* Add inLif to VSI and add it flood MC group */</span>
<a name="l01441"></a>01441   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a420d8c462502c6c006b9382625dc1048" title="Add gport of type vlan-port to the multicast.">example_add_inLif_to_vswitch</a>(unit, vpn_id, access_port, g_vxlan.<a class="code" href="structvxlan__s.html#a216de94dfb7c6b4dee49c39ac0d075d5">vlan_inLif</a>);
<a name="l01442"></a>01442   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01443"></a>01443     printf(<span class="stringliteral">&quot;Failed to add inLif to VSI or adding access port to multicast &quot;</span>
<a name="l01444"></a>01444         <span class="stringliteral">&quot;group, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01445"></a>01445     <span class="keywordflow">return</span> rv;
<a name="l01446"></a>01446   }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448   <span class="comment">/*** build tunnel initiator ***/</span>
<a name="l01449"></a>01449   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a68ddb0d0ce33c08cd1205345ace91018" title="Build IP tunnel.">example_vxlan_egress_tunnel_create</a>(unit, ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#ac06eafb784664031824be6cdda096566">tunnel_vlan</a>,
<a name="l01450"></a>01450       &amp;g_vxlan.<a class="code" href="structvxlan__s.html#a7dde8b90deec0c176991dbff88289f35">tunnel_init_gport</a>);
<a name="l01451"></a>01451   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01452"></a>01452     printf(<span class="stringliteral">&quot;Failed to build tunnel initiator network_port %d, Error %s\n&quot;</span>,
<a name="l01453"></a>01453         network_port, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01454"></a>01454   }
<a name="l01455"></a>01455 
<a name="l01456"></a>01456   <span class="comment">/*** build tunnel FEC ***/</span>
<a name="l01457"></a>01457   rv = <a class="code" href="dpp_2example__vxlan_8c.html#adb8e51af57ca4e7cac9fcb834bc18aa8" title="Create Egress FEC object.">example_vxlan_egress_tunnel_fec_create</a>(unit, ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#ac06eafb784664031824be6cdda096566">tunnel_vlan</a>,
<a name="l01458"></a>01458       network_port, &amp;g_vxlan.<a class="code" href="structvxlan__s.html#a8bb65f9081317e27044d587510e2fed7">vxlan_fec_intf_id</a>);
<a name="l01459"></a>01459   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01460"></a>01460     printf(<span class="stringliteral">&quot;Failed to create FEC, network_port %d, Error %s\n&quot;</span>,
<a name="l01461"></a>01461         network_port, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01462"></a>01462   }
<a name="l01463"></a>01463 
<a name="l01464"></a>01464   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l01465"></a>01465     printf(<span class="stringliteral">&quot;out-tunnel gport-id: 0x%08x FEC-id:0x%08x\n\r&quot;</span>,
<a name="l01466"></a>01466         g_vxlan.<a class="code" href="structvxlan__s.html#a7dde8b90deec0c176991dbff88289f35">tunnel_init_gport</a>, g_vxlan.<a class="code" href="structvxlan__s.html#a8bb65f9081317e27044d587510e2fed7">vxlan_fec_intf_id</a>);
<a name="l01467"></a>01467   }
<a name="l01468"></a>01468 
<a name="l01469"></a>01469   <span class="comment">/* tunnel termination configuration */</span>
<a name="l01470"></a>01470   <span class="keywordflow">if</span> (g_vxlan.<a class="code" href="structvxlan__s.html#ae31c573d0a4c39166a520e58375a7cd2">dip_sip_vrf_using_my_vtep_index_mode</a> == 0) {
<a name="l01471"></a>01471     <span class="comment">/*** build tunnel termination  ***/</span>
<a name="l01472"></a>01472     rv = <a class="code" href="dpp_2example__vxlan_8c.html#afb4809761bfd3367c7d1ae11a28ffeaf" title="Create IP tunnel termination interface.">example_vxlan_tunnel_terminator_create</a>(unit, &amp;g_vxlan.<a class="code" href="structvxlan__s.html#a6d8b46cddca08debd4645f38e008dab5">tunnel_term_gport</a>);
<a name="l01473"></a>01473     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01474"></a>01474       printf(<span class="stringliteral">&quot;Failed to build tunnel termination, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01475"></a>01475       <span class="keywordflow">return</span> rv;
<a name="l01476"></a>01476     }
<a name="l01477"></a>01477 
<a name="l01478"></a>01478     <span class="comment">/*** create L3 interface on provider_vlan, not using it explicitly, but used in pipeline */</span>
<a name="l01479"></a>01479     rv = <a class="code" href="dpp_2example__vxlan_8c.html#a025f115ed142679975518fd8ac76ca09" title="Create L3 interface on provider_vlan.">example_ip_tunnel_term_create_l3_intf</a>(unit, ip_tunnel_glbl_info.<a class="code" href="structip__tunnel__glbl__info__s.html#a64cd9f31c970420a8119bc9956c88da6">provider_vlan</a>);
<a name="l01480"></a>01480     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01481"></a>01481       printf(<span class="stringliteral">&quot;Failed to create L3 interface on provider VLAN, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01482"></a>01482     }
<a name="l01483"></a>01483 
<a name="l01484"></a>01484     <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l01485"></a>01485       printf(<span class="stringliteral">&quot;in-tunnel gport-id: 0x%08x L3 itf:%x\r&quot;</span>, g_vxlan.<a class="code" href="structvxlan__s.html#a6d8b46cddca08debd4645f38e008dab5">tunnel_term_gport</a>, g_vxlan.<a class="code" href="structvxlan__s.html#abb2535de38a9772d1086c307e988d1da">prov_vlan_l3_intf_id</a>);
<a name="l01486"></a>01486     }
<a name="l01487"></a>01487     <span class="comment">/* build l2 vxlan ports */</span>
<a name="l01488"></a>01488     vxlan_port_add.<a class="code" href="structvxlan__port__add__s.html#a3c72b692b025ba9c797e178e6df99ec1">network_group_id</a> = g_vxlan.<a class="code" href="structvxlan__s.html#a9b5e69181be2bfb6c9dd27d2ceb6b01a">vxlan_network_group_id</a>;
<a name="l01489"></a>01489   }
<a name="l01490"></a>01490   <span class="comment">/* create VxLAN gport using tunnel inlif */</span>
<a name="l01491"></a>01491   vxlan_port_add.<a class="code" href="structvxlan__port__add__s.html#a871ac564d33b78b193bba71ab8007acb">vpn</a>         = <a class="code" href="structvxlan__s.html#ad86bc71950683d29530ca040aaf545fe">vpn_id</a>;
<a name="l01492"></a>01492   vxlan_port_add.<a class="code" href="structvxlan__port__add__s.html#aa63b6f1c4a3906da1dd79446e2606d30">in_port</a>     = <a class="code" href="structvxlan__s.html#a920ac099de8959b39b8f02076afd837f">network_port</a>;
<a name="l01493"></a>01493   vxlan_port_add.<a class="code" href="structvxlan__port__add__s.html#ab32e0326829e5a9ebd5437a924286e9f">in_tunnel</a>   = g_vxlan.<a class="code" href="structvxlan__s.html#a6d8b46cddca08debd4645f38e008dab5">tunnel_term_gport</a>;
<a name="l01494"></a>01494   vxlan_port_add.<a class="code" href="structvxlan__port__add__s.html#a15fadc6bc382fbd97c2b669987ce0c5e">out_tunnel</a>  = g_vxlan.<a class="code" href="structvxlan__s.html#a7dde8b90deec0c176991dbff88289f35">tunnel_init_gport</a>;
<a name="l01495"></a>01495   vxlan_port_add.<a class="code" href="structvxlan__port__add__s.html#a79ce4d83e6ef740255e7a2c76c8a05ad">egress_if</a>   = g_vxlan.<a class="code" href="structvxlan__s.html#a8bb65f9081317e27044d587510e2fed7">vxlan_fec_intf_id</a>;
<a name="l01496"></a>01496   vxlan_port_add.<a class="code" href="structvxlan__port__add__s.html#a65c03fc2e80c752f9caa54e9e4c7eb48">flags</a>       = vxlan_port_flags;
<a name="l01497"></a>01497 
<a name="l01498"></a>01498   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a7ed94e934f01fbde62c6d0d5ce55ac95" title="To create VxLAN port.">example_vxlan_port_add</a>(unit, &amp;vxlan_port_add);
<a name="l01499"></a>01499   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01500"></a>01500     printf(<span class="stringliteral">&quot;Failed to add vxlan tunnel, in_gport=0x%08x --&gt; out_intf=0x%08x, &quot;</span>
<a name="l01501"></a>01501         <span class="stringliteral">&quot;Error %s\n&quot;</span>, g_vxlan.<a class="code" href="structvxlan__s.html#a6d8b46cddca08debd4645f38e008dab5">tunnel_term_gport</a>,
<a name="l01502"></a>01502         g_vxlan.<a class="code" href="structvxlan__s.html#a8bb65f9081317e27044d587510e2fed7">vxlan_fec_intf_id</a>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01503"></a>01503     <span class="keywordflow">return</span> rv;
<a name="l01504"></a>01504   }
<a name="l01505"></a>01505 
<a name="l01506"></a>01506   g_vxlan.<a class="code" href="structvxlan__s.html#ac0d9f56dd4557107733a1a6dcc480a0c">vxlan_gport</a> = vxlan_port_add.<a class="code" href="structvxlan__port__add__s.html#a2d496e06482a0c065da46ceb7fe2f9c3">vxlan_port_id</a>;
<a name="l01507"></a>01507 
<a name="l01508"></a>01508   <span class="keywordflow">if</span> (<a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l01509"></a>01509     printf(<span class="stringliteral">&quot;vxlan port created, vxlan_port_id: 0x%08x \n&quot;</span>, g_vxlan.<a class="code" href="structvxlan__s.html#ac0d9f56dd4557107733a1a6dcc480a0c">vxlan_gport</a>);
<a name="l01510"></a>01510   }
<a name="l01511"></a>01511 
<a name="l01512"></a>01512   <span class="comment">/* add mact entries point to created gports */</span>
<a name="l01513"></a>01513   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a6ff8a48e7bde727289c04b10bcea2197" title="To update MAC table.">example_l2_addr_add</a>(unit, g_vxlan.<a class="code" href="structvxlan__s.html#a7248861a4911aa922e37411fb4df449a">user_mac_address</a>, vpn_id, g_vxlan.<a class="code" href="structvxlan__s.html#a216de94dfb7c6b4dee49c39ac0d075d5">vlan_inLif</a>);
<a name="l01514"></a>01514   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01515"></a>01515     printf(<span class="stringliteral">&quot;Failed to update FDB for vlan %d port 0x%08x, Error %s\n&quot;</span>,
<a name="l01516"></a>01516         vpn_id, g_vxlan.<a class="code" href="structvxlan__s.html#a216de94dfb7c6b4dee49c39ac0d075d5">vlan_inLif</a>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01517"></a>01517     <span class="keywordflow">return</span> rv;
<a name="l01518"></a>01518   }
<a name="l01519"></a>01519 
<a name="l01520"></a>01520   rv = <a class="code" href="dpp_2example__vxlan_8c.html#a6ff8a48e7bde727289c04b10bcea2197" title="To update MAC table.">example_l2_addr_add</a>(unit, g_vxlan.<a class="code" href="structvxlan__s.html#ae0340b7e4b5b4b5026ab10c4aace77f4">tunnel_mac_address</a>, vpn_id, g_vxlan.<a class="code" href="structvxlan__s.html#ac0d9f56dd4557107733a1a6dcc480a0c">vxlan_gport</a>);
<a name="l01521"></a>01521   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01522"></a>01522     printf(<span class="stringliteral">&quot;Failed to update FDB for vlan %d port 0x%08x, Error %s\n&quot;</span>,
<a name="l01523"></a>01523         vpn_id, g_vxlan.<a class="code" href="structvxlan__s.html#ac0d9f56dd4557107733a1a6dcc480a0c">vxlan_gport</a>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01524"></a>01524     <span class="keywordflow">return</span> rv;
<a name="l01525"></a>01525   }
<a name="l01526"></a>01526 
<a name="l01527"></a>01527   <span class="comment">/* adding a registered MC using flood MC */</span>
<a name="l01528"></a>01528   <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> l2addr;
<a name="l01529"></a>01529   <a class="code" href="group__l2.html#ga47e819cf5939a8e643ad09505df52071" title="Initialize an L2 address structure to a specified MAC address and VLAN ID.">opennsl_l2_addr_t_init</a>(&amp;l2addr, g_vxlan.<a class="code" href="structvxlan__s.html#af238f93ae76db66e5d353eb48d21aa14">mc_mac</a>, vpn_id);
<a name="l01530"></a>01530 
<a name="l01531"></a>01531   l2addr.<a class="code" href="structopennsl__l2__addr__s.html#a51d440393de19ef5a74d851d252f16e6" title="XGS: index in L2MC table.">l2mc_group</a> = g_vxlan.<a class="code" href="structvxlan__s.html#a1b647ccd563354898062549280703bb9">mc_group_id</a>;
<a name="l01532"></a>01532   l2addr.<a class="code" href="structopennsl__l2__addr__s.html#a3c915015c746bbad9799b9a40a51b829" title="OPENNSL_L2_xxx flags.">flags</a>      = <a class="code" href="group__l2.html#ga838d2e1cee40e3ae41cd4a59599dd333">OPENNSL_L2_STATIC</a> | <a class="code" href="group__l2.html#gaff302c3bc44f98cd482238b9360c01bd">OPENNSL_L2_MCAST</a>;
<a name="l01533"></a>01533 
<a name="l01534"></a>01534   rv = <a class="code" href="group__l2.html#ga4b8920c1c3cf4c0c59bf8f0c5890f7c5" title="Add an L2 address entry to the specified device.">opennsl_l2_addr_add</a>(unit, &amp;l2addr);
<a name="l01535"></a>01535   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01536"></a>01536     printf(<span class="stringliteral">&quot;Failed to FDB with multicast entry, Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01537"></a>01537     <span class="keywordflow">return</span> rv;
<a name="l01538"></a>01538   }
<a name="l01539"></a>01539 
<a name="l01540"></a>01540   <span class="keywordflow">return</span> rv;
<a name="l01541"></a>01541 }
<a name="l01542"></a>01542 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l01543"></a>01543 
<a name="l01544"></a>01544 <span class="comment">/*****************************************************************/</span>
<a name="l01551"></a><a class="code" href="dpp_2example__vxlan_8c.html#a0ddf1224851353fc92bfbff6f499fa97">01551</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for policer application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l01552"></a>01552 {
<a name="l01553"></a>01553   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a>   rv;
<a name="l01554"></a>01554   <span class="keywordtype">int</span> choice;
<a name="l01555"></a>01555   <span class="keywordtype">int</span> index = 0;
<a name="l01556"></a>01556   <span class="keywordtype">int</span> unit = <a class="code" href="dpp_2example__vxlan_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l01557"></a>01557   <span class="keywordtype">int</span> port_a;
<a name="l01558"></a>01558   <span class="keywordtype">int</span> port_n;
<a name="l01559"></a>01559   <span class="keywordtype">int</span> <a class="code" href="structvxlan__s.html#ad86bc71950683d29530ca040aaf545fe">vpn_id</a>;
<a name="l01560"></a>01560 
<a name="l01561"></a>01561   <span class="keywordflow">if</span>(strcmp(argv[0], <span class="stringliteral">&quot;gdb&quot;</span>) == 0)
<a name="l01562"></a>01562   {
<a name="l01563"></a>01563     index = 1;
<a name="l01564"></a>01564   }
<a name="l01565"></a>01565 
<a name="l01566"></a>01566   <span class="keywordflow">if</span>((argc != (index + 1)) || ((argc &gt; (index + 1)) &amp;&amp; (strcmp(argv[index + 1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) {
<a name="l01567"></a>01567     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l01568"></a>01568     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l01569"></a>01569   }
<a name="l01570"></a>01570 
<a name="l01571"></a>01571   <span class="comment">/* Initialize the system. */</span>
<a name="l01572"></a>01572   printf(<span class="stringliteral">&quot;Initializing the switch device.\r\n&quot;</span>);
<a name="l01573"></a>01573   rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01574"></a>01574 
<a name="l01575"></a>01575   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01576"></a>01576     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the switch device. Error %s\r\n&quot;</span>,
<a name="l01577"></a>01577         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01578"></a>01578     <span class="keywordflow">return</span> rv;
<a name="l01579"></a>01579   }
<a name="l01580"></a>01580 
<a name="l01581"></a>01581   <span class="comment">/* cold boot initialization commands */</span>
<a name="l01582"></a>01582   rv = <a class="code" href="examples_2util_8h.html#a2846e8ec8f46d212a3ae2493bdff7980" title="Set default configuration (like STP state, speed/duplex) for all ports.">example_port_default_config</a>(unit);
<a name="l01583"></a>01583   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l01584"></a>01584     printf(<span class="stringliteral">&quot;\r\nFailed to apply default config on ports, rv = %d (%s).\r\n&quot;</span>,
<a name="l01585"></a>01585         rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l01586"></a>01586   }
<a name="l01587"></a>01587 
<a name="l01588"></a>01588   <span class="keywordflow">while</span> (1) {
<a name="l01589"></a>01589     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l01590"></a>01590     printf(<span class="stringliteral">&quot;1. Configure VxLAN segment\n&quot;</span>);
<a name="l01591"></a>01591 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l01592"></a>01592 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l01593"></a>01593 <span class="preprocessor">#endif</span>
<a name="l01594"></a>01594 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application\n&quot;</span>);
<a name="l01595"></a>01595 
<a name="l01596"></a>01596     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l01597"></a>01597     {
<a name="l01598"></a>01598       printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l01599"></a>01599       <span class="keywordflow">continue</span>;
<a name="l01600"></a>01600     }
<a name="l01601"></a>01601     <span class="keywordflow">switch</span>(choice){
<a name="l01602"></a>01602 
<a name="l01603"></a>01603       <span class="keywordflow">case</span> 1:
<a name="l01604"></a>01604         {
<a name="l01605"></a>01605           <span class="comment">/* Configure VXLAN settings for access and network ports */</span>
<a name="l01606"></a>01606           printf(<span class="stringliteral">&quot;a. Enter Access port number\n&quot;</span>);
<a name="l01607"></a>01607           <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;port_a) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l01608"></a>01608           {
<a name="l01609"></a>01609             printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l01610"></a>01610             <span class="keywordflow">continue</span>;
<a name="l01611"></a>01611           }
<a name="l01612"></a>01612 
<a name="l01613"></a>01613           printf(<span class="stringliteral">&quot;b. Enter Network port number\n&quot;</span>);
<a name="l01614"></a>01614           <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;port_n) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l01615"></a>01615           {
<a name="l01616"></a>01616             printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l01617"></a>01617             <span class="keywordflow">continue</span>;
<a name="l01618"></a>01618           }
<a name="l01619"></a>01619 
<a name="l01620"></a>01620           printf(<span class="stringliteral">&quot;c. Enter VPN ID (Ex: 9216)\n&quot;</span>);
<a name="l01621"></a>01621           <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;vpn_id) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l01622"></a>01622           {
<a name="l01623"></a>01623             printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l01624"></a>01624             <span class="keywordflow">continue</span>;
<a name="l01625"></a>01625           }
<a name="l01626"></a>01626 
<a name="l01627"></a>01627           rv = <a class="code" href="dpp_2example__vxlan_8c.html#a5bd99907b1249af4dc595c4d17b727b3" title="Main function to build VxLAN IP tunnel.">example_vxlan</a>(unit, port_n, port_a, vpn_id); 
<a name="l01628"></a>01628           <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l01629"></a>01629           {
<a name="l01630"></a>01630             printf(<span class="stringliteral">&quot;\r\nVxLAN configuration has failed.\n&quot;</span>);
<a name="l01631"></a>01631             <span class="keywordflow">return</span> rv;
<a name="l01632"></a>01632           }
<a name="l01633"></a>01633 
<a name="l01634"></a>01634           printf(<span class="stringliteral">&quot;\r\nVxLAN configuration is done successfully\n&quot;</span>);
<a name="l01635"></a>01635           <span class="keywordflow">break</span>;
<a name="l01636"></a>01636         }
<a name="l01637"></a>01637 
<a name="l01638"></a>01638 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l01639"></a>01639 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l01640"></a>01640         {
<a name="l01641"></a>01641           opennsl_driver_shell();
<a name="l01642"></a>01642           <span class="keywordflow">break</span>;
<a name="l01643"></a>01643         }
<a name="l01644"></a>01644 <span class="preprocessor">#endif</span>
<a name="l01645"></a>01645 <span class="preprocessor"></span>
<a name="l01646"></a>01646       <span class="keywordflow">case</span> 0:
<a name="l01647"></a>01647         {
<a name="l01648"></a>01648           printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l01649"></a>01649           rv = <a class="code" href="driver_8h.html#aa760e8f1af45c7fd27ec014b82c572f2" title="Function to free up the resources and exit the driver.">opennsl_driver_exit</a>();
<a name="l01650"></a>01650           <span class="keywordflow">return</span> rv;
<a name="l01651"></a>01651         }
<a name="l01652"></a>01652       <span class="keywordflow">default</span>:
<a name="l01653"></a>01653         <span class="keywordflow">break</span>;
<a name="l01654"></a>01654     } <span class="comment">/* End of switch */</span>
<a name="l01655"></a>01655   } <span class="comment">/* End of while */</span>
<a name="l01656"></a>01656 
<a name="l01657"></a>01657   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l01658"></a>01658 }
<a name="l01659"></a>01659 <span class="comment">/* __doxy_func_body_end__ */</span>
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016-17 by Broadcom Limited. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Limited reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Limited is believed to be accurate and reliable. However, Broadcom Limited does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
