<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/dpp/example_packet_transmit.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/dpp/example_packet_transmit.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="dpp_2example__packet__transmit_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2017</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> **********************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> * \file     example_packet_transmit.c</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * \brief    Example code for packet transmission</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * \details  This example demonstrates the transmission of a packet</span>
<a name="l00023"></a>00023 <span class="comment"> *           through a specified port.</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> ************************************************************************/</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="version_8h.html" title="This file contains functions to get the build details.">sal/version.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2port_8h.html">opennsl/port.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2switch_8h.html">opennsl/switch.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2pkt_8h.html">opennsl/pkt.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="tx_8h.html">opennsl/tx.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="stack_8h.html">opennsl/stack.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="dpp_2example__packet__transmit_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00041</a> <span class="preprocessor">#define DEFAULT_UNIT  0</span>
<a name="l00042"></a><a class="code" href="dpp_2example__packet__transmit_8c.html#a91668ed1245d073a2ac84e6121205d28">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_VLAN  1</span>
<a name="l00043"></a><a class="code" href="dpp_2example__packet__transmit_8c.html#a068278b0838b6670ab0ab0a93ed77484">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_DIGITS_IN_CHOICE 5</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00045"></a><a class="code" href="dpp_2example__packet__transmit_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00045</a> <span class="keywordtype">char</span> <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00046"></a>00046 <span class="stringliteral">&quot;Syntax: example_packet_transmit                                       \n\r&quot;</span>
<a name="l00047"></a>00047 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00048"></a>00048 <span class="stringliteral">&quot;Paramaters: None.                                                     \n\r&quot;</span>
<a name="l00049"></a>00049 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00050"></a>00050 <span class="stringliteral">&quot;Example: The following command is used to demonstrate transmit and    \n\r&quot;</span>
<a name="l00051"></a>00051 <span class="stringliteral">&quot;         packet API&#39;s.                                                \n\r&quot;</span>
<a name="l00052"></a>00052 <span class="stringliteral">&quot;         example_packet_transmit                                      \n\r&quot;</span>
<a name="l00053"></a>00053 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00054"></a>00054 <span class="stringliteral">&quot;Usage Guidelines: None.                                               \n\r&quot;</span>;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="comment">/*****************************************************************/</span>
<a name="l00064"></a><a class="code" href="dpp_2example__packet__transmit_8c.html#a29fcf08e3f5e7cb66cfe3e744a8b124b">00064</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__packet__transmit_8c.html#a29fcf08e3f5e7cb66cfe3e744a8b124b" title="print packet contents">example_pkt_dump</a>(<a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> *data, <span class="keywordtype">int</span> len)
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066     <span class="keywordtype">int</span> i;
<a name="l00067"></a>00067     <span class="keywordtype">int</span> line_len = 16;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069     printf (<span class="stringliteral">&quot;\n packet dump for len = %d\n&quot;</span>, len);
<a name="l00070"></a>00070 
<a name="l00071"></a>00071     <span class="keywordflow">for</span> (i = 0; i &lt; len; i++)
<a name="l00072"></a>00072     {
<a name="l00073"></a>00073       <span class="keywordflow">if</span> (i % line_len == 0)
<a name="l00074"></a>00074       {
<a name="l00075"></a>00075         <span class="keywordflow">if</span> (i !=0) printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00076"></a>00076         printf(<span class="stringliteral">&quot;%04x  &quot;</span>, i);
<a name="l00077"></a>00077       }
<a name="l00078"></a>00078       printf (<span class="stringliteral">&quot;%02x &quot;</span>, (data[i]) &amp; 0xff);
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     printf (<span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l00082"></a>00082     <span class="keywordflow">return</span> 0;
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">/*****************************************************************/</span>
<a name="l00096"></a><a class="code" href="dpp_2example__packet__transmit_8c.html#a208041509858437e771297b868bdea46">00096</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__packet__transmit_8c.html#a208041509858437e771297b868bdea46" title="Send a packet on the specified port and VLAN.">example_pkt_send</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>, <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vlan)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00099"></a>00099   <span class="keywordtype">int</span> pkt_flags;
<a name="l00100"></a>00100   <span class="keywordtype">int</span> pkt_len = 128;
<a name="l00101"></a>00101   <span class="keywordtype">int</span> pkt_header_len = 0;
<a name="l00102"></a>00102   <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> pkt_header[64];
<a name="l00103"></a>00103   <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> pkt_tagged_data[64] =
<a name="l00104"></a>00104   {
<a name="l00105"></a>00105     0x00, 0x01, 0x02, 0x03, 0x04, 0x05, <span class="comment">/* DA */</span>
<a name="l00106"></a>00106     0x00, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, <span class="comment">/* SA */</span>
<a name="l00107"></a>00107     0x81, 0x00, 0x00, 0x01, <span class="comment">/* TPID + VID */</span>
<a name="l00108"></a>00108     0x08, 0x00, 0x45, 0x10, 0x00, 0x46, 0x00, 0x00, 0x00, 0x00, 0x32, 0x06,
<a name="l00109"></a>00109     0x82, 0xab, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02,
<a name="l00110"></a>00110     0x03, 0x04, 0x00, 0x04, 0x01, 0x00, 0x56, 0xf1, 0x39, 0x00, 0x00,
<a name="l00111"></a>00111     0x11, 0x22, 0x33, 0x44, 0x55, 0x66
<a name="l00112"></a>00112   };
<a name="l00113"></a>00113   <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> pkt_buf[128];
<a name="l00114"></a>00114   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> sysport = 0;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   pkt_flags = <a class="code" href="group__pkt.html#gabae7c32c7f54411a5c41636ca2d34f0b" title="Allocate buffer for CRC.">OPENNSL_TX_CRC_ALLOC</a>;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <a class="code" href="structopennsl__pkt__s.html" title="Initialize a OPENNSL packet structure.">opennsl_pkt_t</a> *tx_pkt;
<a name="l00119"></a>00119   rv = <a class="code" href="group__pkt.html#ga47a42ca3b1affa6979707e70007122ea" title="Allocate or deallocate a packet structure and packet data.">opennsl_pkt_alloc</a>(unit, pkt_len, pkt_flags, &amp;tx_pkt);
<a name="l00120"></a>00120   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00121"></a>00121   {
<a name="l00122"></a>00122     printf(<span class="stringliteral">&quot;Failed to allocate pkt memory, rv %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00123"></a>00123     <span class="keywordflow">return</span> rv;
<a name="l00124"></a>00124   }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126   rv = <a class="code" href="group__stack.html#ga25653c8557d241bf84b648d26847bd93" title="Given a Gport get the SAND System-Port.">opennsl_stk_gport_sysport_get</a>(unit, port, &amp;sysport);
<a name="l00127"></a>00127   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00128"></a>00128   {
<a name="l00129"></a>00129     printf(<span class="stringliteral">&quot;Failed to get system port for unit %d port %d, rv %s\n&quot;</span>, unit, port, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00130"></a>00130     <span class="keywordflow">return</span> rv;
<a name="l00131"></a>00131   }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133   <span class="keywordtype">void</span> * cookie = (<span class="keywordtype">void</span> *)1;
<a name="l00134"></a>00134   tx_pkt-&gt;<a class="code" href="structopennsl__pkt__s.html#a26583a267a574c2ee389df3cae8e0b28" title="Callback function.">call_back</a> = 0;
<a name="l00135"></a>00135   tx_pkt-&gt;<a class="code" href="structopennsl__pkt__s.html#af490392aee5e8ff9dd59bf3a991b9679" title="Number of blocks in data array.">blk_count</a> = 1;
<a name="l00136"></a>00136   tx_pkt-&gt;<a class="code" href="structopennsl__pkt__s.html#aa7048607e85c4487ce439f8a5ea873dd" title="Unit number.">unit</a> = 0;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138   <span class="comment">/* PTCH */</span>
<a name="l00139"></a>00139   pkt_header[pkt_header_len++] = 0x50;
<a name="l00140"></a>00140   pkt_header[pkt_header_len++] = 0;
<a name="l00141"></a>00141   <span class="comment">/* ITMH */</span>
<a name="l00142"></a>00142   pkt_header[pkt_header_len++] = 0x01;
<a name="l00143"></a>00143   pkt_header[pkt_header_len++] = 0x00;
<a name="l00144"></a>00144   pkt_header[pkt_header_len++] = (sysport &amp; 0xff);
<a name="l00145"></a>00145   pkt_header[pkt_header_len++] = 0x00;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147   pkt_len =  pkt_header_len + 64;
<a name="l00148"></a>00148   <span class="comment">/* VID */</span>
<a name="l00149"></a>00149   pkt_tagged_data[14] = (vlan &amp; 0xff00) &gt;&gt; 8;
<a name="l00150"></a>00150   pkt_tagged_data[15] = (vlan &amp; 0x00ff);
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   memset(pkt_buf, 0, 128);
<a name="l00153"></a>00153   memcpy(pkt_buf, pkt_header, pkt_header_len);
<a name="l00154"></a>00154   memcpy(&amp;pkt_buf[pkt_header_len], pkt_tagged_data, 64);
<a name="l00155"></a>00155   pkt_len = pkt_header_len + 64;
<a name="l00156"></a>00156   <a class="code" href="group__pkt.html#ga9acefb6d4b56d5988e9f43fc20375c98" title="Copy data into the data blocks of a packet structure.">opennsl_pkt_memcpy</a> (tx_pkt, 0, pkt_buf, pkt_len);
<a name="l00157"></a>00157 
<a name="l00158"></a>00158   rv = <a class="code" href="group__pkt.html#ga967e993e7903a64d2a170f23b8f6c7ba" title="Transmit one or more packets.">opennsl_tx</a> (unit, tx_pkt, cookie);
<a name="l00159"></a>00159   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00160"></a>00160   {
<a name="l00161"></a>00161     printf(<span class="stringliteral">&quot;Failed to transmit packet, rv %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00162"></a>00162     <span class="keywordflow">return</span> rv;
<a name="l00163"></a>00163   }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <a class="code" href="dpp_2example__packet__transmit_8c.html#a29fcf08e3f5e7cb66cfe3e744a8b124b" title="print packet contents">example_pkt_dump</a> (pkt_buf, pkt_len);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167   rv = <a class="code" href="group__pkt.html#gaad1aa79d4ef9907edc9ab6b30f6a0b0f" title="Allocate or deallocate a packet structure and packet data.">opennsl_pkt_free</a>(unit, tx_pkt);
<a name="l00168"></a>00168   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00169"></a>00169   {
<a name="l00170"></a>00170     printf(<span class="stringliteral">&quot;Failed to free up packet memory, rv %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00171"></a>00171     <span class="keywordflow">return</span> rv;
<a name="l00172"></a>00172   }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   <span class="keywordflow">return</span> rv;
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="comment">/*****************************************************************/</span>
<a name="l00188"></a><a class="code" href="dpp_2example__packet__transmit_8c.html#afafac394430c5b69fe38db87ad5ca95c">00188</a> <span class="keywordtype">void</span> <a class="code" href="dpp_2example__packet__transmit_8c.html#afafac394430c5b69fe38db87ad5ca95c" title="Form a packet and send multiple packets from the specified port.">example_multi_pkt_send</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>,
<a name="l00189"></a>00189     <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vlan,  <span class="keywordtype">int</span> count)
<a name="l00190"></a>00190 {
<a name="l00191"></a>00191   <span class="keywordtype">int</span> i;
<a name="l00192"></a>00192   <span class="keywordtype">int</span> rv;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l00195"></a>00195   {
<a name="l00196"></a>00196     rv = <a class="code" href="dpp_2example__packet__transmit_8c.html#a208041509858437e771297b868bdea46" title="Send a packet on the specified port and VLAN.">example_pkt_send</a>(unit, port, vlan);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     <span class="keywordflow">if</span> (!<a class="code" href="group__error.html#ga90e491548f2e873e9fd1615f610f4c0a">OPENNSL_SUCCESS</a>(rv))
<a name="l00199"></a>00199     {
<a name="l00200"></a>00200       printf(<span class="stringliteral">&quot;Error Sending Packet: %d.  Error: %s\n&quot;</span>, i + 1, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202     <span class="keywordflow">else</span>
<a name="l00203"></a>00203     {
<a name="l00204"></a>00204       printf(<span class="stringliteral">&quot;Transmitted Packet %d\n&quot;</span>, i + 1);
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206   }
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="comment">/*****************************************************************/</span>
<a name="l00217"></a><a class="code" href="dpp_2example__packet__transmit_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00217</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for policer application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00218"></a>00218 {
<a name="l00219"></a>00219   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a>   rv;
<a name="l00220"></a>00220   <span class="keywordtype">int</span> count;
<a name="l00221"></a>00221   <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>;
<a name="l00222"></a>00222   <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vlan;
<a name="l00223"></a>00223   <span class="keywordtype">int</span> unit = <a class="code" href="dpp_2example__packet__transmit_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l00224"></a>00224   <span class="keywordtype">int</span> choice;
<a name="l00225"></a>00225   <span class="keywordtype">int</span> index = 0;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227   <span class="keywordflow">if</span>(strcmp(argv[0], <span class="stringliteral">&quot;gdb&quot;</span>) == 0)
<a name="l00228"></a>00228   {
<a name="l00229"></a>00229     index = 1;
<a name="l00230"></a>00230   }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232   <span class="keywordflow">if</span>((argc != (index + 1)) || ((argc &gt; (index + 1)) &amp;&amp; (strcmp(argv[index + 1], <span class="stringliteral">&quot;--help&quot;</span>) == 0)))
<a name="l00233"></a>00233   {
<a name="l00234"></a>00234     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00235"></a>00235     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00236"></a>00236   }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   <span class="comment">/* Initialize the system. */</span>
<a name="l00239"></a>00239   printf(<span class="stringliteral">&quot;Initializing the system.\r\n&quot;</span>);
<a name="l00240"></a>00240   rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00243"></a>00243   {
<a name="l00244"></a>00244     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system. Error %s\r\n&quot;</span>,
<a name="l00245"></a>00245         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00246"></a>00246     <span class="keywordflow">return</span> rv;
<a name="l00247"></a>00247   }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249   <span class="comment">/* cold boot initialization commands */</span>
<a name="l00250"></a>00250   rv = <a class="code" href="examples_2util_8h.html#a2846e8ec8f46d212a3ae2493bdff7980" title="Set default configuration (like STP state, speed/duplex) for all ports.">example_port_default_config</a>(unit);
<a name="l00251"></a>00251   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00252"></a>00252   {
<a name="l00253"></a>00253     printf(<span class="stringliteral">&quot;\r\nFailed to apply default config on ports, rc = %d (%s).\r\n&quot;</span>,
<a name="l00254"></a>00254         rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00255"></a>00255   }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <span class="comment">/* Add ports to default vlan. */</span>
<a name="l00258"></a>00258   printf(<span class="stringliteral">&quot;Adding ports to default vlan.\r\n&quot;</span>);
<a name="l00259"></a>00259   rv = <a class="code" href="examples_2util_8h.html#a2d14e4de1f4a7192ac7e378f8f7c63ff" title="Add all ports to default vlan.">example_switch_default_vlan_config</a>(unit);
<a name="l00260"></a>00260   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00261"></a>00261   {
<a name="l00262"></a>00262     printf(<span class="stringliteral">&quot;\r\nFailed to add default ports. rv: %s\r\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00263"></a>00263     <span class="keywordflow">return</span> rv;
<a name="l00264"></a>00264   }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   <span class="keywordflow">while</span> (1)
<a name="l00267"></a>00267   {
<a name="l00268"></a>00268     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l00269"></a>00269     printf(<span class="stringliteral">&quot;1. Transmit a packet\n&quot;</span>);
<a name="l00270"></a>00270     printf(<span class="stringliteral">&quot;2. Display OpenNSL version\n&quot;</span>);
<a name="l00271"></a>00271 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00272"></a>00272 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00273"></a>00273 <span class="preprocessor">#endif</span>
<a name="l00274"></a>00274 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application\n&quot;</span>);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00277"></a>00277     {
<a name="l00278"></a>00278       printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00279"></a>00279       <span class="keywordflow">continue</span>;
<a name="l00280"></a>00280     }
<a name="l00281"></a>00281     <span class="keywordflow">switch</span>(choice){
<a name="l00282"></a>00282 
<a name="l00283"></a>00283       <span class="keywordflow">case</span> 1:
<a name="l00284"></a>00284         {
<a name="l00285"></a>00285           printf(<span class="stringliteral">&quot;\r\nEnter the port on which packet needs to be transmitted.\r\n&quot;</span>);
<a name="l00286"></a>00286           <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;port) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00287"></a>00287           {
<a name="l00288"></a>00288             printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00289"></a>00289             <span class="keywordflow">continue</span>;
<a name="l00290"></a>00290           }
<a name="l00291"></a>00291 
<a name="l00292"></a>00292           printf(<span class="stringliteral">&quot;\r\nEnter VLAN ID of the packet.\r\n&quot;</span>);
<a name="l00293"></a>00293           <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00294"></a>00294           {
<a name="l00295"></a>00295             printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00296"></a>00296             <span class="keywordflow">continue</span>;
<a name="l00297"></a>00297           }
<a name="l00298"></a>00298           vlan = (<a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a>) choice;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300           printf(<span class="stringliteral">&quot;\r\nEnter number of packets to be sent.\r\n&quot;</span>);
<a name="l00301"></a>00301           <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;count) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00302"></a>00302           {
<a name="l00303"></a>00303             printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00304"></a>00304             <span class="keywordflow">continue</span>;
<a name="l00305"></a>00305           }
<a name="l00306"></a>00306 
<a name="l00307"></a>00307           <span class="comment">/* Transmit packet(s) on the specified port */</span>
<a name="l00308"></a>00308           <a class="code" href="dpp_2example__packet__transmit_8c.html#afafac394430c5b69fe38db87ad5ca95c" title="Form a packet and send multiple packets from the specified port.">example_multi_pkt_send</a>(unit, port, vlan, count);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310           <span class="keywordflow">break</span>;
<a name="l00311"></a>00311         } <span class="comment">/* End of case 1 */</span>
<a name="l00312"></a>00312 
<a name="l00313"></a>00313       <span class="keywordflow">case</span> 2:
<a name="l00314"></a>00314         {
<a name="l00315"></a>00315           printf(<span class="stringliteral">&quot;OpenNSL version: %s\n&quot;</span>, <a class="code" href="version_8h.html#a3a64145ac66212711af67ac2e7ecc22d" title="To get the OpenNSL version.">opennsl_version_get</a>());
<a name="l00316"></a>00316           <span class="keywordflow">break</span>;
<a name="l00317"></a>00317         }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00321"></a>00321         {
<a name="l00322"></a>00322           opennsl_driver_shell();
<a name="l00323"></a>00323           <span class="keywordflow">break</span>;
<a name="l00324"></a>00324         }
<a name="l00325"></a>00325 <span class="preprocessor">#endif</span>
<a name="l00326"></a>00326 <span class="preprocessor"></span>
<a name="l00327"></a>00327       <span class="keywordflow">case</span> 0:
<a name="l00328"></a>00328         {
<a name="l00329"></a>00329           printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00330"></a>00330           rv = <a class="code" href="driver_8h.html#aa760e8f1af45c7fd27ec014b82c572f2" title="Function to free up the resources and exit the driver.">opennsl_driver_exit</a>();
<a name="l00331"></a>00331           <span class="keywordflow">return</span> rv;
<a name="l00332"></a>00332         }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334       <span class="keywordflow">default</span>:
<a name="l00335"></a>00335         <span class="keywordflow">break</span>;
<a name="l00336"></a>00336     } <span class="comment">/* End of switch */</span>
<a name="l00337"></a>00337   } <span class="comment">/* End of while */</span>
<a name="l00338"></a>00338 
<a name="l00339"></a>00339   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00340"></a>00340 }
<a name="l00341"></a>00341 <span class="comment">/* __doxy_func_body_end__ */</span>
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016-17 by Broadcom Limited. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Limited reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Limited is believed to be accurate and reliable. However, Broadcom Limited does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
