<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/dpp/example_routing.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/dpp/example_routing.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="dpp_2example__routing_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2017</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> **********************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * \file         example_routing.c</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief        OPENNSL example program to demonstrate routing</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \details      This example demonstrates routing of packets across</span>
<a name="l00024"></a>00024 <span class="comment"> * two different VLAN&#39;s by using host route and default routes.</span>
<a name="l00025"></a>00025 <span class="comment"> * In the first case, switch installs a host route to route</span>
<a name="l00026"></a>00026 <span class="comment"> * packets from INGRESS_VLAN, destination MAC = MY_MAC to HOST1</span>
<a name="l00027"></a>00027 <span class="comment"> * attached to EGRESS_VLAN. But, in the second case a default</span>
<a name="l00028"></a>00028 <span class="comment"> * route is installed to route packets from INGRESS_VLAN,</span>
<a name="l00029"></a>00029 <span class="comment"> * destination MAC = MY_MAC destined to DEFAULT_SUBNET_IP to</span>
<a name="l00030"></a>00030 <span class="comment"> * egress port that is a member of EGRESS_VLAN.</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> **********************************************************************/</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2switch_8h.html">opennsl/switch.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="l2_8h.html">opennsl/l2.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="l3_8h.html">opennsl/l3.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="dpp_2example__routing_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00044</a> <span class="keywordtype">char</span> <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00045"></a>00045 <span class="stringliteral">&quot;Syntax: example_routing                                                \n\r&quot;</span>
<a name="l00046"></a>00046 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00047"></a>00047 <span class="stringliteral">&quot;Paramaters:                                                            \n\r&quot;</span>
<a name="l00048"></a>00048 <span class="stringliteral">&quot;       in_sysport  - Ingress port number on which test packet is       \n\r&quot;</span>
<a name="l00049"></a>00049 <span class="stringliteral">&quot;                     received                                          \n\r&quot;</span>
<a name="l00050"></a>00050 <span class="stringliteral">&quot;       out_sysport - Egress port number to which packet is routed.     \n\r&quot;</span>
<a name="l00051"></a>00051 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00052"></a>00052 <span class="stringliteral">&quot;Example: The following command is used to demonstrate routing from     \n\r&quot;</span>
<a name="l00053"></a>00053 <span class="stringliteral">&quot;         port 2 to port 6.                                             \n\r&quot;</span>
<a name="l00054"></a>00054 <span class="stringliteral">&quot;         example_routing 2 6                                           \n\r&quot;</span>
<a name="l00055"></a>00055 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00056"></a>00056 <span class="stringliteral">&quot;Usage Guidelines: This program request the user to enter the           \n\r&quot;</span>
<a name="l00057"></a>00057 <span class="stringliteral">&quot;       ingress and egress port numbers. Using the host route, it routes\n\r&quot;</span>
<a name="l00058"></a>00058 <span class="stringliteral">&quot;       the packets arrived on ingress port with VLAN = 10,             \n\r&quot;</span>
<a name="l00059"></a>00059 <span class="stringliteral">&quot;       destination MAC = 00:11:22:33:99:58 to host 20.1.1.2 attached   \n\r&quot;</span>
<a name="l00060"></a>00060 <span class="stringliteral">&quot;       to egress port that is a member of VLAN 20. Using the default   \n\r&quot;</span>
<a name="l00061"></a>00061 <span class="stringliteral">&quot;       route, it also routes packets with VLAN = 10, destination       \n\r&quot;</span>
<a name="l00062"></a>00062 <span class="stringliteral">&quot;       MAC = 00:11:22:33:99:58 destinated to subnet 55.0.0.0 to egress \n\r&quot;</span>
<a name="l00063"></a>00063 <span class="stringliteral">&quot;       port that is a member of VLAN 20.                               \n\r&quot;</span>
<a name="l00064"></a>00064 <span class="stringliteral">&quot;       The routed packet should have destination MAC same as           \n\r&quot;</span>
<a name="l00065"></a>00065 <span class="stringliteral">&quot;       00:00:70:5B:C7:34 with TTL decremented by 1.                    \n\r&quot;</span>;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="dpp_2example__routing_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00068</a> <span class="preprocessor">#define DEFAULT_UNIT         0</span>
<a name="l00069"></a><a class="code" href="dpp_2example__routing_8c.html#a30c3344f99ac40e769705eda221a6b5b">00069</a> <span class="preprocessor"></span><span class="preprocessor">#define INGRESS_VLAN         10</span>
<a name="l00070"></a><a class="code" href="dpp_2example__routing_8c.html#a344c92147986035627b0d387b8790318">00070</a> <span class="preprocessor"></span><span class="preprocessor">#define EGRESS_VLAN          20</span>
<a name="l00071"></a><a class="code" href="dpp_2example__routing_8c.html#a2971da41865730e076908e0ae6757103">00071</a> <span class="preprocessor"></span><span class="preprocessor">#define HOST1                0x14010102     </span><span class="comment">/* 20.1.1.2 */</span>
<a name="l00072"></a><a class="code" href="dpp_2example__routing_8c.html#aeaa487f5205c0aac9da4e004c173429c">00072</a> <span class="preprocessor">#define MY_MAC               {0x00, 0x11, 0x22, 0x33, 0x99, 0x58}</span>
<a name="l00073"></a>00073 <span class="preprocessor"></span><span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00074"></a><a class="code" href="dpp_2example__routing_8c.html#ac777a672bdb738a1ffcbb511b6ba2ed9">00074</a> <span class="preprocessor">#define NEXTHOP_MAC          {0x00, 0x00, 0x70, 0x5B, 0xC7, 0x34}</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00076"></a><a class="code" href="dpp_2example__routing_8c.html#a84f447ab6677e412dc77e89f08152369">00076</a> <span class="preprocessor">#define DEFAULT_SUBNET_IP    0x37000000         </span><span class="comment">/* 55.0.0.0 */</span>
<a name="l00077"></a><a class="code" href="dpp_2example__routing_8c.html#a6bf0d6365e5891e41a12fe0a84452a46">00077</a> <span class="preprocessor">#define DEFAULT_SUBNET_MASK  0xff000000         </span><span class="comment">/* /8 network */</span>
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">/**************************************************************************/</span>
<a name="l00088"></a><a class="code" href="dpp_2example__routing_8c.html#a91d8e3aa1ee27bddd5de08253c34fa73">00088</a> <span class="keywordtype">void</span> <a class="code" href="dpp_2example__routing_8c.html#a91d8e3aa1ee27bddd5de08253c34fa73" title="To print the host entry.">print_host</a>(<span class="keywordtype">char</span> *type, <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> host, <span class="keywordtype">int</span> vrf)
<a name="l00089"></a>00089 {
<a name="l00090"></a>00090   printf(<span class="stringliteral">&quot;%s  vrf : %d   &quot;</span>, type, vrf);
<a name="l00091"></a>00091   <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot;&quot;</span>, host);
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">/**************************************************************************/</span>
<a name="l00105"></a><a class="code" href="dpp_2example__routing_8c.html#abf8769d64fbc9c9012f1070fdcb080d2">00105</a> <span class="keywordtype">void</span> <a class="code" href="dpp_2example__routing_8c.html#abf8769d64fbc9c9012f1070fdcb080d2" title="To print the route entry.">print_route</a>(<span class="keywordtype">char</span> *type, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> addr, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> mask, <span class="keywordtype">int</span> vrf)
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107   printf(<span class="stringliteral">&quot;%s  vrf : %d   &quot;</span>, type, vrf);
<a name="l00108"></a>00108   <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot;&quot;</span>, addr);
<a name="l00109"></a>00109   printf(<span class="stringliteral">&quot;/&quot;</span>);
<a name="l00110"></a>00110   <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot;&quot;</span>, mask);
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">/**************************************************************************/</span>
<a name="l00125"></a><a class="code" href="dpp_2example__routing_8c.html#a180d5fe6445ec157bd332f916060651d">00125</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__routing_8c.html#a180d5fe6445ec157bd332f916060651d" title="To add host based route.">example_host_add</a>(<span class="keywordtype">int</span> unit, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> addr, <span class="keywordtype">int</span> vrf, <span class="keywordtype">int</span> intf)
<a name="l00126"></a>00126 {
<a name="l00127"></a>00127     <span class="keywordtype">int</span> rc;
<a name="l00128"></a>00128     <a class="code" href="structopennsl__l3__host__s.html" title="L3 Host Structure.">opennsl_l3_host_t</a> l3host;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     <a class="code" href="group__l3.html#ga2902ef9ba3facbb09cf79ad9f97e32a4" title="Initialize a opennsl_l3_host_t structure.">opennsl_l3_host_t_init</a>(&amp;l3host);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     l3host.<a class="code" href="structopennsl__l3__host__s.html#ab24ca9ef38b0dfa61e097e10cf97bc60" title="See OPENNSL_L3_xxx flag definitions.">l3a_flags</a> = 0;
<a name="l00133"></a>00133     l3host.<a class="code" href="structopennsl__l3__host__s.html#a3143b4bacdaa29423449a37f71d6343f" title="Destination host IP address (IPv4).">l3a_ip_addr</a> = addr;
<a name="l00134"></a>00134     l3host.<a class="code" href="structopennsl__l3__host__s.html#a561bf70bc761fa1250ef4bc156a62e94" title="Virtual router instance.">l3a_vrf</a> = vrf;
<a name="l00135"></a>00135     l3host.<a class="code" href="structopennsl__l3__host__s.html#a00aa36c796ba45462b1eecd1dcaa7e58" title="L3 intf associated with this address.">l3a_intf</a> = intf;
<a name="l00136"></a>00136     l3host.<a class="code" href="structopennsl__l3__host__s.html#a7bb54abde72384e8b7dc7693791105c6" title="Port/TGID packet is switched to.">l3a_port_tgid</a> = 0;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     rc = <a class="code" href="group__l3.html#ga2ff0b5376d55cc362714e343d192db45" title="Add an entry into the L3 switching table.">opennsl_l3_host_add</a>(unit, &amp;l3host);
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00140"></a>00140       printf (<span class="stringliteral">&quot;opennsl_l3_host_add failed: %x \n&quot;</span>, rc);
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142 
<a name="l00143"></a>00143     <span class="keywordflow">return</span> rc;
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="comment">/**************************************************************************/</span>
<a name="l00160"></a><a class="code" href="dpp_2example__routing_8c.html#ad0bd741922e21adeac11f23b946ce296">00160</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__routing_8c.html#ad0bd741922e21adeac11f23b946ce296" title="To add subnet based route.">example_route_add</a>(<span class="keywordtype">int</span> unit, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> addr, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> mask, <span class="keywordtype">int</span> vrf, <span class="keywordtype">int</span> intf) {
<a name="l00161"></a>00161   <span class="keywordtype">int</span> rc;
<a name="l00162"></a>00162   <a class="code" href="structopennsl__l3__route__s.html" title="L3 Route Structure.">opennsl_l3_route_t</a> l3rt;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164   <a class="code" href="group__l3.html#ga97c194ad2c065d5bf45d3f3a9c6c0998" title="Initialize a opennsl_l3_route_t structure.">opennsl_l3_route_t_init</a>(&amp;l3rt);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166   l3rt.<a class="code" href="structopennsl__l3__route__s.html#acfbb25072754c882757a9738475a3fd6" title="See OPENNSL_L3_xxx flag definitions.">l3a_flags</a> = 0;
<a name="l00167"></a>00167   l3rt.<a class="code" href="structopennsl__l3__route__s.html#a433b102f16a1b6aa9366a03f83b44e77" title="IP subnet address (IPv4).">l3a_subnet</a> = addr;
<a name="l00168"></a>00168   l3rt.<a class="code" href="structopennsl__l3__route__s.html#af36c5f11f9ed1ea6f18a96e180ec48fa" title="IP subnet mask (IPv4).">l3a_ip_mask</a> = mask;
<a name="l00169"></a>00169   l3rt.<a class="code" href="structopennsl__l3__route__s.html#a0ed4318f23d66a4bb4e4034bef15751c" title="Virtual router instance.">l3a_vrf</a> = vrf;
<a name="l00170"></a>00170   l3rt.<a class="code" href="structopennsl__l3__route__s.html#a6154bd36147b624e453f82a5396be222" title="L3 interface associated with route.">l3a_intf</a> = intf;
<a name="l00171"></a>00171   l3rt.<a class="code" href="structopennsl__l3__route__s.html#a2eddc194bf238ce2510a4fdf26e4c6f6" title="Port or trunk group ID.">l3a_port_tgid</a> = 0;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   rc = <a class="code" href="group__l3.html#gafc35f6809a98707e3c54610512094a1d" title="Add an IP route to the L3 route table.">opennsl_l3_route_add</a>(unit, &amp;l3rt);
<a name="l00174"></a>00174   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00175"></a>00175     printf (<span class="stringliteral">&quot;opennsl_l3_route_add failed: %x \n&quot;</span>, rc);
<a name="l00176"></a>00176   }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178   <a class="code" href="dpp_2example__routing_8c.html#abf8769d64fbc9c9012f1070fdcb080d2" title="To print the route entry.">print_route</a>(<span class="stringliteral">&quot;add route&quot;</span>, addr, mask, vrf);
<a name="l00179"></a>00179   printf(<span class="stringliteral">&quot;---&gt; egress-object=0x%08x, \n&quot;</span>, intf);
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keywordflow">return</span> rc;
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="comment">/**************************************************************************/</span>
<a name="l00204"></a><a class="code" href="dpp_2example__routing_8c.html#a8c917a57f4dac4fb64dda7803c25831d">00204</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__routing_8c.html#a8c917a57f4dac4fb64dda7803c25831d" title="Creates Router interface.">example_create_l3_intf</a>(<span class="keywordtype">int</span> unit, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> flags, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>, <span class="keywordtype">int</span> vlan,
<a name="l00205"></a>00205     <span class="keywordtype">int</span> vrf, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac_addr, <span class="keywordtype">int</span> ttl, <span class="keywordtype">int</span> *intf)
<a name="l00206"></a>00206 {
<a name="l00207"></a>00207   <span class="keywordtype">int</span> rc, station_id;
<a name="l00208"></a>00208   <a class="code" href="structopennsl__l3__intf__s.html" title="L3 Interface Structure.">opennsl_l3_intf_t</a> l3if;
<a name="l00209"></a>00209   <a class="code" href="structopennsl__l3__ingress__s.html" title="L3 Ingress Structure.">opennsl_l3_ingress_t</a> l3_ing_if;
<a name="l00210"></a>00210   <a class="code" href="structopennsl__l2__station__s.html" title="L2 Station address info.">opennsl_l2_station_t</a> station;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   <a class="code" href="group__l3.html#gaa92edab97138caed29fe11f4f9b35fa7" title="Initialize a opennsl_l3_intf_t structure.">opennsl_l3_intf_t_init</a>(&amp;l3if);
<a name="l00213"></a>00213   <a class="code" href="group__l3.html#ga326fd6c3b1e90668a46fe57d4fa5d482" title="Initialize L3 Ingress Interface object structure.">opennsl_l3_ingress_t_init</a>(&amp;l3_ing_if);
<a name="l00214"></a>00214   <a class="code" href="group__l2.html#ga237f10dccfaf6f29a0c4ccee74a3ed8e" title="Initialize L2 Station structure.">opennsl_l2_station_t_init</a>(&amp;station);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216   <span class="comment">/* set my-Mac global MSB */</span>
<a name="l00217"></a>00217   station.<a class="code" href="structopennsl__l2__station__s.html#a2eb42681485db17c250d2aab2481403d" title="OPENNSL_L2_STATION_xxx flags.">flags</a> = 0;
<a name="l00218"></a>00218   memcpy(station.<a class="code" href="structopennsl__l2__station__s.html#ac294283242a88ad175d25e02f621d5f5" title="Destination MAC address to match.">dst_mac</a>, mac_addr, 6);
<a name="l00219"></a>00219   station.<a class="code" href="structopennsl__l2__station__s.html#a42011f54c5fd03cd3c6bf292b14e9af5" title="VLAN mask value.">vlan_mask</a> = 0; <span class="comment">/* vsi is not valid */</span>
<a name="l00220"></a>00220   station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[0] = 0xff; <span class="comment">/* dst_mac my-Mac MSB mask is -1 */</span>
<a name="l00221"></a>00221   station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[1] = 0xff;
<a name="l00222"></a>00222   station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[2] = 0xff;
<a name="l00223"></a>00223   station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[3] = 0xff;
<a name="l00224"></a>00224   station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[4] = 0xff;
<a name="l00225"></a>00225   station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>[5] = 0xff;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227   rc = <a class="code" href="group__l2.html#ga8b8c76a2dd59776079dba4e8e25b681c" title="Add an entry to L2 Station table.">opennsl_l2_station_add</a>(unit, &amp;station_id, &amp;station);
<a name="l00228"></a>00228   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00229"></a>00229     <span class="keywordflow">return</span> rc;
<a name="l00230"></a>00230   }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232   rc = <a class="code" href="group__vlan.html#ga4db9e633ba9c276064768d1718c3062c" title="Allocate and configure a VLAN on the OPENNSL device.">opennsl_vlan_create</a>(unit, vlan);
<a name="l00233"></a>00233   <span class="keywordflow">if</span> (rc == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5ad03e135eecd46c9c1280e7b3f6ab5b6a">OPENNSL_E_EXISTS</a>) {
<a name="l00234"></a>00234     printf(<span class="stringliteral">&quot;vlan (%d) already exists&quot;</span>, vlan);
<a name="l00235"></a>00235   }
<a name="l00236"></a>00236   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00237"></a>00237     printf(<span class="stringliteral">&quot;fail open vlan (%d)&quot;</span>, vlan);
<a name="l00238"></a>00238     printf(<span class="stringliteral">&quot;    continue..\n&quot;</span>);
<a name="l00239"></a>00239   }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   rc = <a class="code" href="group__vlan.html#ga56e2dc3c7cf8dd9dd7985c4980393645" title="Add a virtual or physical port to the specified VLAN.">opennsl_vlan_gport_add</a>(unit, vlan, port, 0);
<a name="l00242"></a>00242   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00243"></a>00243     printf(<span class="stringliteral">&quot;fail add port(0x%08x) to vlan(%d)\n&quot;</span>, port, vlan);
<a name="l00244"></a>00244     <span class="keywordflow">return</span> rc;
<a name="l00245"></a>00245   }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247   memcpy(l3if.<a class="code" href="structopennsl__l3__intf__s.html#ace9be269a08c66e4420c4a11b1689936" title="MAC address.">l3a_mac_addr</a>, mac_addr, 6);
<a name="l00248"></a>00248   l3if.<a class="code" href="structopennsl__l3__intf__s.html#acc865cc8d7ef1ed69ca9d3648ad47c07" title="VLAN ID.">l3a_vid</a> = vlan;
<a name="l00249"></a>00249   l3if.<a class="code" href="structopennsl__l3__intf__s.html#afd264ddfcd5088463180739c886a68c7" title="TTL threshold.">l3a_ttl</a> = ttl;
<a name="l00250"></a>00250   l3if.<a class="code" href="structopennsl__l3__intf__s.html#a006aee03ae47f03204d59537eb568bc0" title="MTU.">l3a_mtu</a> = 1524;
<a name="l00251"></a>00251   l3if.<a class="code" href="structopennsl__l3__intf__s.html#a1f4aef82705348abe8caec9a827cb5bf" title="See OPENNSL_L3_XXX flag definitions.">l3a_flags</a> = flags;
<a name="l00252"></a>00252   l3if.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a> = *intf;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254   rc = <a class="code" href="group__l3.html#ga9706ea196e518e48a9a7940471c7a04d" title="Create a new L3 interface.">opennsl_l3_intf_create</a>(unit, &amp;l3if);
<a name="l00255"></a>00255   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00256"></a>00256     <span class="keywordflow">return</span> rc;
<a name="l00257"></a>00257   }
<a name="l00258"></a>00258   *intf = l3if.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a>;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   l3_ing_if.<a class="code" href="structopennsl__l3__ingress__s.html#aebfa01a97a7e22d12e87977947a410c6" title="Interface flags.">flags</a> = <a class="code" href="group__l3.html#gaffe7430b00fe89bbf5d8b1445518d590" title="L3 Ingress ID is provided.">OPENNSL_L3_INGRESS_WITH_ID</a> | <a class="code" href="group__l3.html#ga51d5fe02d5f4160e9e856b4ffcdb5559" title="Allow Global Route on L3 Ingress Interface.">OPENNSL_L3_INGRESS_GLOBAL_ROUTE</a>; <span class="comment">/* must, as we update exist RIF */</span>
<a name="l00261"></a>00261   l3_ing_if.<a class="code" href="structopennsl__l3__ingress__s.html#af0b51967b7d9f56282a37303a77e4edb" title="Virtual router id.">vrf</a> = vrf;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   rc = <a class="code" href="group__l3.html#ga3687e6ad79ebc4e99820655e6b4f55b4" title="Create L3 Ingress Interface object.">opennsl_l3_ingress_create</a>(unit, &amp;l3_ing_if, &amp;l3if.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a>);
<a name="l00264"></a>00264   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00265"></a>00265     <span class="keywordflow">return</span> rc;
<a name="l00266"></a>00266   }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   <span class="keywordflow">return</span> rc;
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="comment">/**************************************************************************/</span>
<a name="l00292"></a><a class="code" href="dpp_2example__routing_8c.html#a02a44759ff7b5b5f7cdcf06f2ac74bea">00292</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__routing_8c.html#a02a44759ff7b5b5f7cdcf06f2ac74bea" title="create l3 egress object object includes next hop information.">example_create_l3_egress</a>(<span class="keywordtype">int</span> unit, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> flags, <span class="keywordtype">int</span> out_port, <span class="keywordtype">int</span> vlan,
<a name="l00293"></a>00293     <span class="keywordtype">int</span> l3_eg_intf, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> nhop_mac_addr, <span class="keywordtype">int</span> *intf, <span class="keywordtype">int</span> *encap_id)
<a name="l00294"></a>00294 {
<a name="l00295"></a>00295   <span class="keywordtype">int</span> rc;
<a name="l00296"></a>00296   <a class="code" href="structopennsl__l3__egress__s.html" title="L3 Egress Structure.">opennsl_l3_egress_t</a> l3eg;
<a name="l00297"></a>00297   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> l3egid;
<a name="l00298"></a>00298   <span class="keywordtype">int</span> mod = 0;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <a class="code" href="group__l3.html#ga10b5ea766149d2bfdcd9d453939057e5" title="Initialize a opennsl_l3_egress_t structure.">opennsl_l3_egress_t_init</a>(&amp;l3eg);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a495387f57bb66a0b0c38842564af10ec" title="L3 interface (source MAC, tunnel).">intf</a> = l3_eg_intf;
<a name="l00303"></a>00303   memcpy(l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>, nhop_mac_addr, 6);
<a name="l00304"></a>00304   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a4559c3254ee6ba88106523dd8c9b4422" title="Next hop vlan id.">vlan</a>     = vlan;
<a name="l00305"></a>00305   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#ac2808e98d73621c12f027186fb74cbaf">module</a>   = mod;
<a name="l00306"></a>00306   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#af53aa7695462aa231d4ba889ad06601a" title="Port packet switched to (if !OPENNSL_L3_TGID).">port</a>     = out_port;
<a name="l00307"></a>00307   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#aa2d4d9b638d36c0ead585e6c9e103f46" title="Encapsulation index.">encap_id</a> = *encap_id;
<a name="l00308"></a>00308   l3egid        = *intf;
<a name="l00309"></a>00309   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#ad2020d0ca398d03556c939201f5d1744" title="Interface flags (OPENNSL_L3_TGID, OPENNSL_L3_L2TOCPU).">flags</a>    = flags;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311   rc = <a class="code" href="group__l3.html#ga0b4c7fdba7b362a408ba712e6894ee50" title="Create an Egress forwarding object.">opennsl_l3_egress_create</a>(unit, flags, &amp;l3eg, &amp;l3egid);
<a name="l00312"></a>00312   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00313"></a>00313     printf(<span class="stringliteral">&quot;Error, create egress object, out_port = %d, \n&quot;</span>, out_port);
<a name="l00314"></a>00314     <span class="keywordflow">return</span> rc;
<a name="l00315"></a>00315   }
<a name="l00316"></a>00316   *encap_id = l3eg.<a class="code" href="structopennsl__l3__egress__s.html#aa2d4d9b638d36c0ead585e6c9e103f46" title="Encapsulation index.">encap_id</a>;
<a name="l00317"></a>00317   *intf = l3egid;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="keywordflow">return</span> rc;
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 <span class="comment">/**************************************************************************/</span>
<a name="l00332"></a><a class="code" href="dpp_2example__routing_8c.html#ab2916e2f9d9f1c255c9dddf4a42c79a9">00332</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__routing_8c.html#ab2916e2f9d9f1c255c9dddf4a42c79a9" title="To setup host based IPv4 route.">example_ipv4_route_setup</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> in_port, <span class="keywordtype">int</span> out_port)
<a name="l00333"></a>00333 {
<a name="l00334"></a>00334   <span class="keywordtype">int</span> rv;
<a name="l00335"></a>00335   <span class="keywordtype">int</span> ing_intf_in;
<a name="l00336"></a>00336   <span class="keywordtype">int</span> ing_intf_out;
<a name="l00337"></a>00337   <span class="keywordtype">int</span> fec[2];
<a name="l00338"></a>00338   <span class="keywordtype">int</span> encap_id[2];
<a name="l00339"></a>00339   <span class="keywordtype">int</span> flags = 0;
<a name="l00340"></a>00340   <span class="keywordtype">int</span> in_vlan = <a class="code" href="dpp_2example__routing_8c.html#a30c3344f99ac40e769705eda221a6b5b">INGRESS_VLAN</a>;
<a name="l00341"></a>00341   <span class="keywordtype">int</span> out_vlan = <a class="code" href="dpp_2example__routing_8c.html#a344c92147986035627b0d387b8790318">EGRESS_VLAN</a>;
<a name="l00342"></a>00342   <span class="keywordtype">int</span> vrf = 0;
<a name="l00343"></a>00343   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> my_mac_address  = <a class="code" href="dpp_2example__routing_8c.html#aeaa487f5205c0aac9da4e004c173429c">MY_MAC</a>;
<a name="l00344"></a>00344   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> next_hop_mac    = <a class="code" href="dpp_2example__routing_8c.html#ac777a672bdb738a1ffcbb511b6ba2ed9">NEXTHOP_MAC</a>;
<a name="l00345"></a>00345   <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> host = <a class="code" href="dpp_2example__routing_8c.html#a2971da41865730e076908e0ae6757103">HOST1</a>;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <span class="comment">/*** create ingress router interface ***/</span>
<a name="l00348"></a>00348   rv = <a class="code" href="dpp_2example__routing_8c.html#a8c917a57f4dac4fb64dda7803c25831d" title="Creates Router interface.">example_create_l3_intf</a>(unit, flags, in_port, in_vlan, vrf, my_mac_address, 62, &amp;ing_intf_in);
<a name="l00349"></a>00349   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00350"></a>00350     printf(<span class="stringliteral">&quot;Error, create ingress interface, in_port = %d, \n&quot;</span>, in_port);
<a name="l00351"></a>00351   }
<a name="l00352"></a>00352   printf(<span class="stringliteral">&quot;---&gt; Ingress router intf = 0x%08x created on port %d\n&quot;</span>, ing_intf_in, in_port);
<a name="l00353"></a>00353 
<a name="l00354"></a>00354   <span class="comment">/*** create egress router interface ***/</span>
<a name="l00355"></a>00355   rv = <a class="code" href="dpp_2example__routing_8c.html#a8c917a57f4dac4fb64dda7803c25831d" title="Creates Router interface.">example_create_l3_intf</a>(unit, flags, out_port, out_vlan, vrf, my_mac_address, 62, &amp;ing_intf_out);
<a name="l00356"></a>00356   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00357"></a>00357     printf(<span class="stringliteral">&quot;Error, create ingress enterface, out_port = %d, \n&quot;</span>, out_port);
<a name="l00358"></a>00358   }
<a name="l00359"></a>00359   printf(<span class="stringliteral">&quot;---&gt; Ingress router intf = 0x%08x created on port %d\n&quot;</span>, ing_intf_out, out_port);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361   <span class="comment">/*** create egress object 1 ***/</span>
<a name="l00362"></a>00362   fec[0] = 0;
<a name="l00363"></a>00363   encap_id[0] = 0;
<a name="l00364"></a>00364   <span class="comment">/* built FEC points to out-RIF and MAC address */</span>
<a name="l00365"></a>00365   rv = <a class="code" href="dpp_2example__routing_8c.html#a02a44759ff7b5b5f7cdcf06f2ac74bea" title="create l3 egress object object includes next hop information.">example_create_l3_egress</a>(unit, flags, out_port, out_vlan, ing_intf_out,
<a name="l00366"></a>00366       next_hop_mac, &amp;fec[0], &amp;encap_id[0]);
<a name="l00367"></a>00367   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00368"></a>00368     printf(<span class="stringliteral">&quot;Error, create egress object, out_port = %d, \n&quot;</span>, out_port);
<a name="l00369"></a>00369   }
<a name="l00370"></a>00370   printf(<span class="stringliteral">&quot;---&gt; Egress interface = 0x%08x, \n&quot;</span>, ing_intf_out);
<a name="l00371"></a>00371   printf(<span class="stringliteral">&quot;     created FEC-id = 0x%08x, \n&quot;</span>, fec[0]);
<a name="l00372"></a>00372   printf(<span class="stringliteral">&quot;     next hop mac at encap-id %08x, \n&quot;</span>, encap_id[0]);
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="comment">/*** add IPV4 host entry with OUT-RIF + MAC + eg-port ***/</span>
<a name="l00375"></a>00375   rv = <a class="code" href="dpp_2example__routing_8c.html#a180d5fe6445ec157bd332f916060651d" title="To add host based route.">example_host_add</a>(unit, host, vrf, fec[0]);
<a name="l00376"></a>00376   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00377"></a>00377     printf(<span class="stringliteral">&quot;Error, example_host_add\n&quot;</span>);
<a name="l00378"></a>00378   }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   <a class="code" href="dpp_2example__routing_8c.html#a91d8e3aa1ee27bddd5de08253c34fa73" title="To print the host entry.">print_host</a>(<span class="stringliteral">&quot;add host &quot;</span>, host, vrf);
<a name="l00381"></a>00381   printf(<span class="stringliteral">&quot;---&gt; egress-intf = 0x%08x, port = %d, \n&quot;</span>, ing_intf_out, out_port);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   <span class="comment">/*** add route point to FEC2 ***/</span>
<a name="l00384"></a>00384   <span class="keywordtype">int</span> route = <a class="code" href="dpp_2example__routing_8c.html#a84f447ab6677e412dc77e89f08152369">DEFAULT_SUBNET_IP</a>;
<a name="l00385"></a>00385   <span class="keywordtype">int</span> mask  = <a class="code" href="dpp_2example__routing_8c.html#a6bf0d6365e5891e41a12fe0a84452a46">DEFAULT_SUBNET_MASK</a>;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   rv = <a class="code" href="dpp_2example__routing_8c.html#ad0bd741922e21adeac11f23b946ce296" title="To add subnet based route.">example_route_add</a>(unit, route, mask, vrf, fec[0]) ;
<a name="l00388"></a>00388   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00389"></a>00389     printf(<span class="stringliteral">&quot;Error, failed to add route\n&quot;</span>);
<a name="l00390"></a>00390     <span class="keywordflow">return</span> rv;
<a name="l00391"></a>00391   }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393   <span class="keywordflow">return</span> rv;
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="comment">/*****************************************************************/</span>
<a name="l00404"></a><a class="code" href="dpp_2example__routing_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00404</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for policer application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00405"></a>00405 {
<a name="l00406"></a>00406   <span class="keywordtype">int</span> rv = 0;
<a name="l00407"></a>00407   <span class="keywordtype">int</span> choice;
<a name="l00408"></a>00408   <span class="keywordtype">int</span> in_sysport;
<a name="l00409"></a>00409   <span class="keywordtype">int</span> out_sysport;
<a name="l00410"></a>00410   <span class="keywordtype">int</span> index = 0;
<a name="l00411"></a>00411   <span class="keywordtype">int</span> unit = <a class="code" href="dpp_2example__routing_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413   <span class="keywordflow">if</span>(strcmp(argv[0], <span class="stringliteral">&quot;gdb&quot;</span>) == 0)
<a name="l00414"></a>00414   {
<a name="l00415"></a>00415     index = 1;
<a name="l00416"></a>00416   }
<a name="l00417"></a>00417   <span class="keywordflow">if</span>((argc != (index + 3)) || ((argc &gt; (index + 1))
<a name="l00418"></a>00418         &amp;&amp; (strcmp(argv[index + 1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) {
<a name="l00419"></a>00419     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00420"></a>00420     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00421"></a>00421   }
<a name="l00422"></a>00422 
<a name="l00423"></a>00423   <span class="comment">/* Initialize the system */</span>
<a name="l00424"></a>00424   rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426   <span class="keywordflow">if</span>(rv != 0) {
<a name="l00427"></a>00427     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system.\r\n&quot;</span>);
<a name="l00428"></a>00428     <span class="keywordflow">return</span> rv;
<a name="l00429"></a>00429   }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431   <span class="comment">/* Extract inputs parameters */</span>
<a name="l00432"></a>00432   in_sysport   = atoi(argv[index + 1]);
<a name="l00433"></a>00433   out_sysport  = atoi(argv[index + 2]);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435   rv = <a class="code" href="examples_2util_8h.html#a2846e8ec8f46d212a3ae2493bdff7980" title="Set default configuration (like STP state, speed/duplex) for all ports.">example_port_default_config</a>(unit);
<a name="l00436"></a>00436   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00437"></a>00437     printf(<span class="stringliteral">&quot;\r\nFailed to apply default config on ports, rc = %d (%s).\r\n&quot;</span>,
<a name="l00438"></a>00438         rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00439"></a>00439   }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   rv = <a class="code" href="dpp_2example__routing_8c.html#ab2916e2f9d9f1c255c9dddf4a42c79a9" title="To setup host based IPv4 route.">example_ipv4_route_setup</a>(0, in_sysport, out_sysport);
<a name="l00442"></a>00442   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00443"></a>00443     printf(<span class="stringliteral">&quot;\r\nFailed to configure routing, rc = %d (%s).\r\n&quot;</span>,
<a name="l00444"></a>00444         rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00445"></a>00445   }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447   <span class="keywordflow">while</span>(1) {
<a name="l00448"></a>00448     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l00449"></a>00449 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00450"></a>00450 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00451"></a>00451 <span class="preprocessor">#endif</span>
<a name="l00452"></a>00452 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application.\r\n&quot;</span>);
<a name="l00453"></a>00453 
<a name="l00454"></a>00454     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00455"></a>00455     {
<a name="l00456"></a>00456         printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00457"></a>00457         <span class="keywordflow">continue</span>;
<a name="l00458"></a>00458     }
<a name="l00459"></a>00459     <span class="keywordflow">switch</span>(choice)
<a name="l00460"></a>00460     {
<a name="l00461"></a>00461 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00462"></a>00462 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00463"></a>00463       {
<a name="l00464"></a>00464         opennsl_driver_shell();
<a name="l00465"></a>00465         <span class="keywordflow">break</span>;
<a name="l00466"></a>00466       }
<a name="l00467"></a>00467 <span class="preprocessor">#endif</span>
<a name="l00468"></a>00468 <span class="preprocessor"></span>
<a name="l00469"></a>00469       <span class="keywordflow">case</span> 0:
<a name="l00470"></a>00470       {
<a name="l00471"></a>00471         printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00472"></a>00472         rv = <a class="code" href="driver_8h.html#aa760e8f1af45c7fd27ec014b82c572f2" title="Function to free up the resources and exit the driver.">opennsl_driver_exit</a>();
<a name="l00473"></a>00473         <span class="keywordflow">return</span> rv;
<a name="l00474"></a>00474       }
<a name="l00475"></a>00475       <span class="keywordflow">default</span>:
<a name="l00476"></a>00476       <span class="keywordflow">break</span>;
<a name="l00477"></a>00477     } <span class="comment">/* End of switch */</span>
<a name="l00478"></a>00478   } <span class="comment">/* End of while */</span>
<a name="l00479"></a>00479 
<a name="l00480"></a>00480   <span class="keywordflow">return</span> rv;
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 <span class="comment">/* __doxy_func_body_end__ */</span>
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016-17 by Broadcom Limited. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Limited reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Limited is believed to be accurate and reliable. However, Broadcom Limited does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
