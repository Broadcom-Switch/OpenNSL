<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/dpp/example_policer.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/dpp/example_policer.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="dpp_2example__policer_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2017</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> **********************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * \file         example_policer.c</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief        OpenNSL example application for policer or service meter</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \details       In this example, we will create a simple single rate, three color policer. </span>
<a name="l00024"></a>00024 <span class="comment"> *                This policer will be attached to a Field Processor rule that counts </span>
<a name="l00025"></a>00025 <span class="comment"> *                packets ingressing with a specific destination MAC address. </span>
<a name="l00026"></a>00026 <span class="comment"> * </span>
<a name="l00027"></a>00027 <span class="comment"> *                If single_rate=1 - meter mode is opennslPolicerModeSrTcm (single rate 3 colors), </span>
<a name="l00028"></a>00028 <span class="comment"> *                the excess bucket has no credits of its own and it only receives excess credits </span>
<a name="l00029"></a>00029 <span class="comment"> *                from the committed bucket run ethernet packet with DA 1 and vlan tag id 1 from </span>
<a name="l00030"></a>00030 <span class="comment"> *                in_port, with:</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> *                1) priority = 1:</span>
<a name="l00033"></a>00033 <span class="comment"> *                     the stream will go through the committed bucket and afterwards also through </span>
<a name="l00034"></a>00034 <span class="comment"> *                     the excess bucket for single_rate: the stream will arrive at out_port with </span>
<a name="l00035"></a>00035 <span class="comment"> *                     30M rate (EIR has no credits).</span>
<a name="l00036"></a>00036 <span class="comment"> *</span>
<a name="l00037"></a>00037 <span class="comment"> *                2) priority = 4: </span>
<a name="l00038"></a>00038 <span class="comment"> *                     the stream will go straight to the excess bucket and arrive at out_port with </span>
<a name="l00039"></a>00039 <span class="comment"> *                     20M rate</span>
<a name="l00040"></a>00040 <span class="comment"> *</span>
<a name="l00041"></a>00041 <span class="comment"> *      Note: Stats processor is set based on the core. Use ports belonging to core=0(1 through 20)</span>
<a name="l00042"></a>00042 <span class="comment"> *      Create VLAN 100 and add input port and output port in the VLAN</span>
<a name="l00043"></a>00043 <span class="comment"> *             vlan create 100 PortBitMap=xe2,xe3 </span>
<a name="l00044"></a>00044 <span class="comment"> *</span>
<a name="l00045"></a>00045 <span class="comment"> **********************************************************************/</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="init_8h.html">opennsl/init.h</a>&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2port_8h.html">opennsl/port.h</a>&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;<a class="code" href="l2_8h.html">opennsl/l2.h</a>&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;<a class="code" href="field_8h.html">opennsl/field.h</a>&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;<a class="code" href="policer_8h.html">opennsl/policer.h</a>&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;<a class="code" href="cosqX_8h.html">opennsl/cosqX.h</a>&gt;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="dpp_2example__policer_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00061</a> <span class="keywordtype">char</span> <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00062"></a>00062 <span class="stringliteral">&quot;Syntax: example_policer                                                \n\r&quot;</span>
<a name="l00063"></a>00063 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00064"></a>00064 <span class="stringliteral">&quot;Paramaters: None.                                                      \n\r&quot;</span>
<a name="l00065"></a>00065 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00066"></a>00066 <span class="stringliteral">&quot;Example: The following command is used to create a policer and attach  \n\r&quot;</span>
<a name="l00067"></a>00067 <span class="stringliteral">&quot;         it to a field processor rule matching traffic with            \n\r&quot;</span>
<a name="l00068"></a>00068 <span class="stringliteral">&quot;         destination MAC = MAC_DA.                                     \n\r&quot;</span>
<a name="l00069"></a>00069 <span class="stringliteral">&quot;         It also provides an option to display the number of packets   \n\r&quot;</span>
<a name="l00070"></a>00070 <span class="stringliteral">&quot;         redirected to destination port.                               \n\r&quot;</span>
<a name="l00071"></a>00071 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00072"></a>00072 <span class="stringliteral">&quot;         example_policer                                               \n\r&quot;</span>
<a name="l00073"></a>00073 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00074"></a>00074 <span class="stringliteral">&quot;Usage Guidelines: None.                                                \n\r&quot;</span>;
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="dpp_2example__policer_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00076</a> <span class="preprocessor">#define DEFAULT_UNIT 0</span>
<a name="l00077"></a><a class="code" href="dpp_2example__policer_8c.html#a91668ed1245d073a2ac84e6121205d28">00077</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_VLAN 1</span>
<a name="l00078"></a><a class="code" href="dpp_2example__policer_8c.html#a074e4c6c5b35a6e7df06fbc024b0760d">00078</a> <span class="preprocessor"></span><span class="preprocessor">#define MAC_DA        {0x00, 0x00, 0x00, 0x00, 0x00, 0x01}</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00080"></a><a class="code" href="dpp_2example__policer_8c.html#a523822b8d626fa4bcd6cfa36a6d8c0be">00080</a> <span class="preprocessor">#define MAC_MASK      {0xff, 0xff, 0xff, 0xff, 0xff, 0xff}</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span><span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="dpp_2example__policer_8c.html#ae1f8e7ccbc1a30485b63b662315eb49c">00084</a> <a class="code" href="group__types.html#gac91c9cde19d67513d4d7a5693f0d1fa4" title="opennsl_policer_t">opennsl_policer_t</a> <a class="code" href="dpp_2example__policer_8c.html#ae1f8e7ccbc1a30485b63b662315eb49c">policer_id</a>;
<a name="l00085"></a><a class="code" href="dpp_2example__policer_8c.html#a31bf8ad94a92b00a66bc7e32e1ba7c98">00085</a> <span class="keywordtype">int</span> <a class="code" href="example__field__redirect_8c.html#a31bf8ad94a92b00a66bc7e32e1ba7c98">stat_id</a>                = 2;
<a name="l00086"></a><a class="code" href="dpp_2example__policer_8c.html#a6c55b5e23edc21bd23828117f2babe59">00086</a> <a class="code" href="group__types.html#ga265033c7aaf6d915b6aa85b49e6ecaf1" title="opennsl_field_stat_e">opennsl_field_stat_t</a> <a class="code" href="dpp_2example__policer_8c.html#a6c55b5e23edc21bd23828117f2babe59">accept_stats</a> = <a class="code" href="group__types.html#gga4e242bb4676be2d7083bd25738f65aafad171d8f929e45ceb4dc9527a8b5d6279" title="Packet count of accepted traffic of all colors.">opennslFieldStatAcceptedPackets</a>;
<a name="l00087"></a><a class="code" href="dpp_2example__policer_8c.html#a871b3c025a8b037a7eaa43265b8639d9">00087</a> <a class="code" href="group__types.html#ga265033c7aaf6d915b6aa85b49e6ecaf1" title="opennsl_field_stat_e">opennsl_field_stat_t</a> <a class="code" href="dpp_2example__policer_8c.html#a871b3c025a8b037a7eaa43265b8639d9">drop_stats</a> = <a class="code" href="group__types.html#gga4e242bb4676be2d7083bd25738f65aafad5bf7753c9c539ea22b69d0b3994babd" title="Packet count of dropped traffic of all colors.">opennslFieldStatDroppedPackets</a>;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a>
<a name="l00090"></a><a class="code" href="dpp_2example__policer_8c.html#aa4320dfff072ae795431d11fc2cd76fb">00090</a> <a class="code" href="dpp_2example__policer_8c.html#aa4320dfff072ae795431d11fc2cd76fb">example_create_meter</a>(<span class="keywordtype">int</span> unit) 
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092   <span class="keywordtype">int</span> rv;
<a name="l00093"></a>00093   <a class="code" href="structopennsl__info__s.html" title="OPENNSL Information structure.">opennsl_info_t</a> info;
<a name="l00094"></a>00094   <a class="code" href="structopennsl__policer__config__s.html">opennsl_policer_config_t</a> pol_cfg;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096   rv = <a class="code" href="group__init.html#ga64691ef7b923460206cd9abb675807c0" title="Get information about a OPENNSL unit.">opennsl_info_get</a>(unit, &amp;info);
<a name="l00097"></a>00097   <span class="keywordflow">if</span> (<a class="code" href="group__error.html#ga655eb72518850235a4c759ddceb622e6">OPENNSL_FAILURE</a>(rv)) 
<a name="l00098"></a>00098   {
<a name="l00099"></a>00099     printf(<span class="stringliteral">&quot;Error in opennsl_info_get, rv=%d\n&quot;</span>, rv);
<a name="l00100"></a>00100     <span class="keywordflow">return</span> rv;
<a name="l00101"></a>00101   }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103   <span class="comment">/* create policer 1 */</span>
<a name="l00104"></a>00104   <a class="code" href="group__policer.html#ga91761860f3bc8d45c400f0df15c5ebb8" title="Initialize a policer configuration structure.">opennsl_policer_config_t_init</a>(&amp;pol_cfg);
<a name="l00105"></a>00105   pol_cfg.<a class="code" href="structopennsl__policer__config__s.html#ad68ece54793c13998c4fbc57da4c9f1d" title="Policer mode.">mode</a> = <a class="code" href="group__policer.html#gga4f914affbe1d6b845ee39c41ef2decd0a4fdd8f4cdb6ea261bf5b7cec2e57e774" title="RFC 2697.">opennslPolicerModeSrTcm</a>; <span class="comment">/* single rate three colors mode */</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   pol_cfg.<a class="code" href="structopennsl__policer__config__s.html#a0234c298242cb9c97edf38839cee39e2" title="Committed rate (kbits per sec).">ckbits_sec</a> = 30000; <span class="comment">/* 30Mbps */</span>
<a name="l00108"></a>00108   pol_cfg.<a class="code" href="structopennsl__policer__config__s.html#a6192654a85f674180fa00e496f21cbb2" title="Committed burst size (kbits).">ckbits_burst</a> = 1000;
<a name="l00109"></a>00109   pol_cfg.<a class="code" href="structopennsl__policer__config__s.html#a45403bdbdaa193dfb2d2d872dcb65b33" title="Peak burst size (kbits).">pkbits_burst</a> = 1000;
<a name="l00110"></a>00110   pol_cfg.<a class="code" href="structopennsl__policer__config__s.html#a42754fa5db85201067f5365b3d7da302" title="Maximum Peak rate (kbits per sec), Applicable only for cascade mode.">max_pkbits_sec</a> = 20000; <span class="comment">/* 20Mbps max */</span>
<a name="l00111"></a>00111 
<a name="l00112"></a>00112   rv = <a class="code" href="group__policer.html#gac1d0dc00c9ebbf0a1b263ded965e9915" title="Create a policer entry.">opennsl_policer_create</a>(unit, &amp;(pol_cfg), &amp;(<a class="code" href="dpp_2example__policer_8c.html#ae1f8e7ccbc1a30485b63b662315eb49c">policer_id</a>));
<a name="l00113"></a>00113   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00114"></a>00114   {
<a name="l00115"></a>00115     printf(<span class="stringliteral">&quot;Error in opennsl_policer_create no. 1, rv=%d\n&quot;</span>,rv);
<a name="l00116"></a>00116     <span class="keywordflow">return</span> rv;
<a name="l00117"></a>00117   }
<a name="l00118"></a>00118   printf(<span class="stringliteral">&quot;policer_id1: %d\n&quot;</span>, <a class="code" href="dpp_2example__policer_8c.html#ae1f8e7ccbc1a30485b63b662315eb49c">policer_id</a>);
<a name="l00119"></a>00119 
<a name="l00120"></a>00120   <span class="keywordflow">return</span> rv;
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> 
<a name="l00126"></a><a class="code" href="dpp_2example__policer_8c.html#a6b75bad6242820d8c47be3a04a6ba24b">00126</a> <a class="code" href="dpp_2example__policer_8c.html#a6b75bad6242820d8c47be3a04a6ba24b">example_create_policy</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> in_port, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> out_port) 
<a name="l00127"></a>00127 {
<a name="l00128"></a>00128   <span class="keywordtype">int</span> rv;
<a name="l00129"></a>00129   <span class="keywordtype">int</span> group_priority = 6;
<a name="l00130"></a>00130   <a class="code" href="group__field.html#ga4387a1b4682c605fcc1a2b8297f8a404" title="Opaque handle to a field group.">opennsl_field_group_t</a> <a class="code" href="example__field__redirect_8c.html#ae05d96b029e63f2deae4f883fb46726d">grp</a> = 1;
<a name="l00131"></a>00131   <a class="code" href="structopennsl__field__qset__s.html" title="Field qset defines the set of fields used for lookup.">opennsl_field_qset_t</a> qset;
<a name="l00132"></a>00132   <a class="code" href="structopennsl__field__aset__s.html" title="Used to specify the actions that can be taken by the entries in a group.">opennsl_field_aset_t</a> aset;
<a name="l00133"></a>00133   <a class="code" href="group__field.html#ga699caff1a232fe42e6668e5d2869e61e" title="Opaque handle to a field entry.">opennsl_field_entry_t</a> ent;
<a name="l00134"></a>00134   <a class="code" href="group__types.html#ga265033c7aaf6d915b6aa85b49e6ecaf1" title="opennsl_field_stat_e">opennsl_field_stat_t</a> <a class="code" href="example__field__redirect_8c.html#ab30be53fb3407849f0fac2f490911c1f">stats</a>[2];
<a name="l00135"></a>00135   <span class="keywordtype">int</span> statId;
<a name="l00136"></a>00136   <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> l2addr;
<a name="l00137"></a>00137   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac = <a class="code" href="dpp_2example__policer_8c.html#a074e4c6c5b35a6e7df06fbc024b0760d">MAC_DA</a>;
<a name="l00138"></a>00138   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mask = <a class="code" href="dpp_2example__policer_8c.html#a523822b8d626fa4bcd6cfa36a6d8c0be">MAC_MASK</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00141"></a>00141   <span class="comment">/* map packet to meter_id, according to in-port and dst-port */</span>
<a name="l00142"></a>00142   <a class="code" href="group__field.html#ga37e97efc912030850263af8ef6248443">OPENNSL_FIELD_QSET_INIT</a>(qset);
<a name="l00143"></a>00143   <a class="code" href="group__field.html#gae7dc7300f0a4b3add5d9099b52eaf735">OPENNSL_FIELD_QSET_ADD</a>(qset, <a class="code" href="group__field.html#ggaa519dd558cda3869447bd6e1209b8ce4ab1700b0457705169d5cd3227404761bf" title="Destination L2 MAC Address.">opennslFieldQualifyDstMac</a>);
<a name="l00144"></a>00144   rv = <a class="code" href="group__field.html#ga724e490c5293940db0bcf62208fb9baf" title="Create a field group.">opennsl_field_group_create_mode_id</a>(unit, qset, group_priority, <a class="code" href="group__field.html#ggaa5747a2e53f2ae8b0507e40508e3b292a5d6ab9cb3b3e7a9fb7e18cffbf4f41c6" title="Auto-expand group based on Qset (default).">opennslFieldGroupModeAuto</a>, grp);
<a name="l00145"></a>00145   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00146"></a>00146   {
<a name="l00147"></a>00147     printf(<span class="stringliteral">&quot;Error in opennsl_field_group_create_mode_id. rv=%d \n&quot;</span>,rv);
<a name="l00148"></a>00148     <span class="keywordflow">return</span> rv;
<a name="l00149"></a>00149   }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151   <a class="code" href="group__field.html#gaade393b183413ecfa854bcfe0d4e0da4">OPENNSL_FIELD_ASET_INIT</a>(aset);
<a name="l00152"></a>00152   <a class="code" href="group__field.html#ga069ead7d7b8463459bc9ff678cfe2485">OPENNSL_FIELD_ASET_ADD</a>(aset, <a class="code" href="group__field.html#gga7e4b15dc0ad1411548bfbaff998cb97fa53f27966995a4a6fec12025009754006" title="Apply policer (policerId in param0) to traffic hitting this entry.">opennslFieldActionPolicerLevel0</a>);
<a name="l00153"></a>00153   <a class="code" href="group__field.html#ga069ead7d7b8463459bc9ff678cfe2485">OPENNSL_FIELD_ASET_ADD</a>(aset, <a class="code" href="group__field.html#gga7e4b15dc0ad1411548bfbaff998cb97fad0bc6993469025940c2558ef975e15c5" title="Specify/override where policer result will be used for matched packets.">opennslFieldActionUsePolicerResult</a>);
<a name="l00154"></a>00154   <a class="code" href="group__field.html#ga069ead7d7b8463459bc9ff678cfe2485">OPENNSL_FIELD_ASET_ADD</a>(aset, <a class="code" href="group__field.html#gga7e4b15dc0ad1411548bfbaff998cb97faa54a14fba38183f498eb1638d772c4cf" title="Update statistics (statId in param0) on entry hit.">opennslFieldActionStat0</a>);
<a name="l00155"></a>00155   rv = <a class="code" href="group__field.html#gaead4ec9137a60ab402a82391bcbfaa83" title="Change or retrieve the actions for a field group.">opennsl_field_group_action_set</a>(unit, grp, aset);
<a name="l00156"></a>00156   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00157"></a>00157   {
<a name="l00158"></a>00158     printf(<span class="stringliteral">&quot;Error in opennsl_field_group_action_set. rv=%d \n&quot;</span>,rv);
<a name="l00159"></a>00159     <span class="keywordflow">return</span> rv;
<a name="l00160"></a>00160   }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162   rv = <a class="code" href="group__field.html#gac6491132b08dde21c8a22ef703744d8e" title="Create a blank field entry.">opennsl_field_entry_create</a>(unit, grp, &amp;ent);
<a name="l00163"></a>00163   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00164"></a>00164   {
<a name="l00165"></a>00165     printf(<span class="stringliteral">&quot;Error in opennsl_field_entry_create. rv=%d\n&quot;</span>,rv);
<a name="l00166"></a>00166     <span class="keywordflow">return</span> rv;
<a name="l00167"></a>00167   }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   rv = <a class="code" href="group__field.html#gaa95056ca152dd574025fd5aaa9b786bc">opennsl_field_qualify_DstMac</a>(unit, ent, mac, mask);
<a name="l00170"></a>00170   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00171"></a>00171   {
<a name="l00172"></a>00172     printf(<span class="stringliteral">&quot;Error in opennsl_field_qualify_DstMac. rv=%d\n&quot;</span>,rv);
<a name="l00173"></a>00173     <span class="keywordflow">return</span> rv;
<a name="l00174"></a>00174   }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176   stats[0] = <a class="code" href="group__types.html#gga4e242bb4676be2d7083bd25738f65aafad171d8f929e45ceb4dc9527a8b5d6279" title="Packet count of accepted traffic of all colors.">opennslFieldStatAcceptedPackets</a>;
<a name="l00177"></a>00177   stats[1] = <a class="code" href="group__types.html#gga4e242bb4676be2d7083bd25738f65aafad5bf7753c9c539ea22b69d0b3994babd" title="Packet count of dropped traffic of all colors.">opennslFieldStatDroppedPackets</a>;
<a name="l00178"></a>00178   statId = <a class="code" href="example__field__redirect_8c.html#a31bf8ad94a92b00a66bc7e32e1ba7c98">stat_id</a>;
<a name="l00179"></a>00179   rv = <a class="code" href="group__field.html#ga3e7541a4a6cab0e6ed7a98c4f6a4fd7b" title="Create stat collection entity with specified Statistics entity ID value.">opennsl_field_stat_create_id</a>(unit, grp, 2, &amp;(stats[0]), statId);
<a name="l00180"></a>00180   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00181"></a>00181   {
<a name="l00182"></a>00182     printf(<span class="stringliteral">&quot;Error in opennsl_field_stat_create. rv=%d \n&quot;</span>, rv);
<a name="l00183"></a>00183     <span class="keywordflow">return</span> rv;
<a name="l00184"></a>00184   }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   rv = <a class="code" href="group__field.html#gad262135567b2fd47ceb1af7b4ca5c620" title="Attach statistics entity to Field Processor entry.">opennsl_field_entry_stat_attach</a>(unit, ent, statId);
<a name="l00187"></a>00187   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00188"></a>00188   {
<a name="l00189"></a>00189     printf(<span class="stringliteral">&quot;Error in opennsl_field_entry_stat_attach with ent %d. rv=%d\n&quot;</span>, ent, rv);
<a name="l00190"></a>00190     <span class="keywordflow">return</span> rv;
<a name="l00191"></a>00191   }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <span class="comment">/* Create the policer */</span>
<a name="l00194"></a>00194   rv = <a class="code" href="dpp_2example__policer_8c.html#aa4320dfff072ae795431d11fc2cd76fb">example_create_meter</a>(unit);
<a name="l00195"></a>00195   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00196"></a>00196   {
<a name="l00197"></a>00197     printf(<span class="stringliteral">&quot;\r\nFailed to create the meter. Error: %s\r\n&quot;</span>,
<a name="l00198"></a>00198   <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00199"></a>00199     <span class="keywordflow">return</span> rv;
<a name="l00200"></a>00200   }  
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   rv = <a class="code" href="group__field.html#gad260788b3efb1eae8ff7f5e434767e87" title="Attach a policer to a field entry.">opennsl_field_entry_policer_attach</a>(unit, ent, 0, (<a class="code" href="dpp_2example__policer_8c.html#ae1f8e7ccbc1a30485b63b662315eb49c">policer_id</a> &amp; 0xffff));
<a name="l00203"></a>00203   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00204"></a>00204   {
<a name="l00205"></a>00205     printf(<span class="stringliteral">&quot;Error in opennsl_field_entry_policer_attach with policer_id %d. rv=%d \n&quot;</span>, <a class="code" href="dpp_2example__policer_8c.html#ae1f8e7ccbc1a30485b63b662315eb49c">policer_id</a>, rv);
<a name="l00206"></a>00206     <span class="keywordflow">return</span> rv;
<a name="l00207"></a>00207   }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   rv = <a class="code" href="group__field.html#gacca0f485d7654f4b0fadb2c5eef2a95f" title="Install all entries of a field group into the hardware tables.">opennsl_field_group_install</a>(unit, grp);
<a name="l00210"></a>00210   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00211"></a>00211   {
<a name="l00212"></a>00212     printf(<span class="stringliteral">&quot;Error in opennsl_field_group_install. rv=%d \n&quot;</span>, rv);
<a name="l00213"></a>00213     <span class="keywordflow">return</span> rv;
<a name="l00214"></a>00214   }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216   <span class="comment">/* send traffic with DA=1 and Vlan tag id 100 to out_port */</span>
<a name="l00217"></a>00217   <a class="code" href="group__l2.html#ga47e819cf5939a8e643ad09505df52071" title="Initialize an L2 address structure to a specified MAC address and VLAN ID.">opennsl_l2_addr_t_init</a>(&amp;l2addr, mac, 100);
<a name="l00218"></a>00218   l2addr.<a class="code" href="structopennsl__l2__addr__s.html#a7546884120ba8ab5dce9348fd9bd819f" title="Zero-based port number.">port</a> = out_port;
<a name="l00219"></a>00219   rv = <a class="code" href="group__l2.html#ga4b8920c1c3cf4c0c59bf8f0c5890f7c5" title="Add an L2 address entry to the specified device.">opennsl_l2_addr_add</a>(unit, &amp;l2addr);
<a name="l00220"></a>00220   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00221"></a>00221   {
<a name="l00222"></a>00222     printf(<span class="stringliteral">&quot;Error, opennsl_l2_addr_add with vid 1. rv=%d \n&quot;</span>, rv);
<a name="l00223"></a>00223     <span class="keywordflow">return</span> rv;
<a name="l00224"></a>00224   }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <span class="comment">/* </span>
<a name="l00227"></a>00227 <span class="comment">   * map Vlan tag proirity=4 and cfi=0 to yellow color:</span>
<a name="l00228"></a>00228 <span class="comment">   * this will mean that the packet will arrive with a yellow color instead of green </span>
<a name="l00229"></a>00229 <span class="comment">   * if meter mode is not COLOR_BLIND, the packet will go straight to the excess bucket </span>
<a name="l00230"></a>00230 <span class="comment">   * (without going through the committed bucket) </span>
<a name="l00231"></a>00231 <span class="comment">   */</span>
<a name="l00232"></a>00232   rv = <a class="code" href="group__port.html#ga15667a93ccb19b29d1e6509a5932e73e">opennsl_port_vlan_priority_map_set</a>(unit, in_port, 4 <span class="comment">/* priority */</span>, 0 <span class="comment">/* cfi */</span>, 
<a name="l00233"></a>00233               1 <span class="comment">/* internal priority */</span>, <a class="code" href="group__types.html#ggab05e850eabb21ae43c3814f22adfc486a2e70ad0ee5548a17d98da998983d116d">opennslColorYellow</a> <span class="comment">/* color */</span>);
<a name="l00234"></a>00234   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00235"></a>00235   {
<a name="l00236"></a>00236     printf(<span class="stringliteral">&quot;Error, opennsl_port_vlan_priority_map_set with prio 4. rv=%d \n&quot;</span>, rv);
<a name="l00237"></a>00237     <span class="keywordflow">return</span> rv;
<a name="l00238"></a>00238   }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240   <span class="comment">/* </span>
<a name="l00241"></a>00241 <span class="comment">   * map Vlan tag proirity=1 and cfi=0 to green color:</span>
<a name="l00242"></a>00242 <span class="comment">   * packet that will arrive with a green color will go through the committed bucket </span>
<a name="l00243"></a>00243 <span class="comment">   * and the excess bucket </span>
<a name="l00244"></a>00244 <span class="comment">   */</span>
<a name="l00245"></a>00245   rv = <a class="code" href="group__port.html#ga15667a93ccb19b29d1e6509a5932e73e">opennsl_port_vlan_priority_map_set</a>(unit, in_port, 1 <span class="comment">/* priority */</span>, 0 <span class="comment">/* cfi */</span>, 
<a name="l00246"></a>00246               0 <span class="comment">/* internal priority */</span>, <a class="code" href="group__types.html#ggab05e850eabb21ae43c3814f22adfc486ab02e93ac50c8c32306e9a6b88664b216">opennslColorGreen</a> <span class="comment">/* color */</span>);
<a name="l00247"></a>00247   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00248"></a>00248   {
<a name="l00249"></a>00249     printf(<span class="stringliteral">&quot;Error, opennsl_port_vlan_priority_map_set with prio 1. rv=%d \n&quot;</span>, rv);
<a name="l00250"></a>00250     <span class="keywordflow">return</span> rv;
<a name="l00251"></a>00251   }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <span class="comment">/* set discard DP to drop all packets with DP = 3 */</span>
<a name="l00254"></a>00254   rv = <a class="code" href="group__cosq.html#ga7f06994a80a1a4cbc5986ce34b1d60af" title="Configure Weighted Random Early Discard (WRED).">opennsl_cosq_discard_set</a>(unit, <a class="code" href="group__cosq.html#gaaf2b5ff9e0ad1a0cc72a3059e2968931">OPENNSL_COSQ_DISCARD_ENABLE</a> | <a class="code" href="group__cosq.html#ga29d08ef127ac209c9c82eb2b1cdaa674">OPENNSL_COSQ_DISCARD_COLOR_BLACK</a>);
<a name="l00255"></a>00255   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00256"></a>00256   {
<a name="l00257"></a>00257     printf(<span class="stringliteral">&quot;Error, opennsl_cosq_discard_set. rv=%d \n&quot;</span>, rv);
<a name="l00258"></a>00258   }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <span class="keywordflow">return</span> rv;
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <span class="comment">/*****************************************************************/</span>
<a name="l00271"></a><a class="code" href="dpp_2example__policer_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00271</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for policer application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00272"></a>00272 {
<a name="l00273"></a>00273   <span class="keywordtype">int</span> rv = 0;
<a name="l00274"></a>00274   <span class="keywordtype">int</span> unit = <a class="code" href="dpp_2example__policer_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l00275"></a>00275   <span class="keywordtype">int</span> choice;
<a name="l00276"></a>00276   <a class="code" href="sal_2types_8h.html#aa3ad64cf41ec3a042bd92550cc6ed308">uint64</a> val;
<a name="l00277"></a>00277   <span class="keywordtype">int</span> inport, outport;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   <span class="keywordflow">if</span>((argc != 1) || ((argc &gt; 1) &amp;&amp; (strcmp(argv[1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) 
<a name="l00280"></a>00280   {
<a name="l00281"></a>00281     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00282"></a>00282     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00283"></a>00283   }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   <span class="comment">/* Initialize the system. */</span>
<a name="l00286"></a>00286   rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00287"></a>00287   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00288"></a>00288   {
<a name="l00289"></a>00289     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system. Error: %s\r\n&quot;</span>,
<a name="l00290"></a>00290            <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00291"></a>00291     <span class="keywordflow">return</span> rv;
<a name="l00292"></a>00292   }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294   <span class="comment">/* cold boot initialization commands */</span>
<a name="l00295"></a>00295   rv = <a class="code" href="examples_2util_8h.html#a2846e8ec8f46d212a3ae2493bdff7980" title="Set default configuration (like STP state, speed/duplex) for all ports.">example_port_default_config</a>(unit);
<a name="l00296"></a>00296   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00297"></a>00297   {
<a name="l00298"></a>00298     printf(<span class="stringliteral">&quot;\r\nFailed to apply default config on ports, rc = %d (%s).\r\n&quot;</span>,
<a name="l00299"></a>00299            rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00300"></a>00300   }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302   <span class="comment">/* Add ports to default vlan. */</span>
<a name="l00303"></a>00303   printf(<span class="stringliteral">&quot;Adding ports to default vlan.\r\n&quot;</span>);
<a name="l00304"></a>00304   rv = <a class="code" href="examples_2util_8h.html#a2d14e4de1f4a7192ac7e378f8f7c63ff" title="Add all ports to default vlan.">example_switch_default_vlan_config</a>(unit);
<a name="l00305"></a>00305   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00306"></a>00306   {
<a name="l00307"></a>00307     printf(<span class="stringliteral">&quot;\r\nFailed to add default ports. Error: %s\r\n&quot;</span>,
<a name="l00308"></a>00308         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00309"></a>00309   }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311   <span class="keywordflow">while</span>(1) {
<a name="l00312"></a>00312     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l00313"></a>00313     printf(<span class="stringliteral">&quot;1. Apply policer to the traffic\n&quot;</span>);
<a name="l00314"></a>00314     printf(<span class="stringliteral">&quot;2. Retrieve statistics of the policer\n&quot;</span>);
<a name="l00315"></a>00315 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00317"></a>00317 <span class="preprocessor">#endif</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application.\r\n&quot;</span>);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00321"></a>00321     {
<a name="l00322"></a>00322       printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00323"></a>00323       <span class="keywordflow">continue</span>;
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325     <span class="keywordflow">switch</span>(choice)
<a name="l00326"></a>00326     {
<a name="l00327"></a>00327       <span class="keywordflow">case</span> 1:
<a name="l00328"></a>00328       {
<a name="l00329"></a>00329         printf(<span class="stringliteral">&quot;Enter the input port number(belonging to core-0):\n&quot;</span>);
<a name="l00330"></a>00330         <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;inport) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00331"></a>00331         {
<a name="l00332"></a>00332           printf(<span class="stringliteral">&quot;Invalid value entered. Please re-enter.\n&quot;</span>);
<a name="l00333"></a>00333           <span class="keywordflow">continue</span>;
<a name="l00334"></a>00334         }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336         printf(<span class="stringliteral">&quot;Enter the output port number(belonging to core-0):\n&quot;</span>);
<a name="l00337"></a>00337         <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;outport) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00338"></a>00338         {
<a name="l00339"></a>00339           printf(<span class="stringliteral">&quot;Invalid value entered. Please re-enter.\n&quot;</span>);
<a name="l00340"></a>00340           <span class="keywordflow">continue</span>;
<a name="l00341"></a>00341         }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   <span class="comment">/* Create policer and test traffic rate */</span>
<a name="l00344"></a>00344   rv = <a class="code" href="dpp_2example__policer_8c.html#a6b75bad6242820d8c47be3a04a6ba24b">example_create_policy</a>(unit, inport, outport);
<a name="l00345"></a>00345   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00346"></a>00346   {
<a name="l00347"></a>00347     printf(<span class="stringliteral">&quot;\r\nFailed to create the policer. Error: %s\r\n&quot;</span>,
<a name="l00348"></a>00348         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00349"></a>00349   }  
<a name="l00350"></a>00350 
<a name="l00351"></a>00351         <span class="keywordflow">break</span>;
<a name="l00352"></a>00352       }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354       <span class="keywordflow">case</span> 2:
<a name="l00355"></a>00355       {
<a name="l00356"></a>00356         rv = <a class="code" href="group__field.html#gaf85528d51ba145198ff9be30d597814a" title="Get 64-bit counter value for specific statistic type.">opennsl_field_stat_get</a>(unit, <a class="code" href="example__field__redirect_8c.html#a31bf8ad94a92b00a66bc7e32e1ba7c98">stat_id</a>, <a class="code" href="dpp_2example__policer_8c.html#a6c55b5e23edc21bd23828117f2babe59">accept_stats</a>, &amp;val);
<a name="l00357"></a>00357         <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00358"></a>00358           printf(<span class="stringliteral">&quot;Failed to get the accepted packets statistics, &quot;</span>
<a name="l00359"></a>00359               <span class="stringliteral">&quot;Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00360"></a>00360           <span class="keywordflow">return</span> rv;
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362         printf(<span class="stringliteral">&quot;Number of packets accepted: %lld (0x%0x)\n&quot;</span>, val, val);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364         val = 0;
<a name="l00365"></a>00365         rv = <a class="code" href="group__field.html#gaf85528d51ba145198ff9be30d597814a" title="Get 64-bit counter value for specific statistic type.">opennsl_field_stat_get</a>(unit, <a class="code" href="example__field__redirect_8c.html#a31bf8ad94a92b00a66bc7e32e1ba7c98">stat_id</a>, <a class="code" href="dpp_2example__policer_8c.html#a871b3c025a8b037a7eaa43265b8639d9">drop_stats</a>, &amp;val);
<a name="l00366"></a>00366         <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00367"></a>00367           printf(<span class="stringliteral">&quot;Failed to get the dropped packets statistics, &quot;</span>
<a name="l00368"></a>00368               <span class="stringliteral">&quot;Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00369"></a>00369           <span class="keywordflow">return</span> rv;
<a name="l00370"></a>00370         }
<a name="l00371"></a>00371         printf(<span class="stringliteral">&quot;Number of packets dropped: %lld (0x%0x)\n&quot;</span>, val, val);
<a name="l00372"></a>00372         <span class="keywordflow">break</span>;
<a name="l00373"></a>00373       }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00376"></a>00376 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00377"></a>00377       {
<a name="l00378"></a>00378         opennsl_driver_shell();
<a name="l00379"></a>00379         <span class="keywordflow">break</span>;
<a name="l00380"></a>00380       }
<a name="l00381"></a>00381 <span class="preprocessor">#endif</span>
<a name="l00382"></a>00382 <span class="preprocessor"></span>
<a name="l00383"></a>00383       <span class="keywordflow">case</span> 0:
<a name="l00384"></a>00384       {
<a name="l00385"></a>00385         printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00386"></a>00386         rv = <a class="code" href="driver_8h.html#aa760e8f1af45c7fd27ec014b82c572f2" title="Function to free up the resources and exit the driver.">opennsl_driver_exit</a>();
<a name="l00387"></a>00387         <span class="keywordflow">return</span> rv;
<a name="l00388"></a>00388       }
<a name="l00389"></a>00389       <span class="keywordflow">default</span>:
<a name="l00390"></a>00390       <span class="keywordflow">break</span>;
<a name="l00391"></a>00391     } <span class="comment">/* End of switch */</span>
<a name="l00392"></a>00392   } <span class="comment">/* End of while */</span>
<a name="l00393"></a>00393 
<a name="l00394"></a>00394   <span class="keywordflow">return</span> rv;
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 <span class="comment">/* __doxy_func_body_end__ */</span>
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016-17 by Broadcom Limited. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Limited reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Limited is believed to be accurate and reliable. However, Broadcom Limited does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
