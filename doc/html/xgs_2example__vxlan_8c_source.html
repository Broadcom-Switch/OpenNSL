<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/xgs/example_vxlan.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/xgs/example_vxlan.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="xgs_2example__vxlan_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/******************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2017</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> ******************************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> * \file     example_vxlan.c</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * \brief    Example code for VxLAN application</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * VXLAN is a L2 VPN technology targeted for Data-Center communication </span>
<a name="l00023"></a>00023 <span class="comment"> * between Virtual Machines (VM) assigned to the same customer(Tenant) that are </span>
<a name="l00024"></a>00024 <span class="comment"> * distributed in various racks in the Data-Center. L2VPN over IP/UDP tunnels can provide </span>
<a name="l00025"></a>00025 <span class="comment"> * E-LAN (similar to VPLS) and E-LINE (similar to VPWS) service. With VXLAN the ethernet </span>
<a name="l00026"></a>00026 <span class="comment"> * packets are encapsulated in UDP tunnels over an IP network. VXLAN uses UDP Source_Port</span>
<a name="l00027"></a>00027 <span class="comment"> * as multiplexing field for multiplexing multiple VPNs into the same UDP Tunnel.</span>
<a name="l00028"></a>00028 <span class="comment"> * E-LINE is point-to-point service without support for Multicast traffic. In E-LINE, Ethernet</span>
<a name="l00029"></a>00029 <span class="comment"> * frames are mapped into a VXLAN Tunnel based on incoming port plus packet header information. </span>
<a name="l00030"></a>00030 <span class="comment"> * At the end of Tunnel, forwarding of Ethernet frames after Tunnel decapsulation is based on </span>
<a name="l00031"></a>00031 <span class="comment"> * VXLAN-VNID and Tunnel lookup.</span>
<a name="l00032"></a>00032 <span class="comment"> *</span>
<a name="l00033"></a>00033 <span class="comment"> * In E-LAN, Ethernet frames of interest are also identified by incoming port plus packet </span>
<a name="l00034"></a>00034 <span class="comment"> * header information. Ethernet frames are switched into one or more VXLAN Tunnels based </span>
<a name="l00035"></a>00035 <span class="comment"> * on the MAC DA lookup.  At the end of  Tunnel, forwarding of Ethernet frames after Tunnel </span>
<a name="l00036"></a>00036 <span class="comment"> * decapsulation is based on the VXLAN-VNID and Tunnel lookup and frames are again forwarded </span>
<a name="l00037"></a>00037 <span class="comment"> * based on MAC-DA lookup.</span>
<a name="l00038"></a>00038 <span class="comment"> *</span>
<a name="l00039"></a>00039 <span class="comment"> * VXLAN VPN can be of type ELINE or ELAN.</span>
<a name="l00040"></a>00040 <span class="comment"> *</span>
<a name="l00041"></a>00041 <span class="comment"> * For ELAN, a VPN is similar to a VLAN, which identifies a group of physical ports to be </span>
<a name="l00042"></a>00042 <span class="comment"> * included in a broadcast domain. However, instead of physical ports, a ELAN VPN identifies </span>
<a name="l00043"></a>00043 <span class="comment"> * a group of &quot;virtual-ports&quot; to be included in a broadcast domain. In the VXLAN APIs, </span>
<a name="l00044"></a>00044 <span class="comment"> * a &quot;virtual-port&quot; is called an VXLAN port (see description below). The VPN ID is used to </span>
<a name="l00045"></a>00045 <span class="comment"> * qualify MAC DA lookups within the VPN.</span>
<a name="l00046"></a>00046 <span class="comment"> *</span>
<a name="l00047"></a>00047 <span class="comment"> * For ELINE, a VPN consists of two VXLAN ports. Packets arriving on one VXLAN port are sent </span>
<a name="l00048"></a>00048 <span class="comment"> * directly out the other VXLAN port.</span>
<a name="l00049"></a>00049 <span class="comment"> *</span>
<a name="l00050"></a>00050 <span class="comment"> * This example application creates 2 VxLAN segments, and two access ports that share 1 tunnel:</span>
<a name="l00051"></a>00051 <span class="comment"> *</span>
<a name="l00052"></a>00052 <span class="comment"> *   Access Port1 --&gt; Segment 1 (VPN 1) \</span>
<a name="l00053"></a>00053 <span class="comment"> *                                       +-&gt; share 1 network UDP tunnel</span>
<a name="l00054"></a>00054 <span class="comment"> *   Access Port2 --&gt; Segment 2 (VPN 2) /</span>
<a name="l00055"></a>00055 <span class="comment"> *</span>
<a name="l00056"></a>00056 <span class="comment"> ******************************************************************************/</span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;<a class="code" href="l2_8h.html">opennsl/l2.h</a>&gt;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2switch_8h.html">opennsl/switch.h</a>&gt;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &lt;<a class="code" href="tunnel_8h.html">opennsl/tunnel.h</a>&gt;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &lt;<a class="code" href="multicast_8h.html">opennsl/multicast.h</a>&gt;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &lt;<a class="code" href="vxlan_8h.html">opennsl/vxlan.h</a>&gt;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="xgs_2example__vxlan_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00071</a> <span class="preprocessor">#define DEFAULT_UNIT  0</span>
<a name="l00072"></a><a class="code" href="xgs_2example__vxlan_8c.html#a91668ed1245d073a2ac84e6121205d28">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_VLAN  1</span>
<a name="l00073"></a><a class="code" href="xgs_2example__vxlan_8c.html#a068278b0838b6670ab0ab0a93ed77484">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_DIGITS_IN_CHOICE 5</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>
<a name="l00075"></a><a class="code" href="xgs_2example__vxlan_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00075</a> <span class="keywordtype">char</span> <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00076"></a>00076 <span class="stringliteral">&quot;Syntax: example_vxlan                                                 \n\r&quot;</span>
<a name="l00077"></a>00077 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00078"></a>00078 <span class="stringliteral">&quot;Paramaters: None.                                                     \n\r&quot;</span>
<a name="l00079"></a>00079 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00080"></a>00080 <span class="stringliteral">&quot;Usage Guidelines: None.                                               \n\r&quot;</span>;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="comment">/* debug prints */</span>
<a name="l00083"></a><a class="code" href="xgs_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">00083</a> <span class="keywordtype">int</span> <a class="code" href="dpp_2example__vxlan_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = 3;
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="xgs_2example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">00085</a> <span class="preprocessor">#define TRUE  1</span>
<a name="l00086"></a><a class="code" href="xgs_2example__vxlan_8c.html#aa93f0eb578d23995850d61f7d61c55c1">00086</a> <span class="preprocessor"></span><span class="preprocessor">#define FALSE 0</span>
<a name="l00087"></a><a class="code" href="xgs_2example__vxlan_8c.html#a6771677c2de7aeda8be146d9068290e3">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define VXLAN_UDP_DEST_PORT 4789</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a>00089 <span class="comment">/*****************************************************************/</span>
<a name="l00096"></a>00096 <span class="keyword">static</span> <span class="keywordtype">int</span> do_vxlan_global_setting(<span class="keywordtype">int</span> unit)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098   <span class="comment">/* Enable L3 Egress Mode */</span>
<a name="l00099"></a>00099   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>
<a name="l00100"></a>00100     (<a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca99cbe7dac9fc5a734a46fdcf66b2e291" title="Enable advanced egress management.">opennslSwitchL3EgressMode</a>, <a class="code" href="xgs_2example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>));
<a name="l00101"></a>00101 
<a name="l00102"></a>00102   <span class="comment">/* Set UDP destination port for VXLAN */</span>
<a name="l00103"></a>00103   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>
<a name="l00104"></a>00104     (<a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca2bd885f05e90af619d58cb5c41fab717" title="Set UDP Destination port for VXLAN.">opennslSwitchVxlanUdpDestPortSet</a>,
<a name="l00105"></a>00105                                 <a class="code" href="xgs_2example__vxlan_8c.html#a6771677c2de7aeda8be146d9068290e3">VXLAN_UDP_DEST_PORT</a>));
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="comment">/* Enable UDP Source port based HASH for VXLAN */</span>
<a name="l00108"></a>00108   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>
<a name="l00109"></a>00109     (<a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca368d941467ad3d8e3476e409f34669a4" title="Set UDP Source port for VXLAN Tunnel Entropy(Value = TRUE/FALSE)">opennslSwitchVxlanEntropyEnable</a>, <a class="code" href="xgs_2example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>));
<a name="l00110"></a>00110 
<a name="l00111"></a>00111   <span class="comment">/* Enable VXLAN Tunnel lookup failure settings to send packets to CPU. */</span>
<a name="l00112"></a>00112   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>
<a name="l00113"></a>00113     (<a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33caed08e670fbc6f4756bfaea6703937f2e" title="If set, send a copy of VXLAN packet to CPU if VXLAN Tunnel lookup fails.">opennslSwitchVxlanTunnelMissToCpu</a>, <a class="code" href="xgs_2example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>));
<a name="l00114"></a>00114 
<a name="l00115"></a>00115   <span class="comment">/* Enable VXLAN VN_ID lookup failure settings to send packets to CPU. */</span>
<a name="l00116"></a>00116   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>
<a name="l00117"></a>00117     (<a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca3f37229fc8e28cdfad6e23be2fcb809b" title="Set VXLAN VN_ID lookup failure Copy to Cpu.">opennslSwitchVxlanVnIdMissToCpu</a>, <a class="code" href="xgs_2example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>));
<a name="l00118"></a>00118 
<a name="l00119"></a>00119   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="comment">/*****************************************************************/</span>
<a name="l00131"></a>00131 <span class="keyword">static</span> <span class="keywordtype">int</span> do_vxlan_access_port_settings(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> a_port)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133   <span class="comment">/* Should disable Vxlan Processing on access port. VXLAN encapsulated packets are  </span>
<a name="l00134"></a>00134 <span class="comment">   * not expected on the access port.</span>
<a name="l00135"></a>00135 <span class="comment">   */</span>
<a name="l00136"></a>00136   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>
<a name="l00137"></a>00137     (<a class="code" href="group__port.html#gaadb3a3b151da4c086bb70045b577ef3f" title="Get or set various features at the port level.">opennsl_port_control_set</a>(unit, a_port, <a class="code" href="group__port.html#gga5379940dfdb23bbc238f5bb9fa6114c9a5e94e33b7b332d12c0aac86eb3c8a9cc" title="Set per port enable for VXLAN (Value=TRUE/FALSE)">opennslPortControlVxlanEnable</a>, <a class="code" href="xgs_2example__vxlan_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>));
<a name="l00138"></a>00138 
<a name="l00139"></a>00139   <span class="comment">/* Should disable Tunnel Based Vxlan-VnId lookup */</span>
<a name="l00140"></a>00140   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>
<a name="l00141"></a>00141     (<a class="code" href="group__port.html#gaadb3a3b151da4c086bb70045b577ef3f" title="Get or set various features at the port level.">opennsl_port_control_set</a>(unit, a_port, <a class="code" href="group__port.html#gga5379940dfdb23bbc238f5bb9fa6114c9a22e32cbf6779567bb86f41d79407ff0c" title="Set per port VNID lookup key (Value=TRUE/FALSE)">opennslPortControlVxlanTunnelbasedVnId</a>, <a class="code" href="xgs_2example__vxlan_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>));
<a name="l00142"></a>00142 
<a name="l00143"></a>00143   <span class="comment">/* Should Enable VLAN translation if access port uses 802.1Q or QinQ */</span>
<a name="l00144"></a>00144   <a class="code" href="group__vlan.html#gafd2c2b34fb525b94d5cb2e14fb75044b" title="Set/get miscellaneous VLAN-specific chip options.">opennsl_vlan_control_set</a>(unit, <a class="code" href="group__vlan.html#gga2c2faca7a7fee163ce2efdf0e74d44efad3d63a7b7b26994677b9e27d0dbd1d11" title="Chip is in VLAN translate mode.">opennslVlanTranslate</a>, <a class="code" href="xgs_2example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00145"></a>00145 
<a name="l00146"></a>00146   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 <span class="comment">/*****************************************************************/</span>
<a name="l00158"></a>00158 <span class="keyword">static</span> <span class="keywordtype">int</span> do_vxlan_net_port_settings(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> n_port)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160   <span class="comment">/* Enable VXLAN Processing on network port */</span>
<a name="l00161"></a>00161   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>
<a name="l00162"></a>00162     (<a class="code" href="group__port.html#gaadb3a3b151da4c086bb70045b577ef3f" title="Get or set various features at the port level.">opennsl_port_control_set</a>(unit, n_port, <a class="code" href="group__port.html#gga5379940dfdb23bbc238f5bb9fa6114c9a5e94e33b7b332d12c0aac86eb3c8a9cc" title="Set per port enable for VXLAN (Value=TRUE/FALSE)">opennslPortControlVxlanEnable</a>, <a class="code" href="xgs_2example__vxlan_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>));
<a name="l00163"></a>00163 
<a name="l00164"></a>00164   <span class="comment">/* Allow tunnel based VXLAN-VNID lookup */</span>
<a name="l00165"></a>00165   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>
<a name="l00166"></a>00166     (<a class="code" href="group__port.html#gaadb3a3b151da4c086bb70045b577ef3f" title="Get or set various features at the port level.">opennsl_port_control_set</a>(unit, n_port, <a class="code" href="group__port.html#gga5379940dfdb23bbc238f5bb9fa6114c9a22e32cbf6779567bb86f41d79407ff0c" title="Set per port VNID lookup key (Value=TRUE/FALSE)">opennslPortControlVxlanTunnelbasedVnId</a>, <a class="code" href="xgs_2example__vxlan_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>));
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <span class="comment">/* Enable Default SVP on network side */</span>
<a name="l00169"></a>00169   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>
<a name="l00170"></a>00170     (<a class="code" href="group__port.html#gaadb3a3b151da4c086bb70045b577ef3f" title="Get or set various features at the port level.">opennsl_port_control_set</a>(unit, n_port, <a class="code" href="group__port.html#gga5379940dfdb23bbc238f5bb9fa6114c9ab68bf32a1e094ee14119eac595ef13f8" title="Set per port dafult-SVP for Tunnel lookup failure(Value=TRUE/FALSE)">opennslPortControlVxlanDefaultTunnelEnable</a>, 0));
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="comment">/*****************************************************************/</span>
<a name="l00188"></a>00188 <span class="keyword">static</span> <span class="keywordtype">int</span> create_vxlan_vpn(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> <a class="code" href="structvxlan__s.html#ad86bc71950683d29530ca040aaf545fe">vpn_id</a>, <span class="keywordtype">int</span> vnid, <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> bc,
<a name="l00189"></a>00189                             <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> mc, <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> uuc)
<a name="l00190"></a>00190 {
<a name="l00191"></a>00191   <a class="code" href="structopennsl__vxlan__vpn__config__s.html" title="VXLAN VPN Config Structure.">opennsl_vxlan_vpn_config_t</a> vpn_info;
<a name="l00192"></a>00192   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <a class="code" href="group__vxlan.html#ga6714301b6f97f14df45b8e96f26cbae8" title="Initialize VXLAN VPN config structure.">opennsl_vxlan_vpn_config_t_init</a>(&amp;vpn_info);
<a name="l00195"></a>00195   vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a16136c29ade623ced30606f46e7ff6d5" title="OPENNSL_VXLAN_VPN_xxx.">flags</a> = <a class="code" href="group__vxlan.html#ga40d3a155a0639cf603ce0fddc8765e87">OPENNSL_VXLAN_VPN_ELAN</a> | <a class="code" href="group__vxlan.html#ga91cf169bff8103ae7e80bf2f437a3725">OPENNSL_VXLAN_VPN_WITH_ID</a> |
<a name="l00196"></a>00196                    <a class="code" href="group__vxlan.html#gad5f555e90830304d8338b723f9239698">OPENNSL_VXLAN_VPN_WITH_VPNID</a>;
<a name="l00197"></a>00197   vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#afbf3610c95f5cf94a92c79259b65211c" title="VXLAN VPN.">vpn</a>  = <a class="code" href="structvxlan__s.html#ad86bc71950683d29530ca040aaf545fe">vpn_id</a>;
<a name="l00198"></a>00198   vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a662233db9e571082acf8eeb89d495a68" title="VNID.">vnid</a> = vnid;
<a name="l00199"></a>00199   vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a497586a6d6f0ce3195a29975068e1461">broadcast_group</a>         = bc;
<a name="l00200"></a>00200   vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#afa48be63476fbb0faff6317d8748446c">unknown_multicast_group</a> = mc;
<a name="l00201"></a>00201   vpn_info.<a class="code" href="structopennsl__vxlan__vpn__config__s.html#a1105297de06ffd03b750d7f46c8ea12d">unknown_unicast_group</a>   = uuc;
<a name="l00202"></a>00202   rv = <a class="code" href="group__vxlan.html#ga7a04195dfb41f6db86a90a1b865962c8" title="Create or update VXLAN VPN.">opennsl_vxlan_vpn_create</a>(unit, &amp;vpn_info);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00205"></a>00205   {
<a name="l00206"></a>00206     printf(<span class="stringliteral">&quot;create_vxlan_vpn: failed to create VXLAN VPN rv %d\n&quot;</span>, rv);
<a name="l00207"></a>00207   }
<a name="l00208"></a>00208   <span class="keywordflow">return</span> rv;
<a name="l00209"></a>00209 }
<a name="l00210"></a>00210 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="comment">/*****************************************************************/</span>
<a name="l00228"></a>00228 <span class="keyword">static</span> <span class="keywordtype">int</span> create_vxlan_acc_vp(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga6cdac91ca2a0f776faf2ec43ea898ad5" title="opennsl_vpn_t">opennsl_vpn_t</a> vpn, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> flags, 
<a name="l00229"></a>00229                                <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>,
<a name="l00230"></a>00230                                <a class="code" href="group__vxlan.html#gaf19a879f9ff312af35a9035c1cad81a0" title="VXLAN port match criteria.">opennsl_vxlan_port_match_t</a> criteria,
<a name="l00231"></a>00231                                <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> egr_obj, <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vid, 
<a name="l00232"></a>00232                                <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> *vp)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234   <a class="code" href="structopennsl__vxlan__port__s.html" title="VXLAN Gport.">opennsl_vxlan_port_t</a> vxlan_port;
<a name="l00235"></a>00235   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237   <a class="code" href="group__vxlan.html#gabb37c026d44cf86b88db9b746864678c" title="Initialize VXLAN port structure.">opennsl_vxlan_port_t_init</a>(&amp;vxlan_port);
<a name="l00238"></a>00238   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ab25ba86e1f740cefc25bcfe66511afb0" title="OPENNSL_VXLAN_PORT_xxx.">flags</a> = <a class="code" href="group__vxlan.html#ga029b6965e196a809b181b56593368c47" title="Service tag mode.">OPENNSL_VXLAN_PORT_SERVICE_TAGGED</a> | flags;
<a name="l00239"></a>00239   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a7db9ca71d49c4d5adb2452eb7f37bd69" title="Match port / trunk.">match_port</a> =        <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>;
<a name="l00240"></a>00240   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a55833885a33e3b4564f244eb739366f0" title="Match criteria.">criteria</a> =          criteria;
<a name="l00241"></a>00241   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#abede24b43e4492ea401abe937bc24b47" title="VXLAN egress object.">egress_if</a> =         egr_obj;
<a name="l00242"></a>00242   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a83ec19441b48299030f5bf9814223cbb" title="Outer VLAN ID to match.">match_vlan</a> =        vid;
<a name="l00243"></a>00243   rv = <a class="code" href="group__vxlan.html#ga436707cb4c75c0ecf856e2859f878ef5" title="opennsl_vxlan_port_add adds a Access or Network VXLAN port.">opennsl_vxlan_port_add</a>(unit, vpn, &amp;vxlan_port);
<a name="l00244"></a>00244   *vp = vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ad75a73a038313fbb6412b11c99a8410b" title="GPORT identifier.">vxlan_port_id</a>;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00247"></a>00247   {
<a name="l00248"></a>00248     printf(<span class="stringliteral">&quot;create_vxlan_acc_vp: failed to create vxlan port rv %d\n&quot;</span>, rv);
<a name="l00249"></a>00249   }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   <span class="keywordflow">return</span> rv;
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="comment">/*****************************************************************/</span>
<a name="l00271"></a>00271 <span class="keyword">static</span> <span class="keywordtype">int</span> create_vxlan_net_vp(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga6cdac91ca2a0f776faf2ec43ea898ad5" title="opennsl_vpn_t">opennsl_vpn_t</a> vpn, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> flags, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> port,
<a name="l00272"></a>00272                                <a class="code" href="group__vxlan.html#gaf19a879f9ff312af35a9035c1cad81a0" title="VXLAN port match criteria.">opennsl_vxlan_port_match_t</a> criteria, <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> egr_obj,
<a name="l00273"></a>00273                                <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> tun_init, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> tun_term, 
<a name="l00274"></a>00274                                <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> *vp)
<a name="l00275"></a>00275 {
<a name="l00276"></a>00276   <a class="code" href="structopennsl__vxlan__port__s.html" title="VXLAN Gport.">opennsl_vxlan_port_t</a> vxlan_port;
<a name="l00277"></a>00277   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   <a class="code" href="group__vxlan.html#gabb37c026d44cf86b88db9b746864678c" title="Initialize VXLAN port structure.">opennsl_vxlan_port_t_init</a>(&amp;vxlan_port);
<a name="l00280"></a>00280   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ab25ba86e1f740cefc25bcfe66511afb0" title="OPENNSL_VXLAN_PORT_xxx.">flags</a> = <a class="code" href="group__vxlan.html#gabc6fe5af508cc9e898aa992bdf981db1" title="Network facing interface.">OPENNSL_VXLAN_PORT_NETWORK</a> | 
<a name="l00281"></a>00281                      <a class="code" href="group__vxlan.html#ga970a0937f71cff5f48e85b2be086aeb2" title="Specified Egress tunnel is valid.">OPENNSL_VXLAN_PORT_EGRESS_TUNNEL</a> |
<a name="l00282"></a>00282                      <a class="code" href="group__vxlan.html#ga029b6965e196a809b181b56593368c47" title="Service tag mode.">OPENNSL_VXLAN_PORT_SERVICE_TAGGED</a> | flags;
<a name="l00283"></a>00283   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a7db9ca71d49c4d5adb2452eb7f37bd69" title="Match port / trunk.">match_port</a> =        <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>;
<a name="l00284"></a>00284   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a55833885a33e3b4564f244eb739366f0" title="Match criteria.">criteria</a> =          criteria;
<a name="l00285"></a>00285   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#abede24b43e4492ea401abe937bc24b47" title="VXLAN egress object.">egress_if</a> =         egr_obj;
<a name="l00286"></a>00286   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#a66bd0455a644c92731efa6997b53d709" title="Tunnel Initiator ID.">egress_tunnel_id</a> =  tun_init;
<a name="l00287"></a>00287   vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#aa3c53f3028118b7e98d3547e179e25eb" title="Tunnel Terminator ID.">match_tunnel_id</a> =   tun_term;
<a name="l00288"></a>00288   rv = <a class="code" href="group__vxlan.html#ga436707cb4c75c0ecf856e2859f878ef5" title="opennsl_vxlan_port_add adds a Access or Network VXLAN port.">opennsl_vxlan_port_add</a>(unit, vpn, &amp;vxlan_port);
<a name="l00289"></a>00289   *vp = vxlan_port.<a class="code" href="structopennsl__vxlan__port__s.html#ad75a73a038313fbb6412b11c99a8410b" title="GPORT identifier.">vxlan_port_id</a>;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00292"></a>00292   {
<a name="l00293"></a>00293     printf(<span class="stringliteral">&quot;create_vxlan_net_vp: failed to create vxlan port rv %d\n&quot;</span>, rv);
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   <span class="keywordflow">return</span> rv;
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="comment">/*****************************************************************/</span>
<a name="l00310"></a>00310 <span class="keyword">static</span> <span class="keywordtype">int</span> add_to_l2_station(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac, <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vid)
<a name="l00311"></a>00311 {
<a name="l00312"></a>00312   <a class="code" href="structopennsl__l2__station__s.html" title="L2 Station address info.">opennsl_l2_station_t</a> l2_station;
<a name="l00313"></a>00313   <span class="keywordtype">int</span> station_id;
<a name="l00314"></a>00314   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00315"></a>00315   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> bc_mac_mask = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff};
<a name="l00316"></a>00316 
<a name="l00317"></a>00317   <a class="code" href="group__l2.html#ga237f10dccfaf6f29a0c4ccee74a3ed8e" title="Initialize L2 Station structure.">opennsl_l2_station_t_init</a>(&amp;l2_station);
<a name="l00318"></a>00318   memcpy(l2_station.<a class="code" href="structopennsl__l2__station__s.html#ac294283242a88ad175d25e02f621d5f5" title="Destination MAC address to match.">dst_mac</a>, mac, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));
<a name="l00319"></a>00319   memcpy(l2_station.<a class="code" href="structopennsl__l2__station__s.html#ace249a6805ad70b11bef4ee29358d93b" title="Destination MAC address mask value.">dst_mac_mask</a>, bc_mac_mask, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));
<a name="l00320"></a>00320   l2_station.<a class="code" href="structopennsl__l2__station__s.html#afae2da66542a8267711e9c33265d0c16" title="VLAN to match.">vlan</a>         = vid;
<a name="l00321"></a>00321   l2_station.<a class="code" href="structopennsl__l2__station__s.html#a42011f54c5fd03cd3c6bf292b14e9af5" title="VLAN mask value.">vlan_mask</a>    = 0xfff;
<a name="l00322"></a>00322   l2_station.<a class="code" href="structopennsl__l2__station__s.html#a2eb42681485db17c250d2aab2481403d" title="OPENNSL_L2_STATION_xxx flags.">flags</a>        = <a class="code" href="group__l2.html#gadd4f59f30875eda41faeacea3b2b1be3" title="Subject packets matching this entry to L3 processing.">OPENNSL_L2_STATION_IPV4</a>;
<a name="l00323"></a>00323   rv = <a class="code" href="group__l2.html#ga8b8c76a2dd59776079dba4e8e25b681c" title="Add an entry to L2 Station table.">opennsl_l2_station_add</a>(unit, &amp;station_id, &amp;l2_station);
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00326"></a>00326   {
<a name="l00327"></a>00327     printf(<span class="stringliteral">&quot;add_to_l2_station: failed to create l2 entry rv %d\n&quot;</span>, rv);
<a name="l00328"></a>00328   }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330   <span class="keywordflow">return</span> rv;
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="comment">/*****************************************************************/</span>
<a name="l00344"></a><a class="code" href="xgs_2example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb">00344</a> <span class="keywordtype">int</span> <a class="code" href="xgs_2example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb" title="Add L2 entry based on the MAC, VPN and physical port.">add_to_l2_table</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac, <a class="code" href="group__types.html#ga6cdac91ca2a0f776faf2ec43ea898ad5" title="opennsl_vpn_t">opennsl_vpn_t</a> vpn_id, <span class="keywordtype">int</span> port)
<a name="l00345"></a>00345 {
<a name="l00346"></a>00346   <span class="keywordtype">int</span> rv;
<a name="l00347"></a>00347   <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> l2_addr;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   <a class="code" href="group__l2.html#ga47e819cf5939a8e643ad09505df52071" title="Initialize an L2 address structure to a specified MAC address and VLAN ID.">opennsl_l2_addr_t_init</a>(&amp;l2_addr, mac, vpn_id);
<a name="l00350"></a>00350   l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a3c915015c746bbad9799b9a40a51b829" title="OPENNSL_L2_xxx flags.">flags</a> = <a class="code" href="group__l2.html#ga838d2e1cee40e3ae41cd4a59599dd333">OPENNSL_L2_STATIC</a>;
<a name="l00351"></a>00351   l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a7546884120ba8ab5dce9348fd9bd819f" title="Zero-based port number.">port</a> = <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>;
<a name="l00352"></a>00352   rv =  <a class="code" href="group__l2.html#ga4b8920c1c3cf4c0c59bf8f0c5890f7c5" title="Add an L2 address entry to the specified device.">opennsl_l2_addr_add</a>(unit, &amp;l2_addr);
<a name="l00353"></a>00353   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00354"></a>00354   {
<a name="l00355"></a>00355     printf(<span class="stringliteral">&quot;add_to_l2_table: failed to create l2 entry rv %d\n&quot;</span>, rv);
<a name="l00356"></a>00356   }
<a name="l00357"></a>00357   <span class="keywordflow">return</span> rv;
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="comment">/*****************************************************************/</span>
<a name="l00370"></a><a class="code" href="xgs_2example__vxlan_8c.html#a8ddc7e204c5da187b95ce791952d4735">00370</a> <span class="keywordtype">int</span> <a class="code" href="xgs_2example__vxlan_8c.html#a8ddc7e204c5da187b95ce791952d4735" title="Create VLAN and add a port to it.">vlan_create_add_port</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> vid, <span class="keywordtype">int</span> port)
<a name="l00371"></a>00371 {
<a name="l00372"></a>00372   <a class="code" href="struct__shr__pbmp.html">opennsl_pbmp_t</a> pbmp, upbmp;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__vlan.html#ga4db9e633ba9c276064768d1718c3062c" title="Allocate and configure a VLAN on the OPENNSL device.">opennsl_vlan_create</a>(unit, vid));
<a name="l00375"></a>00375   <a class="code" href="group__types.html#gafe134087fe1330ec8fffbe7685f139b8">OPENNSL_PBMP_CLEAR</a>(pbmp);
<a name="l00376"></a>00376   <a class="code" href="group__types.html#gafe134087fe1330ec8fffbe7685f139b8">OPENNSL_PBMP_CLEAR</a>(upbmp);
<a name="l00377"></a>00377   <a class="code" href="group__types.html#ga7a3934e09536bcaabfdf0f5aefc48411">OPENNSL_PBMP_PORT_ADD</a>(pbmp, port);
<a name="l00378"></a>00378   <span class="keywordflow">return</span> <a class="code" href="group__vlan.html#ga1e7cecaf6718cd174f1b1aef29349340" title="Add ports to the specified VLAN.">opennsl_vlan_port_add</a>(unit, vid, pbmp, upbmp);
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="comment">/*****************************************************************/</span>
<a name="l00392"></a>00392 <span class="keyword">static</span> <span class="keywordtype">int</span> create_l3_interface(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> local_mac, <span class="keywordtype">int</span> vid,
<a name="l00393"></a>00393                                <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> *intf_id)
<a name="l00394"></a>00394 {
<a name="l00395"></a>00395   <a class="code" href="structopennsl__l3__intf__s.html" title="L3 Interface Structure.">opennsl_l3_intf_t</a> l3_intf;
<a name="l00396"></a>00396   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398   <span class="comment">/* L3 interface and egress object for access */</span>
<a name="l00399"></a>00399   <a class="code" href="group__l3.html#gaa92edab97138caed29fe11f4f9b35fa7" title="Initialize a opennsl_l3_intf_t structure.">opennsl_l3_intf_t_init</a>(&amp;l3_intf);
<a name="l00400"></a>00400   memcpy(l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#ace9be269a08c66e4420c4a11b1689936" title="MAC address.">l3a_mac_addr</a>, local_mac, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));
<a name="l00401"></a>00401   l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#acc865cc8d7ef1ed69ca9d3648ad47c07" title="VLAN ID.">l3a_vid</a> = vid;
<a name="l00402"></a>00402   rv = <a class="code" href="group__l3.html#ga9706ea196e518e48a9a7940471c7a04d" title="Create a new L3 interface.">opennsl_l3_intf_create</a>(unit, &amp;l3_intf);
<a name="l00403"></a>00403   *intf_id = l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a>;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00406"></a>00406   {
<a name="l00407"></a>00407     printf(<span class="stringliteral">&quot;create_l3_interface: failed to create L3 intf rv %d\n&quot;</span>, rv);
<a name="l00408"></a>00408   }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <span class="keywordflow">return</span> rv;
<a name="l00411"></a>00411 }
<a name="l00412"></a>00412 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 <span class="comment">/*****************************************************************/</span>
<a name="l00427"></a>00427 <span class="keyword">static</span> <span class="keywordtype">int</span> create_egr_obj(<span class="keywordtype">int</span> unit, <a class="code" href="sal_2types_8h.html#a1134b580f8da4de94ca6b1de4d37975e">uint32</a> flag, <span class="keywordtype">int</span> l3_if, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> nh_mac,
<a name="l00428"></a>00428                           <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> gport, <span class="keywordtype">int</span> vid, <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> *egr_obj_id)
<a name="l00429"></a>00429 {
<a name="l00430"></a>00430   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00431"></a>00431   <a class="code" href="structopennsl__l3__egress__s.html" title="L3 Egress Structure.">opennsl_l3_egress_t</a> l3_egress;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433   <a class="code" href="group__l3.html#ga10b5ea766149d2bfdcd9d453939057e5" title="Initialize a opennsl_l3_egress_t structure.">opennsl_l3_egress_t_init</a>(&amp;l3_egress);
<a name="l00434"></a>00434   l3_egress.<a class="code" href="structopennsl__l3__egress__s.html#ad2020d0ca398d03556c939201f5d1744" title="Interface flags (OPENNSL_L3_TGID, OPENNSL_L3_L2TOCPU).">flags</a> = <a class="code" href="group__l3.html#gaa2311f752b9726433b9a9fe2eee8bc5c" title="Specific for VXLAN Nexthop.">OPENNSL_L3_VXLAN_ONLY</a> | flag;
<a name="l00435"></a>00435   l3_egress.<a class="code" href="structopennsl__l3__egress__s.html#a495387f57bb66a0b0c38842564af10ec" title="L3 interface (source MAC, tunnel).">intf</a>  = l3_if;
<a name="l00436"></a>00436   memcpy(l3_egress.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>,  nh_mac, <span class="keyword">sizeof</span>(<a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a>));
<a name="l00437"></a>00437   l3_egress.<a class="code" href="structopennsl__l3__egress__s.html#a4559c3254ee6ba88106523dd8c9b4422" title="Next hop vlan id.">vlan</a> = vid;
<a name="l00438"></a>00438   l3_egress.<a class="code" href="structopennsl__l3__egress__s.html#af53aa7695462aa231d4ba889ad06601a" title="Port packet switched to (if !OPENNSL_L3_TGID).">port</a> = gport;
<a name="l00439"></a>00439   rv = <a class="code" href="group__l3.html#ga0b4c7fdba7b362a408ba712e6894ee50" title="Create an Egress forwarding object.">opennsl_l3_egress_create</a>(unit, flag, &amp;l3_egress, egr_obj_id);
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00442"></a>00442   {
<a name="l00443"></a>00443     printf(<span class="stringliteral">&quot;create_egr_obj: failed to create L3 egress object rv %d\n&quot;</span>, rv);
<a name="l00444"></a>00444   }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446   <span class="keywordflow">return</span> rv;
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 <span class="comment">/*****************************************************************/</span>
<a name="l00463"></a>00463 <span class="keyword">static</span> <span class="keywordtype">int</span> tunnel_initiator_setup(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> lip, <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> rip,
<a name="l00464"></a>00464                                   <span class="keywordtype">int</span> dp, <span class="keywordtype">int</span> sp, <span class="keywordtype">int</span> ttl, <span class="keywordtype">int</span> *tid)
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466   <a class="code" href="structopennsl__tunnel__initiator__s.html" title="L3 tunneling initiator.">opennsl_tunnel_initiator_t</a> tnl_init;
<a name="l00467"></a>00467   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469   <a class="code" href="group__tunnel.html#gaf47bc343029b37da6493ad1608452c49" title="Initialize a opennsl_tunnel_initiator_t structure.">opennsl_tunnel_initiator_t_init</a>(&amp;tnl_init);
<a name="l00470"></a>00470   tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#a99d41099e966760cce3744d7390e6b5c" title="Tunnel type.">type</a>  = <a class="code" href="group__tunnel.html#gga3e4190fb50ca1bcda4c884af45ca716fac1249e178f6daa961b5ae19195b4b1e1" title="VXLAN Tunnel.">opennslTunnelTypeVxlan</a>;
<a name="l00471"></a>00471   tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#a8c381d8f2f316b82e1d267f0b6eea3ce" title="Tunnel header TTL.">ttl</a> = ttl;
<a name="l00472"></a>00472   tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#afb622ffe0e32261607929317b796b188" title="Tunnel header SIP (IPv4).">sip</a> = lip;
<a name="l00473"></a>00473   tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#ae197f0e3771f255246a3b926d77d44d8" title="Tunnel header DIP (IPv4).">dip</a> = rip;
<a name="l00474"></a>00474   tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#aeb7589088376cfffcc94519380990216" title="Destination UDP port.">udp_dst_port</a> = dp;
<a name="l00475"></a>00475   tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#a9373ad16f5908eb6d1311233156022bb" title="Source UDP port.">udp_src_port</a> = sp;
<a name="l00476"></a>00476   rv = <a class="code" href="group__vxlan.html#ga0abe7a23a0c1aae0d7699d684dfc835b" title="Create VXLAN Tunnel Initiator.">opennsl_vxlan_tunnel_initiator_create</a>(unit, &amp;tnl_init);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00479"></a>00479   {
<a name="l00480"></a>00480     printf(<span class="stringliteral">&quot;tunnel_initiator_setup: failed to create VXLAN tunnel initiator rv %d\n&quot;</span>, rv);
<a name="l00481"></a>00481   }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483   *tid = tnl_init.<a class="code" href="structopennsl__tunnel__initiator__s.html#ace61a09c712a58a55daaa3ffec6a9682" title="Tunnel ID.">tunnel_id</a>;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 
<a name="l00486"></a>00486   <span class="keywordflow">return</span> rv;
<a name="l00487"></a>00487 }
<a name="l00488"></a>00488 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 <span class="comment">/*****************************************************************/</span>
<a name="l00503"></a>00503 <span class="keyword">static</span> <span class="keywordtype">int</span> tunnel_terminator_setup(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> rip, <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> lip,
<a name="l00504"></a>00504     <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> net_vid, <span class="keywordtype">int</span> tunnel_init_id, <span class="keywordtype">int</span> *term_id)
<a name="l00505"></a>00505 {
<a name="l00506"></a>00506   <a class="code" href="structopennsl__tunnel__terminator__s.html" title="L3 tunneling terminator.">opennsl_tunnel_terminator_t</a> tnl_term;
<a name="l00507"></a>00507   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509   <a class="code" href="group__tunnel.html#gae9a2149c3e68ae37b11739ea199f08f5" title="Initialize a opennsl_tunnel_terminator_t structure.">opennsl_tunnel_terminator_t_init</a>(&amp;tnl_term);
<a name="l00510"></a>00510   tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#abcc9831103f029841cd0821ec0b0988b" title="Tunnel type.">type</a> = <a class="code" href="group__tunnel.html#gga3e4190fb50ca1bcda4c884af45ca716fac1249e178f6daa961b5ae19195b4b1e1" title="VXLAN Tunnel.">opennslTunnelTypeVxlan</a>;
<a name="l00511"></a>00511   tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#a5cbcb1eaa0a16ebc96c576dfc73421b5" title="SIP for tunnel header match.">sip</a> = rip;    <span class="comment">/* For MC tunnel, Don&#39;t care */</span>
<a name="l00512"></a>00512   tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#a57a7d057bf79bbcfed4db60fd9236b7e" title="DIP for tunnel header match.">dip</a> = lip;
<a name="l00513"></a>00513   tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#ad41b511de63a2839f30511f2f03c5302" title="Tunnel id.">tunnel_id</a> = tunnel_init_id;
<a name="l00514"></a>00514   tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#a8eb25fd225a784f420cced44546c08d4" title="Configuration flags.">flags</a> = <a class="code" href="group__tunnel.html#ga07fc2c2aa4e65af0ddb9f2fca9b0f4f0" title="Create tunnel with ID.">OPENNSL_TUNNEL_TERM_TUNNEL_WITH_ID</a>;
<a name="l00515"></a>00515   <span class="keywordflow">if</span> (net_vid != -1) {
<a name="l00516"></a>00516     tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#afd287480cd689441bf7c394c37d6023e" title="The VLAN ID for IPMC lookup or WLAN tunnel.">vlan</a> = net_vid;  <span class="comment">/* MC tunnel only - for Bud check */</span>
<a name="l00517"></a>00517   }
<a name="l00518"></a>00518   rv = <a class="code" href="group__vxlan.html#gab330353b817ed5c343a895905d1e8d94" title="Create VXLAN Tunnel terminator.">opennsl_vxlan_tunnel_terminator_create</a>(unit, &amp;tnl_term);
<a name="l00519"></a>00519   *term_id = tnl_term.<a class="code" href="structopennsl__tunnel__terminator__s.html#ad41b511de63a2839f30511f2f03c5302" title="Tunnel id.">tunnel_id</a>;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00522"></a>00522   {
<a name="l00523"></a>00523     printf(<span class="stringliteral">&quot;tunnel_terminator_setup: failed to create VXLAN tunnel terminator rv %d\n&quot;</span>, rv);
<a name="l00524"></a>00524   }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526   <span class="keywordflow">return</span> rv;
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00529"></a>00529 
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 <span class="comment">/*****************************************************************/</span>
<a name="l00540"></a>00540 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="dpp_2example__vxlan_8c.html#a5bd99907b1249af4dc595c4d17b727b3" title="Main function to build VxLAN IP tunnel.">example_vxlan</a>(<a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> a_port1, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> a_port2,
<a name="l00541"></a>00541     <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> n_port)
<a name="l00542"></a>00542 {
<a name="l00543"></a>00543   <span class="keywordtype">int</span> unit = <a class="code" href="xgs_2example__vxlan_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545   <span class="comment">/* VPN IDs */</span>
<a name="l00546"></a>00546   <a class="code" href="group__types.html#ga6cdac91ca2a0f776faf2ec43ea898ad5" title="opennsl_vpn_t">opennsl_vpn_t</a> vpn_id_1 = 0x7010, vpn_id_2 = 0x7020;
<a name="l00547"></a>00547   <span class="keywordtype">int</span> vnid_1 = 0x12345, vnid_2 = 0x53535;
<a name="l00548"></a>00548   <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> bc_group_1 = 0, bc_group_2 = 0;
<a name="l00549"></a>00549 
<a name="l00550"></a>00550   <span class="comment">/* Used to create a dummy VPN that is used to create network VP */</span>
<a name="l00551"></a>00551   <span class="keywordtype">int</span> rsvd_network_vpn = 0x7001;
<a name="l00552"></a>00552   <span class="keywordtype">int</span> rsvd_network_vpn_vnid = 0xeeee;
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   <span class="comment">/* Access side */</span>
<a name="l00555"></a>00555   <span class="comment">/* Access side MAC addresses are not really used */</span>
<a name="l00556"></a>00556   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> acc_dummy_mac = {0x00, 0x00, 0x01, 0x00, 0x00, 0x01};
<a name="l00557"></a>00557 
<a name="l00558"></a>00558   <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> acc_port_1 = a_port1;          <span class="comment">/* access 1 */</span>
<a name="l00559"></a>00559   <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> acc_vid_1 = 21;
<a name="l00560"></a>00560   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_intf_id_1 = a_port1;
<a name="l00561"></a>00561   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> acc_gport_1 = <a class="code" href="group__types.html#ga14e03ebb50d7d83f78e289cc2f49c3e1">OPENNSL_GPORT_INVALID</a>;
<a name="l00562"></a>00562   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_egr_obj_1;
<a name="l00563"></a>00563   <span class="keywordtype">int</span> acc_vxlan_port_1;
<a name="l00564"></a>00564   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_encap_id_1;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> acc_port_2 = a_port2;          <span class="comment">/* access 2 */</span>
<a name="l00567"></a>00567   <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> acc_vid_2 = 20;
<a name="l00568"></a>00568   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_intf_id_2 = a_port2;
<a name="l00569"></a>00569   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> acc_gport_2 = <a class="code" href="group__types.html#ga14e03ebb50d7d83f78e289cc2f49c3e1">OPENNSL_GPORT_INVALID</a>;
<a name="l00570"></a>00570   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_egr_obj_2;
<a name="l00571"></a>00571   <span class="keywordtype">int</span> acc_vxlan_port_2;
<a name="l00572"></a>00572   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> acc_encap_id_2;
<a name="l00573"></a>00573 
<a name="l00574"></a>00574   <span class="comment">/* Network side */</span>
<a name="l00575"></a>00575   <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> net_port = n_port;
<a name="l00576"></a>00576   <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> net_vid = 22;
<a name="l00577"></a>00577   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> net_intf_id = n_port;
<a name="l00578"></a>00578   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> net_gport = <a class="code" href="group__types.html#ga14e03ebb50d7d83f78e289cc2f49c3e1">OPENNSL_GPORT_INVALID</a>;
<a name="l00579"></a>00579   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> net_egr_obj;
<a name="l00580"></a>00580   <span class="keywordtype">int</span> net_vxlan_port;
<a name="l00581"></a>00581 
<a name="l00582"></a>00582   <span class="comment">/* UC Tunnel */</span>
<a name="l00583"></a>00583   <a class="code" href="sal_2types_8h.html#adde6aaee8457bee49c2a92621fe22b79">uint8</a> ttl = 16;
<a name="l00584"></a>00584   <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> udp_dp = <a class="code" href="xgs_2example__vxlan_8c.html#a6771677c2de7aeda8be146d9068290e3">VXLAN_UDP_DEST_PORT</a>;
<a name="l00585"></a>00585   <a class="code" href="sal_2types_8h.html#a05f6b0ae8f6a6e135b0e290c25fe0e4e">uint16</a> udp_sp = 0xffff;
<a name="l00586"></a>00586   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> net_local_mac = {0x00, 0x00, 0x00, 0x00, 0x22, 0x22};
<a name="l00587"></a>00587   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> net_remote_mac = {0x00, 0x00, 0x00, 0x00, 0x00, 0x02};
<a name="l00588"></a>00588   <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> tnl_local_ip = 0x0a0a0a01;     <span class="comment">/* 10.10.10.1 */</span>
<a name="l00589"></a>00589   <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> tnl_remote_ip = 0xC0A80101;    <span class="comment">/* 192.168.1.1 */</span>
<a name="l00590"></a>00590   <span class="keywordtype">int</span> tunnel_init_id, tunnel_term_id;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <span class="comment">/* DLF/BC tunnel and virtual port */</span>
<a name="l00593"></a>00593   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> dlf_mac = {0x01, 0x00, 0x5e, 0x00, 0x00, 0x0A}; <span class="comment">/* 224.0.0.10 */</span>
<a name="l00594"></a>00594   <a class="code" href="group__types.html#gacc0736ffd87ecd28c801537a88e5fd1f" title="opennsl_ip_t">opennsl_ip_t</a> tnl_mc_dip = 0xe000000A; <span class="comment">/* 224.0.0.10 */</span>
<a name="l00595"></a>00595   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> egr_obj_mc;
<a name="l00596"></a>00596   <span class="keywordtype">int</span> vxlan_port_mc;
<a name="l00597"></a>00597   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> encap_id_mc;
<a name="l00598"></a>00598   <span class="keywordtype">int</span> tunnel_mc_init_id, tunnel_mc_term_id;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600   <span class="comment">/* Payment MAC from access 1 */</span>
<a name="l00601"></a>00601   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> payload_sa_1 = {0x00, 0x00, 0x00, 0x00, 0x11, 0xaa};
<a name="l00602"></a>00602   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> payload_da_1 = {0x00, 0x00, 0x00, 0x00, 0x11, 0xbb};
<a name="l00603"></a>00603 
<a name="l00604"></a>00604   <span class="comment">/* Payment MAC from access 2 */</span>
<a name="l00605"></a>00605   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> payload_sa_2 = {0x00, 0x00, 0x00, 0x00, 0x22, 0xaa};
<a name="l00606"></a>00606   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> payload_da_2 = {0x00, 0x00, 0x00, 0x00, 0x22, 0xbb};
<a name="l00607"></a>00607 
<a name="l00608"></a>00608 
<a name="l00609"></a>00609   <span class="comment">/* Global settings */</span>
<a name="l00610"></a>00610   do_vxlan_global_setting(unit);
<a name="l00611"></a>00611 
<a name="l00612"></a>00612   <span class="comment">/* Access port settings */</span>
<a name="l00613"></a>00613   do_vxlan_access_port_settings(unit, acc_port_1);
<a name="l00614"></a>00614   do_vxlan_access_port_settings(unit, acc_port_2);
<a name="l00615"></a>00615 
<a name="l00616"></a>00616   <span class="comment">/* Network port settings */</span>
<a name="l00617"></a>00617   do_vxlan_net_port_settings(unit, net_port);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619   <a class="code" href="group__port.html#gac3b1ddc83dbed38868b5ba256d29cdf7" title="Get the GPORT ID for the specified local port number.">opennsl_port_gport_get</a>(unit, acc_port_1, &amp;acc_gport_1);
<a name="l00620"></a>00620   <a class="code" href="group__port.html#gac3b1ddc83dbed38868b5ba256d29cdf7" title="Get the GPORT ID for the specified local port number.">opennsl_port_gport_get</a>(unit, acc_port_2, &amp;acc_gport_2);
<a name="l00621"></a>00621   <a class="code" href="group__port.html#gac3b1ddc83dbed38868b5ba256d29cdf7" title="Get the GPORT ID for the specified local port number.">opennsl_port_gport_get</a>(unit, net_port, &amp;net_gport);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623   <span class="comment">/* Multicast group for segment BC/DLF/MC */</span>
<a name="l00624"></a>00624   <a class="code" href="group__multicast.html#ga9134d19d090cf0b13f883abc1edf606c" title="Create a multicast group for packet replication.">opennsl_multicast_create</a>(unit, <a class="code" href="group__multicast.html#ga70c82010da013c1265eaaa4bf661ebb2">OPENNSL_MULTICAST_TYPE_VXLAN</a>, &amp;bc_group_1);
<a name="l00625"></a>00625   <a class="code" href="group__multicast.html#ga9134d19d090cf0b13f883abc1edf606c" title="Create a multicast group for packet replication.">opennsl_multicast_create</a>(unit, <a class="code" href="group__multicast.html#ga70c82010da013c1265eaaa4bf661ebb2">OPENNSL_MULTICAST_TYPE_VXLAN</a>, &amp;bc_group_2);
<a name="l00626"></a>00626 
<a name="l00627"></a>00627   <span class="comment">/* Create VXLAN VPNs */</span>
<a name="l00628"></a>00628   create_vxlan_vpn(unit, vpn_id_1, vnid_1, bc_group_1, bc_group_1, bc_group_1);
<a name="l00629"></a>00629   create_vxlan_vpn(unit, vpn_id_2, vnid_2, bc_group_2, bc_group_2, bc_group_2);
<a name="l00630"></a>00630 
<a name="l00631"></a>00631   <span class="comment">/* Create VXLAN VPN for assigning Network-VP */</span>
<a name="l00632"></a>00632   create_vxlan_vpn(unit, rsvd_network_vpn, rsvd_network_vpn_vnid, bc_group_2,
<a name="l00633"></a>00633                    bc_group_2, bc_group_2);
<a name="l00634"></a>00634 
<a name="l00635"></a>00635   <span class="comment">/* Create access side VXLAN port 1 (belongs to VPN 1) */</span>
<a name="l00636"></a>00636 
<a name="l00637"></a>00637   <span class="comment">/* VLAN settings */</span>
<a name="l00638"></a>00638   <a class="code" href="xgs_2example__vxlan_8c.html#a8ddc7e204c5da187b95ce791952d4735" title="Create VLAN and add a port to it.">vlan_create_add_port</a>(unit, acc_vid_1, acc_port_1);
<a name="l00639"></a>00639 
<a name="l00640"></a>00640   <span class="comment">/* L3 interface and egress object for access 1 - note use a dummy MAC address */</span>
<a name="l00641"></a>00641   create_l3_interface(unit, acc_dummy_mac, acc_vid_1, &amp;acc_intf_id_1);
<a name="l00642"></a>00642   create_egr_obj(unit, 0, acc_intf_id_1, acc_dummy_mac,
<a name="l00643"></a>00643                  acc_gport_1, acc_vid_1, &amp;acc_egr_obj_1);
<a name="l00644"></a>00644 
<a name="l00645"></a>00645   <span class="comment">/* Create VXLAN VP for access port 1 */</span>
<a name="l00646"></a>00646   create_vxlan_acc_vp(unit, vpn_id_1, 0, acc_gport_1, <a class="code" href="group__vxlan.html#gga4600e13897e04ce6c7eef1ea4c52a97aacd7c461c631c617fc7729eb13076e4ee" title="{Module, Port} or Trunk.">OPENNSL_VXLAN_PORT_MATCH_PORT</a>,
<a name="l00647"></a>00647                       acc_egr_obj_1, acc_vid_1, &amp;acc_vxlan_port_1);
<a name="l00648"></a>00648 
<a name="l00649"></a>00649   <span class="comment">/* Create access side VXLAN port 2 (belongs to VPN 2) */</span>
<a name="l00650"></a>00650 
<a name="l00651"></a>00651   <span class="comment">/* VLAN settings */</span>
<a name="l00652"></a>00652   <a class="code" href="xgs_2example__vxlan_8c.html#a8ddc7e204c5da187b95ce791952d4735" title="Create VLAN and add a port to it.">vlan_create_add_port</a>(unit, acc_vid_2, acc_port_2);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   <span class="comment">/* L3 interface and egress object for access 2 - note use a dummy MAC address */</span>
<a name="l00655"></a>00655   create_l3_interface(unit, acc_dummy_mac, acc_vid_2, &amp;acc_intf_id_2);
<a name="l00656"></a>00656   create_egr_obj(unit, 0, acc_intf_id_2, acc_dummy_mac,
<a name="l00657"></a>00657                  acc_gport_2, acc_vid_2, &amp;acc_egr_obj_2);
<a name="l00658"></a>00658 
<a name="l00659"></a>00659   <span class="comment">/* Create VXLAN VP for access port 2 */</span>
<a name="l00660"></a>00660   create_vxlan_acc_vp(unit, vpn_id_2, 0, acc_gport_2, <a class="code" href="group__vxlan.html#gga4600e13897e04ce6c7eef1ea4c52a97aacd7c461c631c617fc7729eb13076e4ee" title="{Module, Port} or Trunk.">OPENNSL_VXLAN_PORT_MATCH_PORT</a>,
<a name="l00661"></a>00661                       acc_egr_obj_2, acc_vid_2, &amp;acc_vxlan_port_2);
<a name="l00662"></a>00662 
<a name="l00663"></a>00663   <span class="comment">/* The network tunnel is shared by the two VPNs */</span>
<a name="l00664"></a>00664 
<a name="l00665"></a>00665   <span class="comment">/* VLAN settings */</span>
<a name="l00666"></a>00666   <a class="code" href="xgs_2example__vxlan_8c.html#a8ddc7e204c5da187b95ce791952d4735" title="Create VLAN and add a port to it.">vlan_create_add_port</a>(unit, net_vid, net_port);
<a name="l00667"></a>00667 
<a name="l00668"></a>00668   <span class="comment">/* L3 interface and egress object for network */</span>
<a name="l00669"></a>00669   create_l3_interface(unit, net_local_mac, net_vid, &amp;net_intf_id);
<a name="l00670"></a>00670   create_egr_obj(unit, 0, net_intf_id, net_remote_mac, net_gport,
<a name="l00671"></a>00671                  net_vid, &amp;net_egr_obj);
<a name="l00672"></a>00672 
<a name="l00673"></a>00673   <span class="comment">/* Tunnel Setup (Initiator &amp; Terminator - UC) */</span>
<a name="l00674"></a>00674   tunnel_initiator_setup(unit, tnl_local_ip, tnl_remote_ip, udp_dp, udp_sp, ttl, &amp;tunnel_init_id);
<a name="l00675"></a>00675   tunnel_terminator_setup(unit, tnl_remote_ip, tnl_local_ip, -1, tunnel_init_id, &amp;tunnel_term_id);
<a name="l00676"></a>00676 
<a name="l00677"></a>00677   <span class="comment">/* Create VXLAN VP for network port */</span>
<a name="l00678"></a>00678   create_vxlan_net_vp(unit, rsvd_network_vpn, 0, net_gport, <a class="code" href="group__vxlan.html#gga4600e13897e04ce6c7eef1ea4c52a97aa95dd2a39582292c5434afce67210ca12" title="Match VXLAN VN_ID.">OPENNSL_VXLAN_PORT_MATCH_VN_ID</a>, net_egr_obj,
<a name="l00679"></a>00679                       tunnel_init_id, tunnel_term_id, &amp;net_vxlan_port);
<a name="l00680"></a>00680 
<a name="l00681"></a>00681   <span class="comment">/* Station MAC set up - this will terminate incoming L3 packets on network port */</span>
<a name="l00682"></a>00682   add_to_l2_station(unit, net_local_mac, net_vid);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684   <span class="comment">/*</span>
<a name="l00685"></a>00685 <span class="comment">   * DLF/BC network port set up</span>
<a name="l00686"></a>00686 <span class="comment">   */</span>
<a name="l00687"></a>00687 
<a name="l00688"></a>00688   <span class="comment">/* Egress object for non-UC VXLAN VP, use same interface as UC VXLAN network */</span>
<a name="l00689"></a>00689   create_egr_obj(unit, <a class="code" href="group__l3.html#ga11efb97e21f394668a625073a16ba8e6" title="Set IPMC for real IPMC entry.">OPENNSL_L3_IPMC</a>, net_intf_id, dlf_mac, net_gport, net_vid, &amp;egr_obj_mc);
<a name="l00690"></a>00690 
<a name="l00691"></a>00691   <span class="comment">/* Tunnel Setup (Initiator &amp; Terminator - non-UC) */</span>
<a name="l00692"></a>00692   tunnel_initiator_setup(unit, tnl_local_ip, tnl_mc_dip, udp_dp, udp_sp, ttl, &amp;tunnel_mc_init_id);
<a name="l00693"></a>00693   tunnel_terminator_setup(unit, tnl_remote_ip, tnl_mc_dip, net_vid,
<a name="l00694"></a>00694       tunnel_mc_init_id, &amp;tunnel_mc_term_id);
<a name="l00695"></a>00695 
<a name="l00696"></a>00696   <span class="comment">/* Create non-UC VXLAN VP for network port */</span>
<a name="l00697"></a>00697   create_vxlan_net_vp(unit, rsvd_network_vpn, <a class="code" href="group__vxlan.html#gae52163c41eb7affb28fe32e108e03391" title="Create Multicast-only VXLAN Tunnel.">OPENNSL_VXLAN_PORT_MULTICAST</a>, net_gport,
<a name="l00698"></a>00698       <a class="code" href="group__vxlan.html#gga4600e13897e04ce6c7eef1ea4c52a97aada3f8233dbf519882b89cebcd3823f08" title="No source match criteria.">OPENNSL_VXLAN_PORT_MATCH_NONE</a>, egr_obj_mc,
<a name="l00699"></a>00699       tunnel_mc_init_id, tunnel_mc_term_id, &amp;vxlan_port_mc);
<a name="l00700"></a>00700 
<a name="l00701"></a>00701   <span class="comment">/* Station MAC set up */</span>
<a name="l00702"></a>00702   add_to_l2_station(unit, dlf_mac, net_vid);
<a name="l00703"></a>00703 
<a name="l00704"></a>00704   <span class="comment">/*</span>
<a name="l00705"></a>00705 <span class="comment">   * MC group set up - MC group should contains all Access ports and Network non-UC port</span>
<a name="l00706"></a>00706 <span class="comment">   */</span>
<a name="l00707"></a>00707 
<a name="l00708"></a>00708   <span class="comment">/* BC group 1 (VPN 1)*/</span>
<a name="l00709"></a>00709   <a class="code" href="group__multicast.html#gafc7e3a95a0a18021de98480a83aeb351" title="Get the multicast encapsulation ID for VXLAN replication.">opennsl_multicast_vxlan_encap_get</a>(unit, bc_group_1, net_gport, vxlan_port_mc, &amp;encap_id_mc);
<a name="l00710"></a>00710   <a class="code" href="group__multicast.html#gae60ad27650b6302a5fc73df3af8efaa6" title="Add an encapsulated interface to a multicast group&#39;s replication list on a specific port...">opennsl_multicast_egress_add</a>(unit, bc_group_1, vxlan_port_mc, encap_id_mc);
<a name="l00711"></a>00711 
<a name="l00712"></a>00712   <a class="code" href="group__multicast.html#gafc7e3a95a0a18021de98480a83aeb351" title="Get the multicast encapsulation ID for VXLAN replication.">opennsl_multicast_vxlan_encap_get</a>(unit, bc_group_1, acc_gport_1, acc_vxlan_port_1, &amp;acc_encap_id_1);
<a name="l00713"></a>00713   <a class="code" href="group__multicast.html#gae60ad27650b6302a5fc73df3af8efaa6" title="Add an encapsulated interface to a multicast group&#39;s replication list on a specific port...">opennsl_multicast_egress_add</a>(unit, bc_group_1, acc_vxlan_port_1, acc_encap_id_1);
<a name="l00714"></a>00714 
<a name="l00715"></a>00715   <span class="comment">/* BC group 2 (VPN 2) */</span>
<a name="l00716"></a>00716   <a class="code" href="group__multicast.html#gafc7e3a95a0a18021de98480a83aeb351" title="Get the multicast encapsulation ID for VXLAN replication.">opennsl_multicast_vxlan_encap_get</a>(unit, bc_group_2, net_gport, vxlan_port_mc, &amp;encap_id_mc);
<a name="l00717"></a>00717   <a class="code" href="group__multicast.html#gae60ad27650b6302a5fc73df3af8efaa6" title="Add an encapsulated interface to a multicast group&#39;s replication list on a specific port...">opennsl_multicast_egress_add</a>(unit, bc_group_2, vxlan_port_mc, encap_id_mc);
<a name="l00718"></a>00718 
<a name="l00719"></a>00719   <a class="code" href="group__multicast.html#gafc7e3a95a0a18021de98480a83aeb351" title="Get the multicast encapsulation ID for VXLAN replication.">opennsl_multicast_vxlan_encap_get</a>(unit, bc_group_2, acc_gport_2, acc_vxlan_port_2, &amp;acc_encap_id_2);
<a name="l00720"></a>00720   <a class="code" href="group__multicast.html#gae60ad27650b6302a5fc73df3af8efaa6" title="Add an encapsulated interface to a multicast group&#39;s replication list on a specific port...">opennsl_multicast_egress_add</a>(unit, bc_group_2, acc_vxlan_port_2, acc_encap_id_2);
<a name="l00721"></a>00721 
<a name="l00722"></a>00722   <span class="comment">/*</span>
<a name="l00723"></a>00723 <span class="comment">   * Add Payload L2 address to L2 table</span>
<a name="l00724"></a>00724 <span class="comment">   */</span>
<a name="l00725"></a>00725 
<a name="l00726"></a>00726   <span class="comment">/* Access 1 =&gt; Network */</span>
<a name="l00727"></a>00727   <a class="code" href="xgs_2example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb" title="Add L2 entry based on the MAC, VPN and physical port.">add_to_l2_table</a>(unit, payload_da_1, vpn_id_1, net_vxlan_port);
<a name="l00728"></a>00728 
<a name="l00729"></a>00729   <span class="comment">/* Network =&gt; Access 1 */</span>
<a name="l00730"></a>00730   <a class="code" href="xgs_2example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb" title="Add L2 entry based on the MAC, VPN and physical port.">add_to_l2_table</a>(unit, payload_sa_1, vpn_id_1, acc_vxlan_port_1);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732   <span class="comment">/* Access 2 =&gt; Network */</span>
<a name="l00733"></a>00733   <a class="code" href="xgs_2example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb" title="Add L2 entry based on the MAC, VPN and physical port.">add_to_l2_table</a>(unit, payload_da_2, vpn_id_2, net_vxlan_port);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735   <span class="comment">/* Network =&gt; Access 2 */</span>
<a name="l00736"></a>00736   <a class="code" href="xgs_2example__vxlan_8c.html#a062f7ae8c9c074eec9753297ea4734fb" title="Add L2 entry based on the MAC, VPN and physical port.">add_to_l2_table</a>(unit, payload_sa_2, vpn_id_2, acc_vxlan_port_2);
<a name="l00737"></a>00737 
<a name="l00738"></a>00738 }
<a name="l00739"></a>00739 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00740"></a>00740 
<a name="l00741"></a>00741 <span class="comment">/*****************************************************************/</span>
<a name="l00748"></a><a class="code" href="xgs_2example__vxlan_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00748</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for policer application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00749"></a>00749 {
<a name="l00750"></a>00750   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a>   rv;
<a name="l00751"></a>00751   <span class="keywordtype">int</span> choice;
<a name="l00752"></a>00752   <span class="keywordtype">int</span> index = 0;
<a name="l00753"></a>00753   <span class="keywordtype">int</span> unit = <a class="code" href="xgs_2example__vxlan_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l00754"></a>00754   <span class="keywordtype">int</span> aport_1, aport_2, nport;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756   <span class="keywordflow">if</span>(strcmp(argv[0], <span class="stringliteral">&quot;gdb&quot;</span>) == 0)
<a name="l00757"></a>00757   {
<a name="l00758"></a>00758     index = 1;
<a name="l00759"></a>00759   }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761   <span class="keywordflow">if</span>((argc != (index + 1)) || ((argc &gt; (index + 1)) &amp;&amp; (strcmp(argv[index + 1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) {
<a name="l00762"></a>00762     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00763"></a>00763     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00764"></a>00764   }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766   <span class="comment">/* Initialize the system. */</span>
<a name="l00767"></a>00767   printf(<span class="stringliteral">&quot;Initializing the switch device.\r\n&quot;</span>);
<a name="l00768"></a>00768   rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00771"></a>00771     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the switch device. Error %s\r\n&quot;</span>,
<a name="l00772"></a>00772         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00773"></a>00773     <span class="keywordflow">return</span> rv;
<a name="l00774"></a>00774   }
<a name="l00775"></a>00775 
<a name="l00776"></a>00776   <span class="comment">/* cold boot initialization commands */</span>
<a name="l00777"></a>00777   rv = <a class="code" href="examples_2util_8h.html#a2846e8ec8f46d212a3ae2493bdff7980" title="Set default configuration (like STP state, speed/duplex) for all ports.">example_port_default_config</a>(unit);
<a name="l00778"></a>00778   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00779"></a>00779     printf(<span class="stringliteral">&quot;\r\nFailed to apply default config on ports, rc = %d (%s).\r\n&quot;</span>,
<a name="l00780"></a>00780            rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00781"></a>00781   }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783   printf(<span class="stringliteral">&quot;1. Enter Access port 1\n&quot;</span>);
<a name="l00784"></a>00784   <span class="keywordflow">do</span>
<a name="l00785"></a>00785   {
<a name="l00786"></a>00786     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;aport_1) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00787"></a>00787     {
<a name="l00788"></a>00788       printf(<span class="stringliteral">&quot;Invalid port number entered. Please re-enter.\n&quot;</span>);
<a name="l00789"></a>00789       <span class="keywordflow">continue</span>;
<a name="l00790"></a>00790     }
<a name="l00791"></a>00791     <span class="keywordflow">break</span>;
<a name="l00792"></a>00792   } <span class="keywordflow">while</span>(1);
<a name="l00793"></a>00793 
<a name="l00794"></a>00794   printf(<span class="stringliteral">&quot;2. Enter Access port 2\n&quot;</span>);
<a name="l00795"></a>00795   <span class="keywordflow">do</span>
<a name="l00796"></a>00796   {
<a name="l00797"></a>00797     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;aport_2) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00798"></a>00798     {
<a name="l00799"></a>00799       printf(<span class="stringliteral">&quot;Invalid port number entered. Please re-enter.\n&quot;</span>);
<a name="l00800"></a>00800       <span class="keywordflow">continue</span>;
<a name="l00801"></a>00801     }
<a name="l00802"></a>00802     <span class="keywordflow">break</span>;
<a name="l00803"></a>00803   } <span class="keywordflow">while</span>(1);
<a name="l00804"></a>00804 
<a name="l00805"></a>00805   printf(<span class="stringliteral">&quot;3. Enter Network port\n&quot;</span>);
<a name="l00806"></a>00806   <span class="keywordflow">do</span>
<a name="l00807"></a>00807   {
<a name="l00808"></a>00808     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;nport) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00809"></a>00809     {
<a name="l00810"></a>00810       printf(<span class="stringliteral">&quot;Invalid port number entered. Please re-enter.\n&quot;</span>);
<a name="l00811"></a>00811       <span class="keywordflow">continue</span>;
<a name="l00812"></a>00812     }
<a name="l00813"></a>00813     <span class="keywordflow">break</span>;
<a name="l00814"></a>00814   } <span class="keywordflow">while</span>(1);
<a name="l00815"></a>00815 
<a name="l00816"></a>00816   <span class="comment">/* Configure VXLAN settings for access and network ports */</span>
<a name="l00817"></a>00817   <a class="code" href="dpp_2example__vxlan_8c.html#a5bd99907b1249af4dc595c4d17b727b3" title="Main function to build VxLAN IP tunnel.">example_vxlan</a>(aport_1, aport_2, nport);
<a name="l00818"></a>00818 
<a name="l00819"></a>00819   printf(<span class="stringliteral">&quot;\r\nVxLAN configuration is done successfully\n&quot;</span>);
<a name="l00820"></a>00820 
<a name="l00821"></a>00821   <span class="keywordflow">while</span> (1) {
<a name="l00822"></a>00822     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l00823"></a>00823 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00824"></a>00824 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00825"></a>00825 <span class="preprocessor">#endif</span>
<a name="l00826"></a>00826 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application\n&quot;</span>);
<a name="l00827"></a>00827 
<a name="l00828"></a>00828     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00829"></a>00829     {
<a name="l00830"></a>00830         printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00831"></a>00831         <span class="keywordflow">continue</span>;
<a name="l00832"></a>00832     }
<a name="l00833"></a>00833     <span class="keywordflow">switch</span>(choice){
<a name="l00834"></a>00834 
<a name="l00835"></a>00835 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00836"></a>00836 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00837"></a>00837       {
<a name="l00838"></a>00838         opennsl_driver_shell();
<a name="l00839"></a>00839         <span class="keywordflow">break</span>;
<a name="l00840"></a>00840       }
<a name="l00841"></a>00841 <span class="preprocessor">#endif</span>
<a name="l00842"></a>00842 <span class="preprocessor"></span>
<a name="l00843"></a>00843       <span class="keywordflow">case</span> 0:
<a name="l00844"></a>00844       {
<a name="l00845"></a>00845         printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00846"></a>00846         rv = <a class="code" href="driver_8h.html#aa760e8f1af45c7fd27ec014b82c572f2" title="Function to free up the resources and exit the driver.">opennsl_driver_exit</a>();
<a name="l00847"></a>00847         <span class="keywordflow">return</span> rv;
<a name="l00848"></a>00848       }
<a name="l00849"></a>00849       <span class="keywordflow">default</span>:
<a name="l00850"></a>00850         <span class="keywordflow">break</span>;
<a name="l00851"></a>00851     } <span class="comment">/* End of switch */</span>
<a name="l00852"></a>00852   } <span class="comment">/* End of while */</span>
<a name="l00853"></a>00853 
<a name="l00854"></a>00854   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00855"></a>00855 }
<a name="l00856"></a>00856 <span class="comment">/* __doxy_func_body_end__ */</span>
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016-17 by Broadcom Limited. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Limited reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Limited is believed to be accurate and reliable. However, Broadcom Limited does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
