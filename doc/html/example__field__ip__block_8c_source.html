<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenNSL API Guide and Reference Manual: examples/example_field_ip_block.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&nbsp;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&nbsp;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>examples/example_field_ip_block.c</h1><a href="example__field__ip__block_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2016</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> **********************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * \file         example_field_ip_block.c</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief        OPENNSL example program to demonstrate field processor</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \details      This example demonstrates blocking of traffic from</span>
<a name="l00024"></a>00024 <span class="comment"> *               hosts with IP addresses 192.168.199.36 to 192.168.199.47</span>
<a name="l00025"></a>00025 <span class="comment"> *               with the exception of 192.168.199.40.</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> **********************************************************************/</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2port_8h.html">opennsl/port.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="field_8h.html">opennsl/field.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="example__field__ip__block_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00038</a> <span class="keywordtype">char</span> <a class="code" href="example__bst_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00039"></a>00039 <span class="stringliteral">&quot;Syntax: example_field_ip_block                                         \n\r&quot;</span>
<a name="l00040"></a>00040 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00041"></a>00041 <span class="stringliteral">&quot;Paramaters: None.                                                      \n\r&quot;</span>
<a name="l00042"></a>00042 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00043"></a>00043 <span class="stringliteral">&quot;Example: The following command is used to block traffic from hosts with\n\r&quot;</span>
<a name="l00044"></a>00044 <span class="stringliteral">&quot;         IP addresses 192.168.199.36 to 192.168.199.47 with the        \n\r&quot;</span>
<a name="l00045"></a>00045 <span class="stringliteral">&quot;         exception of 192.168.199.40. The traffic should be of VLAN 1. \n\r&quot;</span>
<a name="l00046"></a>00046 <span class="stringliteral">&quot;         example_field_ip_block                                        \n\r&quot;</span>
<a name="l00047"></a>00047 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00048"></a>00048 <span class="stringliteral">&quot;Usage Guidelines: None.                                                \n\r&quot;</span>;
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="example__field__ip__block_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00050</a> <span class="preprocessor">#define DEFAULT_UNIT  0</span>
<a name="l00051"></a><a class="code" href="example__field__ip__block_8c.html#a91668ed1245d073a2ac84e6121205d28">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_VLAN  1</span>
<a name="l00052"></a><a class="code" href="example__field__ip__block_8c.html#a068278b0838b6670ab0ab0a93ed77484">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_DIGITS_IN_CHOICE 5</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span>
<a name="l00054"></a><a class="code" href="example__field__ip__block_8c.html#aa76156cfaf77eb109fdac6fb76d48c22">00054</a> <span class="preprocessor">#define ETHERTYPE           0x0800</span>
<a name="l00055"></a><a class="code" href="example__field__ip__block_8c.html#a2612f849c1d0d57fa4f81de9989b3c41">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define ETHERMASK           0xffff</span>
<a name="l00056"></a><a class="code" href="example__field__ip__block_8c.html#a23989b0535cc4550fdf8e66ed8411ab1">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define IPADDR_36           0xC0A8C724 </span><span class="comment">/* 192.168.199.36 */</span>
<a name="l00057"></a><a class="code" href="example__field__ip__block_8c.html#a5076734910a2ba629df1615d36b236fc">00057</a> <span class="preprocessor">#define IPADDR_39           0xC0A8C727 </span><span class="comment">/* 192.168.199.39 */</span>
<a name="l00058"></a><a class="code" href="example__field__ip__block_8c.html#a6adebda67bb8913bbfc2add77a73657d">00058</a> <span class="preprocessor">#define IPMASK_BLOCK_36_39  0xFFFFFFFC </span><span class="comment">/* Mask: 192.168.199.36-39 */</span>
<a name="l00059"></a><a class="code" href="example__field__ip__block_8c.html#a3b67b71aed795748141061025876f906">00059</a> <span class="preprocessor">#define IPADDR_40           0xC0A8C728 </span><span class="comment">/* 192.168.199.40 */</span>
<a name="l00060"></a><a class="code" href="example__field__ip__block_8c.html#a80fde78ee26594985c36f674a2e915e4">00060</a> <span class="preprocessor">#define IPMASK_BLOCK_40_47  0xFFFFFFF8 </span><span class="comment">/* Mask: 192.168.199.40-47 */</span>
<a name="l00061"></a><a class="code" href="example__field__ip__block_8c.html#a556b0a4be1883b6b03022c8166addbe7">00061</a> <span class="preprocessor">#define IPMASK_HOST_UNBLOCK 0xFFFFFFFF </span><span class="comment">/* Unblock host mask */</span>
<a name="l00062"></a><a class="code" href="example__field__ip__block_8c.html#a178be1d88cfd7916e7ace60a0d294d73">00062</a> <span class="preprocessor">#define IPADDR_47           0xC0A8C72F </span><span class="comment">/* 192.168.199.47 */</span>
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="example__field__ip__block_8c.html#ad148af3cd81733fec0a4eb2b7bee1071">00064</a> <span class="preprocessor">#define CALL_IF_ERROR_RETURN(op)                              \</span>
<a name="l00065"></a>00065 <span class="preprocessor">  do                                                          \</span>
<a name="l00066"></a>00066 <span class="preprocessor">  {                                                           \</span>
<a name="l00067"></a>00067 <span class="preprocessor">    int __rv__;                                               \</span>
<a name="l00068"></a>00068 <span class="preprocessor">      if ((__rv__ = (op)) &lt; 0) {                              \</span>
<a name="l00069"></a>00069 <span class="preprocessor">        printf(&quot;%s:%s: line %d rv: %d failed: %s\n&quot;,          \</span>
<a name="l00070"></a>00070 <span class="preprocessor">            __FILE__, __FUNCTION__, __LINE__, __rv__,         \</span>
<a name="l00071"></a>00071 <span class="preprocessor">            opennsl_errmsg(__rv__));                          \</span>
<a name="l00072"></a>00072 <span class="preprocessor">      }                                                       \</span>
<a name="l00073"></a>00073 <span class="preprocessor">  } while(0)</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">/* debug prints */</span>
<a name="l00077"></a><a class="code" href="example__field__ip__block_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">00077</a> <span class="keywordtype">int</span> <a class="code" href="example__field__ip__block_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = 3;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">/**************************************************************************/</span>
<a name="l00086"></a><a class="code" href="example__field__ip__block_8c.html#af1005fa40860866c4a2e9283ee0539c7">00086</a> <span class="keywordtype">int</span> <a class="code" href="example__field__ip__block_8c.html#af1005fa40860866c4a2e9283ee0539c7" title="Install filters to block traffic.">example_fp_ip_block</a>(<span class="keywordtype">int</span> unit) {
<a name="l00087"></a>00087   <a class="code" href="structopennsl__field__qset__s.html" title="Field qset defines the set of fields used for lookup.">opennsl_field_qset_t</a> qset;
<a name="l00088"></a>00088   <a class="code" href="group__field.html#ga4387a1b4682c605fcc1a2b8297f8a404" title="Opaque handle to a field group.">opennsl_field_group_t</a> group;
<a name="l00089"></a>00089   <a class="code" href="group__field.html#ga699caff1a232fe42e6668e5d2869e61e" title="Opaque handle to a field entry.">opennsl_field_entry_t</a> entry;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   <a class="code" href="group__field.html#ga37e97efc912030850263af8ef6248443">OPENNSL_FIELD_QSET_INIT</a>( qset );
<a name="l00092"></a>00092 
<a name="l00094"></a>00094   <a class="code" href="group__field.html#gae7dc7300f0a4b3add5d9099b52eaf735">OPENNSL_FIELD_QSET_ADD</a>(qset, <a class="code" href="group__field.html#ggaa519dd558cda3869447bd6e1209b8ce4a48ba857c1dea52b9ab5beb9dbd675b4a" title="Ethernet Type.">opennslFieldQualifyEtherType</a>);
<a name="l00095"></a>00095   <a class="code" href="group__field.html#gae7dc7300f0a4b3add5d9099b52eaf735">OPENNSL_FIELD_QSET_ADD</a>(qset, <a class="code" href="group__field.html#ggaa519dd558cda3869447bd6e1209b8ce4a23138ab7f5a0bcdc2791fd2ff0f6720f" title="Source IPv4 Address.">opennslFieldQualifySrcIp</a>);
<a name="l00096"></a>00096 
<a name="l00098"></a>00098   <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__field.html#gac08a5398598caf186f4e084493431245" title="Create a field group.">opennsl_field_group_create</a>(unit, qset,
<a name="l00099"></a>00099         <a class="code" href="group__field.html#ga650a60a6b7159e9aaa653f7e0f17c07a">OPENNSL_FIELD_GROUP_PRIO_ANY</a>, &amp;group));
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 
<a name="l00103"></a>00103   {
<a name="l00105"></a>00105     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__field.html#gac6491132b08dde21c8a22ef703744d8e" title="Create a blank field entry.">opennsl_field_entry_create</a>(unit, group, &amp;entry));
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     <a class="code" href="group__field.html#gaa39a3278560cbb0a2c8e3d97173ac8df">opennsl_field_qualify_EtherType</a>(unit, entry, <a class="code" href="example__field__ip__block_8c.html#aa76156cfaf77eb109fdac6fb76d48c22">ETHERTYPE</a>, <a class="code" href="example__field__ip__block_8c.html#a2612f849c1d0d57fa4f81de9989b3c41">ETHERMASK</a>);
<a name="l00108"></a>00108     <a class="code" href="group__field.html#ga4e2ecbae5c9b71a2095c22adc57ede3f">opennsl_field_qualify_SrcIp</a>(unit, entry, <a class="code" href="example__field__ip__block_8c.html#a3b67b71aed795748141061025876f906">IPADDR_40</a>, <a class="code" href="example__field__ip__block_8c.html#a556b0a4be1883b6b03022c8166addbe7">IPMASK_HOST_UNBLOCK</a>);
<a name="l00109"></a>00109     <a class="code" href="group__field.html#ga32de64a448e1706862ad27111610c718" title="Install a field entry into the hardware tables.">opennsl_field_entry_install</a>(unit, entry);
<a name="l00110"></a>00110 
<a name="l00112"></a>00112     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__field.html#gab08abe643c27e9880d28748202969035" title="Add an action to a field entry.">opennsl_field_action_add</a>(unit, entry,
<a name="l00113"></a>00113           <a class="code" href="group__field.html#gga7e4b15dc0ad1411548bfbaff998cb97faa3c2a686550d23e255c3df543d1f124b" title="Override another rule.">opennslFieldActionDropCancel</a>, 0, 0));
<a name="l00114"></a>00114 
<a name="l00115"></a>00115     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__field.html#ga32de64a448e1706862ad27111610c718" title="Install a field entry into the hardware tables.">opennsl_field_entry_install</a>(unit, entry));
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="keywordflow">if</span>(<a class="code" href="example__field__ip__block_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l00118"></a>00118       printf(<span class="stringliteral">&quot;Updated Field Processor to unblock host&quot;</span>);
<a name="l00119"></a>00119       <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot;&quot;</span>, <a class="code" href="example__field__ip__block_8c.html#a3b67b71aed795748141061025876f906">IPADDR_40</a>);
<a name="l00120"></a>00120       printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   }
<a name="l00124"></a>00124 
<a name="l00126"></a>00126   {
<a name="l00128"></a>00128     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__field.html#gac6491132b08dde21c8a22ef703744d8e" title="Create a blank field entry.">opennsl_field_entry_create</a>(unit, group, &amp;entry));
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     <a class="code" href="group__field.html#gaa39a3278560cbb0a2c8e3d97173ac8df">opennsl_field_qualify_EtherType</a>(unit, entry, <a class="code" href="example__field__ip__block_8c.html#aa76156cfaf77eb109fdac6fb76d48c22">ETHERTYPE</a>, <a class="code" href="example__field__ip__block_8c.html#a2612f849c1d0d57fa4f81de9989b3c41">ETHERMASK</a>);
<a name="l00131"></a>00131     <a class="code" href="group__field.html#ga4e2ecbae5c9b71a2095c22adc57ede3f">opennsl_field_qualify_SrcIp</a>(unit, entry, <a class="code" href="example__field__ip__block_8c.html#a23989b0535cc4550fdf8e66ed8411ab1">IPADDR_36</a>, <a class="code" href="example__field__ip__block_8c.html#a6adebda67bb8913bbfc2add77a73657d">IPMASK_BLOCK_36_39</a>);
<a name="l00132"></a>00132     <a class="code" href="group__field.html#ga32de64a448e1706862ad27111610c718" title="Install a field entry into the hardware tables.">opennsl_field_entry_install</a>(unit, entry);
<a name="l00133"></a>00133 
<a name="l00135"></a>00135     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__field.html#gab08abe643c27e9880d28748202969035" title="Add an action to a field entry.">opennsl_field_action_add</a>(unit, entry,
<a name="l00136"></a>00136           <a class="code" href="group__field.html#gga7e4b15dc0ad1411548bfbaff998cb97fa5944a5feb0a9bf6bf9de570b0ff057a9" title="Drop.">opennslFieldActionDrop</a>, 0, 0));
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__field.html#ga32de64a448e1706862ad27111610c718" title="Install a field entry into the hardware tables.">opennsl_field_entry_install</a>(unit, entry));
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <span class="keywordflow">if</span>(<a class="code" href="example__field__ip__block_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l00141"></a>00141       printf(<span class="stringliteral">&quot;Updated Field Processor to block hosts with IP addresses&quot;</span>);
<a name="l00142"></a>00142       <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot; from&quot;</span>, <a class="code" href="example__field__ip__block_8c.html#a23989b0535cc4550fdf8e66ed8411ab1">IPADDR_36</a>);
<a name="l00143"></a>00143       <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot; to&quot;</span>, <a class="code" href="example__field__ip__block_8c.html#a5076734910a2ba629df1615d36b236fc">IPADDR_39</a>);
<a name="l00144"></a>00144       printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146   }
<a name="l00147"></a>00147 
<a name="l00149"></a>00149   {
<a name="l00151"></a>00151     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__field.html#gac6491132b08dde21c8a22ef703744d8e" title="Create a blank field entry.">opennsl_field_entry_create</a>(unit, group, &amp;entry));
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <a class="code" href="group__field.html#gaa39a3278560cbb0a2c8e3d97173ac8df">opennsl_field_qualify_EtherType</a>(unit, entry, <a class="code" href="example__field__ip__block_8c.html#aa76156cfaf77eb109fdac6fb76d48c22">ETHERTYPE</a>, <a class="code" href="example__field__ip__block_8c.html#a2612f849c1d0d57fa4f81de9989b3c41">ETHERMASK</a>);
<a name="l00154"></a>00154     <a class="code" href="group__field.html#ga4e2ecbae5c9b71a2095c22adc57ede3f">opennsl_field_qualify_SrcIp</a>(unit, entry, <a class="code" href="example__field__ip__block_8c.html#a3b67b71aed795748141061025876f906">IPADDR_40</a>, <a class="code" href="example__field__ip__block_8c.html#a80fde78ee26594985c36f674a2e915e4">IPMASK_BLOCK_40_47</a>);
<a name="l00155"></a>00155     <a class="code" href="group__field.html#ga32de64a448e1706862ad27111610c718" title="Install a field entry into the hardware tables.">opennsl_field_entry_install</a>(unit, entry);
<a name="l00156"></a>00156 
<a name="l00158"></a>00158     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__field.html#gab08abe643c27e9880d28748202969035" title="Add an action to a field entry.">opennsl_field_action_add</a>(unit, entry,
<a name="l00159"></a>00159           <a class="code" href="group__field.html#gga7e4b15dc0ad1411548bfbaff998cb97fa5944a5feb0a9bf6bf9de570b0ff057a9" title="Drop.">opennslFieldActionDrop</a>, 0, 0));
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__field.html#ga32de64a448e1706862ad27111610c718" title="Install a field entry into the hardware tables.">opennsl_field_entry_install</a>(unit, entry));
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="keywordflow">if</span>(<a class="code" href="example__field__ip__block_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l00164"></a>00164       printf(<span class="stringliteral">&quot;Updated Field Processor to block hosts with IP addresses&quot;</span>);
<a name="l00165"></a>00165       <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot; from&quot;</span>, <a class="code" href="example__field__ip__block_8c.html#a3b67b71aed795748141061025876f906">IPADDR_40</a>);
<a name="l00166"></a>00166       <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot; to&quot;</span>, <a class="code" href="example__field__ip__block_8c.html#a178be1d88cfd7916e7ace60a0d294d73">IPADDR_47</a>);
<a name="l00167"></a>00167       printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 <span class="comment">/********************************************************************/</span>
<a name="l00183"></a><a class="code" href="example__field__ip__block_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00183</a> <span class="keywordtype">int</span> <a class="code" href="example__bst_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for bst sample application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00186"></a>00186   <span class="keywordtype">int</span> choice;
<a name="l00187"></a>00187   <span class="keywordtype">int</span> unit = <a class="code" href="example__bst_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189   <span class="keywordflow">if</span>((argc != 1) || ((argc &gt; 1) &amp;&amp; (strcmp(argv[1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) {
<a name="l00190"></a>00190     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__bst_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00191"></a>00191     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00192"></a>00192   }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="comment">/* Initialize the system */</span>
<a name="l00195"></a>00195   rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00196"></a>00196 
<a name="l00197"></a>00197   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00198"></a>00198     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system.\r\n&quot;</span>);
<a name="l00199"></a>00199     <span class="keywordflow">return</span> rv;
<a name="l00200"></a>00200   }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="comment">/* cold boot initialization commands */</span>
<a name="l00203"></a>00203   rv = <a class="code" href="examples_2util_8h.html#a2846e8ec8f46d212a3ae2493bdff7980" title="Set default configuration (like STP state, speed/duplex) for all ports.">example_port_default_config</a>(unit);
<a name="l00204"></a>00204   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00205"></a>00205     printf(<span class="stringliteral">&quot;\r\nFailed to apply default config on ports, rc = %d (%s).\r\n&quot;</span>,
<a name="l00206"></a>00206            rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00207"></a>00207   }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 
<a name="l00210"></a>00210   <span class="comment">/* Add ports to default vlan. */</span>
<a name="l00211"></a>00211   printf(<span class="stringliteral">&quot;Adding ports to default vlan.\r\n&quot;</span>);
<a name="l00212"></a>00212   rv = <a class="code" href="examples_2util_8h.html#a2d14e4de1f4a7192ac7e378f8f7c63ff" title="Add all ports to default vlan.">example_switch_default_vlan_config</a>(unit);
<a name="l00213"></a>00213   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00214"></a>00214     printf(<span class="stringliteral">&quot;\r\nFailed to add ports to default VLAN. Error: %s\r\n&quot;</span>,
<a name="l00215"></a>00215         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00216"></a>00216   }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   rv = <a class="code" href="example__field__ip__block_8c.html#af1005fa40860866c4a2e9283ee0539c7" title="Install filters to block traffic.">example_fp_ip_block</a>(unit);
<a name="l00219"></a>00219 
<a name="l00220"></a>00220   <span class="keywordflow">while</span>(1) {
<a name="l00221"></a>00221     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l00222"></a>00222 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00223"></a>00223 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00224"></a>00224 <span class="preprocessor">#endif</span>
<a name="l00225"></a>00225 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application.\r\n&quot;</span>);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00228"></a>00228     {
<a name="l00229"></a>00229       printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00230"></a>00230       <span class="keywordflow">continue</span>;
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232     <span class="keywordflow">switch</span>(choice)
<a name="l00233"></a>00233     {
<a name="l00234"></a>00234 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00235"></a>00235 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00236"></a>00236       {
<a name="l00237"></a>00237         opennsl_driver_shell();
<a name="l00238"></a>00238         <span class="keywordflow">break</span>;
<a name="l00239"></a>00239       }
<a name="l00240"></a>00240 <span class="preprocessor">#endif</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>
<a name="l00242"></a>00242       <span class="keywordflow">case</span> 0:
<a name="l00243"></a>00243       {
<a name="l00244"></a>00244         printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00245"></a>00245         <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00246"></a>00246       }
<a name="l00247"></a>00247       <span class="keywordflow">default</span>:
<a name="l00248"></a>00248       <span class="keywordflow">break</span>;
<a name="l00249"></a>00249     } <span class="comment">/* End of switch */</span>
<a name="l00250"></a>00250   } <span class="comment">/* End of while */</span>
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   <span class="keywordflow">return</span> rv;
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 <span class="comment">/* __doxy_func_body_end__ */</span>
</pre></div></div>
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016 by Broadcom Corporation. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Corporation reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Corporation is believed to be accurate and reliable. However, Broadcom Corporation does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->



<!--BEGIN !GENERATE_TREEVIEW-->
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
