<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>OpenNSL API Guide and Reference Manual: Installing and Executing OpenNSL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css" />
<link href="tabs_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li class="current"><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Installing and Executing OpenNSL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The following pages explain how to <a class="el" href="OPENNSL_INSTALL_RUN.html#OPENNSL_INSTALL_RUN_GTO">Install and Execute OpenNSL on GTO</a> and how to <a class="el" href="OPENNSL_INSTALL_RUN.html#OPENNSL_INSTALL_RUN_IM">Install and Execute OpenNSL on IM Switch/Wedge Switch/Celestica Redstone XP/AS5712 Switch</a>. See <a class="el" href="OPENNSL_INSTALL_RUN.html#OPENNSL_PLATFORM_STEPS">Platform specific instructions</a> on how to enable transmit power on optical transceivers and <a class="el" href="OPENNSL_INSTALL_RUN.html#PLATFORM_APPLICATION_SUPPORT">Application support matrix</a> for the support of sample applications on various platforms.</p>
<h1><a class="anchor" id="OPENNSL_INSTALL_RUN_GTO"></a>
Install and Execute OpenNSL on GTO</h1>
<p>The following sections describe how to install and run OpenNSL examples provided in this package on the supported Broadcom Software Validation Kits (SVK). </p>
<h2><a class="anchor" id="CFESETUP"></a>
CFE Setup:</h2>
<p>The Linux kernel provided with this package requires CFE bootloader to be upgraded. These are the instructions to upgrade the CFE on the switch:</p>
<p>Boot the switch and stop at CFE&gt; prompt. If the switch does not present a CFE&gt; prompt on bootup, reset the switch and interrupt the boot sequence by entering ^C before CFE starts the application.</p>
<p>Upgrade the CFE:</p><ul>
<li>Copy the cfe.flash.bcm98548xmc file to a TFTP server that the switch can access.</li>
<li>Enter the following at the CFE&gt; prompt: <pre>
       CFE&gt; ifconfig eth0 -auto
       CFE&gt; flash &lt;tftp_server_ip&gt;:&lt;file_path&gt;/cfe.flash.bcm98548xmc flash0.boot
</pre></li>
<li>Reset the switch: <pre>
       CFE&gt; reset -sysreset
</pre></li>
</ul>
<p>Setup CFE partitions: Enter the following at the CFE&gt; prompt: </p><pre>
     CFE&gt; ptable add cfe0 0x07f00000 0x00100000
     CFE&gt; ptable add linux 0x08000000 0x07b00000
     CFE&gt; ptable add lboot 0x0fb00000 0x400000
     CFE&gt; ptable save
     CFE&gt; reset -sysreset
</pre><p>Setup environment variables </p><pre>
   CFE&gt; setenv -p LINUX_CMDLINE "root=/dev/ram rw console=ttyS0,9600 rd_start=0x8000000 rd_size=1000000"
</pre><h2><a class="anchor" id="LINUXSETUP"></a>
Linux Kernel Setup:</h2>
<p>To load the Linux uImage via TFTP, enter following commands at CFE&gt; prompt:</p>
<pre>
  CFE&gt; ifconfig eth0 -auto
  CFE&gt; boot -uboot &lt;tftp_server_ip&gt;:&lt;file_path&gt;/gto_uImage
</pre><p>Alternatively, you can write the Linux kernel/rootfs to the persistent flash: </p><pre>
  CFE&gt; ifconfig -auto eth0
  CFE&gt; flash -noheader &lt;tftp_server_ip&gt;:&lt;file_path&gt;/gto_uImage flash5.lboot
  CFE&gt; setenv -p STARTUP 'boot -uboot flash5.lboot:'
  CFE&gt; reset -sysreset
</pre><p>Once Linux starts, a login prompt will be displayed. Following username and password should be used to login: </p><pre>
User: root
Password: broadcom
</pre><h2><a class="anchor" id="DOWNLOADING_RUNNING_OPENNSL"></a>
Downloading and Executing OpenNSL Examples</h2>
<p>cd to target directory. To write to persistent flash storage, write to </p><pre>
  # cd /mnt/opennsl
</pre><p>Download the OpenNSL kernel modules onto the Switch. These files are available at opennsl_root/bin/&lt;platform&gt; directory. </p><pre>
  # tftp -g -r &lt;file_path&gt;/linux-kernel-bde.ko &lt;tftp_server_ip&gt;
  # tftp -g -r &lt;file_path&gt;/linux-user-bde.ko &lt;tftp_server_ip&gt;
  # tftp -g -r &lt;file_path&gt;/linux-bcm-knet.ko &lt;tftp_server_ip&gt;
</pre><p>Download the Shared objects and OpenNSL examples on the switch: </p><pre>
  # tftp -g -r &lt;file_path&gt;/*.so &lt;tftp_server_ip&gt;
  # cp *.so /lib/
  # tftp -g -r &lt;file_path&gt;/example_* &lt;tftp_server_ip&gt;
  # chmod 755 example_*
</pre><p>cd to target directory and start OpenNSL executable. </p><pre>
  #./example_*
</pre><h1><a class="anchor" id="OPENNSL_INSTALL_RUN_IM"></a>
Install and Execute OpenNSL on IM Switch/Wedge Switch/Celestica Redstone XP/AS5712 Switch</h1>
<h2><a class="anchor" id="DOWNLOAD_SETUP_ENV"></a>
Downloading Sample Applications and Basic Setup</h2>
<p>The OpenNSL target deliverables are available in opennsl_root/bin/&lt;platform&gt; directory.</p>
<p>Use the following commands to install OpenNSL Linux kernel modules </p><ul>
<li>Execute "lsmod" to list the installed Linux kernel modules. </li>
<li>Remove the Linux kernel and user modules by using "rmmod" command. </li>
<li>Install Linux kernel modules: <pre>
   # mknod /dev/linux-kernel-bde c 127 0
   # mknod /dev/linux-user-bde c 126 0
   # mknod /dev/linux-bcm-knet c 122 0
   # insmod linux-kernel-bde.ko
   # insmod linux-user-bde.ko
   # insmod linux-bcm-knet.ko
</pre></li>
</ul>
<p>Install OpenNSL shared library. The destination directory to install the shared library depends on the host environment configuration. Install the library files in a location included in the system's library search path. </p><pre>
   # mv libopennsl.so.1 /usr/lib
   # cd /usr/lib
   # ln -sf libopennsl.so.1 libopennsl.so
</pre><h2><a class="anchor" id="RUN_OPENNSL_EXAMPLE"></a>
Executing OpenNSL Examples</h2>
<p>cd to target deliverables directory and run example applications </p><pre>
    # chmod +x example_l2_firewall
    #./example_l2_firewall
</pre><p>Issue "example_l2_firewall --help" for usage of the application.</p>
<h1><a class="anchor" id="OPENNSL_PLATFORM_STEPS"></a>
Platform specific instructions</h1>
<h2><a class="anchor" id="AS5712_PLATFORM"></a>
AS5712 platform</h2>
<p>The transmit power of optical transceivers are controlled through CPLD devices that are connected to CPU over I2C bus. The following I2C utilities are used to control transmit power from the Linux shell.</p>
<pre>
To enable transmit power on ports 1-8, write data 0x00 (BITS 0-7 for Ports 1-8 respectively) to register 0x0C, present on CPLD device at address 0x61.
  i2cset -y 1 0x61 0x0c 0x00 b</pre><pre>Similary, for ports 9-16, 17-24, 25-32, 33-40 and 41-48
  i2cset -y 1 0x61 0x0d 0x00 b
  i2cset -y 1 0x61 0x0e 0x00 b</pre><pre>  i2cset -y 1 0x62 0x0c 0x00 b
  i2cset -y 1 0x62 0x0d 0x00 b
  i2cset -y 1 0x62 0x0e 0x00 b</pre><pre>Use 'i2cget' command to read a register. For example, to read transmit power status of ports 1-8, read register 0x0C, issue
  i2cget -y 1 0x61 0x0C b</pre><pre>Use 'i2cdump' to dump all registers. Example: i2cdump -y 1 0x61 b
</pre><h1><a class="anchor" id="PLATFORM_APPLICATION_SUPPORT"></a>
Application support matrix</h1>
<p>The following table lists the support of sample applications on various platforms.</p>
<table class="doxtable">
<tr>
<th>Application </th><th>Platforms  </th></tr>
<tr>
<td>Buffer Statistics (BST)</td><td>Platforms with Trident2 and Tomahawk silicons </td></tr>
<tr>
<td>Others </td><td>All platforms </td></tr>
</table>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2015 by Broadcom Corporation. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Corporation reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Corporation is believed to be accurate and reliable. However, Broadcom Corporation does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
</div>
<!--END GENERATE_TREEVIEW-->
</body>
</html>
