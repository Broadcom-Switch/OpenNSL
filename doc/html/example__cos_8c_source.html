<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/dpp/example_cos.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/dpp/example_cos.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="example__cos_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2017</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> **********************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * \file         example_cos.c</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief        OpenNSL example application for Class Of Service module</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \details       This example includes:</span>
<a name="l00024"></a>00024 <span class="comment"> *  o     Port shaper </span>
<a name="l00025"></a>00025 <span class="comment"> *  o     Queue&#39;s weight (WFQ) </span>
<a name="l00026"></a>00026 <span class="comment"> *  o     Strict priority </span>
<a name="l00027"></a>00027 <span class="comment"> *  o     Incoming TC/DP mapping </span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> * It is assumed diag_init is executed.</span>
<a name="l00030"></a>00030 <span class="comment"> * </span>
<a name="l00031"></a>00031 <span class="comment"> * Settings include:</span>
<a name="l00032"></a>00032 <span class="comment"> * Set the OFP Bandwidth to 5G using the port shaper.</span>
<a name="l00033"></a>00033 <span class="comment"> *  1.  Set the OFP Bandwidth to 5G using the port shaper. </span>
<a name="l00034"></a>00034 <span class="comment"> *    2.    Set queues priorities WFQ/SP as follows:</span>
<a name="l00035"></a>00035 <span class="comment"> *         -    For the high-priority queues, WFQ is set: UC will get 2/3 of the BW and MC will get 1/3 of the BW.</span>
<a name="l00036"></a>00036 <span class="comment"> *         -    For the low-priority queues, SP UC is set over MC.</span>
<a name="l00037"></a>00037 <span class="comment"> *    3.    Configure TC/DP egress mapping. Map low-priority traffic (0 - 3 for UC, 0  - 5 for MC)</span>
<a name="l00038"></a>00038 <span class="comment"> *     to low-priority queues, and high-priority traffic (4  - 7 for UC, 6  - 7 for MC) to high-priority queues.</span>
<a name="l00039"></a>00039 <span class="comment"> * </span>
<a name="l00040"></a>00040 <span class="comment"> *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="l00041"></a>00041 <span class="comment"> *  |                                                                        |</span>
<a name="l00042"></a>00042 <span class="comment"> *  |                                   |\                                   |</span>
<a name="l00043"></a>00043 <span class="comment"> *  |opennslCosqGportTypeUnicastEgress  | \                                  |</span>
<a name="l00044"></a>00044 <span class="comment"> *  |             +-----------+         |  \                                 |</span>
<a name="l00045"></a>00045 <span class="comment"> *  |   TC 0-3 --&gt;| HP UC  || |---------|2/3\                                |</span>
<a name="l00046"></a>00046 <span class="comment"> *  |             +-----------+         |    |                               |</span>
<a name="l00047"></a>00047 <span class="comment"> *  |opennslCosqGportTypeMulticastEgress|WFQ |-----+                         |</span>
<a name="l00048"></a>00048 <span class="comment"> *  |             +-----------+         |    |     |     |\                  |</span>
<a name="l00049"></a>00049 <span class="comment"> *  |   TC 0-5 --&gt;| HP MC  || |---------|1/3/      |     | \                 |</span>
<a name="l00050"></a>00050 <span class="comment"> *  |             +-----------+         |  /       +----&gt;|H \                |</span>
<a name="l00051"></a>00051 <span class="comment"> *  |                                   | /              |   \               |</span>
<a name="l00052"></a>00052 <span class="comment"> *  |                                   |/               |    |    5G        |</span>
<a name="l00053"></a>00053 <span class="comment"> *  |                                                    | SP |----SPR----&gt;  |</span>
<a name="l00054"></a>00054 <span class="comment"> *  |opennslCosqGportTypeUnicastEgress  |\               |    |              |</span>
<a name="l00055"></a>00055 <span class="comment"> *  |             +-----------+         | \              |   /               |</span>
<a name="l00056"></a>00056 <span class="comment"> *  |   TC 4-7 --&gt;| LP UC  || |---------|H \       +----&gt;|L /                |</span>
<a name="l00057"></a>00057 <span class="comment"> *  |             +-----------+         |   |      |     | /                 |</span>
<a name="l00058"></a>00058 <span class="comment"> *  |opennslCosqGportTypeMulticastEgress| SP|------+     |/                  |</span>
<a name="l00059"></a>00059 <span class="comment"> *  |             +-----------+         |   |                                |</span>
<a name="l00060"></a>00060 <span class="comment"> *  |   TC 6-7 --&gt;| LP MC  || |---------|L /          +----------------+     |</span>
<a name="l00061"></a>00061 <span class="comment"> *  |             +-----------+         | /           |      KEY       |     |</span>
<a name="l00062"></a>00062 <span class="comment"> *  |                                   |/            +----------------+     |</span>
<a name="l00063"></a>00063 <span class="comment"> *  |                                                 |SPR- Rate Shaper|     |</span>
<a name="l00064"></a>00064 <span class="comment"> *  |                                                 |                |     |</span>
<a name="l00065"></a>00065 <span class="comment"> *  |                                                 +----------------+     |</span>
<a name="l00066"></a>00066 <span class="comment"> *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="l00067"></a>00067 <span class="comment"> * </span>
<a name="l00068"></a>00068 <span class="comment"> */</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &lt;<a class="code" href="init_8h.html">opennsl/init.h</a>&gt;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &lt;<a class="code" href="stack_8h.html">opennsl/stack.h</a>&gt;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2port_8h.html">opennsl/port.h</a>&gt;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &lt;<a class="code" href="l2_8h.html">opennsl/l2.h</a>&gt;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &lt;<a class="code" href="cosq_8h.html">opennsl/cosq.h</a>&gt;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &lt;<a class="code" href="multicast_8h.html">opennsl/multicast.h</a>&gt;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00084</a> <span class="keywordtype">char</span> <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00085"></a>00085 <span class="stringliteral">&quot;Syntax: example_cos                                                    \n\r&quot;</span>
<a name="l00086"></a>00086 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00087"></a>00087 <span class="stringliteral">&quot;Paramaters: None.                                                      \n\r&quot;</span>
<a name="l00088"></a>00088 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00089"></a>00089 <span class="stringliteral">&quot;Example: The following command is used to test the CoS functionality   \n\r&quot;</span>
<a name="l00090"></a>00090 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00091"></a>00091 <span class="stringliteral">&quot;         example_cos                                                   \n\r&quot;</span>
<a name="l00092"></a>00092 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00093"></a>00093 <span class="stringliteral">&quot;Usage Guidelines: None.                                                \n\r&quot;</span>;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="example__cos_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00096</a> <span class="preprocessor">#define DEFAULT_UNIT 0</span>
<a name="l00097"></a><a class="code" href="example__cos_8c.html#a91668ed1245d073a2ac84e6121205d28">00097</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_VLAN 1</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">00100</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a> = 0;
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="example__cos_8c.html#ac12d4a53600681e3b6cb5e111c8f1765">00102</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#ac12d4a53600681e3b6cb5e111c8f1765">multicast__open_mc_group</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> *mc_group_id, <span class="keywordtype">int</span> extra_flags) 
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00105"></a>00105   <span class="keywordtype">int</span> flags;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="comment">/* destroy before open, to ensure it not exist */</span>
<a name="l00108"></a>00108   rv = <a class="code" href="group__multicast.html#ga27adcadc98215474623759d0d7afb8d2" title="Destroy a multicast group.">opennsl_multicast_destroy</a>(unit, *mc_group_id);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   printf(<span class="stringliteral">&quot;egress_mc: %d \n&quot;</span>, <a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a>);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112   flags = <a class="code" href="group__multicast.html#gaf2991b6d0bfbd56d66953868e6c099be">OPENNSL_MULTICAST_WITH_ID</a> | extra_flags;
<a name="l00113"></a>00113   <span class="comment">/* create ingress/egress MC */</span>
<a name="l00114"></a>00114   <span class="keywordflow">if</span> (<a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a>) 
<a name="l00115"></a>00115   {
<a name="l00116"></a>00116     flags |= <a class="code" href="group__multicast.html#ga9d5471deb377bb1324e0b77f04319250">OPENNSL_MULTICAST_EGRESS_GROUP</a>;
<a name="l00117"></a>00117   } 
<a name="l00118"></a>00118   <span class="keywordflow">else</span> 
<a name="l00119"></a>00119   {
<a name="l00120"></a>00120     flags |= <a class="code" href="group__multicast.html#gaae730f6ddddbdef6db10444bc9e5a657">OPENNSL_MULTICAST_INGRESS_GROUP</a>;
<a name="l00121"></a>00121   }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   rv = <a class="code" href="group__multicast.html#ga9134d19d090cf0b13f883abc1edf606c" title="Create a multicast group for packet replication.">opennsl_multicast_create</a>(unit, flags, mc_group_id);
<a name="l00124"></a>00124   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00125"></a>00125   {
<a name="l00126"></a>00126     printf(<span class="stringliteral">&quot;Error, opennsl_multicast_create, flags $flags mc_group_id $mc_group_id \n&quot;</span>);
<a name="l00127"></a>00127     <span class="keywordflow">return</span> rv;
<a name="l00128"></a>00128   }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130   printf(<span class="stringliteral">&quot;Created mc_group %d \n&quot;</span>, *mc_group_id);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132   <span class="keywordflow">return</span> rv;
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="comment">/* Adding entries to MC group</span>
<a name="l00137"></a>00137 <span class="comment"> * ipmc_index:  mc group</span>
<a name="l00138"></a>00138 <span class="comment"> * ports: array of ports to add to the mc group</span>
<a name="l00139"></a>00139 <span class="comment"> * cud </span>
<a name="l00140"></a>00140 <span class="comment"> * nof_mc_entries: number of entries to add to the mc group</span>
<a name="l00141"></a>00141 <span class="comment"> * is_ingress:  if true, add ingress mc entry, otherwise, add egress mc </span>
<a name="l00142"></a>00142 <span class="comment"> * see add_ingress_multicast_forwarding from cint_ipmc_flows.c</span>
<a name="l00143"></a>00143 <span class="comment"> * </span>
<a name="l00144"></a>00144 <span class="comment">   */</span>
<a name="l00145"></a><a class="code" href="example__cos_8c.html#a2cfb797cf32205ee36458a10d85ec3a3">00145</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a2cfb797cf32205ee36458a10d85ec3a3">multicast__add_multicast_entry</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> ipmc_index, <span class="keywordtype">int</span> *<a class="code" href="opennsl__api_8dox.html#af9d2702e21ab86e9074894ba172b114d">ports</a>, <span class="keywordtype">int</span> *cud, <span class="keywordtype">int</span> nof_mc_entries, <span class="keywordtype">int</span> is_egress) 
<a name="l00146"></a>00146 {
<a name="l00147"></a>00147   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00148"></a>00148   <span class="keywordtype">int</span> i;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150   <span class="keywordflow">for</span> (i=0;i&lt;nof_mc_entries;i++) 
<a name="l00151"></a>00151   {
<a name="l00152"></a>00152     <span class="comment">/* egress MC */</span>
<a name="l00153"></a>00153     <span class="keywordflow">if</span> (is_egress) 
<a name="l00154"></a>00154     {
<a name="l00155"></a>00155       rv = <a class="code" href="group__multicast.html#gae60ad27650b6302a5fc73df3af8efaa6" title="Add an encapsulated interface to a multicast group&#39;s replication list on a specific port...">opennsl_multicast_egress_add</a>(unit,ipmc_index,ports[i],cud[i]);
<a name="l00156"></a>00156       <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00157"></a>00157       {
<a name="l00158"></a>00158         printf(<span class="stringliteral">&quot;Error, opennsl_multicast_egress_add: port %d encap_id: %d \n&quot;</span>, ports[i], cud[i]);
<a name="l00159"></a>00159         <span class="keywordflow">return</span> rv;
<a name="l00160"></a>00160       }
<a name="l00161"></a>00161     } 
<a name="l00162"></a>00162     <span class="comment">/* ingress MC */</span>
<a name="l00163"></a>00163     <span class="keywordflow">else</span> 
<a name="l00164"></a>00164     {
<a name="l00165"></a>00165       rv = <a class="code" href="group__multicast.html#gafa55f761fe7a9b6026267234c3fd7057" title="Add a port to a Ingress Multicast group&#39;s replication list.">opennsl_multicast_ingress_add</a>(unit,ipmc_index,ports[i],cud[i]);
<a name="l00166"></a>00166       <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00167"></a>00167       {
<a name="l00168"></a>00168         printf(<span class="stringliteral">&quot;Error, opennsl_multicast_ingress_add: port %d encap_id: %d \n&quot;</span>, ports[i], cud[i]);
<a name="l00169"></a>00169         <span class="keywordflow">return</span> rv;
<a name="l00170"></a>00170       }
<a name="l00171"></a>00171     }
<a name="l00172"></a>00172   }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174   <span class="keywordflow">return</span> rv;
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00177"></a>00177 
<a name="l00178"></a><a class="code" href="example__cos_8c.html#a8636803c632aebb6238a17262d860c6e">00178</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a8636803c632aebb6238a17262d860c6e">multicast__open_egress_mc_group_with_local_ports</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> mc_group_id, <span class="keywordtype">int</span> *dest_local_port_id, <span class="keywordtype">int</span> *cud, <span class="keywordtype">int</span> num_of_ports, <span class="keywordtype">int</span> extra_flags) 
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180   <span class="keywordtype">int</span> i;
<a name="l00181"></a>00181   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00182"></a>00182   <a class="code" href="structopennsl__cosq__gport__info__s.html" title="gport information related to getting a handle">opennsl_cosq_gport_info_t</a> gport_info;
<a name="l00183"></a>00183   <a class="code" href="group__cosq.html#gace58b01f291bf94595c7c5b7fdff4f64" title="cosq gport type eumerations">opennsl_cosq_gport_type_t</a> gport_type = <a class="code" href="group__cosq.html#ggad51a80545c14c96db5287252c43ea6f7ac9aec04f4dd10ab8085c20f3b49137a0" title="Ports in Egress transmit hierarchy.">opennslCosqGportTypeLocalPort</a>;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185   <a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a> = 1;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187   rv = <a class="code" href="example__cos_8c.html#ac12d4a53600681e3b6cb5e111c8f1765">multicast__open_mc_group</a>(unit, &amp;mc_group_id, extra_flags);
<a name="l00188"></a>00188   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00189"></a>00189   {
<a name="l00190"></a>00190     printf(<span class="stringliteral">&quot;Error, multicast__open_mc_group, extra_flags $extra_flags mc_group $mc_group_id \n&quot;</span>);
<a name="l00191"></a>00191     <span class="keywordflow">return</span> rv;
<a name="l00192"></a>00192   }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="keywordflow">for</span>(i=0;i&lt;num_of_ports;i++) 
<a name="l00195"></a>00195   {
<a name="l00196"></a>00196     <a class="code" href="group__types.html#ga0622ec4146114faa4aab69c4e5265fa6">OPENNSL_GPORT_LOCAL_SET</a>(gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a3cd4116433fb20351cf218dcdf360e34" title="gport to be converted.">in_gport</a>,dest_local_port_id[i]); 
<a name="l00197"></a>00197     rv = <a class="code" href="group__cosq.html#ga8a8f4f366747415ac3cc3b92187c7359" title="Getting a gport handle.">opennsl_cosq_gport_handle_get</a>(unit,gport_type,&amp;gport_info);
<a name="l00198"></a>00198     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00199"></a>00199     {
<a name="l00200"></a>00200       printf(<span class="stringliteral">&quot;Error, opennsl_cosq_gport_handle_get, gport_type $gport_type \n&quot;</span>);
<a name="l00201"></a>00201       <span class="keywordflow">return</span> rv;
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     rv = <a class="code" href="example__cos_8c.html#a2cfb797cf32205ee36458a10d85ec3a3">multicast__add_multicast_entry</a>(unit, mc_group_id, &amp;gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a2c79ed194fe6750fdd52e4f55b5b6829" title="retreived gport">out_gport</a>, &amp;cud[i], 1, <a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a>);
<a name="l00205"></a>00205     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00206"></a>00206     {
<a name="l00207"></a>00207       printf(<span class="stringliteral">&quot;Error, multicast__add_multicast_entry, mc_group_id $mc_group_id dest_gport $gport_info.out_gport \n&quot;</span>);
<a name="l00208"></a>00208       <span class="keywordflow">return</span> rv;
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210   }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   <span class="keywordflow">return</span> rv;
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 <span class="comment">/* Set OFP Bandwidth (max KB per sec)</span>
<a name="l00217"></a>00217 <span class="comment"> * Configure the Port Shaper&#39;s max rate</span>
<a name="l00218"></a>00218 <span class="comment"> */</span>
<a name="l00219"></a><a class="code" href="example__cos_8c.html#a0063ad665ec8be522f1a159970039854">00219</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a0063ad665ec8be522f1a159970039854">example_set_ofp_bandwidth</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> local_port_id, <span class="keywordtype">int</span> max_kbits_sec)
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00222"></a>00222   <a class="code" href="group__cosq.html#gace58b01f291bf94595c7c5b7fdff4f64" title="cosq gport type eumerations">opennsl_cosq_gport_type_t</a> gport_type;
<a name="l00223"></a>00223   <a class="code" href="structopennsl__cosq__gport__info__s.html" title="gport information related to getting a handle">opennsl_cosq_gport_info_t</a> gport_info;
<a name="l00224"></a>00224   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> out_gport;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <span class="keywordtype">int</span> min_kbits_rate = 0;
<a name="l00227"></a>00227   <span class="keywordtype">int</span> flags = 0;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229   <span class="comment">/* Set GPORT according to the given local_port_id */</span>
<a name="l00230"></a>00230   <a class="code" href="group__types.html#ga0622ec4146114faa4aab69c4e5265fa6">OPENNSL_GPORT_LOCAL_SET</a>(gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a3cd4116433fb20351cf218dcdf360e34" title="gport to be converted.">in_gport</a>, local_port_id); 
<a name="l00231"></a>00231 
<a name="l00232"></a>00232   gport_type = <a class="code" href="group__cosq.html#ggad51a80545c14c96db5287252c43ea6f7ac9aec04f4dd10ab8085c20f3b49137a0" title="Ports in Egress transmit hierarchy.">opennslCosqGportTypeLocalPort</a>; 
<a name="l00233"></a>00233 
<a name="l00234"></a>00234   rv = <a class="code" href="group__cosq.html#ga8a8f4f366747415ac3cc3b92187c7359" title="Getting a gport handle.">opennsl_cosq_gport_handle_get</a>(unit, gport_type, &amp;gport_info);
<a name="l00235"></a>00235   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00236"></a>00236   {
<a name="l00237"></a>00237     printf(<span class="stringliteral">&quot;Error, in handle get, gport_type $gport_type \n&quot;</span>);
<a name="l00238"></a>00238     <span class="keywordflow">return</span> rv;
<a name="l00239"></a>00239   }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   out_gport = gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a2c79ed194fe6750fdd52e4f55b5b6829" title="retreived gport">out_gport</a>;
<a name="l00242"></a>00242   rv = <a class="code" href="group__cosq.html#ga52ba1b9fd2823c44ffec397cd3cfae8f" title="Configure/Retrieve bandwidth setting.">opennsl_cosq_gport_bandwidth_set</a>(unit, out_gport, 0, min_kbits_rate, max_kbits_sec, flags);
<a name="l00243"></a>00243   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00244"></a>00244   {
<a name="l00245"></a>00245     printf(<span class="stringliteral">&quot;Error, in bandwidth set, out_gport $out_gport max_kbits_sec $max_kbits_sec \n&quot;</span>);
<a name="l00246"></a>00246     <span class="keywordflow">return</span> rv;
<a name="l00247"></a>00247   }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249   <span class="keywordflow">return</span> rv;
<a name="l00250"></a>00250 }
<a name="l00251"></a>00251 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 <span class="comment">/* Set Strict Priority Configuration </span>
<a name="l00254"></a>00254 <span class="comment"> * queue = OPENNSL_COSQ_LOW_PRIORITY</span>
<a name="l00255"></a>00255 <span class="comment"> *         OPENNSL_COSQ_HIGH_PRIORITY</span>
<a name="l00256"></a>00256 <span class="comment"> * SP_Type = 0 for UC over MC</span>
<a name="l00257"></a>00257 <span class="comment"> *           1 for MC over UC</span>
<a name="l00258"></a>00258 <span class="comment"> */</span>
<a name="l00259"></a><a class="code" href="example__cos_8c.html#a054b01cf2194f70d5d5165f14bf4ba1d">00259</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a054b01cf2194f70d5d5165f14bf4ba1d">example_set_sp</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> local_port_id, <span class="keywordtype">int</span> queue, <span class="keywordtype">int</span> sp_type)
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00262"></a>00262   <a class="code" href="group__cosq.html#gace58b01f291bf94595c7c5b7fdff4f64" title="cosq gport type eumerations">opennsl_cosq_gport_type_t</a> gport_type;
<a name="l00263"></a>00263   <a class="code" href="structopennsl__cosq__gport__info__s.html" title="gport information related to getting a handle">opennsl_cosq_gport_info_t</a> gport_info;
<a name="l00264"></a>00264   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> out_gport;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   <span class="comment">/* Set GPORT according to the given local_port_id */</span>
<a name="l00267"></a>00267   <a class="code" href="group__types.html#ga0622ec4146114faa4aab69c4e5265fa6">OPENNSL_GPORT_LOCAL_SET</a>(gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a3cd4116433fb20351cf218dcdf360e34" title="gport to be converted.">in_gport</a>,local_port_id); 
<a name="l00268"></a>00268 
<a name="l00269"></a>00269   <span class="comment">/* We will define MC as high or low priority */</span>
<a name="l00270"></a>00270   gport_type = <a class="code" href="group__cosq.html#ggad51a80545c14c96db5287252c43ea6f7a6ce513fedb8b124253397577a3d33a10" title="Multicast Egress Queues - Port Hierarchy.">opennslCosqGportTypeMulticastEgress</a>; 
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   rv = <a class="code" href="group__cosq.html#ga8a8f4f366747415ac3cc3b92187c7359" title="Getting a gport handle.">opennsl_cosq_gport_handle_get</a>(unit,gport_type,&amp;gport_info);
<a name="l00273"></a>00273   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00274"></a>00274   {
<a name="l00275"></a>00275     printf(<span class="stringliteral">&quot;Error, in handle get, gport_type $gport_type \n&quot;</span>);
<a name="l00276"></a>00276     <span class="keywordflow">return</span> rv;
<a name="l00277"></a>00277   }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   out_gport = gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a2c79ed194fe6750fdd52e4f55b5b6829" title="retreived gport">out_gport</a>;
<a name="l00280"></a>00280   <span class="keywordflow">if</span>(sp_type == 0) 
<a name="l00281"></a>00281   {
<a name="l00282"></a>00282     <span class="comment">/* Setting with OPENNSL_COSQ_SP1 will set the MC to be LOWER priority --&gt; UC over MC */</span>
<a name="l00283"></a>00283     rv = <a class="code" href="group__cosq.html#gacd1f0d8fdaf8138441139ee645270a3c" title="Configure/retrieve scheduling policy.">opennsl_cosq_gport_sched_set</a>(unit, out_gport, queue, <a class="code" href="group__cosq.html#gad33b3f753f9122249cc1adc75efe65a7" title="Strict priority level 1.">OPENNSL_COSQ_SP1</a>, -1);
<a name="l00284"></a>00284   } 
<a name="l00285"></a>00285   <span class="keywordflow">else</span> 
<a name="l00286"></a>00286   {
<a name="l00287"></a>00287     <span class="comment">/* Setting with OPENNSL_COSQ_SP0 will set the MC to be HIGHER priority --&gt; MC over UC */</span>
<a name="l00288"></a>00288     rv = <a class="code" href="group__cosq.html#gacd1f0d8fdaf8138441139ee645270a3c" title="Configure/retrieve scheduling policy.">opennsl_cosq_gport_sched_set</a>(unit, out_gport, queue, <a class="code" href="group__cosq.html#ga3d93fe9e6d16edf34e962c99b67d5016" title="Strict priority level 0.">OPENNSL_COSQ_SP0</a>, -1);
<a name="l00289"></a>00289   }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00292"></a>00292   {
<a name="l00293"></a>00293     printf(<span class="stringliteral">&quot;Error, in SP set, out_gport $out_gport queue $queue sp_type  $sp_type \n&quot;</span>);
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   <span class="keywordflow">return</span> rv;
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="comment">/* Generic set weight function </span>
<a name="l00301"></a>00301 <span class="comment"> * queue = OPENNSL_COSQ_LOW_PRIORITY</span>
<a name="l00302"></a>00302 <span class="comment"> *         OPENNSL_COSQ_HIGH_PRIORITY</span>
<a name="l00303"></a>00303 <span class="comment"> * uc_mc = 0 for UC</span>
<a name="l00304"></a>00304 <span class="comment"> *         1 for MC </span>
<a name="l00305"></a>00305 <span class="comment"> */</span>
<a name="l00306"></a><a class="code" href="example__cos_8c.html#a88b247921dccafef6412983e5bc509f2">00306</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a88b247921dccafef6412983e5bc509f2">example_set_weight</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> local_port_id, <span class="keywordtype">int</span> queue, <span class="keywordtype">int</span> uc_mc, <span class="keywordtype">int</span> weight)
<a name="l00307"></a>00307 {
<a name="l00308"></a>00308   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00309"></a>00309   <a class="code" href="group__cosq.html#gace58b01f291bf94595c7c5b7fdff4f64" title="cosq gport type eumerations">opennsl_cosq_gport_type_t</a> gport_type;
<a name="l00310"></a>00310   <a class="code" href="structopennsl__cosq__gport__info__s.html" title="gport information related to getting a handle">opennsl_cosq_gport_info_t</a> gport_info;
<a name="l00311"></a>00311   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> out_gport;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313   <span class="comment">/* Set GPORT according to the given local_port_id */</span>
<a name="l00314"></a>00314   <a class="code" href="group__types.html#ga0622ec4146114faa4aab69c4e5265fa6">OPENNSL_GPORT_LOCAL_SET</a>(gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a3cd4116433fb20351cf218dcdf360e34" title="gport to be converted.">in_gport</a>,local_port_id); 
<a name="l00315"></a>00315 
<a name="l00316"></a>00316   <span class="keywordflow">if</span>(uc_mc == 0) 
<a name="l00317"></a>00317   {
<a name="l00318"></a>00318     gport_type = <a class="code" href="group__cosq.html#ggad51a80545c14c96db5287252c43ea6f7a13aff1906b8766ce80522099c1f677bc" title="Unicast Egress Queues - Port hierarchy.">opennslCosqGportTypeUnicastEgress</a>; 
<a name="l00319"></a>00319   } 
<a name="l00320"></a>00320   <span class="keywordflow">else</span> 
<a name="l00321"></a>00321   {
<a name="l00322"></a>00322     gport_type = <a class="code" href="group__cosq.html#ggad51a80545c14c96db5287252c43ea6f7a6ce513fedb8b124253397577a3d33a10" title="Multicast Egress Queues - Port Hierarchy.">opennslCosqGportTypeMulticastEgress</a>; 
<a name="l00323"></a>00323   }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   rv = <a class="code" href="group__cosq.html#ga8a8f4f366747415ac3cc3b92187c7359" title="Getting a gport handle.">opennsl_cosq_gport_handle_get</a>(unit,gport_type,&amp;gport_info);
<a name="l00326"></a>00326   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00327"></a>00327   {
<a name="l00328"></a>00328     printf(<span class="stringliteral">&quot;Error, in handle get, gport_type $gport_type \n&quot;</span>);
<a name="l00329"></a>00329     <span class="keywordflow">return</span> rv;
<a name="l00330"></a>00330   }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332   out_gport = gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a2c79ed194fe6750fdd52e4f55b5b6829" title="retreived gport">out_gport</a>;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334   <span class="comment">/* Set the weight of the designated queue</span>
<a name="l00335"></a>00335 <span class="comment">   * mode = -1 becuase we are setting weight and not strict priority</span>
<a name="l00336"></a>00336 <span class="comment">   */</span>
<a name="l00337"></a>00337   rv = <a class="code" href="group__cosq.html#gacd1f0d8fdaf8138441139ee645270a3c" title="Configure/retrieve scheduling policy.">opennsl_cosq_gport_sched_set</a>(unit, out_gport, queue, -1, weight);
<a name="l00338"></a>00338   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00339"></a>00339   {
<a name="l00340"></a>00340     printf(<span class="stringliteral">&quot;Error, in weight set, out_gport $out_gport queue $queue weight $weight \n&quot;</span>);
<a name="l00341"></a>00341   }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   <span class="keywordflow">return</span> rv;
<a name="l00344"></a>00344 }
<a name="l00345"></a>00345 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="keywordtype">int</span>
<a name="l00348"></a><a class="code" href="example__cos_8c.html#acc782c78cdaa2dcfe743bb1113d29625">00348</a> <a class="code" href="example__cos_8c.html#acc782c78cdaa2dcfe743bb1113d29625">_opennsl_petra_egress_queue_from_cosq</a>(<span class="keywordtype">int</span> unit,
<a name="l00349"></a>00349                                       <span class="keywordtype">int</span> *queue_id,
<a name="l00350"></a>00350                                       <span class="keywordtype">int</span> cosq)
<a name="l00351"></a>00351 {
<a name="l00352"></a>00352   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00353"></a>00353 
<a name="l00354"></a>00354   <span class="keywordflow">switch</span> (cosq) 
<a name="l00355"></a>00355   {
<a name="l00356"></a>00356     <span class="keywordflow">case</span> <a class="code" href="group__cosq.html#ga22d0f6cb4cd8ff714f0485f4f002e100">OPENNSL_COSQ_HIGH_PRIORITY</a>:
<a name="l00357"></a>00357     <span class="keywordflow">case</span> 0:
<a name="l00358"></a>00358         *queue_id = 0;
<a name="l00359"></a>00359         <span class="keywordflow">break</span>;
<a name="l00360"></a>00360     <span class="keywordflow">case</span> <a class="code" href="group__cosq.html#ga5dd7181ebf359ed4ea6d5c9d240c5fee">OPENNSL_COSQ_LOW_PRIORITY</a>:
<a name="l00361"></a>00361     <span class="keywordflow">case</span> 1:
<a name="l00362"></a>00362         *queue_id = 1;
<a name="l00363"></a>00363         <span class="keywordflow">break</span>;
<a name="l00364"></a>00364     <span class="keywordflow">case</span> 2:
<a name="l00365"></a>00365     <span class="keywordflow">case</span> 3:
<a name="l00366"></a>00366     <span class="keywordflow">case</span> 4:
<a name="l00367"></a>00367     <span class="keywordflow">case</span> 5:
<a name="l00368"></a>00368     <span class="keywordflow">case</span> 6:
<a name="l00369"></a>00369     <span class="keywordflow">case</span> 7:
<a name="l00370"></a>00370         *queue_id = cosq;
<a name="l00371"></a>00371         <span class="keywordflow">break</span>;
<a name="l00372"></a>00372   }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="keywordflow">return</span> rv;
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="comment">/* Map incoming UC TC/DP to L/H queue</span>
<a name="l00379"></a>00379 <span class="comment"> *  incoming_tc = 0-7</span>
<a name="l00380"></a>00380 <span class="comment"> *  incoming_dp = 0-3</span>
<a name="l00381"></a>00381 <span class="comment"> *  queue = OPENNSL_COSQ_LOW_PRIORITY</span>
<a name="l00382"></a>00382 <span class="comment"> *          OPENNSL_COSQ_HIGH_PRIORITY</span>
<a name="l00383"></a>00383 <span class="comment"> */</span>
<a name="l00384"></a><a class="code" href="example__cos_8c.html#a945bda4ef03fe124fb261320d9938d8b">00384</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a945bda4ef03fe124fb261320d9938d8b">example_set_uc_queue_mapping</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> local_port_id, <span class="keywordtype">int</span> incoming_tc, <span class="keywordtype">int</span> incoming_dp, <span class="keywordtype">int</span> queue)
<a name="l00385"></a>00385 {
<a name="l00386"></a>00386   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00387"></a>00387   <a class="code" href="group__cosq.html#gace58b01f291bf94595c7c5b7fdff4f64" title="cosq gport type eumerations">opennsl_cosq_gport_type_t</a> gport_type;
<a name="l00388"></a>00388   <a class="code" href="structopennsl__cosq__gport__info__s.html" title="gport information related to getting a handle">opennsl_cosq_gport_info_t</a> gport_info;
<a name="l00389"></a>00389   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> out_gport;
<a name="l00390"></a>00390   <span class="keywordtype">int</span> queue_id;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   <span class="comment">/* Set GPORT according to the given local_port_id */</span>
<a name="l00393"></a>00393   <a class="code" href="group__types.html#ga0622ec4146114faa4aab69c4e5265fa6">OPENNSL_GPORT_LOCAL_SET</a>(gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a3cd4116433fb20351cf218dcdf360e34" title="gport to be converted.">in_gport</a>,local_port_id); 
<a name="l00394"></a>00394 
<a name="l00395"></a>00395   gport_type = <a class="code" href="group__cosq.html#ggad51a80545c14c96db5287252c43ea6f7a13aff1906b8766ce80522099c1f677bc" title="Unicast Egress Queues - Port hierarchy.">opennslCosqGportTypeUnicastEgress</a>; 
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   rv = <a class="code" href="group__cosq.html#ga8a8f4f366747415ac3cc3b92187c7359" title="Getting a gport handle.">opennsl_cosq_gport_handle_get</a>(unit,gport_type,&amp;gport_info);
<a name="l00398"></a>00398   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00399"></a>00399   {
<a name="l00400"></a>00400     printf(<span class="stringliteral">&quot;Error, in handle get, gport_type $gport_type \n&quot;</span>);
<a name="l00401"></a>00401     <span class="keywordflow">return</span> rv;
<a name="l00402"></a>00402   }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404   out_gport = gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a2c79ed194fe6750fdd52e4f55b5b6829" title="retreived gport">out_gport</a>;
<a name="l00405"></a>00405   rv = <a class="code" href="example__cos_8c.html#acc782c78cdaa2dcfe743bb1113d29625">_opennsl_petra_egress_queue_from_cosq</a>(unit,&amp;queue_id,queue);
<a name="l00406"></a>00406   rv = <a class="code" href="group__cosq.html#gabbe9c18f0b9cb8782d17586b1197700d" title="Configure/retrieve {traffic class, dp} mapping to egress queue on a port.">opennsl_cosq_gport_egress_map_set</a>(unit, out_gport, incoming_tc, incoming_dp, queue_id);
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00409"></a>00409   {
<a name="l00410"></a>00410     printf(<span class="stringliteral">&quot;Error, in uc queue mapping, out_gport $out_gport incoming_tc $incoming_tc incoming_dp $incoming_dp queue $queue \n&quot;</span>);
<a name="l00411"></a>00411   }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413   <span class="keywordflow">return</span> rv;
<a name="l00414"></a>00414 }
<a name="l00415"></a>00415 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00416"></a>00416  
<a name="l00417"></a>00417 <span class="comment">/*  Map incoming MC TC/DP to L/H queue</span>
<a name="l00418"></a>00418 <span class="comment"> *  incoming_tc = 0-7</span>
<a name="l00419"></a>00419 <span class="comment"> *  incoming_dp = 0-3</span>
<a name="l00420"></a>00420 <span class="comment"> *  queue = OPENNSL_COSQ_LOW_PRIORITY</span>
<a name="l00421"></a>00421 <span class="comment"> *          OPENNSL_COSQ_HIGH_PRIORITY</span>
<a name="l00422"></a>00422 <span class="comment"> */</span>
<a name="l00423"></a><a class="code" href="example__cos_8c.html#a5930d0e107ce779848804617f136652b">00423</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a5930d0e107ce779848804617f136652b">example_set_mc_queue_mapping</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> local_port_id, <span class="keywordtype">int</span> incoming_tc, <span class="keywordtype">int</span> incoming_dp, <span class="keywordtype">int</span> queue)
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00426"></a>00426   <a class="code" href="group__cosq.html#gace58b01f291bf94595c7c5b7fdff4f64" title="cosq gport type eumerations">opennsl_cosq_gport_type_t</a> gport_type;
<a name="l00427"></a>00427   <a class="code" href="structopennsl__cosq__gport__info__s.html" title="gport information related to getting a handle">opennsl_cosq_gport_info_t</a> gport_info;
<a name="l00428"></a>00428   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> out_gport;
<a name="l00429"></a>00429   <span class="keywordtype">int</span> queue_id;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431   <span class="comment">/* Set GPORT according to the given local_port_id */</span>
<a name="l00432"></a>00432   <a class="code" href="group__types.html#ga0622ec4146114faa4aab69c4e5265fa6">OPENNSL_GPORT_LOCAL_SET</a>(gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a3cd4116433fb20351cf218dcdf360e34" title="gport to be converted.">in_gport</a>,local_port_id); 
<a name="l00433"></a>00433 
<a name="l00434"></a>00434   gport_type = <a class="code" href="group__cosq.html#ggad51a80545c14c96db5287252c43ea6f7ac9aec04f4dd10ab8085c20f3b49137a0" title="Ports in Egress transmit hierarchy.">opennslCosqGportTypeLocalPort</a>; 
<a name="l00435"></a>00435 
<a name="l00436"></a>00436   rv = <a class="code" href="group__cosq.html#ga8a8f4f366747415ac3cc3b92187c7359" title="Getting a gport handle.">opennsl_cosq_gport_handle_get</a>(unit,gport_type,&amp;gport_info);
<a name="l00437"></a>00437   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00438"></a>00438   {
<a name="l00439"></a>00439     printf(<span class="stringliteral">&quot;Error, in handle get, gport_type $gport_type \n&quot;</span>);
<a name="l00440"></a>00440     <span class="keywordflow">return</span> rv;
<a name="l00441"></a>00441   }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443   out_gport = gport_info.<a class="code" href="structopennsl__cosq__gport__info__s.html#a2c79ed194fe6750fdd52e4f55b5b6829" title="retreived gport">out_gport</a>;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445   rv = <a class="code" href="example__cos_8c.html#acc782c78cdaa2dcfe743bb1113d29625">_opennsl_petra_egress_queue_from_cosq</a>(unit,&amp;queue_id,queue);
<a name="l00446"></a>00446   <a class="code" href="structopennsl__cosq__egress__multicast__config__s.html" title="multicast configuration settings">opennsl_cosq_egress_multicast_config_t</a>  multicast_egress_mapping =  { 0, queue_id,-1,-1};
<a name="l00447"></a>00447 
<a name="l00448"></a>00448   rv = <a class="code" href="group__cosq.html#ga0fce837ca3a4fa3e86bd49d14520b4d9" title="Configure/retrieve {traffic class, dp} mapping to multicast egress configuration on a port...">opennsl_cosq_gport_egress_multicast_config_set</a>(unit, out_gport, incoming_tc, incoming_dp, 
<a name="l00449"></a>00449               <a class="code" href="group__cosq.html#ga6d6657b40ed55df72933183dbd92f6ff" title="multicast scheduled values are valid">OPENNSL_COSQ_MULTICAST_SCHEDULED</a>, 
<a name="l00450"></a>00450               &amp;multicast_egress_mapping );
<a name="l00451"></a>00451 
<a name="l00452"></a>00452   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00453"></a>00453   {
<a name="l00454"></a>00454     printf(<span class="stringliteral">&quot;Error, in mc queue mapping, out_gport $out_gport incoming_tc $incoming_tc incoming_dp $incoming_dp queue $queue \n&quot;</span>);
<a name="l00455"></a>00455   }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   <span class="keywordflow">return</span> rv;
<a name="l00458"></a>00458 }
<a name="l00459"></a>00459 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="comment">/* Setup MAC forwading</span>
<a name="l00462"></a>00462 <span class="comment"> * dest_type = 0 for Local Port</span>
<a name="l00463"></a>00463 <span class="comment"> *             1 for MC Group</span>
<a name="l00464"></a>00464 <span class="comment"> */</span>
<a name="l00465"></a><a class="code" href="example__cos_8c.html#af5611df878ea7dfa2f6d27c59cdb57bd">00465</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#af5611df878ea7dfa2f6d27c59cdb57bd">example_setup_mac_forwarding</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac, <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vlan, <span class="keywordtype">int</span> dest_type, <span class="keywordtype">int</span> dest_id)
<a name="l00466"></a>00466 {
<a name="l00467"></a>00467   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00468"></a>00468   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> dest_gport;
<a name="l00469"></a>00469   <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> l2_addr;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471   <a class="code" href="group__l2.html#ga47e819cf5939a8e643ad09505df52071" title="Initialize an L2 address structure to a specified MAC address and VLAN ID.">opennsl_l2_addr_t_init</a>(&amp;l2_addr, mac, vlan);   
<a name="l00472"></a>00472   <span class="comment">/* Create MC or PORT address forwarding */</span>
<a name="l00473"></a>00473   <span class="keywordflow">if</span>(dest_type == 0) 
<a name="l00474"></a>00474   {
<a name="l00475"></a>00475     l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a3c915015c746bbad9799b9a40a51b829" title="OPENNSL_L2_xxx flags.">flags</a> = <a class="code" href="group__l2.html#ga838d2e1cee40e3ae41cd4a59599dd333">OPENNSL_L2_STATIC</a>;
<a name="l00476"></a>00476     <a class="code" href="group__types.html#ga0622ec4146114faa4aab69c4e5265fa6">OPENNSL_GPORT_LOCAL_SET</a>(dest_gport, dest_id);
<a name="l00477"></a>00477     l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a7546884120ba8ab5dce9348fd9bd819f" title="Zero-based port number.">port</a> = dest_gport;
<a name="l00478"></a>00478   } 
<a name="l00479"></a>00479   <span class="keywordflow">else</span> 
<a name="l00480"></a>00480   {
<a name="l00481"></a>00481     l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a3c915015c746bbad9799b9a40a51b829" title="OPENNSL_L2_xxx flags.">flags</a> = <a class="code" href="group__l2.html#ga838d2e1cee40e3ae41cd4a59599dd333">OPENNSL_L2_STATIC</a> | <a class="code" href="group__l2.html#gaff302c3bc44f98cd482238b9360c01bd">OPENNSL_L2_MCAST</a>;
<a name="l00482"></a>00482     l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a51d440393de19ef5a74d851d252f16e6" title="XGS: index in L2MC table.">l2mc_group</a> = dest_id;
<a name="l00483"></a>00483   }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485   rv = <a class="code" href="group__l2.html#ga4b8920c1c3cf4c0c59bf8f0c5890f7c5" title="Add an L2 address entry to the specified device.">opennsl_l2_addr_add</a>(unit,&amp;l2_addr);
<a name="l00486"></a>00486   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00487"></a>00487   {
<a name="l00488"></a>00488     printf(<span class="stringliteral">&quot;Error, in example_setup_mac_forwarding, dest_type $dest_type dest_id $dest_id \n&quot;</span>);
<a name="l00489"></a>00489   }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491   <span class="keywordflow">return</span> rv;
<a name="l00492"></a>00492 }
<a name="l00493"></a>00493 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 <span class="comment">/*  Main function</span>
<a name="l00496"></a>00496 <span class="comment"> *  opennsl_local_port_id = The desiganted port we want to configure</span>
<a name="l00497"></a>00497 <span class="comment"> *  is_tm = 0 for PP Ports</span>
<a name="l00498"></a>00498 <span class="comment"> *          1 for TM ports</span>
<a name="l00499"></a>00499 <span class="comment"> * </span>
<a name="l00500"></a>00500 <span class="comment"> */</span>
<a name="l00501"></a><a class="code" href="example__cos_8c.html#aa83fdaeacee863aec4a2c37dcdf08cf4">00501</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#aa83fdaeacee863aec4a2c37dcdf08cf4">example_egress_transmit_application</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> opennsl_local_port_id, <span class="keywordtype">int</span> is_tm)
<a name="l00502"></a>00502 {
<a name="l00503"></a>00503   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00504"></a>00504   <span class="keywordtype">int</span> tc = 0;
<a name="l00505"></a>00505   <span class="keywordtype">int</span> dp = 0;
<a name="l00506"></a>00506   <span class="keywordtype">int</span> my_modid = 0;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508   <span class="comment">/* Init */</span>
<a name="l00509"></a>00509   printf(<span class="stringliteral">&quot;Starting Egress Transmit Application\n&quot;</span>);
<a name="l00510"></a>00510   rv = <a class="code" href="group__stack.html#gaa8cf2a246337c6adc0238387428dd619" title="Get or set the module ID of the local device.">opennsl_stk_modid_get</a>(unit, &amp;my_modid);
<a name="l00511"></a>00511   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00512"></a>00512   {
<a name="l00513"></a>00513     printf(<span class="stringliteral">&quot;opennsl_stk_my_modid_get failed $rv\n&quot;</span>);
<a name="l00514"></a>00514     <span class="keywordflow">return</span> rv;
<a name="l00515"></a>00515   }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517   <span class="comment">/* Create MC group */</span>
<a name="l00518"></a>00518   printf(<span class="stringliteral">&quot;Setting up Multicast Groups.\n&quot;</span>);
<a name="l00519"></a>00519   <span class="keywordtype">int</span> mc_group_id = 5005;
<a name="l00520"></a>00520   <span class="keywordtype">int</span> cud = 0;
<a name="l00521"></a>00521   <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> mc_group = mc_group_id;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523   <span class="comment">/* We want to overwrite any existing group */</span>
<a name="l00524"></a>00524   <a class="code" href="group__multicast.html#ga27adcadc98215474623759d0d7afb8d2" title="Destroy a multicast group.">opennsl_multicast_destroy</a>(unit, mc_group);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526   <span class="comment">/* Open Egress MC with the designated port as destination and 0 as cud */</span>
<a name="l00527"></a>00527   rv = <a class="code" href="example__cos_8c.html#a8636803c632aebb6238a17262d860c6e">multicast__open_egress_mc_group_with_local_ports</a>(unit, mc_group_id, &amp;opennsl_local_port_id, &amp;cud, 1, 0);
<a name="l00528"></a>00528   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00529"></a>00529 
<a name="l00530"></a>00530   <span class="comment">/* Forwarding Setup, only relevant for PP ports */</span>
<a name="l00531"></a>00531   <span class="keywordflow">if</span>(is_tm == 0) 
<a name="l00532"></a>00532   {
<a name="l00533"></a>00533     printf(<span class="stringliteral">&quot;Setting up MAC Forwarding for PP Ports.\n&quot;</span>);
<a name="l00534"></a>00534     <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> incoming_mac_uc;
<a name="l00535"></a>00535     <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> incoming_mac_mc;
<a name="l00536"></a>00536     incoming_mac_uc[5] = 0x1;
<a name="l00537"></a>00537     <span class="keywordtype">int</span> incoming_vlan_uc = 1;
<a name="l00538"></a>00538     incoming_mac_mc[5] = 0x2;
<a name="l00539"></a>00539     <span class="keywordtype">int</span> incoming_vlan_mc = 1;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     rv = <a class="code" href="example__cos_8c.html#af5611df878ea7dfa2f6d27c59cdb57bd">example_setup_mac_forwarding</a>(unit, incoming_mac_uc, incoming_vlan_uc, 0, opennsl_local_port_id);
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00543"></a>00543     rv = <a class="code" href="example__cos_8c.html#af5611df878ea7dfa2f6d27c59cdb57bd">example_setup_mac_forwarding</a>(unit, incoming_mac_mc, incoming_vlan_mc, 1, mc_group_id);
<a name="l00544"></a>00544     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00545"></a>00545   }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547   <span class="comment">/* Set OFP Bandwidth to 5G */</span>
<a name="l00548"></a>00548   printf(<span class="stringliteral">&quot;Setting Port Bandwidth.\n&quot;</span>);
<a name="l00549"></a>00549   <span class="keywordtype">int</span> max_bandwidth = 5000000; 
<a name="l00550"></a>00550   rv = <a class="code" href="example__cos_8c.html#a0063ad665ec8be522f1a159970039854">example_set_ofp_bandwidth</a>(unit, opennsl_local_port_id, max_bandwidth);
<a name="l00551"></a>00551   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00552"></a>00552 
<a name="l00553"></a>00553   <span class="comment">/* Set Weight for the Low Priority Queues */</span>
<a name="l00554"></a>00554   printf(<span class="stringliteral">&quot;Setting Weight for low priority queues.\n&quot;</span>);
<a name="l00555"></a>00555   <span class="keywordtype">int</span> uc_weight =1;
<a name="l00556"></a>00556   <span class="keywordtype">int</span> mc_weight = 2;
<a name="l00557"></a>00557   rv = <a class="code" href="example__cos_8c.html#a88b247921dccafef6412983e5bc509f2">example_set_weight</a>(unit, opennsl_local_port_id, <a class="code" href="group__cosq.html#ga5dd7181ebf359ed4ea6d5c9d240c5fee">OPENNSL_COSQ_LOW_PRIORITY</a>, 0, uc_weight); 
<a name="l00558"></a>00558   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00559"></a>00559   rv = <a class="code" href="example__cos_8c.html#a88b247921dccafef6412983e5bc509f2">example_set_weight</a>(unit, opennsl_local_port_id, <a class="code" href="group__cosq.html#ga5dd7181ebf359ed4ea6d5c9d240c5fee">OPENNSL_COSQ_LOW_PRIORITY</a>, 1, mc_weight); 
<a name="l00560"></a>00560   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00561"></a>00561 
<a name="l00562"></a>00562   <span class="comment">/* Set UC over MC for the High Priority Queues */</span>
<a name="l00563"></a>00563   printf(<span class="stringliteral">&quot;Setting Strict Priority for high priority queues.\n&quot;</span>);
<a name="l00564"></a>00564   rv = <a class="code" href="example__cos_8c.html#a054b01cf2194f70d5d5165f14bf4ba1d">example_set_sp</a>(unit,opennsl_local_port_id, <a class="code" href="group__cosq.html#ga22d0f6cb4cd8ff714f0485f4f002e100">OPENNSL_COSQ_HIGH_PRIORITY</a>, 0);
<a name="l00565"></a>00565   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00566"></a>00566 
<a name="l00567"></a>00567   <span class="comment">/* Set UC Queue Mapping */</span>
<a name="l00568"></a>00568   printf(<span class="stringliteral">&quot;Setting UC queue mapping.\n&quot;</span>);
<a name="l00569"></a>00569   <span class="keywordflow">for</span> (tc=0; tc &lt;= 3 ; tc++) 
<a name="l00570"></a>00570   { 
<a name="l00571"></a>00571     <span class="keywordflow">for</span>(dp = 0; dp &lt;=3; dp++ ) 
<a name="l00572"></a>00572     {
<a name="l00573"></a>00573       <span class="comment">/* printf(&quot;\t TC $tc DP $dp --&gt; Low Priority.\n&quot;); */</span>
<a name="l00574"></a>00574       rv = <a class="code" href="example__cos_8c.html#a945bda4ef03fe124fb261320d9938d8b">example_set_uc_queue_mapping</a>(unit, opennsl_local_port_id, tc, dp, <a class="code" href="group__cosq.html#ga5dd7181ebf359ed4ea6d5c9d240c5fee">OPENNSL_COSQ_LOW_PRIORITY</a>);
<a name="l00575"></a>00575       <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577   }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   <span class="keywordflow">for</span> (tc=4; tc &lt;= 7 ; tc++) 
<a name="l00580"></a>00580   {
<a name="l00581"></a>00581     <span class="keywordflow">for</span>(dp = 0; dp &lt;=3; dp++ ) 
<a name="l00582"></a>00582     {
<a name="l00583"></a>00583       <span class="comment">/* printf(&quot;\t TC $tc DP $dp --&gt; High Priority.\n&quot;); */</span>
<a name="l00584"></a>00584       rv = <a class="code" href="example__cos_8c.html#a945bda4ef03fe124fb261320d9938d8b">example_set_uc_queue_mapping</a>(unit, opennsl_local_port_id, tc, dp, <a class="code" href="group__cosq.html#ga22d0f6cb4cd8ff714f0485f4f002e100">OPENNSL_COSQ_HIGH_PRIORITY</a>);
<a name="l00585"></a>00585       <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00586"></a>00586     }
<a name="l00587"></a>00587   }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589   <span class="comment">/* Set MC Queue Mapping */</span>
<a name="l00590"></a>00590   printf(<span class="stringliteral">&quot;Setting MC queue mapping.\n&quot;</span>);
<a name="l00591"></a>00591   <span class="keywordflow">for</span> (tc=0; tc &lt;= 5 ; tc++) 
<a name="l00592"></a>00592   {
<a name="l00593"></a>00593     <span class="keywordflow">for</span>(dp = 0; dp &lt;=3; dp++ ) 
<a name="l00594"></a>00594     {
<a name="l00595"></a>00595       <span class="comment">/*printf(&quot;\t TC $tc DP $dp --&gt; Low Priority.\n&quot;); */</span>
<a name="l00596"></a>00596       rv = <a class="code" href="example__cos_8c.html#a5930d0e107ce779848804617f136652b">example_set_mc_queue_mapping</a>(unit, opennsl_local_port_id, tc, dp, <a class="code" href="group__cosq.html#ga5dd7181ebf359ed4ea6d5c9d240c5fee">OPENNSL_COSQ_LOW_PRIORITY</a>);
<a name="l00597"></a>00597       <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599   }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601   <span class="keywordflow">for</span> (tc=6; tc &lt;= 7 ; tc++) 
<a name="l00602"></a>00602   {
<a name="l00603"></a>00603     <span class="keywordflow">for</span>(dp = 0; dp &lt;=3; dp++ ) 
<a name="l00604"></a>00604     {
<a name="l00605"></a>00605       <span class="comment">/* printf(&quot;\t TC $tc DP $dp --&gt; High Priority.\n&quot;); */</span>
<a name="l00606"></a>00606       rv = <a class="code" href="example__cos_8c.html#a5930d0e107ce779848804617f136652b">example_set_mc_queue_mapping</a>(unit, opennsl_local_port_id, tc, dp, <a class="code" href="group__cosq.html#ga22d0f6cb4cd8ff714f0485f4f002e100">OPENNSL_COSQ_HIGH_PRIORITY</a>);
<a name="l00607"></a>00607       <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) <span class="keywordflow">return</span> rv;
<a name="l00608"></a>00608     }
<a name="l00609"></a>00609   }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611   printf(<span class="stringliteral">&quot;Engress Transmit Application Completed Successfully.\n&quot;</span>);
<a name="l00612"></a>00612 
<a name="l00613"></a>00613   <span class="keywordflow">return</span> rv;
<a name="l00614"></a>00614 }
<a name="l00615"></a>00615 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 <span class="comment">/*****************************************************************/</span>
<a name="l00624"></a><a class="code" href="example__cos_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00624</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for policer application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00625"></a>00625 {
<a name="l00626"></a>00626   <span class="keywordtype">int</span> rv = 0;
<a name="l00627"></a>00627   <span class="keywordtype">int</span> unit = <a class="code" href="example__cos_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l00628"></a>00628   <span class="keywordtype">int</span> choice;
<a name="l00629"></a>00629   <span class="keywordtype">int</span> outport;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631   <span class="keywordflow">if</span>((argc != 1) || ((argc &gt; 1) &amp;&amp; (strcmp(argv[1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) 
<a name="l00632"></a>00632   {
<a name="l00633"></a>00633     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00634"></a>00634     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00635"></a>00635   }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637   <span class="comment">/* Initialize the system. */</span>
<a name="l00638"></a>00638   rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00639"></a>00639   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00640"></a>00640   {
<a name="l00641"></a>00641     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system. Error: %s\r\n&quot;</span>,
<a name="l00642"></a>00642            <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00643"></a>00643     <span class="keywordflow">return</span> rv;
<a name="l00644"></a>00644   }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646   <span class="comment">/* cold boot initialization commands */</span>
<a name="l00647"></a>00647   rv = <a class="code" href="examples_2util_8h.html#a2846e8ec8f46d212a3ae2493bdff7980" title="Set default configuration (like STP state, speed/duplex) for all ports.">example_port_default_config</a>(unit);
<a name="l00648"></a>00648   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00649"></a>00649   {
<a name="l00650"></a>00650     printf(<span class="stringliteral">&quot;\r\nFailed to apply default config on ports, rc = %d (%s).\r\n&quot;</span>,
<a name="l00651"></a>00651            rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00652"></a>00652   }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   <span class="comment">/* Add ports to default vlan. */</span>
<a name="l00655"></a>00655   printf(<span class="stringliteral">&quot;Adding ports to default vlan.\r\n&quot;</span>);
<a name="l00656"></a>00656   rv = <a class="code" href="examples_2util_8h.html#a2d14e4de1f4a7192ac7e378f8f7c63ff" title="Add all ports to default vlan.">example_switch_default_vlan_config</a>(unit);
<a name="l00657"></a>00657   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00658"></a>00658   {
<a name="l00659"></a>00659     printf(<span class="stringliteral">&quot;\r\nFailed to add default ports. Error: %s\r\n&quot;</span>,
<a name="l00660"></a>00660         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00661"></a>00661   }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663   <span class="keywordflow">while</span>(1) {
<a name="l00664"></a>00664     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l00665"></a>00665     printf(<span class="stringliteral">&quot;1. Apply CoS mapping to the traffic\n&quot;</span>);
<a name="l00666"></a>00666 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00668"></a>00668 <span class="preprocessor">#endif</span>
<a name="l00669"></a>00669 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application.\r\n&quot;</span>);
<a name="l00670"></a>00670 
<a name="l00671"></a>00671     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00672"></a>00672     {
<a name="l00673"></a>00673       printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00674"></a>00674       <span class="keywordflow">continue</span>;
<a name="l00675"></a>00675     }
<a name="l00676"></a>00676     <span class="keywordflow">switch</span>(choice)
<a name="l00677"></a>00677     {
<a name="l00678"></a>00678       <span class="keywordflow">case</span> 1:
<a name="l00679"></a>00679       {
<a name="l00680"></a>00680         printf(<span class="stringliteral">&quot;Enter the egress port number(belonging to core-0):\n&quot;</span>);
<a name="l00681"></a>00681         <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;outport) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00682"></a>00682         {
<a name="l00683"></a>00683           printf(<span class="stringliteral">&quot;Invalid value entered. Please re-enter.\n&quot;</span>);
<a name="l00684"></a>00684           <span class="keywordflow">continue</span>;
<a name="l00685"></a>00685         }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687         <span class="comment">/* Create CoS mapping to test with traffic */</span>
<a name="l00688"></a>00688         rv = <a class="code" href="example__cos_8c.html#aa83fdaeacee863aec4a2c37dcdf08cf4">example_egress_transmit_application</a>(0, outport, 0);
<a name="l00689"></a>00689         <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) 
<a name="l00690"></a>00690         {
<a name="l00691"></a>00691           printf(<span class="stringliteral">&quot;\r\nFailed to create the CoS mapping. Error: %s\r\n&quot;</span>,
<a name="l00692"></a>00692               <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00693"></a>00693         }  
<a name="l00694"></a>00694 
<a name="l00695"></a>00695         <span class="keywordflow">break</span>;
<a name="l00696"></a>00696       }
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00699"></a>00699 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00700"></a>00700       {
<a name="l00701"></a>00701         opennsl_driver_shell();
<a name="l00702"></a>00702         <span class="keywordflow">break</span>;
<a name="l00703"></a>00703       }
<a name="l00704"></a>00704 <span class="preprocessor">#endif</span>
<a name="l00705"></a>00705 <span class="preprocessor"></span>
<a name="l00706"></a>00706       <span class="keywordflow">case</span> 0:
<a name="l00707"></a>00707       {
<a name="l00708"></a>00708         printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00709"></a>00709         rv = <a class="code" href="driver_8h.html#aa760e8f1af45c7fd27ec014b82c572f2" title="Function to free up the resources and exit the driver.">opennsl_driver_exit</a>();
<a name="l00710"></a>00710         <span class="keywordflow">return</span> rv;
<a name="l00711"></a>00711       }
<a name="l00712"></a>00712       <span class="keywordflow">default</span>:
<a name="l00713"></a>00713       <span class="keywordflow">break</span>;
<a name="l00714"></a>00714     } <span class="comment">/* End of switch */</span>
<a name="l00715"></a>00715   } <span class="comment">/* End of while */</span>
<a name="l00716"></a>00716 
<a name="l00717"></a>00717   <span class="keywordflow">return</span> rv;
<a name="l00718"></a>00718 }
<a name="l00719"></a>00719 <span class="comment">/* __doxy_func_body_end__ */</span>
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016-17 by Broadcom Limited. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Limited reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Limited is believed to be accurate and reliable. However, Broadcom Limited does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
