<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenNSL API Guide and Reference Manual: examples/example_link_monitor.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen_brcm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&nbsp;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&nbsp;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>examples/example_link_monitor.c</h1><a href="example__link__monitor_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2015</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> **********************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * \file         example_link_monitor.c</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief        OpenNSL example application for link monitoring</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \details      Link monitoring can be used to detect uplink failures and</span>
<a name="l00024"></a>00024 <span class="comment"> *               to disable the associated downlink ports such that the</span>
<a name="l00025"></a>00025 <span class="comment"> *               traffic can failover to secondary link.</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> **********************************************************************/</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="link_8h.html">opennsl/link.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="example__link__monitor_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00037</a> <span class="keywordtype">char</span> <a class="code" href="example__bst_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00038"></a>00038 <span class="stringliteral">&quot;Syntax: example_link_monitor uplink_port downlink_ports               \n\r&quot;</span>
<a name="l00039"></a>00039 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00040"></a>00040 <span class="stringliteral">&quot;Paramaters:                                                           \n\r&quot;</span>
<a name="l00041"></a>00041 <span class="stringliteral">&quot;            uplink_port    - Uplink port number to be monitored.      \n\r&quot;</span>
<a name="l00042"></a>00042 <span class="stringliteral">&quot;            downlink_ports - List of ports that follow the link state \n\r&quot;</span>
<a name="l00043"></a>00043 <span class="stringliteral">&quot;                             of uplink port.                          \n\r&quot;</span>
<a name="l00044"></a>00044 <span class="stringliteral">&quot;                             Maximum of 10 ports supported.           \n\r&quot;</span>
<a name="l00045"></a>00045 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00046"></a>00046 <span class="stringliteral">&quot;Example: The following command is used to configure ports 2 and 3     \n\r&quot;</span>
<a name="l00047"></a>00047 <span class="stringliteral">&quot;         to follow the link state of port 1.                          \n\r&quot;</span>
<a name="l00048"></a>00048 <span class="stringliteral">&quot;         example_link_monitor 1 2 3                                   \n\r&quot;</span>
<a name="l00049"></a>00049 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00050"></a>00050 <span class="stringliteral">&quot;Usage Guidelines: This program assumes that software linkscan         \n\r&quot;</span>
<a name="l00051"></a>00051 <span class="stringliteral">&quot;                  is enabled on the system.                           \n\r&quot;</span>;
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="example__link__monitor_8c.html#a91668ed1245d073a2ac84e6121205d28">00053</a> <span class="preprocessor">#define DEFAULT_VLAN             1</span>
<a name="l00054"></a><a class="code" href="example__link__monitor_8c.html#ab744b2981ba1403fa7fd6c668c831254">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define LINKMON_MAX_DOWN_PORTS  10</span>
<a name="l00055"></a><a class="code" href="example__link__monitor_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_UNIT             0</span>
<a name="l00056"></a><a class="code" href="example__link__monitor_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define TRUE                     1</span>
<a name="l00057"></a><a class="code" href="example__link__monitor_8c.html#aa93f0eb578d23995850d61f7d61c55c1">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define FALSE                    0</span>
<a name="l00058"></a><a class="code" href="example__link__monitor_8c.html#a42264337f07aade5b00066b5e9c137cf">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define LINK_MON_ON              1</span>
<a name="l00059"></a><a class="code" href="example__link__monitor_8c.html#a06477652e5c7c918e4ecbbcb1ccac160">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define LINK_MON_OFF             2</span>
<a name="l00060"></a><a class="code" href="example__link__monitor_8c.html#a068278b0838b6670ab0ab0a93ed77484">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_DIGITS_IN_CHOICE     5</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a><a class="code" href="example__link__monitor_8c.html#af85a62c4ebcfbfa8b7e1646b9751e826">00062</a> <span class="keywordtype">int</span> <a class="code" href="example__link__monitor_8c.html#af85a62c4ebcfbfa8b7e1646b9751e826">uport</a> = -1;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">/* List of downlink ports that follow the link state of uplink ports */</span>
<a name="l00065"></a><a class="code" href="example__link__monitor_8c.html#a093e6588ccebeb3bc5396e05f251d838">00065</a> <span class="keywordtype">int</span> <a class="code" href="example__link__monitor_8c.html#a093e6588ccebeb3bc5396e05f251d838">dport</a>[<a class="code" href="example__link__monitor_8c.html#ab744b2981ba1403fa7fd6c668c831254">LINKMON_MAX_DOWN_PORTS</a>];
<a name="l00066"></a><a class="code" href="example__link__monitor_8c.html#a5470994bf34bf2f34b1a634e21d53b67">00066</a> <span class="keywordtype">int</span> <a class="code" href="example__link__monitor_8c.html#a5470994bf34bf2f34b1a634e21d53b67">dport_cnt</a>;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="comment">/* debug prints */</span>
<a name="l00069"></a><a class="code" href="example__link__monitor_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">00069</a> <span class="keywordtype">int</span> <a class="code" href="example__field__ip__block_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = 2;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="keyword">static</span> <span class="keywordtype">void</span> example_link_change_callback(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> port,
<a name="l00072"></a>00072     <a class="code" href="structopennsl__port__info__s.html" title="opennsl_port_info_s">opennsl_port_info_t</a> *info);
<a name="l00073"></a>00073 <span class="keyword">static</span> <span class="keywordtype">int</span> example_link_monitor(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> mode);
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">/*****************************************************************/</span>
<a name="l00082"></a><a class="code" href="example__link__monitor_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00082</a> <span class="keywordtype">int</span> <a class="code" href="example__bst_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for bst sample application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00083"></a>00083 {
<a name="l00084"></a>00084   <span class="keywordtype">int</span> rv = 0;
<a name="l00085"></a>00085   <span class="keywordtype">int</span> i;
<a name="l00086"></a>00086   <span class="keywordtype">int</span> choice;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   <span class="comment">/* Throw command usage here. This program excepts at least one</span>
<a name="l00089"></a>00089 <span class="comment">  down port from the user. */</span>
<a name="l00090"></a>00090   <span class="keywordflow">if</span>((argc &lt; 3) ||
<a name="l00091"></a>00091       ((argc &gt; 1) &amp;&amp; (strcmp(argv[1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) {
<a name="l00092"></a>00092     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__bst_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00093"></a>00093     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00094"></a>00094   }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096   <span class="keywordflow">if</span>(argc &gt; (2 + <a class="code" href="example__link__monitor_8c.html#ab744b2981ba1403fa7fd6c668c831254">LINKMON_MAX_DOWN_PORTS</a>)) {
<a name="l00097"></a>00097     printf(<span class="stringliteral">&quot;Invalid number of arguments passed. Please see example help.\n\r&quot;</span>);
<a name="l00098"></a>00098     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00099"></a>00099   }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="comment">/* Extract input parameters */</span>
<a name="l00102"></a>00102   <a class="code" href="example__link__monitor_8c.html#af85a62c4ebcfbfa8b7e1646b9751e826">uport</a> = atoi(argv[1]);
<a name="l00103"></a>00103   <span class="keywordflow">for</span>(i = 2, <a class="code" href="example__link__monitor_8c.html#a5470994bf34bf2f34b1a634e21d53b67">dport_cnt</a> = 0; i &lt; argc; i++) {
<a name="l00104"></a>00104     <a class="code" href="example__link__monitor_8c.html#a093e6588ccebeb3bc5396e05f251d838">dport</a>[<a class="code" href="example__link__monitor_8c.html#a5470994bf34bf2f34b1a634e21d53b67">dport_cnt</a>++] = atoi(argv[i]);
<a name="l00105"></a>00105   }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="keywordflow">if</span>(<a class="code" href="example__field__ip__block_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt; 1) {
<a name="l00108"></a>00108     printf(<span class="stringliteral">&quot;Uplink Port     : %d\n\r&quot;</span>, <a class="code" href="example__link__monitor_8c.html#af85a62c4ebcfbfa8b7e1646b9751e826">uport</a>);
<a name="l00109"></a>00109     printf(<span class="stringliteral">&quot;Downlink Ports  : &quot;</span>);
<a name="l00110"></a>00110     <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="example__link__monitor_8c.html#a5470994bf34bf2f34b1a634e21d53b67">dport_cnt</a>; i++) {
<a name="l00111"></a>00111       printf(<span class="stringliteral">&quot;%2d &quot;</span>, <a class="code" href="example__link__monitor_8c.html#a093e6588ccebeb3bc5396e05f251d838">dport</a>[i]);
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113     printf(<span class="stringliteral">&quot;\n\r&quot;</span>);
<a name="l00114"></a>00114   }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116   <span class="comment">/* Initialize the system */</span>
<a name="l00117"></a>00117   rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00118"></a>00118   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00119"></a>00119     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system. Error %s \n\r&quot;</span>,
<a name="l00120"></a>00120            <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00121"></a>00121     <span class="keywordflow">return</span> rv;
<a name="l00122"></a>00122   }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124   <span class="comment">/* Setup link monitoring */</span>
<a name="l00125"></a>00125   rv = example_link_monitor(<a class="code" href="example__bst_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>, <a class="code" href="example__link__monitor_8c.html#a42264337f07aade5b00066b5e9c137cf">LINK_MON_ON</a>);
<a name="l00126"></a>00126   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00127"></a>00127     printf(<span class="stringliteral">&quot;\r\nFailed to set link monitor mode. Error: %s.\n\r&quot;</span>,
<a name="l00128"></a>00128         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00129"></a>00129   }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131   printf(<span class="stringliteral">&quot;\r\nLink monitoring is enabled successfully.\n\r&quot;</span>);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133   <span class="keywordflow">while</span>(1) {
<a name="l00134"></a>00134     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l00135"></a>00135     printf(<span class="stringliteral">&quot;1. Enable the link monitoring mode.\r\n&quot;</span>);
<a name="l00136"></a>00136     printf(<span class="stringliteral">&quot;2. Disable the link monitoring mode.\r\n&quot;</span>);
<a name="l00137"></a>00137 <span class="preprocessor">#ifndef CDP_EXCLUDE</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00139"></a>00139 <span class="preprocessor">#endif</span>
<a name="l00140"></a>00140 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application.\r\n&quot;</span>);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00143"></a>00143     {
<a name="l00144"></a>00144         printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00145"></a>00145         <span class="keywordflow">continue</span>;
<a name="l00146"></a>00146     }
<a name="l00147"></a>00147     <span class="keywordflow">switch</span>(choice)
<a name="l00148"></a>00148     {
<a name="l00149"></a>00149       <span class="keywordflow">case</span> 1:
<a name="l00150"></a>00150       {
<a name="l00151"></a>00151         rv = example_link_monitor(<a class="code" href="example__bst_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>, <a class="code" href="example__link__monitor_8c.html#a42264337f07aade5b00066b5e9c137cf">LINK_MON_ON</a>);
<a name="l00152"></a>00152         <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00153"></a>00153           printf(<span class="stringliteral">&quot;\r\nFailed to enable link monitor mode. Error: %s.\n\r&quot;</span>,
<a name="l00154"></a>00154               <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00155"></a>00155         }
<a name="l00156"></a>00156         <span class="keywordflow">break</span>;
<a name="l00157"></a>00157       }
<a name="l00158"></a>00158       <span class="keywordflow">case</span> 2:
<a name="l00159"></a>00159       {
<a name="l00160"></a>00160         rv = example_link_monitor(<a class="code" href="example__bst_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>, <a class="code" href="example__link__monitor_8c.html#a06477652e5c7c918e4ecbbcb1ccac160">LINK_MON_OFF</a>);
<a name="l00161"></a>00161         <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00162"></a>00162           printf(<span class="stringliteral">&quot;\r\nFailed to disable link monitor mode. Error: %s.\n\r&quot;</span>,
<a name="l00163"></a>00163               <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165         <span class="keywordflow">break</span>;
<a name="l00166"></a>00166       }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 <span class="preprocessor">#ifndef CDP_EXCLUDE</span>
<a name="l00169"></a>00169 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00170"></a>00170       {
<a name="l00171"></a>00171         <a class="code" href="driver_8h.html#ae2cb0180311015b4ac70e67fea713438" title="Bringup diagnostic shell prompt and process the input commands.">opennsl_driver_shell</a>();
<a name="l00172"></a>00172         <span class="keywordflow">break</span>;
<a name="l00173"></a>00173       }
<a name="l00174"></a>00174 <span class="preprocessor">#endif</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>
<a name="l00176"></a>00176       <span class="keywordflow">case</span> 0:
<a name="l00177"></a>00177       {
<a name="l00178"></a>00178         printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00179"></a>00179         <span class="keywordflow">return</span> 0;
<a name="l00180"></a>00180       }
<a name="l00181"></a>00181       <span class="keywordflow">default</span>:
<a name="l00182"></a>00182         <span class="keywordflow">break</span>;
<a name="l00183"></a>00183     } <span class="comment">/* End of switch */</span>
<a name="l00184"></a>00184   } <span class="comment">/* End of while */</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186   <span class="keywordflow">return</span> rv;
<a name="l00187"></a>00187 }
<a name="l00188"></a>00188 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="comment">/**************************************************************************/</span>
<a name="l00200"></a>00200 <span class="keywordtype">int</span> example_link_monitor(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> mode) {
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="keywordflow">if</span>((mode != <a class="code" href="example__link__monitor_8c.html#a42264337f07aade5b00066b5e9c137cf">LINK_MON_ON</a>) &amp;&amp; (mode != <a class="code" href="example__link__monitor_8c.html#a06477652e5c7c918e4ecbbcb1ccac160">LINK_MON_OFF</a>)) {
<a name="l00203"></a>00203     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   <span class="keywordflow">if</span> (mode == <a class="code" href="example__link__monitor_8c.html#a42264337f07aade5b00066b5e9c137cf">LINK_MON_ON</a>) {
<a name="l00207"></a>00207 
<a name="l00210"></a>00210     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__link.html#gaf7f45f2780d6f1965cf9874b0b0e6228" title="Register and unregister link notification callouts.">opennsl_linkscan_register</a>(unit,
<a name="l00211"></a>00211           example_link_change_callback));
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   } <span class="keywordflow">else</span> {
<a name="l00214"></a>00214 
<a name="l00216"></a>00216     <a class="code" href="group__error.html#gaa1ed0c76c2846d4d337b3157ff73c823">OPENNSL_IF_ERROR_RETURN</a>(<a class="code" href="group__link.html#ga0ad9802d5638d6f480026e40c8b79fba" title="Register and unregister link notification callouts.">opennsl_linkscan_unregister</a>(unit,
<a name="l00217"></a>00217           example_link_change_callback));
<a name="l00218"></a>00218 
<a name="l00219"></a>00219   }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221   printf(<span class="stringliteral">&quot;Link Monitor mode is %s.\n&quot;</span>, (mode == <a class="code" href="example__link__monitor_8c.html#a42264337f07aade5b00066b5e9c137cf">LINK_MON_ON</a>) ? <span class="stringliteral">&quot;enabled&quot;</span> : <span class="stringliteral">&quot;disabled&quot;</span>);
<a name="l00222"></a>00222   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">/**************************************************************************/</span>
<a name="l00236"></a>00236 <span class="keyword">static</span> <span class="keywordtype">void</span> example_link_change_callback(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#gacaeba2b4ddbc89b0e556720a9388885f" title="Set the default tag protocol ID (TPID) for the specified port.">opennsl_port_t</a> port,
<a name="l00237"></a>00237                                          <a class="code" href="structopennsl__port__info__s.html" title="opennsl_port_info_s">opennsl_port_info_t</a> *info)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239   <span class="keywordtype">int</span> mode = <a class="code" href="sal_2types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00240"></a>00240   <span class="keywordtype">int</span> i;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   <span class="keywordflow">if</span>(<a class="code" href="example__field__ip__block_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt; 2) {
<a name="l00243"></a>00243     printf(<span class="stringliteral">&quot;Link on port %2d changed to %4s\n&quot;</span>, port,
<a name="l00244"></a>00244         info-&gt;<a class="code" href="structopennsl__port__info__s.html#a1bdfe49d046429f5da890f12ebc496c2">linkstatus</a> ? <span class="stringliteral">&quot;UP&quot;</span> : <span class="stringliteral">&quot;DOWN&quot;</span>);
<a name="l00245"></a>00245   }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247   <span class="comment">/* Ignore if the link change is not on the uplink port */</span>
<a name="l00248"></a>00248   <span class="keywordflow">if</span>(port != <a class="code" href="example__link__monitor_8c.html#af85a62c4ebcfbfa8b7e1646b9751e826">uport</a>) {
<a name="l00249"></a>00249     <span class="keywordflow">return</span>;
<a name="l00250"></a>00250   }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   <span class="keywordflow">if</span>(info-&gt;<a class="code" href="structopennsl__port__info__s.html#a1bdfe49d046429f5da890f12ebc496c2">linkstatus</a>) {
<a name="l00253"></a>00253     mode = <a class="code" href="sal_2types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00254"></a>00254   }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256   printf(<span class="stringliteral">&quot;Uplink port %2d link state transitioned to %4s.\n\r&quot;</span>, port,
<a name="l00257"></a>00257       (info-&gt;<a class="code" href="structopennsl__port__info__s.html#a1bdfe49d046429f5da890f12ebc496c2">linkstatus</a>) ? <span class="stringliteral">&quot;UP&quot;</span> : <span class="stringliteral">&quot;DOWN&quot;</span>);
<a name="l00258"></a>00258 
<a name="l00259"></a>00259   <span class="comment">/* Update the link status on the downlink ports as per the latest</span>
<a name="l00260"></a>00260 <span class="comment">   * uplink port link state.</span>
<a name="l00261"></a>00261 <span class="comment">   */</span>
<a name="l00262"></a>00262   <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="example__link__monitor_8c.html#a5470994bf34bf2f34b1a634e21d53b67">dport_cnt</a>; i++) {
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     <span class="keywordflow">if</span>(<a class="code" href="group__port.html#ga32f9447af46f31f2f29c0b65b826f426" title="Enable or disable a port.">opennsl_port_enable_set</a>(unit, <a class="code" href="example__link__monitor_8c.html#a093e6588ccebeb3bc5396e05f251d838">dport</a>[i], mode) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00265"></a>00265       printf(<span class="stringliteral">&quot;Failed to %s port %2d.\n&quot;</span>, (mode == <a class="code" href="sal_2types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)? <span class="stringliteral">&quot;enable&quot;</span> : <span class="stringliteral">&quot;disable&quot;</span>,
<a name="l00266"></a>00266           <a class="code" href="example__link__monitor_8c.html#a093e6588ccebeb3bc5396e05f251d838">dport</a>[i]);
<a name="l00267"></a>00267     }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269     printf(<span class="stringliteral">&quot;%s port %2d.\n&quot;</span>, (mode == <a class="code" href="sal_2types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) ? <span class="stringliteral">&quot;Enabled&quot;</span> : <span class="stringliteral">&quot;Disabled&quot;</span>, <a class="code" href="example__link__monitor_8c.html#a093e6588ccebeb3bc5396e05f251d838">dport</a>[i]);
<a name="l00270"></a>00270   }
<a name="l00271"></a>00271 }
<a name="l00272"></a>00272 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00273"></a>00273 
</pre></div></div>
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2015 by Broadcom Corporation. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Corporation reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Corporation is believed to be accurate and reliable. However, Broadcom Corporation does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->



<!--BEGIN !GENERATE_TREEVIEW-->
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
