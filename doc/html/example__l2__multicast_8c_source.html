<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/dpp/example_l2_multicast.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/dpp/example_l2_multicast.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="example__l2__multicast_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2017</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> **********************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * \file         example_l2_multicast.c</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief        OpenNSL example application for Layer 2 multicast</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \details      This application allows the user to</span>
<a name="l00024"></a>00024 <span class="comment"> *               1) Create multicast group</span>
<a name="l00025"></a>00025 <span class="comment"> *               2) Add a port to multicast group</span>
<a name="l00026"></a>00026 <span class="comment"> *               3) Remove a port from multicast group</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> **********************************************************************/</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="l2_8h.html">opennsl/l2.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="multicast_8h.html">opennsl/multicast.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="example__l2__multicast_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00038</a> <span class="preprocessor">#define DEFAULT_UNIT 0</span>
<a name="l00039"></a><a class="code" href="example__l2__multicast_8c.html#a91668ed1245d073a2ac84e6121205d28">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_VLAN 1</span>
<a name="l00040"></a><a class="code" href="example__l2__multicast_8c.html#a8329bdabf3ab2159b68809bb7e4885c4">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define MCAST_GROUP_ID  10</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a><a class="code" href="example__l2__multicast_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00042</a> <span class="keywordtype">char</span> <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00043"></a>00043 <span class="stringliteral">&quot;Syntax: example_l2_multicast                                          \n\r&quot;</span>
<a name="l00044"></a>00044 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00045"></a>00045 <span class="stringliteral">&quot;Paramaters: None                                                      \n\r&quot;</span>
<a name="l00046"></a>00046 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00047"></a>00047 <span class="stringliteral">&quot;Example: The following command is used to create a multicast group    \n\r&quot;</span>
<a name="l00048"></a>00048 <span class="stringliteral">&quot;         and add or delete multicast members.                         \n\r&quot;</span>
<a name="l00049"></a>00049 <span class="stringliteral">&quot;         example_l2_multicast                                         \n\r&quot;</span>
<a name="l00050"></a>00050 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00051"></a>00051 <span class="stringliteral">&quot;Usage Guidelines: This program request the user to enter the following\n\r&quot;</span>
<a name="l00052"></a>00052 <span class="stringliteral">&quot;                  parameters interactively                            \n\r&quot;</span>
<a name="l00053"></a>00053 <span class="stringliteral">&quot;       MAC address - Multicast group MAC address                      \n\r&quot;</span>
<a name="l00054"></a>00054 <span class="stringliteral">&quot;       port        - Multicast group port members                     \n\r&quot;</span>
<a name="l00055"></a>00055 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00056"></a>00056 <span class="stringliteral">&quot;       Testing:                                                       \n\r&quot;</span>
<a name="l00057"></a>00057 <span class="stringliteral">&quot;       1) Add ports to the multicast group and verify that traffic    \n\r&quot;</span>
<a name="l00058"></a>00058 <span class="stringliteral">&quot;          destined to Multicast MAC address is received by all        \n\r&quot;</span>
<a name="l00059"></a>00059 <span class="stringliteral">&quot;          multicast group members.                                    \n\r&quot;</span>
<a name="l00060"></a>00060 <span class="stringliteral">&quot;       2) Remove a port from the multicast group and verify that      \n\r&quot;</span>
<a name="l00061"></a>00061 <span class="stringliteral">&quot;          traffic destined to Multicast MAC address is not received   \n\r&quot;</span>
<a name="l00062"></a>00062 <span class="stringliteral">&quot;          by removed multicast group member.                          \n\r&quot;</span>
<a name="l00063"></a>00063 <span class="stringliteral">&quot;       3) Verify that traffic to unknown unicast MAC address is       \n\r&quot;</span>
<a name="l00064"></a>00064 <span class="stringliteral">&quot;          received by all ports in the VLAN.                          \n\r&quot;</span>
<a name="l00065"></a>00065 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">/**************************************************************************/</span>
<a name="l00079"></a><a class="code" href="example__l2__multicast_8c.html#a0a999aa42213209ac3935f40356611f6">00079</a> <span class="keywordtype">int</span> <a class="code" href="example__l2__multicast_8c.html#a0a999aa42213209ac3935f40356611f6" title="To add an FDB entry.">example_l2_entry_add</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac, <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vlan,
<a name="l00080"></a>00080     <span class="keywordtype">int</span> is_mc, <span class="keywordtype">int</span> dest_gport, <span class="keywordtype">int</span> dest_mcg)
<a name="l00081"></a>00081 {
<a name="l00082"></a>00082   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00083"></a>00083   <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> l2_addr;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085   <a class="code" href="group__l2.html#ga47e819cf5939a8e643ad09505df52071" title="Initialize an L2 address structure to a specified MAC address and VLAN ID.">opennsl_l2_addr_t_init</a>(&amp;l2_addr, mac, vlan);
<a name="l00086"></a>00086   <span class="keywordflow">if</span>(is_mc == 1) {
<a name="l00087"></a>00087     <span class="comment">/* add multicast entry */</span>
<a name="l00088"></a>00088     l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a3c915015c746bbad9799b9a40a51b829" title="OPENNSL_L2_xxx flags.">flags</a> = <a class="code" href="group__l2.html#ga838d2e1cee40e3ae41cd4a59599dd333">OPENNSL_L2_STATIC</a> | <a class="code" href="group__l2.html#gaff302c3bc44f98cd482238b9360c01bd">OPENNSL_L2_MCAST</a>;
<a name="l00089"></a>00089     l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a51d440393de19ef5a74d851d252f16e6" title="XGS: index in L2MC table.">l2mc_group</a> = dest_mcg;
<a name="l00090"></a>00090   } <span class="keywordflow">else</span> {
<a name="l00091"></a>00091     <span class="comment">/* add static entry */</span>
<a name="l00092"></a>00092     l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a3c915015c746bbad9799b9a40a51b829" title="OPENNSL_L2_xxx flags.">flags</a> = <a class="code" href="group__l2.html#ga838d2e1cee40e3ae41cd4a59599dd333">OPENNSL_L2_STATIC</a>;
<a name="l00093"></a>00093     l2_addr.<a class="code" href="structopennsl__l2__addr__s.html#a7546884120ba8ab5dce9348fd9bd819f" title="Zero-based port number.">port</a> = dest_gport;
<a name="l00094"></a>00094   }
<a name="l00095"></a>00095   rv = <a class="code" href="group__l2.html#ga4b8920c1c3cf4c0c59bf8f0c5890f7c5" title="Add an L2 address entry to the specified device.">opennsl_l2_addr_add</a>(unit,&amp;l2_addr);
<a name="l00096"></a>00096   <span class="keywordflow">return</span> rv;
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="comment">/**************************************************************************/</span>
<a name="l00109"></a><a class="code" href="example__l2__multicast_8c.html#a0f80c22ad6f74e8923467cc2e54ae3b3">00109</a> <span class="keywordtype">int</span> <a class="code" href="example__l2__multicast_8c.html#a0f80c22ad6f74e8923467cc2e54ae3b3" title="To create multicast group.">example_multicast_create</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> mcg, <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a8b5659941298c6f209a80a5bb61b6bf7">egress_mc</a>)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111   <span class="keywordtype">int</span> rv = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00112"></a>00112   <span class="keywordtype">int</span> flags;
<a name="l00113"></a>00113   <a class="code" href="group__types.html#ga50bad717e3851cb2dd6acaac4d2a2f1b" title="opennsl_multicast_t">opennsl_multicast_t</a> mc_group = mcg;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115   flags = <a class="code" href="group__multicast.html#gaf2991b6d0bfbd56d66953868e6c099be">OPENNSL_MULTICAST_WITH_ID</a> | <a class="code" href="group__multicast.html#gaa76a6dd0b85d5ddc43cea2c36df48b4e">OPENNSL_MULTICAST_TYPE_L2</a>;
<a name="l00116"></a>00116   <span class="keywordflow">if</span> (egress_mc)
<a name="l00117"></a>00117   {
<a name="l00118"></a>00118     flags |= <a class="code" href="group__multicast.html#ga9d5471deb377bb1324e0b77f04319250">OPENNSL_MULTICAST_EGRESS_GROUP</a>;
<a name="l00119"></a>00119   }
<a name="l00120"></a>00120   <span class="keywordflow">else</span>
<a name="l00121"></a>00121   {
<a name="l00122"></a>00122     flags |= <a class="code" href="group__multicast.html#gaae730f6ddddbdef6db10444bc9e5a657">OPENNSL_MULTICAST_INGRESS_GROUP</a>;
<a name="l00123"></a>00123   }
<a name="l00124"></a>00124   rv = <a class="code" href="group__multicast.html#ga9134d19d090cf0b13f883abc1edf606c" title="Create a multicast group for packet replication.">opennsl_multicast_create</a>(unit, flags, &amp;mc_group);
<a name="l00125"></a>00125   <span class="keywordflow">return</span> rv;
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="comment">/*****************************************************************/</span>
<a name="l00136"></a><a class="code" href="example__l2__multicast_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00136</a> <span class="keywordtype">int</span> <a class="code" href="example__cos_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for policer application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138   <span class="keywordtype">int</span> rv = 0;
<a name="l00139"></a>00139   <span class="keywordtype">int</span> choice;
<a name="l00140"></a>00140   <span class="keywordtype">int</span> unit = <a class="code" href="example__l2__multicast_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l00141"></a>00141   <span class="keywordtype">int</span> <a class="code" href="opennsl__api_8dox.html#abd1fe5382f13606db566da3450b351b0">port</a>;
<a name="l00142"></a>00142   <span class="keywordtype">int</span> mcg = <a class="code" href="example__l2__multicast_8c.html#a8329bdabf3ab2159b68809bb7e4885c4">MCAST_GROUP_ID</a>;
<a name="l00143"></a>00143   <span class="keywordtype">int</span> encap_id = <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00144"></a>00144   <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> gport;
<a name="l00145"></a>00145   <span class="keywordtype">char</span> macstr[18];
<a name="l00146"></a>00146   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac;
<a name="l00147"></a>00147   <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vlan = <a class="code" href="example__l2__multicast_8c.html#a91668ed1245d073a2ac84e6121205d28">DEFAULT_VLAN</a>;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149   <span class="keywordflow">if</span>((argc != 1) || ((argc &gt; 1) &amp;&amp; (strcmp(argv[1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) {
<a name="l00150"></a>00150     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__cos_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00151"></a>00151     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00152"></a>00152   }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154   <span class="comment">/* Initialize the system. */</span>
<a name="l00155"></a>00155   rv = <a class="code" href="driver_8h.html#a06a6fe41f5ea8664c461423d3cad0923" title="Function to initialize the switch.">opennsl_driver_init</a>((<a class="code" href="structopennsl__config__s.html">opennsl_init_t</a> *) <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00158"></a>00158     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system. Error: %s\r\n&quot;</span>,
<a name="l00159"></a>00159            <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00160"></a>00160     <span class="keywordflow">return</span> rv;
<a name="l00161"></a>00161   }
<a name="l00162"></a>00162 
<a name="l00163"></a>00163   rv = <a class="code" href="examples_2util_8h.html#a2846e8ec8f46d212a3ae2493bdff7980" title="Set default configuration (like STP state, speed/duplex) for all ports.">example_port_default_config</a>(unit);
<a name="l00164"></a>00164   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00165"></a>00165     printf(<span class="stringliteral">&quot;\r\nFailed to apply default config on ports, rc = %d (%s).\r\n&quot;</span>,
<a name="l00166"></a>00166            rv, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00167"></a>00167   }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   <span class="comment">/* Add ports to default vlan. */</span>
<a name="l00170"></a>00170   printf(<span class="stringliteral">&quot;Adding ports to default vlan.\r\n&quot;</span>);
<a name="l00171"></a>00171   rv = <a class="code" href="examples_2util_8h.html#a2d14e4de1f4a7192ac7e378f8f7c63ff" title="Add all ports to default vlan.">example_switch_default_vlan_config</a>(unit);
<a name="l00172"></a>00172   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00173"></a>00173     printf(<span class="stringliteral">&quot;\r\nFailed to add default ports. Error: %s\r\n&quot;</span>,
<a name="l00174"></a>00174         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00175"></a>00175   }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177   <span class="keywordflow">if</span>(<a class="code" href="example__l2__multicast_8c.html#a0f80c22ad6f74e8923467cc2e54ae3b3" title="To create multicast group.">example_multicast_create</a>(unit, mcg, 0) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00178"></a>00178   {
<a name="l00179"></a>00179     printf(<span class="stringliteral">&quot;\r\nFailed to create multicast group. Error: %s\r\n&quot;</span>,
<a name="l00180"></a>00180         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00181"></a>00181     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5acc22c36dedd5356dfbbf50d38397cca5">OPENNSL_E_FAIL</a>;
<a name="l00182"></a>00182   }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   printf(<span class="stringliteral">&quot;Enter multicast MAC address in xx:xx:xx:xx:xx:xx format &quot;</span>
<a name="l00185"></a>00185       <span class="stringliteral">&quot;(Ex: 01:00:00:01:02:03): \n&quot;</span>);
<a name="l00186"></a>00186   <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#aaaf82384f15fd6b2295de85ad6529ecc" title="Read a string from user.">example_read_user_string</a>(macstr, <span class="keyword">sizeof</span>(macstr)) == NULL)
<a name="l00187"></a>00187   {
<a name="l00188"></a>00188     printf(<span class="stringliteral">&quot;\n\rInvalid MAC address entered.\n\r&quot;</span>);
<a name="l00189"></a>00189     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5acc22c36dedd5356dfbbf50d38397cca5">OPENNSL_E_FAIL</a>;
<a name="l00190"></a>00190   }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192   <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#abdc906039b3b47e6213585346a0ad1e6" title="Parse MAC address string.">opennsl_mac_parse</a>(macstr, mac) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00193"></a>00193   {
<a name="l00194"></a>00194     printf(<span class="stringliteral">&quot;\n\rFailed to parse input MAC address.\n\r&quot;</span>);
<a name="l00195"></a>00195     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5acc22c36dedd5356dfbbf50d38397cca5">OPENNSL_E_FAIL</a>;
<a name="l00196"></a>00196   }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   rv = <a class="code" href="example__l2__multicast_8c.html#a0a999aa42213209ac3935f40356611f6" title="To add an FDB entry.">example_l2_entry_add</a>(unit, mac, vlan, 1, 0, mcg);
<a name="l00199"></a>00199   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00200"></a>00200   {
<a name="l00201"></a>00201     printf(<span class="stringliteral">&quot;\n\rFailed to update FDB with multicast MAC address. &quot;</span>
<a name="l00202"></a>00202         <span class="stringliteral">&quot;Error: %s\n\r&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00203"></a>00203     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5acc22c36dedd5356dfbbf50d38397cca5">OPENNSL_E_FAIL</a>;
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   <span class="keywordflow">while</span>(1) {
<a name="l00207"></a>00207     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l00208"></a>00208     printf(<span class="stringliteral">&quot;1. Add port to multicast group\n&quot;</span>);
<a name="l00209"></a>00209     printf(<span class="stringliteral">&quot;2. Remove port from multicast group\n&quot;</span>);
<a name="l00210"></a>00210 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00211"></a>00211 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00212"></a>00212 <span class="preprocessor">#endif</span>
<a name="l00213"></a>00213 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application.\r\n&quot;</span>);
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00216"></a>00216     {
<a name="l00217"></a>00217       printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00218"></a>00218       <span class="keywordflow">continue</span>;
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <span class="keywordflow">switch</span>(choice)
<a name="l00222"></a>00222     {
<a name="l00223"></a>00223       <span class="keywordflow">case</span> 1:
<a name="l00224"></a>00224       {
<a name="l00225"></a>00225         printf(<span class="stringliteral">&quot;Enter multicast group member port number: \n&quot;</span>);
<a name="l00226"></a>00226         <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;port) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00227"></a>00227         {
<a name="l00228"></a>00228           printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00229"></a>00229           <span class="keywordflow">continue</span>;
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         <span class="keywordflow">if</span>(encap_id == NULL)
<a name="l00233"></a>00233         {
<a name="l00234"></a>00234           rv = <a class="code" href="group__multicast.html#ga891eb8710a78b0a1621d3e3c4636e76d" title="Get the multicast encapsulation ID for L2 replication.">opennsl_multicast_l2_encap_get</a>(0, mcg, 3, vlan, &amp;encap_id);
<a name="l00235"></a>00235           <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00236"></a>00236           {
<a name="l00237"></a>00237             printf(<span class="stringliteral">&quot;Failed to get encapsulation ID, Error: %d\r\n&quot;</span>,
<a name="l00238"></a>00238                 <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00239"></a>00239             <span class="keywordflow">return</span> rv;
<a name="l00240"></a>00240           }
<a name="l00241"></a>00241         }
<a name="l00242"></a>00242         <a class="code" href="group__types.html#ga0622ec4146114faa4aab69c4e5265fa6">OPENNSL_GPORT_LOCAL_SET</a>(gport, port);
<a name="l00243"></a>00243         rv = <a class="code" href="group__multicast.html#gafa55f761fe7a9b6026267234c3fd7057" title="Add a port to a Ingress Multicast group&#39;s replication list.">opennsl_multicast_ingress_add</a>(0, mcg, gport, encap_id);
<a name="l00244"></a>00244         <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a> &amp;&amp; rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5ad03e135eecd46c9c1280e7b3f6ab5b6a">OPENNSL_E_EXISTS</a>)
<a name="l00245"></a>00245         {
<a name="l00246"></a>00246           printf(<span class="stringliteral">&quot;\r\nFailed to add the port to multicast group. &quot;</span>
<a name="l00247"></a>00247               <span class="stringliteral">&quot;Error: %s\r\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249         <span class="keywordflow">else</span>
<a name="l00250"></a>00250         {
<a name="l00251"></a>00251           printf(<span class="stringliteral">&quot;Port %d is added to Multicast group successfully\n&quot;</span>, port);
<a name="l00252"></a>00252         }
<a name="l00253"></a>00253         <span class="keywordflow">break</span>;
<a name="l00254"></a>00254       }
<a name="l00255"></a>00255       <span class="keywordflow">case</span> 2:
<a name="l00256"></a>00256       {
<a name="l00257"></a>00257         printf(<span class="stringliteral">&quot;Enter multicast group member port number: \n&quot;</span>);
<a name="l00258"></a>00258         <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;port) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00259"></a>00259         {
<a name="l00260"></a>00260           printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00261"></a>00261           <span class="keywordflow">continue</span>;
<a name="l00262"></a>00262         }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264         <a class="code" href="group__types.html#ga0622ec4146114faa4aab69c4e5265fa6">OPENNSL_GPORT_LOCAL_SET</a>(gport, port);
<a name="l00265"></a>00265         rv = <a class="code" href="group__multicast.html#gae92827d7cece3e754a4886ba15e3c5b4" title="Delete a port from Ingress Multicast group&#39;s replication list.">opennsl_multicast_ingress_delete</a>(0, mcg, gport, encap_id);
<a name="l00266"></a>00266         <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a> &amp;&amp; rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a90445f03d34051de0c90acfd955ef178">OPENNSL_E_NOT_FOUND</a>)
<a name="l00267"></a>00267         {
<a name="l00268"></a>00268           printf(<span class="stringliteral">&quot;\r\nFailed to remove the port from multicast group. &quot;</span>
<a name="l00269"></a>00269               <span class="stringliteral">&quot;Error: %s\r\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271         <span class="keywordflow">else</span>
<a name="l00272"></a>00272         {
<a name="l00273"></a>00273           printf(<span class="stringliteral">&quot;Port %d is removed from Multicast group &quot;</span>
<a name="l00274"></a>00274               <span class="stringliteral">&quot;successfully\n&quot;</span>, port);
<a name="l00275"></a>00275         }
<a name="l00276"></a>00276         <span class="keywordflow">break</span>;
<a name="l00277"></a>00277       }
<a name="l00278"></a>00278 <span class="preprocessor">#ifdef INCLUDE_DIAG_SHELL</span>
<a name="l00279"></a>00279 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00280"></a>00280       {
<a name="l00281"></a>00281         opennsl_driver_shell();
<a name="l00282"></a>00282         <span class="keywordflow">break</span>;
<a name="l00283"></a>00283       }
<a name="l00284"></a>00284 <span class="preprocessor">#endif</span>
<a name="l00285"></a>00285 <span class="preprocessor"></span>
<a name="l00286"></a>00286       <span class="keywordflow">case</span> 0:
<a name="l00287"></a>00287       {
<a name="l00288"></a>00288         printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00289"></a>00289         rv = <a class="code" href="driver_8h.html#aa760e8f1af45c7fd27ec014b82c572f2" title="Function to free up the resources and exit the driver.">opennsl_driver_exit</a>();
<a name="l00290"></a>00290         <span class="keywordflow">return</span> rv;
<a name="l00291"></a>00291       }
<a name="l00292"></a>00292       <span class="keywordflow">default</span>:
<a name="l00293"></a>00293       <span class="keywordflow">break</span>;
<a name="l00294"></a>00294     } <span class="comment">/* End of switch */</span>
<a name="l00295"></a>00295   }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297   <span class="keywordflow">return</span> rv;
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00300"></a>00300 
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2016-17 by Broadcom Limited. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Limited reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Limited is believed to be accurate and reliable. However, Broadcom Limited does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
